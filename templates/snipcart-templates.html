<!-- 
  Templates Snipcart Personnalisés - Thème D&D GeeknDragon
  =========================================================
  Ces templates remplacent l'interface par défaut de Snipcart
  avec notre esthétique médiévale/fantasy immersive.
-->

<!-- Template du panier principal -->
<script type="text/template" id="snipcart-layout">
  <div class="snipcart-layout gd-medieval-layout">
    <!-- Header avec logo et titre personnalisé -->
    <header class="snipcart-layout__header gd-cart-header">
      <div class="gd-header-content">
        <div class="gd-cart-logo">
          <img src="/images/brand-geekndragon-white.webp" alt="Geek&Dragon" class="gd-logo-small">
        </div>
        <h2 class="snipcart-layout__header-title gd-medieval-title">
          🎒 Sac d'Aventurier
        </h2>
        <button class="snipcart-layout__close gd-close-btn" aria-label="Fermer">
          <span class="gd-close-icon">✕</span>
        </button>
      </div>
      
      <!-- Barre de progression de commande -->
      <div class="gd-quest-progress">
        <div class="gd-progress-step" data-step="cart">
          <span class="gd-step-icon">🎒</span>
          <span class="gd-step-label">Équipement</span>
        </div>
        <div class="gd-progress-step" data-step="customer">
          <span class="gd-step-icon">⚔️</span>
          <span class="gd-step-label">Aventurier</span>
        </div>
        <div class="gd-progress-step" data-step="shipping">
          <span class="gd-step-icon">🚚</span>
          <span class="gd-step-label">Livraison</span>
        </div>
        <div class="gd-progress-step" data-step="payment">
          <span class="gd-step-icon">💰</span>
          <span class="gd-step-label">Trésor</span>
        </div>
      </div>
    </header>

    <!-- Contenu principal -->
    <div class="snipcart-layout__content gd-cart-content">
      <div class="snipcart-layout__body">
        <!-- Zone de contenu dynamique -->
        <div bind-event-click="layout.handleContentClick">
          {{{ content }}}
        </div>
      </div>
    </div>

    <!-- Footer avec informations -->
    <footer class="snipcart-layout__footer gd-cart-footer">
      <div class="gd-footer-content">
        <div class="gd-security-badges">
          <span class="gd-badge">🔒 Paiement Sécurisé</span>
          <span class="gd-badge">🛡️ Données Protégées</span>
        </div>
        <div class="gd-made-in">
          <img src="/images/logo-fabrique-BqFMdtDT.png" alt="Fabriqué au Québec" class="gd-quebec-badge">
          <span>Fabriqué au Québec</span>
        </div>
      </div>
    </footer>
  </div>
</script>

<!-- Template d'un article dans le panier -->
<script type="text/template" id="snipcart-item">
  <article class="snipcart-item gd-cart-item" data-item-id="{{ item.id }}">
    <div class="gd-item-content">
      <!-- Image du produit -->
      <div class="gd-item-image">
        {{#if item.image}}
          <img src="{{ item.image }}" alt="{{ item.name }}" class="gd-product-thumb">
        {{else}}
          <div class="gd-placeholder-image">
            <span class="gd-placeholder-icon">⚔️</span>
          </div>
        {{/if}}
      </div>

      <!-- Informations du produit -->
      <div class="gd-item-details">
        <h3 class="snipcart-item__name gd-item-name">{{ item.name }}</h3>
        
        {{#if item.description}}
          <p class="gd-item-description">{{ item.description }}</p>
        {{/if}}

        <!-- Variantes sélectionnées -->
        {{#if item.customFields}}
          <div class="gd-item-variants">
            {{#each item.customFields}}
              <span class="gd-variant">
                <strong>{{name}}:</strong> {{value}}
              </span>
            {{/each}}
          </div>
        {{/if}}

        <!-- Prix unitaire -->
        <div class="gd-item-pricing">
          <span class="snipcart-item__price gd-unit-price">
            {{ item.price }}$ CAD
          </span>
          {{#if item.originalPrice}}
            <span class="gd-original-price">{{ item.originalPrice }}$ CAD</span>
          {{/if}}
        </div>
      </div>

      <!-- Contrôles de quantité -->
      <div class="gd-item-controls">
        <div class="snipcart-item__quantity gd-quantity-controls">
          <button class="snipcart-item__quantity-decrease gd-qty-btn" 
                  aria-label="Diminuer la quantité">
            <span class="gd-qty-icon">−</span>
          </button>
          
          <input class="snipcart-item__quantity-input gd-qty-input" 
                 type="number" 
                 value="{{ item.quantity }}" 
                 min="1"
                 aria-label="Quantité">
          
          <button class="snipcart-item__quantity-increase gd-qty-btn" 
                  aria-label="Augmenter la quantité">
            <span class="gd-qty-icon">+</span>
          </button>
        </div>

        <!-- Prix total de la ligne -->
        <div class="gd-line-total">
          <span class="snipcart-item__total-price gd-total-price">
            {{ item.totalPrice }}$ CAD
          </span>
        </div>

        <!-- Bouton de suppression -->
        <button class="snipcart-item__remove gd-remove-btn" 
                aria-label="Retirer cet article">
          <span class="gd-remove-icon">🗑️</span>
        </button>
      </div>
    </div>
  </article>
</script>

<!-- Template du récapitulatif du panier -->
<script type="text/template" id="snipcart-cart-summary">
  <div class="snipcart-cart-summary gd-cart-summary">
    <div class="gd-summary-scroll">
      <h3 class="snipcart-cart-summary__title gd-summary-title">
        💰 Récapitulatif du Trésor
      </h3>

      <!-- Détails des coûts -->
      <div class="gd-cost-breakdown">
        <!-- Sous-total -->
        <div class="gd-cost-line">
          <span class="gd-cost-label">Sous-total des articles</span>
          <span class="gd-cost-value">{{ cart.subtotal }}$ CAD</span>
        </div>

        <!-- Frais de livraison -->
        {{#if cart.shippingInformation}}
          <div class="gd-cost-line">
            <span class="gd-cost-label">
              📦 {{ cart.shippingInformation.name }}
            </span>
            <span class="gd-cost-value">
              {{#if cart.shippingInformation.cost}}
                {{ cart.shippingInformation.cost }}$ CAD
              {{else}}
                Gratuit
              {{/if}}
            </span>
          </div>
        {{/if}}

        <!-- Taxes -->
        {{#if cart.taxesTotal}}
          <div class="gd-cost-line">
            <span class="gd-cost-label">Taxes</span>
            <span class="gd-cost-value">{{ cart.taxesTotal }}$ CAD</span>
          </div>
        {{/if}}

        <!-- Code promo -->
        {{#if cart.discounts}}
          {{#each cart.discounts}}
            <div class="gd-cost-line gd-discount">
              <span class="gd-cost-label">
                🎯 {{ name }}
              </span>
              <span class="gd-cost-value gd-discount-amount">
                -{{ amount }}$ CAD
              </span>
            </div>
          {{/each}}
        {{/if}}
      </div>

      <!-- Total final -->
      <div class="gd-total-section">
        <div class="gd-total-line">
          <span class="gd-total-label">Total de votre Trésor</span>
          <span class="snipcart-cart-summary__total gd-final-total">
            {{ cart.total }}$ CAD
          </span>
        </div>
      </div>

      <!-- Actions -->
      <div class="gd-cart-actions">
        <button class="snipcart-button-primary gd-checkout-btn">
          ⚔️ Finaliser ma Quête
        </button>
        
        <button class="snipcart-button-secondary gd-continue-btn">
          🛒 Continuer mes Achats
        </button>
      </div>

      <!-- Message motivant -->
      <div class="gd-motivation-message">
        {{#if cart.isEmpty}}
          <p class="gd-empty-message">
            🎒 Votre sac d'aventurier est vide...<br>
            <em>Partez équipé pour votre prochaine quête !</em>
          </p>
        {{else}}
          <p class="gd-ready-message">
            ⚔️ Vous êtes prêt pour l'aventure !<br>
            <em>Finalisez votre équipement héroïque.</em>
          </p>
        {{/if}}
      </div>
    </div>
  </div>
</script>

<!-- Template du formulaire de checkout -->
<script type="text/template" id="snipcart-checkout">
  <div class="snipcart-checkout gd-checkout">
    <div class="gd-checkout-header">
      <h2 class="gd-checkout-title">
        🏰 Finaliser votre Commande Héroïque
      </h2>
      <p class="gd-checkout-subtitle">
        Quelques détails pour livrer votre trésor en toute sécurité
      </p>
    </div>

    <div class="gd-checkout-content">
      <!-- Étapes du checkout -->
      <div class="gd-checkout-steps">
        <div class="gd-step {{#if isCustomerStep}}active{{/if}}">
          <div class="gd-step-header">
            <span class="gd-step-number">1</span>
            <h3>⚔️ Informations d'Aventurier</h3>
          </div>
        </div>

        <div class="gd-step {{#if isShippingStep}}active{{/if}}">
          <div class="gd-step-header">
            <span class="gd-step-number">2</span>
            <h3>📦 Livraison du Trésor</h3>
          </div>
        </div>

        <div class="gd-step {{#if isBillingStep}}active{{/if}}">
          <div class="gd-step-header">
            <span class="gd-step-number">3</span>
            <h3>💳 Paiement Sécurisé</h3>
          </div>
        </div>
      </div>

      <!-- Contenu du formulaire -->
      <div class="gd-form-content">
        {{{ content }}}
      </div>
    </div>

    <!-- Résumé de commande sticky -->
    <div class="gd-order-summary">
      <h4 class="gd-summary-header">📋 Votre Équipement</h4>
      <div class="gd-summary-items">
        {{#each cart.items}}
          <div class="gd-summary-item">
            <span class="gd-item-name">{{ name }}</span>
            <span class="gd-item-qty">× {{ quantity }}</span>
            <span class="gd-item-price">{{ totalPrice }}$ CAD</span>
          </div>
        {{/each}}
      </div>
      
      <div class="gd-summary-total">
        <strong>Total: {{ cart.total }}$ CAD</strong>
      </div>
    </div>
  </div>
</script>

<!-- Template de confirmation de commande -->
<script type="text/template" id="snipcart-order-confirmation">
  <div class="snipcart-order-confirmation gd-confirmation">
    <div class="gd-confirmation-hero">
      <div class="gd-success-icon">
        🎉
      </div>
      <h2 class="gd-confirmation-title">
        Félicitations, Aventurier !
      </h2>
      <p class="gd-confirmation-subtitle">
        Votre quête d'équipement s'est achevée avec succès !
      </p>
    </div>

    <div class="gd-order-details">
      <div class="gd-order-info">
        <h3>📋 Détails de votre Commande</h3>
        <div class="gd-info-grid">
          <div class="gd-info-item">
            <label>Numéro de Quête:</label>
            <strong>{{ order.invoiceNumber }}</strong>
          </div>
          
          <div class="gd-info-item">
            <label>Email de contact:</label>
            <strong>{{ order.email }}</strong>
          </div>
          
          <div class="gd-info-item">
            <label>Total payé:</label>
            <strong>{{ order.finalGrandTotal }}$ CAD</strong>
          </div>
          
          {{#if order.shippingInformation}}
            <div class="gd-info-item">
              <label>Livraison:</label>
              <strong>{{ order.shippingInformation.name }}</strong>
            </div>
          {{/if}}
        </div>
      </div>

      <!-- Articles commandés -->
      <div class="gd-ordered-items">
        <h3>⚔️ Votre Équipement Héroïque</h3>
        <div class="gd-items-list">
          {{#each order.items}}
            <div class="gd-ordered-item">
              <div class="gd-item-details">
                <h4>{{ name }}</h4>
                {{#if description}}
                  <p>{{ description }}</p>
                {{/if}}
                <div class="gd-item-specs">
                  <span>Quantité: {{ quantity }}</span>
                  <span>Prix: {{ price }}$ CAD</span>
                </div>
              </div>
              <div class="gd-item-total">
                <strong>{{ totalPrice }}$ CAD</strong>
              </div>
            </div>
          {{/each}}
        </div>
      </div>

      <!-- Prochaines étapes -->
      <div class="gd-next-steps">
        <h3>📬 Prochaines Étapes</h3>
        <div class="gd-steps-list">
          <div class="gd-step-item">
            <span class="gd-step-icon">📧</span>
            <div class="gd-step-content">
              <strong>Confirmation par email</strong>
              <p>Vous recevrez un email de confirmation avec tous les détails</p>
            </div>
          </div>
          
          <div class="gd-step-item">
            <span class="gd-step-icon">📦</span>
            <div class="gd-step-content">
              <strong>Préparation de commande</strong>
              <p>Nos artisans préparent votre équipement avec soin</p>
            </div>
          </div>
          
          <div class="gd-step-item">
            <span class="gd-step-icon">🚚</span>
            <div class="gd-step-content">
              <strong>Expédition</strong>
              <p>Vous recevrez un numéro de suivi une fois expédié</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Actions finales -->
      <div class="gd-final-actions">
        <a href="/boutique.html" class="gd-btn-primary">
          🛒 Continuer mes Achats
        </a>
        
        <a href="/contact.html" class="gd-btn-secondary">
          💬 Nous Contacter
        </a>
      </div>
    </div>

    <!-- Message de remerciement -->
    <div class="gd-thank-you">
      <p>
        <strong>Merci de faire confiance à Geek&Dragon !</strong><br>
        Que vos aventures soient légendaires ! ⚔️🐉
      </p>
    </div>
  </div>
</script>

<!-- CSS pour les templates -->
<style>
/* Styles spécifiques aux templates Snipcart GeeknDragon */
.gd-medieval-layout {
  font-family: 'Cinzel', serif !important;
}

.gd-cart-header {
  background: linear-gradient(135deg, var(--primary-color, #8b4513) 0%, var(--primary-dark, #654321) 100%);
  border-bottom: 3px solid var(--secondary-color, #d4af37);
  padding: 20px;
}

.gd-header-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
}

.gd-logo-small {
  height: 40px;
}

.gd-medieval-title {
  color: var(--parchment, #f4e4bc);
  font-weight: 700;
  font-size: 1.8rem;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
  margin: 0;
}

.gd-close-btn {
  background: none;
  border: 2px solid var(--secondary-color, #d4af37);
  color: var(--secondary-color, #d4af37);
  border-radius: 50%;
  width: 40px;
  height: 40px;
  cursor: pointer;
  font-size: 1.2rem;
  transition: all 0.3s ease;
}

.gd-close-btn:hover {
  background: var(--secondary-color, #d4af37);
  color: var(--primary-color, #8b4513);
  transform: scale(1.1);
}

.gd-quest-progress {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 15px;
}

.gd-progress-step {
  display: flex;
  flex-direction: column;
  align-items: center;
  opacity: 0.5;
  transition: all 0.3s ease;
}

.gd-progress-step.active {
  opacity: 1;
  transform: scale(1.1);
}

.gd-step-icon {
  font-size: 1.5rem;
  margin-bottom: 5px;
}

.gd-step-label {
  font-size: 0.8rem;
  color: var(--parchment, #f4e4bc);
}

.gd-cart-item {
  background: var(--card-bg, rgba(26,26,26,0.95));
  border: 1px solid rgba(212, 175, 55, 0.3);
  border-radius: 12px;
  padding: 20px;
  margin: 15px 0;
  transition: all 0.3s ease;
}

.gd-cart-item:hover {
  border-color: var(--secondary-color, #d4af37);
  box-shadow: 0 6px 20px rgba(212, 175, 55, 0.2);
}

.gd-item-content {
  display: grid;
  grid-template-columns: 80px 1fr auto;
  gap: 15px;
  align-items: start;
}

.gd-item-image img,
.gd-placeholder-image {
  width: 80px;
  height: 80px;
  border-radius: 8px;
  object-fit: cover;
}

.gd-placeholder-image {
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--primary-color, #8b4513);
  color: var(--parchment, #f4e4bc);
  font-size: 1.5rem;
}

.gd-item-name {
  font-weight: 600;
  color: var(--secondary-color, #d4af37);
  margin-bottom: 8px;
}

.gd-item-description {
  font-size: 0.9rem;
  color: var(--light-text, #ffffff);
  opacity: 0.8;
  margin-bottom: 10px;
}

.gd-quantity-controls {
  display: flex;
  align-items: center;
  gap: 5px;
  background: rgba(0,0,0,0.3);
  border-radius: 8px;
  padding: 5px;
}

.gd-qty-btn {
  width: 30px;
  height: 30px;
  border: 1px solid var(--secondary-color, #d4af37);
  background: transparent;
  color: var(--secondary-color, #d4af37);
  border-radius: 4px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.gd-qty-input {
  width: 50px;
  text-align: center;
  background: transparent;
  border: 1px solid rgba(212, 175, 55, 0.3);
  color: var(--light-text, #ffffff);
  border-radius: 4px;
  padding: 5px;
}

.gd-total-price {
  font-weight: 700;
  color: var(--secondary-color, #d4af37);
  font-size: 1.1rem;
}

.gd-remove-btn {
  background: none;
  border: none;
  color: var(--dragon-red, #dc143c);
  cursor: pointer;
  font-size: 1.2rem;
  padding: 5px;
  border-radius: 4px;
  transition: all 0.3s ease;
}

.gd-remove-btn:hover {
  background: rgba(220, 20, 60, 0.2);
  transform: scale(1.2);
}

/* Responsive */
@media (max-width: 768px) {
  .gd-item-content {
    grid-template-columns: 1fr;
    gap: 12px;
  }
  
  .gd-header-content {
    flex-direction: column;
    gap: 15px;
    text-align: center;
  }
  
  .gd-quest-progress {
    gap: 15px;
  }
  
  .gd-step-label {
    font-size: 0.7rem;
  }
}
</style>