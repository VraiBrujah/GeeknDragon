<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi Construction Maison - Québec</title>
    
    <!-- CSS Framework -->
    <link rel="stylesheet" href="vendor/bulma.min.css">
    <link rel="stylesheet" href="vendor/flatpickr.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar is-dark" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item">
                <i class="fas fa-home mr-2"></i>
                <strong>Construction Maison Québec</strong>
            </a>
            <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarMenu">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>

        <div id="navbarMenu" class="navbar-menu">
            <div class="navbar-start">
                <a class="navbar-item is-active" data-page="dashboard">
                    <i class="fas fa-chart-line mr-2"></i> Tableau de bord
                </a>
                <a class="navbar-item" data-page="artisans">
                    <i class="fas fa-hard-hat mr-2"></i> Artisans
                </a>
                <a class="navbar-item" data-page="pointage">
                    <i class="fas fa-clock mr-2"></i> Pointage
                </a>
                <a class="navbar-item" data-page="materiaux">
                    <i class="fas fa-boxes mr-2"></i> Matériaux
                </a>
                <a class="navbar-item" data-page="paiements">
                    <i class="fas fa-money-check mr-2"></i> Paiements
                </a>
                <a class="navbar-item" data-page="rapports">
                    <i class="fas fa-file-pdf mr-2"></i> Rapports
                </a>
                <a class="navbar-item" data-page="configuration">
                    <i class="fas fa-cog mr-2"></i> Configuration
                </a>
            </div>
            <div class="navbar-end">
                <div class="navbar-item">
                    <div class="buttons">
                        <button class="button is-primary" id="btnBackup">
                            <i class="fas fa-download"></i>
                            <span class="ml-2">Backup</span>
                        </button>
                        <button class="button is-info" id="btnRestore">
                            <i class="fas fa-upload"></i>
                            <span class="ml-2">Restore</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Content Container -->
    <div id="app" class="container is-fluid mt-4">
        <!-- Dashboard Page -->
        <div id="dashboard" class="page">
            <h1 class="title">
                <i class="fas fa-chart-line"></i> Tableau de bord
            </h1>
            
            <!-- KPIs Row -->
            <div class="columns is-multiline">
                <div class="column is-3">
                    <div class="box has-background-dark">
                        <p class="heading has-text-grey-light">Coût Total Maison</p>
                        <p class="title has-text-warning" id="kpiCoutTotal">0.00 $</p>
                    </div>
                </div>
                <div class="column is-3">
                    <div class="box has-background-dark">
                        <p class="heading has-text-grey-light">Main-d'œuvre</p>
                        <p class="title has-text-info" id="kpiMainOeuvre">0.00 $</p>
                    </div>
                </div>
                <div class="column is-3">
                    <div class="box has-background-dark">
                        <p class="heading has-text-grey-light">Matériaux</p>
                        <p class="title has-text-primary" id="kpiMateriaux">0.00 $</p>
                    </div>
                </div>
                <div class="column is-3">
                    <div class="box has-background-dark">
                        <p class="heading has-text-grey-light">Solde Dû Total</p>
                        <p class="title has-text-danger" id="kpiSoldeDu">0.00 $</p>
                    </div>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="box has-background-dark">
                <p class="heading has-text-grey-light">Avancement Global</p>
                <progress class="progress is-success is-large" id="progressGlobal" value="0" max="100">0%</progress>
                <p class="has-text-centered has-text-weight-bold" id="progressText">0%</p>
            </div>

            <!-- Charts Row -->
            <div class="columns">
                <div class="column is-6">
                    <div class="box has-background-dark">
                        <h2 class="subtitle has-text-white">Répartition des coûts</h2>
                        <canvas id="chartRepartition"></canvas>
                    </div>
                </div>
                <div class="column is-6">
                    <div class="box has-background-dark">
                        <h2 class="subtitle has-text-white">Budget vs Réel</h2>
                        <canvas id="chartBudget"></canvas>
                    </div>
                </div>
            </div>

            <!-- Recent Activities -->
            <div class="box has-background-dark">
                <h2 class="subtitle has-text-white">
                    <i class="fas fa-history"></i> Activités récentes
                </h2>
                <div id="recentActivities" class="content has-text-grey-light">
                    <!-- Activities will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Artisans Page -->
        <div id="artisans" class="page" style="display: none;">
            <div class="level">
                <div class="level-left">
                    <h1 class="title">
                        <i class="fas fa-hard-hat"></i> Gestion des Artisans
                    </h1>
                </div>
                <div class="level-right">
                    <button class="button is-success" id="btnAddArtisan">
                        <i class="fas fa-plus"></i>
                        <span class="ml-2">Ajouter un artisan</span>
                    </button>
                </div>
            </div>

            <div class="box has-background-dark">
                <div class="table-container">
                    <table class="table is-fullwidth is-dark">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Spécialité</th>
                                <th>Taux horaire</th>
                                <th>Statut</th>
                                <th>Téléphone</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="artisansTableBody">
                            <!-- Artisans will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Pointage Page -->
        <div id="pointage" class="page" style="display: none;">
            <h1 class="title">
                <i class="fas fa-clock"></i> Pointage Quotidien
            </h1>

            <div class="columns">
                <div class="column is-4">
                    <div class="box has-background-dark">
                        <div class="level mb-4">
                            <div class="level-left">
                                <h2 class="subtitle has-text-white mb-0">Nouveau Pointage</h2>
                            </div>
                            <div class="level-right">
                                <button type="button" class="button is-small is-info" onclick="app.refreshArtisansList()">
                                    <i class="fas fa-sync"></i>
                                    <span class="ml-1">Actualiser</span>
                                </button>
                            </div>
                        </div>
                        <form id="formPointage">
                            <div class="field">
                                <label class="label has-text-white">Date</label>
                                <div class="control">
                                    <input type="text" id="pointageDate" name="pointageDate" class="input" placeholder="Sélectionner une date" required>
                                </div>
                            </div>
                            <div class="field">
                                <label class="label has-text-white">Artisan</label>
                                <div class="control">
                                    <div class="select is-fullwidth">
                                        <select id="pointageArtisan" name="pointageArtisan" required>
                                            <option value="">Sélectionner un artisan</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="field">
                                <label class="label has-text-white">Heure début</label>
                                <div class="control">
                                    <input type="time" id="pointageDebut" name="pointageDebut" class="input" required>
                                </div>
                            </div>
                            <div class="field">
                                <label class="label has-text-white">Heure fin</label>
                                <div class="control">
                                    <input type="time" id="pointageFin" name="pointageFin" class="input" required>
                                </div>
                            </div>
                            <div class="field">
                                <label class="label has-text-white">Temps de pause (minutes)</label>
                                <div class="control">
                                    <input type="number" id="pointagePause" name="pointagePause" class="input" value="0" min="0" required>
                                </div>
                            </div>
                            <div class="field">
                                <label class="label has-text-white">Type de travaux</label>
                                <div class="control">
                                    <input type="text" id="pointageTypeTravaux" name="pointageTypeTravaux" class="input" placeholder="Ex: Installation charpente" required>
                                </div>
                            </div>
                            <div class="field">
                                <label class="label has-text-white">Étape maison</label>
                                <div class="control">
                                    <div class="select is-fullwidth">
                                        <select id="pointageEtape" name="pointageEtape" required>
                                            <option value="">Sélectionner une étape</option>
                                            <option value="Excavation et Fondation">Excavation et Fondation</option>
                                            <option value="Charpente et Structure">Charpente et Structure</option>
                                            <option value="Couverture et Étanchéité">Couverture et Étanchéité</option>
                                            <option value="Électricité et Plomberie">Électricité et Plomberie</option>
                                            <option value="Isolation et Pare-vapeur">Isolation et Pare-vapeur</option>
                                            <option value="Gypse et Finition Intérieure">Gypse et Finition Intérieure</option>
                                            <option value="Revêtements Extérieurs">Revêtements Extérieurs</option>
                                            <option value="Finition et Nettoyage">Finition et Nettoyage</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="field">
                                <label class="label has-text-white">Notes</label>
                                <div class="control">
                                    <textarea id="pointageNotes" name="pointageNotes" class="textarea" placeholder="Notes sur l'avancement..."></textarea>
                                </div>
                            </div>
                            <div class="field">
                                <label class="label has-text-white">Photos progression</label>
                                <div class="control">
                                    <input type="file" id="pointagePhotos" name="pointagePhotos" class="input" accept="image/*" multiple>
                                </div>
                                <p class="help has-text-grey-light">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Vous pouvez sélectionner plusieurs images (Ctrl+clic ou Cmd+clic)
                                </p>
                            </div>
                            <div class="field">
                                <div class="control">
                                    <button type="submit" class="button is-success is-fullwidth">
                                        <i class="fas fa-save"></i>
                                        <span class="ml-2">Enregistrer le pointage</span>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="column is-8">
                    <div class="box has-background-dark">
                        <h2 class="subtitle has-text-white">Pointages récents</h2>
                        <div id="pointagesRecents">
                            <!-- Recent pointages will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Calendrier historique des pointages -->
                    <div class="box has-background-dark mt-5">
                        <div class="level mb-4">
                            <div class="level-left">
                                <h2 class="subtitle has-text-white mb-0">
                                    <i class="fas fa-calendar-alt mr-2"></i>Historique des pointages
                                </h2>
                            </div>
                            <div class="level-right">
                                <div class="field has-addons">
                                    <div class="control">
                                        <input type="month" id="calendrierMois" class="input is-small" 
                                               onchange="app.chargerPointagesMois(this.value)">
                                    </div>
                                    <div class="control">
                                        <button class="button is-small is-info" onclick="app.chargerPointagesMois(document.getElementById('calendrierMois').value)">
                                            <i class="fas fa-search"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="calendrierPointages">
                            <!-- Calendar view will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Matériaux Page -->
        <div id="materiaux" class="page" style="display: none;">
            <div class="level">
                <div class="level-left">
                    <h1 class="title">
                        <i class="fas fa-boxes"></i> Factures Matériaux
                    </h1>
                </div>
                <div class="level-right">
                    <button class="button is-success" id="btnAddFacture">
                        <i class="fas fa-plus"></i>
                        <span class="ml-2">Ajouter une facture</span>
                    </button>
                </div>
            </div>

            <div class="box has-background-dark">
                <div class="table-container">
                    <table class="table is-fullwidth is-dark">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Fournisseur</th>
                                <th>Catégorie</th>
                                <th>Montant HT</th>
                                <th>TPS</th>
                                <th>TVQ</th>
                                <th>Total TTC</th>
                                <th>Payée</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="facturesTableBody">
                            <!-- Factures will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Paiements Page -->
        <div id="paiements" class="page" style="display: none;">
            <h1 class="title">
                <i class="fas fa-money-check"></i> Gestion des Paiements
            </h1>

            <!-- Section Soldes dus aux artisans -->
            <div class="box has-background-dark mb-5">
                <h2 class="subtitle has-text-white">
                    <i class="fas fa-exclamation-triangle has-text-warning"></i> Soldes dus aux artisans
                </h2>
                <div id="soldesDusArtisans">
                    <!-- Soldes dus will be loaded here -->
                </div>
            </div>

            <div class="columns">
                <div class="column is-6">
                    <div class="box has-background-dark">
                        <h2 class="subtitle has-text-white">
                            <i class="fas fa-hard-hat"></i> Historique Paiements Main-d'œuvre
                        </h2>
                        <button class="button is-primary is-fullwidth mb-4" id="btnAddPaiementMainOeuvre">
                            <i class="fas fa-plus"></i>
                            <span class="ml-2">Nouveau paiement artisan</span>
                        </button>
                        <div id="paiementsMainOeuvre">
                            <!-- Payments list will be loaded here -->
                        </div>
                    </div>
                </div>
                <div class="column is-6">
                    <div class="box has-background-dark">
                        <h2 class="subtitle has-text-white">
                            <i class="fas fa-boxes"></i> Paiements Matériaux
                        </h2>
                        <button class="button is-info is-fullwidth mb-4" id="btnAddPaiementMateriaux">
                            <i class="fas fa-plus"></i>
                            <span class="ml-2">Nouveau paiement fournisseur</span>
                        </button>
                        <div id="paiementsMateriaux">
                            <!-- Payments list will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration Page -->
        <div id="configuration" class="page" style="display: none;">
            <div class="level">
                <div class="level-left">
                    <h1 class="title">
                        <i class="fas fa-cog"></i> Configuration du Projet
                    </h1>
                </div>
            </div>

            <div class="columns">
                <div class="column is-6">
                    <div class="box has-background-dark">
                        <h2 class="subtitle has-text-white">
                            <i class="fas fa-home"></i> Configuration de la Maison
                        </h2>
                        <button class="button is-info is-fullwidth mb-4" onclick="app.editConfigMaison()">
                            <i class="fas fa-edit"></i>
                            <span class="ml-2">Modifier la Configuration</span>
                        </button>
                        <div id="configMaisonDetails">
                            <!-- Configuration details will be loaded here -->
                        </div>
                    </div>
                </div>
                <div class="column is-6">
                    <div class="box has-background-dark">
                        <h2 class="subtitle has-text-white">
                            <i class="fas fa-tasks"></i> Étapes de Construction
                        </h2>
                        <button class="button is-info is-fullwidth mb-4" onclick="app.editEtapesConstruction()">
                            <i class="fas fa-edit"></i>
                            <span class="ml-2">Modifier les Étapes</span>
                        </button>
                        <div id="etapesConstructionDetails">
                            <!-- Etapes details will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="box has-background-dark mt-4">
                <h2 class="subtitle has-text-white">
                    <i class="fas fa-database"></i> Gestion des Données
                </h2>
                <div class="columns">
                    <div class="column is-4">
                        <button class="button is-success is-fullwidth" onclick="app.exportBackupJSON()">
                            <i class="fas fa-download"></i>
                            <span class="ml-2">Exporter Backup JSON</span>
                        </button>
                    </div>
                    <div class="column is-4">
                        <button class="button is-warning is-fullwidth" onclick="app.importBackupJSON()">
                            <i class="fas fa-upload"></i>
                            <span class="ml-2">Importer Backup JSON</span>
                        </button>
                    </div>
                    <div class="column is-4">
                        <button class="button is-danger is-fullwidth" onclick="app.resetAllData()">
                            <i class="fas fa-trash-alt"></i>
                            <span class="ml-2">Réinitialiser Tout</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rapports Page -->
        <div id="rapports" class="page" style="display: none;">
            <h1 class="title">
                <i class="fas fa-file-pdf"></i> Rapports et Exports
            </h1>

            <div class="columns is-multiline">
                <div class="column is-4">
                    <div class="box has-background-dark has-text-centered">
                        <div class="icon is-large has-text-warning">
                            <i class="fas fa-3x fa-university"></i>
                        </div>
                        <h3 class="subtitle has-text-white mt-4">Rapport Bancaire</h3>
                        <p class="has-text-grey-light mb-4">Pour demande de prêt ou refinancement</p>
                        <button class="button is-warning is-fullwidth" id="btnRapportBanque">
                            <i class="fas fa-download"></i>
                            <span class="ml-2">Générer PDF</span>
                        </button>
                    </div>
                </div>
                <div class="column is-4">
                    <div class="box has-background-dark has-text-centered">
                        <div class="icon is-large has-text-info">
                            <i class="fas fa-3x fa-shield-alt"></i>
                        </div>
                        <h3 class="subtitle has-text-white mt-4">Rapport Assurance</h3>
                        <p class="has-text-grey-light mb-4">Documentation pour assurance habitation</p>
                        <button class="button is-info is-fullwidth" id="btnRapportAssurance">
                            <i class="fas fa-download"></i>
                            <span class="ml-2">Générer PDF</span>
                        </button>
                    </div>
                </div>
                <div class="column is-4">
                    <div class="box has-background-dark has-text-centered">
                        <div class="icon is-large has-text-success">
                            <i class="fas fa-3x fa-calculator"></i>
                        </div>
                        <h3 class="subtitle has-text-white mt-4">Rapport Comptabilité</h3>
                        <p class="has-text-grey-light mb-4">Export pour déclaration fiscale Québec</p>
                        <button class="button is-success is-fullwidth" id="btnRapportCompta">
                            <i class="fas fa-download"></i>
                            <span class="ml-2">Générer PDF</span>
                        </button>
                    </div>
                </div>
                <div class="column is-4">
                    <div class="box has-background-dark has-text-centered">
                        <div class="icon is-large has-text-primary">
                            <i class="fas fa-3x fa-file-csv"></i>
                        </div>
                        <h3 class="subtitle has-text-white mt-4">Export Pointages CSV</h3>
                        <p class="has-text-grey-light mb-4">Données pour Excel</p>
                        <button class="button is-primary is-fullwidth" id="btnExportCSV">
                            <i class="fas fa-download"></i>
                            <span class="ml-2">Exporter tout</span>
                        </button>
                    </div>
                </div>
                <div class="column is-4">
                    <div class="box has-background-dark has-text-centered">
                        <div class="icon is-large has-text-danger">
                            <i class="fas fa-3x fa-images"></i>
                        </div>
                        <h3 class="subtitle has-text-white mt-4">Album Photos</h3>
                        <p class="has-text-grey-light mb-4">Progression chronologique</p>
                        <button class="button is-danger is-fullwidth" id="btnAlbumPhotos">
                            <i class="fas fa-camera"></i>
                            <span class="ml-2">Voir l'album</span>
                        </button>
                    </div>
                </div>
                <div class="column is-4">
                    <div class="box has-background-dark has-text-centered">
                        <div class="icon is-large has-text-link">
                            <i class="fas fa-3x fa-chart-bar"></i>
                        </div>
                        <h3 class="subtitle has-text-white mt-4">Statistiques</h3>
                        <p class="has-text-grey-light mb-4">Analyse détaillée du projet</p>
                        <button class="button is-link is-fullwidth" id="btnStatistiques">
                            <i class="fas fa-chart-pie"></i>
                            <span class="ml-2">Voir stats</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals will be added here via JavaScript -->
    <div id="modals"></div>

    <!-- Hidden file input for restore -->
    <input type="file" id="restoreFileInput" accept=".json" style="display: none;">

    <!-- JavaScript Libraries -->
    <script src="vendor/chart.min.js"></script>
    <script src="vendor/jspdf.min.js"></script>
    <script src="vendor/html2canvas.min.js"></script>
    <script src="vendor/flatpickr.min.js"></script>
    <script src="vendor/flatpickr-fr.js"></script>
    
    <!-- Main Application -->
    <script src="script.js"></script>
</body>
</html>