<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ √âditeur de Widgets Universels - Architecture R√©volutionnaire</title>
    
    <!-- 
        R√¥le : Page principale de l'√©diteur r√©volutionnaire
        Type : Interface modulaire compl√®tement personnalisable
        Innovation : 2 widgets universels couvrent 90% des besoins
        Architecture : ES6+ Classes orient√©es objet extensibles
    -->
    
    <!-- Styles modulaires -->
    <link rel="stylesheet" href="./css/core.css">
    <link rel="stylesheet" href="./css/editor.css">
    <link rel="stylesheet" href="./css/widgets.css">
    <link rel="stylesheet" href="./css/themes.css">
    
    <!-- Biblioth√®ques externes (locales) -->
    <script src="./js/lib/marked.min.js"></script>
    <script src="./js/lib/dompurify.min.js"></script>
    
    <!-- Core syst√®me -->
    <script src="./js/core/Utils.js"></script>
    <script src="./js/core/EventManager.js"></script>
    <script src="./js/core/Persistence.js"></script>
    <script src="./js/core/GridEngine.js"></script>
    <script src="./js/core/DragDropSystem.js"></script>
    <script src="./js/core/SyncManager.js"></script>
    
    <!-- Widgets universels -->
    <script src="./js/widgets/BaseWidget.js"></script>
    <script src="./js/widgets/ElementUniversel.js"></script>
    <script src="./js/widgets/GrilleComposition.js"></script>
    
    <!-- Interface utilisateur -->
    <script src="./js/ui/PropertyPanel.js"></script>
    <script src="./js/ui/WidgetBank.js"></script>
    <script src="./js/ui/Toolbar.js"></script>
    <script src="./js/ui/TreeView.js"></script>
    
    <!-- √âditeur principal -->
    <script src="./js/PresentationEditor.js"></script>
</head>

<body class="editor-body">
    <!-- 
        === INTERFACE MODULAIRE ===
        
        Panneau Gauche : Banque widgets (dossiers, recherche, filtres)
        Zone Centrale  : √âditeur grille infinie + outils
        Panneau Droit  : Propri√©t√©s contextuelles d√©taill√©es
        Arborescence   : Structure Gimp-like (noms, visibilit√©, lock)
    -->
    
    <!-- Barre d'outils principale -->
    <header class="main-toolbar">
        <div class="toolbar-section toolbar-left">
            <div class="logo-container">
                <h1 class="editor-title">üéØ √âditeur R√©volutionnaire</h1>
                <span class="version-badge">Phase 1 - Widgets Universels</span>
            </div>
        </div>
        
        <div class="toolbar-section toolbar-center">
            <div class="project-controls">
                <button id="btn-nouveau-projet" class="btn-primary" title="Nouveau Projet">
                    <span class="icon">üìÑ</span> Nouveau
                </button>
                <button id="btn-ouvrir-projet" class="btn-secondary" title="Ouvrir Projet">
                    <span class="icon">üìÇ</span> Ouvrir
                </button>
                <button id="btn-sauvegarder" class="btn-secondary" title="Sauvegarder (Ctrl+S)">
                    <span class="icon">üíæ</span> Sauvegarder
                </button>
            </div>
            
            <div class="history-controls">
                <button id="btn-undo" class="btn-icon" title="Annuler (Ctrl+Z)" disabled>
                    <span class="icon">‚Ü∂</span>
                </button>
                <button id="btn-redo" class="btn-icon" title="Refaire (Ctrl+Y)" disabled>
                    <span class="icon">‚Ü∑</span>
                </button>
                <span id="history-counter" class="history-info">0/100</span>
            </div>
        </div>
        
        <div class="toolbar-section toolbar-right">
            <div class="sync-controls">
                <button id="btn-sync-viewer" class="btn-sync" title="Synchroniser Viewer">
                    <span class="icon">üîÑ</span>
                    <span class="sync-status" id="sync-status">‚óè</span>
                </button>
                <button id="btn-open-viewer" class="btn-secondary" title="Ouvrir Viewer">
                    <span class="icon">üëÅ</span> Viewer
                </button>
            </div>
            
            <div class="export-controls">
                <button id="btn-export-zip" class="btn-primary" title="Exporter ZIP Complet">
                    <span class="icon">üì¶</span> Export ZIP
                </button>
            </div>
        </div>
    </header>
    
    <!-- Interface principale √† 3 panneaux -->
    <main class="main-interface">
        
        <!-- === PANNEAU GAUCHE - Banque Widgets ===-->
        <aside class="left-panel" id="widget-bank-panel">
            <div class="panel-header">
                <h3 class="panel-title">üß© Banque Widgets</h3>
                <div class="panel-controls">
                    <button class="btn-collapse" title="R√©duire Panneau">‚àí</button>
                </div>
            </div>
            
            <div class="panel-content">
                <!-- Recherche et filtres -->
                <div class="search-section">
                    <input type="text" id="widget-search" class="search-input" 
                           placeholder="üîç Rechercher widget..." autocomplete="off">
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-filter="all">Tous</button>
                        <button class="filter-btn" data-filter="universel">Universels</button>
                        <button class="filter-btn" data-filter="atomique">Atomiques</button>
                    </div>
                </div>
                
                <!-- Widgets Universels - 90% des besoins -->
                <div class="widget-category expanded">
                    <h4 class="category-title">
                        <span class="expand-icon">‚ñº</span>
                        ‚≠ê Widgets Universels
                        <span class="category-badge">2</span>
                    </h4>
                    <div class="widget-list">
                        <div class="widget-item" 
                             data-widget-type="element-universel" 
                             draggable="true"
                             title="Widget modulaire tout-en-un : image optionnelle + 3 textes (H1/H2/P)">
                            <div class="widget-icon">üåü</div>
                            <div class="widget-info">
                                <div class="widget-name">√âl√©ment Universel</div>
                                <div class="widget-desc">Image + 3 textes modulaires</div>
                                <div class="widget-usage">Remplace: Logo, Texte, Hero</div>
                            </div>
                        </div>
                        
                        <div class="widget-item" 
                             data-widget-type="grille-composition" 
                             draggable="true"
                             title="Compositeur dynamique : 3 modes (colonne/ligne/grille 2D)">
                            <div class="widget-icon">üèóÔ∏è</div>
                            <div class="widget-info">
                                <div class="widget-name">Grille Composition</div>
                                <div class="widget-desc">G√©n√©rateur tableaux N√óM</div>
                                <div class="widget-usage">3 modes : Col/Ligne/Grille 2D</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Widgets Atomiques Futurs -->
                <div class="widget-category">
                    <h4 class="category-title">
                        <span class="expand-icon">‚ñ∂</span>
                        ‚ö° Widgets Atomiques
                        <span class="category-badge">5</span>
                    </h4>
                    <div class="widget-list" style="display: none;">
                        <div class="widget-item coming-soon">
                            <div class="widget-icon">üîò</div>
                            <div class="widget-info">
                                <div class="widget-name">Bouton Atomique</div>
                                <div class="widget-desc">Phase 2</div>
                            </div>
                        </div>
                        
                        <div class="widget-item coming-soon">
                            <div class="widget-icon">üéØ</div>
                            <div class="widget-info">
                                <div class="widget-name">Ic√¥ne Atomique</div>
                                <div class="widget-desc">Phase 2</div>
                            </div>
                        </div>
                        
                        <div class="widget-item coming-soon">
                            <div class="widget-icon">üè∑Ô∏è</div>
                            <div class="widget-info">
                                <div class="widget-name">Badge Atomique</div>
                                <div class="widget-desc">Phase 2</div>
                            </div>
                        </div>
                        
                        <div class="widget-item coming-soon">
                            <div class="widget-icon">‚ûñ</div>
                            <div class="widget-info">
                                <div class="widget-name">S√©parateur Atomique</div>
                                <div class="widget-desc">Phase 2</div>
                            </div>
                        </div>
                        
                        <div class="widget-item coming-soon">
                            <div class="widget-icon">üé¨</div>
                            <div class="widget-info">
                                <div class="widget-name">Vid√©o Atomique</div>
                                <div class="widget-desc">Phase 2</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- === ZONE CENTRALE - √âditeur Grille Infinie ===-->
        <section class="center-area">
            <!-- Barre d'outils grille -->
            <div class="grid-toolbar">
                <div class="grid-info">
                    <span id="grid-dimensions">Grille: Infinie</span>
                    <span id="zoom-level">Zoom: 100%</span>
                    <span id="selected-widget">Aucun widget s√©lectionn√©</span>
                </div>
                
                <div class="grid-controls">
                    <button id="btn-grid-snap" class="btn-toggle active" title="Magn√©tisme Grille">
                        <span class="icon">‚äû</span>
                    </button>
                    <button id="btn-grid-visible" class="btn-toggle active" title="Afficher Grille">
                        <span class="icon">‚ä°</span>
                    </button>
                    <button id="btn-zoom-fit" class="btn-icon" title="Ajuster Zoom">
                        <span class="icon">‚äü</span>
                    </button>
                    <button id="btn-zoom-out" class="btn-icon" title="D√©zoomer">
                        <span class="icon">‚àí</span>
                    </button>
                    <button id="btn-zoom-in" class="btn-icon" title="Zoomer">
                        <span class="icon">+</span>
                    </button>
                </div>
            </div>
            
            <!-- Conteneur grille infinie avec scroll -->
            <div class="grid-container" id="grid-container">
                <div class="grid-canvas" id="grid-canvas">
                    <!-- 
                        Grille infinie dynamique
                        - Taille libre d√©finie par utilisateur (AUCUN maximum)
                        - Cellules pixels pr√©cises (pas de contraintes grid)
                        - R√©cursion illimit√©e (chaque widget peut contenir sous-grille)
                        - Resize handles visuels
                    -->
                    <div class="grid-overlay" id="grid-overlay"></div>
                    <div class="widgets-container" id="widgets-container">
                        <!-- Les widgets seront inject√©s ici dynamiquement -->
                    </div>
                </div>
            </div>
        </section>
        
        <!-- === PANNEAU DROIT - Propri√©t√©s ===-->
        <aside class="right-panel" id="properties-panel">
            <div class="panel-header">
                <h3 class="panel-title">‚öôÔ∏è Propri√©t√©s</h3>
                <div class="panel-controls">
                    <button class="btn-collapse" title="R√©duire Panneau">‚àí</button>
                </div>
            </div>
            
            <div class="panel-content" id="properties-content">
                <!-- Propri√©t√©s contextuelles -->
                <div class="no-selection-state">
                    <div class="empty-state-icon">‚öôÔ∏è</div>
                    <h4>Aucun widget s√©lectionn√©</h4>
                    <p>Cliquez sur un widget ou faites glisser-d√©poser depuis la banque pour commencer l'√©dition.</p>
                    
                    <div class="quick-actions">
                        <button class="btn-primary" id="btn-add-element-universel">
                            <span class="icon">üåü</span> Ajouter √âl√©ment Universel
                        </button>
                        <button class="btn-secondary" id="btn-add-grille-composition">
                            <span class="icon">üèóÔ∏è</span> Ajouter Grille Composition
                        </button>
                    </div>
                </div>
                
                <!-- Les panneaux de propri√©t√©s seront inject√©s ici selon le widget s√©lectionn√© -->
            </div>
        </aside>
    </main>
    
    <!-- === ARBORESCENCE GIMP-LIKE (Position flottante) ===-->
    <div class="tree-panel" id="tree-panel">
        <div class="panel-header">
            <h3 class="panel-title">üå≥ Structure</h3>
            <div class="panel-controls">
                <button class="btn-collapse" title="R√©duire Arborescence">‚àí</button>
                <button class="btn-close" title="Fermer Arborescence">√ó</button>
            </div>
        </div>
        
        <div class="panel-content">
            <div class="tree-toolbar">
                <button class="btn-icon" id="btn-expand-all" title="Tout D√©velopper">
                    <span class="icon">‚äû</span>
                </button>
                <button class="btn-icon" id="btn-collapse-all" title="Tout R√©duire">
                    <span class="icon">‚äü</span>
                </button>
                <button class="btn-icon" id="btn-show-all" title="Tout Afficher">
                    <span class="icon">üëÅ</span>
                </button>
                <button class="btn-icon" id="btn-unlock-all" title="Tout D√©verrouiller">
                    <span class="icon">üîì</span>
                </button>
            </div>
            
            <div class="tree-content" id="tree-content">
                <!-- Structure hi√©rarchique des widgets -->
                <div class="tree-item root-item">
                    <div class="tree-node">
                        <span class="tree-icon">üìÑ</span>
                        <span class="tree-name editable" contenteditable="false">Projet Sans Titre</span>
                        <div class="tree-controls">
                            <button class="tree-btn" title="Visibilit√©">üëÅ</button>
                            <button class="tree-btn" title="Verrouillage">üîì</button>
                        </div>
                    </div>
                    <div class="tree-children" id="root-children">
                        <!-- Widgets enfants seront ajout√©s ici -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- === OVERLAY SYST√àME ===-->
    <div class="system-overlay" id="system-overlay" style="display: none;">
        <div class="loading-screen">
            <div class="spinner"></div>
            <div class="loading-text">Chargement...</div>
        </div>
    </div>
    
    <!-- === MODALS ===-->
    
    <!-- Modal Nouveau Projet -->
    <div class="modal" id="modal-nouveau-projet" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üÜï Nouveau Projet</h3>
                <button class="modal-close">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="project-name">Nom du projet :</label>
                    <input type="text" id="project-name" class="form-input" 
                           placeholder="Mon Projet Marketing" autocomplete="off">
                </div>
                <div class="form-group">
                    <label for="project-template">Template :</label>
                    <select id="project-template" class="form-select">
                        <option value="vide">Projet vide</option>
                        <option value="marketing">Page marketing</option>
                        <option value="presentation">Pr√©sentation</option>
                        <option value="portfolio">Portfolio</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="btn-annuler-projet">Annuler</button>
                <button class="btn-primary" id="btn-creer-projet">Cr√©er</button>
            </div>
        </div>
    </div>
    
    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>
    
    <!-- Script d'initialisation -->
    <script>
        // 
        // R√¥le : Point d'entr√©e de l'application r√©volutionnaire
        // Type : Initialisation syst√®me complet
        // Responsabilit√© : Orchestration des modules et d√©marrage interface
        //
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('üöÄ D√©marrage √âditeur R√©volutionnaire - Phase 1');
                
                // Initialisation du syst√®me
                window.presentationEditor = new PresentationEditor();
                
                console.log('‚úÖ √âditeur initialis√© avec succ√®s');
                
                // Animation d'entr√©e
                document.body.classList.add('app-loaded');
                
            } catch (error) {
                console.error('‚ùå Erreur lors de l\'initialisation:', error);
                
                // Affichage d'erreur utilisateur
                document.body.innerHTML = `
                    <div class="error-screen">
                        <h2>‚ö†Ô∏è Erreur de Chargement</h2>
                        <p>L'√©diteur n'a pas pu d√©marrer correctement.</p>
                        <details>
                            <summary>D√©tails techniques</summary>
                            <pre>${error.stack}</pre>
                        </details>
                        <button onclick="location.reload()" class="btn-primary">Recharger</button>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>