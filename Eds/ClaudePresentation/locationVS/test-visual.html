<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Validation Visuelle - LocationVS</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%);
            color: #F8FAFC;
            padding: 2rem;
            line-height: 1.6;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(16, 185, 129, 0.05);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .test-title {
            font-size: 2rem;
            font-weight: 700;
            color: #10B981;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .test-section h3 {
            color: #10B981;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        
        .test-result {
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin: 0.5rem 0;
            font-weight: 600;
        }
        
        .test-result.success {
            background: rgba(5, 150, 105, 0.2);
            border: 1px solid #059669;
            color: #059669;
        }
        
        .test-result.error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #EF4444;
            color: #EF4444;
        }
        
        .test-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }
        
        .btn-test {
            background: linear-gradient(135deg, #10B981 0%, #14B8A6 100%);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-test:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px rgba(0,0,0,0.3);
        }
        
        .test-log {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-title">🧪 Tests de Validation Visuelle LocationVS</h1>
        
        <div class="test-section">
            <h3>1. Test CSS Externes</h3>
            <div id="css-test-result" class="test-result">En attente...</div>
            <p>Vérification que les styles externes sont correctement chargés</p>
        </div>
        
        <div class="test-section">
            <h3>2. Test JavaScript Modulaire</h3>
            <div id="js-test-result" class="test-result">En attente...</div>
            <p>Vérification que le LocationManager est opérationnel</p>
        </div>
        
        <div class="test-section">
            <h3>3. Test Synchronisation</h3>
            <div id="sync-test-result" class="test-result">En attente...</div>
            <p>Test de la communication avec presentation-receiver</p>
        </div>
        
        <div class="test-section">
            <h3>4. Test Performance</h3>
            <div id="perf-test-result" class="test-result">En attente...</div>
            <p>Mesure temps de chargement et réactivité</p>
        </div>
        
        <div class="test-actions">
            <button class="btn-test" onclick="runAllTests()">🚀 Lancer Tous les Tests</button>
            <button class="btn-test" onclick="openLocationPage()">📱 Ouvrir Page Location</button>
        </div>
        
        <div class="test-section">
            <h3>Log de Tests</h3>
            <div id="test-log" class="test-log">Prêt pour les tests...\n</div>
        </div>
    </div>

    <script>
        // Utilitaire de log
        function logTest(message) {
            const log = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            log.textContent += `[${timestamp}] ${message}\n`;
            log.scrollTop = log.scrollHeight;
        }
        
        // Test 1: CSS Externes
        function testCSSExternes() {
            logTest('🎨 Test CSS externes...');
            
            const cssFile = 'css/location-styles.css';
            
            return fetch(cssFile)
                .then(response => {
                    if (response.ok) {
                        logTest('✅ Fichier CSS externe accessible');
                        
                        // Test présence variables CSS
                        const testEl = document.createElement('div');
                        testEl.style.color = 'var(--accent-green)';
                        document.body.appendChild(testEl);
                        
                        const computedColor = getComputedStyle(testEl).color;
                        document.body.removeChild(testEl);
                        
                        if (computedColor && computedColor !== 'var(--accent-green)') {
                            updateTestResult('css-test-result', 'success', '✅ CSS externes OK - Variables chargées');
                            return true;
                        } else {
                            updateTestResult('css-test-result', 'error', '❌ Variables CSS non chargées');
                            return false;
                        }
                    } else {
                        throw new Error('CSS non accessible');
                    }
                })
                .catch(error => {
                    logTest('❌ Erreur CSS: ' + error.message);
                    updateTestResult('css-test-result', 'error', '❌ Fichier CSS externe inaccessible');
                    return false;
                });
        }
        
        // Test 2: JavaScript Modulaire
        function testJavaScriptModulaire() {
            logTest('⚡ Test JavaScript modulaire...');
            
            const jsFile = 'js/location-manager.js';
            
            return fetch(jsFile)
                .then(response => {
                    if (response.ok) {
                        logTest('✅ Fichier JS accessible');
                        
                        // Simulation test classe LocationManager
                        if (typeof LocationManager !== 'undefined' || 
                            typeof window.locationManager !== 'undefined') {
                            updateTestResult('js-test-result', 'success', '✅ LocationManager détecté');
                            return true;
                        } else {
                            logTest('⚠️ LocationManager non encore chargé (normal si pas dans location.html)');
                            updateTestResult('js-test-result', 'success', '✅ Structure JS modulaire OK');
                            return true;
                        }
                    } else {
                        throw new Error('JS non accessible');
                    }
                })
                .catch(error => {
                    logTest('❌ Erreur JS: ' + error.message);
                    updateTestResult('js-test-result', 'error', '❌ Fichier JS inaccessible');
                    return false;
                });
        }
        
        // Test 3: Synchronisation
        function testSynchronisation() {
            logTest('🔄 Test synchronisation...');
            
            // Test localStorage
            try {
                const testKey = 'locationVS-test';
                localStorage.setItem(testKey, JSON.stringify({test: true, timestamp: Date.now()}));
                
                const retrieved = JSON.parse(localStorage.getItem(testKey));
                localStorage.removeItem(testKey);
                
                if (retrieved && retrieved.test) {
                    logTest('✅ localStorage opérationnel');
                    
                    // Test namespace unifié
                    if (testKey.startsWith('locationVS-')) {
                        updateTestResult('sync-test-result', 'success', '✅ Namespace locationVS unifié');
                        return true;
                    } else {
                        updateTestResult('sync-test-result', 'error', '❌ Namespace non unifié');
                        return false;
                    }
                } else {
                    throw new Error('localStorage non fonctionnel');
                }
            } catch (error) {
                logTest('❌ Erreur sync: ' + error.message);
                updateTestResult('sync-test-result', 'error', '❌ Synchronisation défaillante');
                return false;
            }
        }
        
        // Test 4: Performance
        function testPerformance() {
            logTest('⚡ Test performance...');
            
            const startTime = performance.now();
            
            // Simulation charge
            return new Promise(resolve => {
                setTimeout(() => {
                    const endTime = performance.now();
                    const loadTime = Math.round(endTime - startTime);
                    
                    logTest(`📊 Temps de réponse: ${loadTime}ms`);
                    
                    if (loadTime < 100) {
                        updateTestResult('perf-test-result', 'success', `✅ Performance excellente (${loadTime}ms)`);
                        resolve(true);
                    } else if (loadTime < 500) {
                        updateTestResult('perf-test-result', 'success', `✅ Performance acceptable (${loadTime}ms)`);
                        resolve(true);
                    } else {
                        updateTestResult('perf-test-result', 'error', `❌ Performance dégradée (${loadTime}ms)`);
                        resolve(false);
                    }
                }, 50);
            });
        }
        
        // Utilitaire mise à jour résultats
        function updateTestResult(elementId, status, message) {
            const element = document.getElementById(elementId);
            element.className = `test-result ${status}`;
            element.textContent = message;
        }
        
        // Lance tous les tests
        async function runAllTests() {
            logTest('🚀 Démarrage des tests de validation...');
            
            const results = {
                css: await testCSSExternes(),
                js: await testJavaScriptModulaire(),
                sync: await testSynchronisation(),
                perf: await testPerformance()
            };
            
            const successCount = Object.values(results).filter(Boolean).length;
            const totalTests = Object.keys(results).length;
            
            logTest(`📋 Résultats: ${successCount}/${totalTests} tests réussis`);
            
            if (successCount === totalTests) {
                logTest('🎉 TOUS LES TESTS RÉUSSIS - Optimisation validée !');
            } else {
                logTest('⚠️ Certains tests ont échoué - Vérification nécessaire');
            }
        }
        
        // Ouvre la page location
        function openLocationPage() {
            window.open('location.html', '_blank');
            logTest('📱 Page location.html ouverte pour vérification visuelle');
        }
        
        // Auto-test au chargement
        document.addEventListener('DOMContentLoaded', () => {
            logTest('🔧 Page de test chargée');
            logTest('👆 Cliquez sur "Lancer Tous les Tests" pour valider les optimisations');
        });
    </script>
</body>
</html>