<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Synchronisation - Cr√©ateur de Pr√©sentations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .test-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e5e5;
        }

        .test-header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .test-header p {
            color: #666;
            font-size: 1.2rem;
        }

        .test-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .action-card {
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .action-card:hover {
            border-color: #3b82f6;
            background: #eff6ff;
            transform: translateY(-2px);
        }

        .action-card h3 {
            color: #374151;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #10b981;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-warning {
            background: #f59e0b;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .status-section {
            background: #f8fafc;
            border-radius: 8px;
            padding: 25px;
            margin-top: 30px;
        }

        .status-section h3 {
            color: #374151;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .log-container {
            background: #1f2937;
            color: #f9fafb;
            padding: 20px;
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', monospace;
            max-height: 300px;
            overflow-y: auto;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 4px 0;
            border-bottom: 1px solid #374151;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-timestamp {
            color: #9ca3af;
            font-size: 0.8rem;
        }

        .log-success {
            color: #10b981;
        }

        .log-error {
            color: #f87171;
        }

        .log-info {
            color: #60a5fa;
        }

        .projects-list {
            display: grid;
            gap: 12px;
            margin-top: 16px;
        }

        .project-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }

        .project-item:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }

        .project-info-item {
            flex: 1;
        }

        .project-title {
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
        }

        .project-meta {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .project-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.875rem;
        }

        .project-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 20px;
        }

        .info-card h4 {
            color: #374151;
            margin-bottom: 10px;
        }

        .info-card p {
            color: #6b7280;
            margin: 5px 0;
        }

        .sync-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .sync-active {
            background: #dcfce7;
            color: #166534;
        }

        .sync-inactive {
            background: #fee2e2;
            color: #991b1b;
        }

        .instructions {
            background: #fffbeb;
            border-left: 4px solid #f59e0b;
            padding: 20px;
            margin-bottom: 30px;
        }

        .instructions h3 {
            color: #92400e;
            margin-bottom: 10px;
        }

        .instructions ol {
            margin-left: 20px;
            color: #78350f;
        }

        .instructions li {
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üîÑ Test de Synchronisation</h1>
            <p>Testez la synchronisation temps r√©el entre l'√©diteur et le viewer</p>
        </div>

        <div class="instructions">
            <h3>üìã Instructions de test</h3>
            <ol>
                <li>Cliquez sur "Cr√©er Projet Test" pour g√©n√©rer un projet de d√©monstration</li>
                <li>Ouvrez l'√©diteur dans un nouvel onglet avec "Ouvrir √âditeur"</li>
                <li>Ouvrez le viewer dans un autre onglet avec "Ouvrir Viewer"</li>
                <li>Modifiez le contenu dans l'√©diteur et observez les changements en temps r√©el dans le viewer</li>
            </ol>
        </div>

        <div class="project-info" id="projectInfo" style="display: none;">
            <div class="info-card">
                <h4>Projet Actuel</h4>
                <p id="projectName">-</p>
                <p id="projectId">-</p>
            </div>
            <div class="info-card">
                <h4>√âtat de Synchronisation</h4>
                <p>Status: <span id="syncStatus" class="sync-status sync-inactive">Inactif</span></p>
                <p id="lastSync">Derni√®re sync: Jamais</p>
            </div>
            <div class="info-card">
                <h4>Statistiques</h4>
                <p id="metaSectionsCount">Meta-sections: 0</p>
                <p id="widgetsCount">Widgets: 0</p>
            </div>
        </div>

        <div class="status-section" id="projectsListSection" style="display: none;">
            <h3>üìÅ Projets Disponibles</h3>
            <div id="projectsList" class="projects-list">
                <!-- Liste dynamique des projets -->
            </div>
        </div>

        <div class="test-actions">
            <div class="action-card">
                <h3>üöÄ Cr√©er Projet Test</h3>
                <p>G√©n√®re un nouveau projet de d√©monstration avec du contenu d'exemple</p>
                <button class="btn" onclick="createTestProject()">Cr√©er Projet</button>
            </div>

            <div class="action-card">
                <h3>üè¢ Cr√©er Li-CUBE PRO</h3>
                <p>Cr√©e une pr√©sentation Li-CUBE PRO compl√®te depuis le template</p>
                <button class="btn" onclick="createLiCubeProProject()" style="background: #10b981;">Cr√©er Li-CUBE PRO</button>
            </div>

            <div class="action-card">
                <h3>‚úèÔ∏è Ouvrir √âditeur</h3>
                <p>Lance l'interface d'√©dition dans un nouvel onglet</p>
                <button class="btn btn-success" onclick="openEditor()" id="editorBtn" disabled>Ouvrir √âditeur</button>
            </div>

            <div class="action-card">
                <h3>üëÅÔ∏è Ouvrir Viewer</h3>
                <p>Lance la visualisation en temps r√©el dans un nouvel onglet</p>
                <button class="btn btn-warning" onclick="openViewer()" id="viewerBtn" disabled>Ouvrir Viewer</button>
            </div>

            <div class="action-card">
                <h3>üß™ Tests CRUD</h3>
                <p>Valide toutes les op√©rations de cr√©ation, modification, suppression</p>
                <button class="btn" onclick="runCRUDTests()" id="crudBtn" disabled style="background: #8b5cf6;">Tester CRUD</button>
            </div>

            <div class="action-card">
                <h3>üîÑ Test Sync</h3>
                <p>Teste la synchronisation temps r√©el entre √©diteur et viewer</p>
                <button class="btn" onclick="testSynchronization()" id="syncBtn" disabled style="background: #06b6d4;">Test Sync</button>
            </div>

            <div class="action-card">
                <h3>‚Ü∂‚Ü∑ Test Historique</h3>
                <p>Teste les fonctionnalit√©s undo/redo du syst√®me</p>
                <button class="btn" onclick="testUndoRedo()" id="historyBtn" disabled style="background: #f59e0b;">Test Undo/Redo</button>
            </div>

            <div class="action-card">
                <h3>üîß Nettoyage</h3>
                <p>Supprime tous les projets de test pour repartir √† z√©ro</p>
                <button class="btn" onclick="cleanupTestProjects()" style="background: #ef4444;">Nettoyer</button>
            </div>
        </div>

        <div class="status-section">
            <h3>üìä Journal de Synchronisation</h3>
            <div class="log-container" id="logContainer">
                <div class="log-entry">
                    <span class="log-timestamp">[Pr√™t]</span>
                    <span class="log-info">Syst√®me de synchronisation initialis√©</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Inclure le moteur de pr√©sentation -->
    <script src="../core/presentation-engine.js"></script>

    <script>
        // ============================================================================
        // SCRIPT DE TEST DE SYNCHRONISATION - TEMPS R√âEL
        // ============================================================================
        
        // Variables globales pour le test
        let engine = null;
        let currentProjectId = null;
        let syncListenerId = null;

        /**
         * Initialise le syst√®me de test au chargement de la page
         */
        function initTestSystem() {
            addLog('Initialisation du moteur de pr√©sentation...', 'info');
            
            try {
                engine = new PresentationEngine();
                addLog('‚úÖ Moteur de pr√©sentation initialis√©', 'success');
                
                // √âcouteur pour les changements de synchronisation
                setupSyncListener();
                
                // Afficher la liste des projets existants
                displayProjectsList();
                
            } catch (error) {
                addLog('‚ùå Erreur lors de l\'initialisation: ' + error.message, 'error');
            }
        }

        /**
         * Affiche la liste des projets disponibles
         */
        function displayProjectsList() {
            const projects = engine.getAllProjects();
            const projectsList = document.getElementById('projectsList');
            const projectsSection = document.getElementById('projectsListSection');
            
            if (projects.length === 0) {
                projectsSection.style.display = 'none';
                return;
            }
            
            projectsSection.style.display = 'block';
            
            let html = '';
            projects.forEach(project => {
                const lastModified = new Date(project.lastModified).toLocaleString();
                html += `
                    <div class="project-item">
                        <div class="project-info-item">
                            <div class="project-title">${project.name}</div>
                            <div class="project-meta">
                                ID: ${project.id}<br>
                                Modifi√©: ${lastModified}<br>
                                ${project.metaSectionsCount} m√©ta-sections
                            </div>
                        </div>
                        <div class="project-actions">
                            <button class="btn btn-primary btn-small" onclick="loadProjectById('${project.id}')">
                                Charger
                            </button>
                            <button class="btn btn-warning btn-small" onclick="deleteProject('${project.id}')">
                                Supprimer
                            </button>
                        </div>
                    </div>
                `;
            });
            
            projectsList.innerHTML = html;
        }

        /**
         * Charge un projet par son ID
         */
        function loadProjectById(projectId) {
            addLog(`üìÇ Chargement du projet: ${projectId}`, 'info');
            
            try {
                const project = engine.loadProject(projectId);
                
                if (project) {
                    currentProjectId = projectId;
                    updateProjectInfo();
                    enableButtons();
                    addLog(`‚úÖ Projet charg√©: ${project.name}`, 'success');
                } else {
                    throw new Error('Projet non trouv√©');
                }
            } catch (error) {
                addLog(`‚ùå Erreur lors du chargement: ${error.message}`, 'error');
            }
        }

        /**
         * Supprime un projet
         */
        function deleteProject(projectId) {
            if (confirm(`√ätes-vous s√ªr de vouloir supprimer le projet ${projectId} ?`)) {
                const key = `presentation-project-${projectId}`;
                localStorage.removeItem(key);
                
                addLog(`üóëÔ∏è Projet supprim√©: ${projectId}`, 'info');
                
                // Rafra√Æchir la liste
                displayProjectsList();
                
                // Si c'√©tait le projet actuel, r√©initialiser
                if (currentProjectId === projectId) {
                    currentProjectId = null;
                    document.getElementById('projectInfo').style.display = 'none';
                    document.getElementById('editorBtn').disabled = true;
                    document.getElementById('viewerBtn').disabled = true;
                }
            }
        }

        /**
         * Configure l'√©couteur d'√©v√©nements de synchronisation
         */
        function setupSyncListener() {
            window.addEventListener('storage', (event) => {
                if (event.key && event.key.startsWith('presentation-project-')) {
                    const projectId = event.key.replace('presentation-project-', '');
                    addLog(`üîÑ Synchronisation d√©tect√©e pour projet: ${projectId}`, 'info');
                    
                    if (projectId === currentProjectId) {
                        updateProjectInfo();
                        updateSyncStatus(true);
                    }
                }
            });

            // √âcouteur pour les √©v√©nements personnalis√©s
            window.addEventListener('presentationSync', (event) => {
                const { projectId, data } = event.detail;
                addLog(`üì° √âv√©nement de sync re√ßu pour: ${projectId}`, 'info');
                updateSyncStatus(true);
            });

            addLog('üëÇ √âcouteurs de synchronisation configur√©s', 'info');
        }

        /**
         * Cr√©e un projet de test avec du contenu d'exemple
         */
        function createTestProject() {
            addLog('üöÄ Cr√©ation du projet de test...', 'info');
            
            try {
                if (!engine) {
                    throw new Error('Moteur de pr√©sentation non initialis√©');
                }

                const projectName = `Test Demo ${new Date().toLocaleTimeString()}`;
                const project = engine.createNewProject(projectName, {
                    description: 'Projet de d√©monstration pour tester la synchronisation temps r√©el',
                    theme: 'modern'
                });

                if (!project) {
                    throw new Error('√âchec de cr√©ation du projet');
                }

                currentProjectId = project.id;
                
                // Ajouter du contenu d'exemple
                addExampleContent();
                
                // Mettre √† jour l'interface
                updateProjectInfo();
                enableButtons();
                
                addLog(`‚úÖ Projet cr√©√©: ${projectName} (${project.id})`, 'success');
                
                // Rafra√Æchir la liste des projets
                displayProjectsList();
                
            } catch (error) {
                addLog('‚ùå Erreur lors de la cr√©ation du projet: ' + error.message, 'error');
            }
        }

        /**
         * Cr√©e un projet Li-CUBE PRO complet depuis le template
         */
        function createLiCubeProProject() {
            addLog('üè¢ Cr√©ation du projet Li-CUBE PRO depuis template...', 'info');
            
            try {
                if (!engine) {
                    throw new Error('Moteur de pr√©sentation non initialis√©');
                }

                const projectName = `Li-CUBE PRO Location ${new Date().toLocaleTimeString()}`;
                addLog(`üìù Nom du projet: ${projectName}`, 'info');
                
                const project = engine.createProjectFromTemplate(projectName, 'licubepro-location');

                if (!project) {
                    throw new Error('√âchec de cr√©ation du projet Li-CUBE PRO');
                }

                addLog(`üîç Projet cr√©√© avec ID: ${project.id}`, 'info');
                addLog(`üìä Structure: ${project.metaSections ? project.metaSections.length : 0} m√©ta-sections`, 'info');
                
                currentProjectId = project.id;
                
                // V√©rifier que le projet est bien sauvegard√©
                const savedProject = engine.loadProject(project.id);
                if (savedProject) {
                    addLog(`‚úÖ Projet Li-CUBE PRO cr√©√© et sauvegard√©: ${projectName}`, 'success');
                } else {
                    addLog(`‚ö†Ô∏è Projet cr√©√© mais probl√®me de sauvegarde`, 'warning');
                }
                
                // Mettre √† jour l'interface
                updateProjectInfo();
                enableButtons();
                
                // Rafra√Æchir la liste des projets
                displayProjectsList();
                
            } catch (error) {
                addLog('‚ùå Erreur lors de la cr√©ation du projet Li-CUBE PRO: ' + error.message, 'error');
                console.error('D√©tails de l\'erreur:', error);
                console.error('Stack trace:', error.stack);
            }
        }

        /**
         * Ajoute du contenu d'exemple au projet
         */
        function addExampleContent() {
            if (!engine || !currentProjectId) return;

            // Ajouter une meta-section de contenu
            const contentMetaId = engine.addMetaSection('content');
            
            // Ajouter des sections avec diff√©rents widgets
            const section1Id = engine.addSection(contentMetaId, 'hero');
            const section2Id = engine.addSection(contentMetaId, 'features');
            
            // Ajouter des widgets
            const heroWidgetId = engine.addWidget(section1Id, 'hero', {
                title: 'Bienvenue dans le Test de Synchronisation',
                description: 'Ce contenu sera synchronis√© en temps r√©el entre l\'√©diteur et le viewer',
                cta_text: 'Commencer le Test'
            });

            const advantageWidgetId = engine.addWidget(section2Id, 'advantage_list', {
                title: 'Avantages de la Synchronisation'
            });

            addLog('üìù Contenu d\'exemple ajout√© au projet', 'info');
        }

        /**
         * Met √† jour les informations du projet affich√©es
         */
        function updateProjectInfo() {
            if (!currentProjectId || !engine) return;

            const project = engine.projectData;
            
            document.getElementById('projectInfo').style.display = 'grid';
            document.getElementById('projectName').textContent = project.name;
            document.getElementById('projectId').textContent = `ID: ${project.id}`;
            
            const metaCount = project.metaSections ? project.metaSections.length : 0;
            let widgetCount = 0;
            
            if (project.metaSections) {
                project.metaSections.forEach(meta => {
                    if (meta.sections) {
                        meta.sections.forEach(section => {
                            if (section.widgets) {
                                widgetCount += section.widgets.length;
                            }
                        });
                    }
                });
            }
            
            document.getElementById('metaSectionsCount').textContent = `Meta-sections: ${metaCount}`;
            document.getElementById('widgetsCount').textContent = `Widgets: ${widgetCount}`;
        }

        /**
         * Met √† jour le statut de synchronisation
         */
        function updateSyncStatus(isActive) {
            const statusElement = document.getElementById('syncStatus');
            const lastSyncElement = document.getElementById('lastSync');
            
            if (isActive) {
                statusElement.textContent = 'Actif';
                statusElement.className = 'sync-status sync-active';
                lastSyncElement.textContent = `Derni√®re sync: ${new Date().toLocaleTimeString()}`;
            } else {
                statusElement.textContent = 'Inactif';
                statusElement.className = 'sync-status sync-inactive';
            }
        }


        /**
         * Ouvre l'√©diteur dans un nouvel onglet
         */
        function openEditor() {
            if (!currentProjectId) {
                addLog('‚ö†Ô∏è Aucun projet s√©lectionn√©', 'error');
                return;
            }

            const editorUrl = `../editor/presentation-editor.html?project=${currentProjectId}`;
            window.open(editorUrl, '_blank');
            
            addLog('üìù √âditeur ouvert dans un nouvel onglet', 'info');
        }

        /**
         * Ouvre le viewer dans un nouvel onglet
         */
        function openViewer() {
            if (!currentProjectId) {
                addLog('‚ö†Ô∏è Aucun projet s√©lectionn√©', 'error');
                return;
            }

            const viewerUrl = `../viewer/presentation-viewer.html?project=${currentProjectId}`;
            window.open(viewerUrl, '_blank');
            
            addLog('üëÅÔ∏è Viewer ouvert dans un nouvel onglet', 'info');
        }

        /**
         * Ajoute une entr√©e au journal de logs
         */
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-${type}">${message}</span>
            `;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        /**
         * Active les boutons de test avanc√©s
         */
        function enableAdvancedTests() {
            document.getElementById('crudBtn').disabled = false;
            document.getElementById('syncBtn').disabled = false;
            document.getElementById('historyBtn').disabled = false;
        }

        /**
         * R√¥le : Test complet des op√©rations CRUD sur tous les niveaux hi√©rarchiques
         * Type : Validation syst√®me - Test automatis√©
         */
        function runCRUDTests() {
            if (!currentProjectId || !engine) {
                addLog('‚ùå Aucun projet actif pour les tests CRUD', 'error');
                return;
            }

            addLog('üß™ D√âBUT DES TESTS CRUD COMPLETS', 'info');
            let testsPassed = 0;
            let testsFailed = 0;

            try {
                // TEST 1: Ajout de m√©ta-section
                addLog('üìù Test 1: Ajout m√©ta-section', 'info');
                const metaId = engine.addMetaSection('content');
                if (metaId) {
                    testsPassed++;
                    addLog('‚úÖ M√©ta-section ajout√©e', 'success');
                } else {
                    testsFailed++;
                    addLog('‚ùå √âchec ajout m√©ta-section', 'error');
                }

                // TEST 2: Ajout de section
                addLog('üìù Test 2: Ajout section', 'info');
                const sectionId = engine.addSection(metaId, 'hero');
                if (sectionId) {
                    testsPassed++;
                    addLog('‚úÖ Section ajout√©e', 'success');
                } else {
                    testsFailed++;
                    addLog('‚ùå √âchec ajout section', 'error');
                }

                // TEST 3: Ajout de widget
                addLog('üìù Test 3: Ajout widget', 'info');
                const widgetId = engine.addWidget(sectionId, 'text_block', {
                    title: 'Test Widget',
                    content: 'Contenu de test pour validation CRUD'
                });
                if (widgetId) {
                    testsPassed++;
                    addLog('‚úÖ Widget ajout√©', 'success');
                } else {
                    testsFailed++;
                    addLog('‚ùå √âchec ajout widget', 'error');
                }

                // TEST 4: Modification de widget
                addLog('üìù Test 4: Modification widget', 'info');
                const updateResult = engine.updateWidget(widgetId, {
                    title: 'Widget Modifi√©',
                    content: 'Contenu mis √† jour'
                });
                if (updateResult) {
                    testsPassed++;
                    addLog('‚úÖ Widget modifi√©', 'success');
                } else {
                    testsFailed++;
                    addLog('‚ùå √âchec modification widget', 'error');
                }

                // TEST 5: Suppression de widget
                addLog('üìù Test 5: Suppression widget', 'info');
                const deleteResult = engine.removeWidget(widgetId);
                if (deleteResult) {
                    testsPassed++;
                    addLog('‚úÖ Widget supprim√©', 'success');
                } else {
                    testsFailed++;
                    addLog('‚ùå √âchec suppression widget', 'error');
                }

                // TEST 6: Suppression de section
                addLog('üìù Test 6: Suppression section', 'info');
                const removeSectionResult = engine.removeSection(sectionId);
                if (removeSectionResult) {
                    testsPassed++;
                    addLog('‚úÖ Section supprim√©e', 'success');
                } else {
                    testsFailed++;
                    addLog('‚ùå √âchec suppression section', 'error');
                }

                // TEST 7: Suppression de m√©ta-section
                addLog('üìù Test 7: Suppression m√©ta-section', 'info');
                const removeMetaResult = engine.removeMetaSection(metaId);
                if (removeMetaResult) {
                    testsPassed++;
                    addLog('‚úÖ M√©ta-section supprim√©e', 'success');
                } else {
                    testsFailed++;
                    addLog('‚ùå √âchec suppression m√©ta-section', 'error');
                }

                // R√©sum√© des tests
                addLog(`üèÅ TESTS CRUD TERMIN√âS: ${testsPassed}/${testsPassed + testsFailed} r√©ussis`, 
                       testsFailed === 0 ? 'success' : 'warning');

                // Mettre √† jour l'interface
                updateProjectInfo();

            } catch (error) {
                addLog(`‚ùå Erreur pendant les tests CRUD: ${error.message}`, 'error');
            }
        }

        /**
         * R√¥le : Test de synchronisation temps r√©el
         * Type : Validation synchronisation - Test de communication
         */
        function testSynchronization() {
            if (!currentProjectId || !engine) {
                addLog('‚ùå Aucun projet actif pour test sync', 'error');
                return;
            }

            addLog('üîÑ D√âBUT TEST SYNCHRONISATION TEMPS R√âEL', 'info');
            
            try {
                // Simuler des changements et v√©rifier la synchronisation
                const testData = { test: true, timestamp: Date.now() };
                
                // D√©clencher un √©v√©nement de synchronisation
                engine.triggerSync();
                
                // V√©rifier que l'√©v√©nement est d√©tect√©
                window.addEventListener('storage', function testListener(event) {
                    if (event.key && event.key.includes(currentProjectId)) {
                        addLog('‚úÖ Synchronisation localStorage d√©tect√©e', 'success');
                        window.removeEventListener('storage', testListener);
                    }
                });
                
                addLog('üì° Test de synchronisation lanc√©', 'info');
                addLog('üí° Ouvrez l\'√©diteur et le viewer pour voir la sync en action', 'info');
                
            } catch (error) {
                addLog(`‚ùå Erreur test synchronisation: ${error.message}`, 'error');
            }
        }

        /**
         * R√¥le : Test du syst√®me undo/redo
         * Type : Validation historique - Test m√©moire
         */
        function testUndoRedo() {
            if (!currentProjectId || !engine) {
                addLog('‚ùå Aucun projet actif pour test historique', 'error');
                return;
            }

            addLog('‚Ü∂‚Ü∑ D√âBUT TEST UNDO/REDO', 'info');
            
            try {
                // √âtat initial
                const initialState = JSON.stringify(engine.projectData);
                
                // Faire un changement
                const metaId = engine.addMetaSection('test-history');
                addLog('üìù Changement effectu√©: ajout m√©ta-section', 'info');
                
                // V√©rifier que l'historique peut revenir en arri√®re
                const undoResult = engine.undo();
                if (undoResult) {
                    addLog('‚úÖ Undo r√©ussi', 'success');
                    
                    // V√©rifier que l'on peut refaire
                    const redoResult = engine.redo();
                    if (redoResult) {
                        addLog('‚úÖ Redo r√©ussi', 'success');
                        addLog('üèÅ Test historique termin√© avec succ√®s', 'success');
                    } else {
                        addLog('‚ùå √âchec redo', 'error');
                    }
                } else {
                    addLog('‚ùå √âchec undo', 'error');
                }
                
                // Mettre √† jour l'interface
                updateProjectInfo();
                
            } catch (error) {
                addLog(`‚ùå Erreur test historique: ${error.message}`, 'error');
            }
        }

        /**
         * R√¥le : Nettoyage des projets de test
         * Type : Maintenance - Nettoyage localStorage
         */
        function cleanupTestProjects() {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer TOUS les projets de test ?')) {
                addLog('üóëÔ∏è Nettoyage des projets de test...', 'info');
                
                const keys = Object.keys(localStorage).filter(key => 
                    key.startsWith('presentation-project-') && 
                    (key.includes('test') || key.includes('li-cube'))
                );
                
                keys.forEach(key => {
                    localStorage.removeItem(key);
                });
                
                addLog(`‚úÖ ${keys.length} projets de test supprim√©s`, 'success');
                
                // R√©initialiser l'interface
                currentProjectId = null;
                document.getElementById('projectInfo').style.display = 'none';
                document.getElementById('editorBtn').disabled = true;
                document.getElementById('viewerBtn').disabled = true;
                document.getElementById('crudBtn').disabled = true;
                document.getElementById('syncBtn').disabled = true;
                document.getElementById('historyBtn').disabled = true;
                
                // Rafra√Æchir la liste
                displayProjectsList();
            }
        }

        /**
         * Met √† jour les boutons apr√®s chargement d'un projet
         */
        function enableButtons() {
            document.getElementById('editorBtn').disabled = false;
            document.getElementById('viewerBtn').disabled = false;
            enableAdvancedTests();
        }

        // Initialiser le syst√®me au chargement de la page
        document.addEventListener('DOMContentLoaded', initTestSystem);
    </script>
</body>
</html>