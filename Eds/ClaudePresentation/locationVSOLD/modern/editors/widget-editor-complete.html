<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√âditeur de Widgets Complet - Li-CUBE PRO‚Ñ¢</title>
    <link rel="stylesheet" href="../assets/css/themes.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ============================================================================
         * √âDITEUR DE WIDGETS COMPLET - INTERFACE AVANC√âE 
         * ============================================================================ */
        
        .widget-editor {
            display: grid;
            grid-template-areas: 
                "toolbar toolbar toolbar"
                "library canvas properties"
                "viewer viewer viewer"
                "footer footer footer";
            grid-template-columns: 280px 1fr 320px;
            grid-template-rows: 60px 1fr 200px 40px;
            height: 100vh;
            background: var(--bg-primary);
            font-family: var(--font-primary);
        }

        /* Barre d'outils */
        .editor-toolbar {
            grid-area: toolbar;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--spacing-lg);
            backdrop-filter: blur(10px);
        }

        .toolbar-left, .toolbar-center, .toolbar-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .toolbar-title {
            font-size: var(--text-xl);
            font-weight: var(--font-semibold);
            color: var(--text-white);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .toolbar-title i {
            color: var(--accent-green);
            font-size: var(--text-2xl);
        }

        /* Biblioth√®que de widgets */
        .widget-library {
            grid-area: library;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .library-header {
            padding: var(--spacing-md) var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-card);
        }

        .library-title {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            color: var(--text-white);
            margin-bottom: var(--spacing-sm);
        }

        .library-search {
            width: 100%;
            padding: var(--spacing-sm);
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            color: var(--text-white);
            font-size: var(--text-sm);
        }

        .library-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-md);
        }

        .widget-category {
            margin-bottom: var(--spacing-lg);
        }

        .category-title {
            font-size: var(--text-sm);
            font-weight: var(--font-semibold);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--spacing-sm);
            padding: 0 var(--spacing-sm);
        }

        .widget-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm);
            margin-bottom: var(--spacing-xs);
            background: var(--bg-card);
            border: 1px solid transparent;
            border-radius: var(--border-radius);
            cursor: grab;
            transition: var(--transition-normal);
            user-select: none;
        }

        .widget-item:hover {
            border-color: var(--border-hover);
            background: rgba(16, 185, 129, 0.05);
            transform: translateX(4px);
        }

        .widget-icon {
            font-size: var(--text-xl);
            width: 32px;
            text-align: center;
        }

        .widget-info {
            flex: 1;
        }

        .widget-name {
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            color: var(--text-white);
            margin-bottom: 2px;
        }

        .widget-description {
            font-size: var(--text-xs);
            color: var(--text-muted);
            line-height: 1.3;
        }

        /* Canvas d'√©dition */
        .editor-canvas {
            grid-area: canvas;
            background: var(--bg-primary);
            position: relative;
            overflow: auto;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
        }

        .canvas-toolbar {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            padding: var(--spacing-sm) var(--spacing-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .canvas-workspace {
            flex: 1;
            padding: var(--spacing-lg);
            background: var(--bg-primary);
            color: var(--text-white);
            position: relative;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-template-rows: repeat(8, minmax(100px, 1fr));
            gap: 8px;
            grid-auto-rows: minmax(100px, auto);
        }
        
        /* Grille visible - lignes de la grille CSS */
        .canvas-workspace.show-grid {
            background-image: 
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent calc(100% / 12 - 1px),
                    rgba(16, 185, 129, 0.3) calc(100% / 12 - 1px),
                    rgba(16, 185, 129, 0.3) calc(100% / 12)
                ),
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent calc(100px - 1px),
                    rgba(16, 185, 129, 0.3) calc(100px - 1px),
                    rgba(16, 185, 129, 0.3) 100px
                );
        }
        
        /* Indicateurs de grille sur chaque cellule */
        .canvas-workspace.show-grid::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            background-image: 
                linear-gradient(rgba(16, 185, 129, 0.2) 1px, transparent 1px),
                linear-gradient(90deg, rgba(16, 185, 129, 0.2) 1px, transparent 1px);
            background-size: calc(100% / 12) 100px;
            z-index: 1;
        }

        /* Widget containers dans le canvas - Grille 2D */
        .widget-container {
            position: relative;
            padding: var(--spacing-md);
            background: var(--bg-card);
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            transition: var(--transition-normal);
            cursor: move;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(5px);
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            z-index: 10; /* Au-dessus de la grille */
        }
        
        .widget-container.dragging {
            opacity: 0.7;
            transform: rotate(2deg);
            z-index: 1000;
        }

        .widget-container:hover {
            border-color: var(--accent-green);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
            border-style: solid;
        }

        .widget-container.selected {
            border-color: var(--accent-green);
            border-style: solid;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
            background: rgba(16, 185, 129, 0.05);
        }
        
        /* Poign√©es de redimensionnement supprim√©es - utilisation des sliders dans l'onglet Organisation */

        .widget-container-header {
            position: absolute;
            top: -30px;
            left: 0;
            right: 0;
            background: var(--accent-green);
            color: white;
            padding: 4px 8px;
            border-radius: 4px 4px 0 0;
            font-size: var(--text-xs);
            font-weight: var(--font-bold);
            display: flex;
            align-items: center;
            justify-content: space-between;
            opacity: 0;
            transition: var(--transition-normal);
        }

        .widget-container:hover .widget-container-header,
        .widget-container.selected .widget-container-header {
            opacity: 1;
        }

        .widget-header-title {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .widget-header-controls {
            display: flex;
            gap: 4px;
        }

        .widget-control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        .widget-control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Panneau de propri√©t√©s avanc√© */
        .properties-panel {
            grid-area: properties;
            background: var(--bg-secondary);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            min-width: 280px;
            max-width: 600px;
            width: var(--properties-width, 350px);
            border-left: 1px solid var(--border-color);
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Handle de redimensionnement */
        .resize-handle {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--border-color);
            cursor: ew-resize;
            z-index: 10;
            opacity: 0;
            transition: all 0.2s ease;
            border-radius: 2px;
        }

        .resize-handle:hover,
        .resize-handle.resizing {
            opacity: 1;
            background: var(--accent-green);
            width: 6px;
            left: -1px;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.3);
        }

        .resize-handle::after {
            content: '';
            position: absolute;
            left: -2px;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 30px;
            background: transparent;
        }

        .properties-panel:hover .resize-handle {
            opacity: 0.6;
        }
        
        /* √âtat collapsed du panneau propri√©t√©s */
        .properties-panel.collapsed {
            width: 40px !important;
            min-width: 40px;
            overflow: hidden;
        }
        
        .properties-panel.collapsed .properties-content {
            display: none;
        }
        
        .properties-panel.collapsed .properties-header {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            padding: var(--spacing-lg) var(--spacing-sm);
            justify-content: center;
            min-height: auto;
        }
        
        .properties-panel.collapsed .properties-title {
            font-size: var(--text-sm);
            writing-mode: vertical-rl;
        }
        
        .properties-panel.collapsed .properties-header-actions {
            position: absolute;
            top: var(--spacing-sm);
            left: 50%;
            transform: translateX(-50%);
        }
        
        .properties-panel.collapsed .properties-width-indicator {
            display: none;
        }

        .properties-header {
            padding: var(--spacing-md) var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, 
                rgba(30, 41, 59, 0.9) 0%, 
                rgba(30, 41, 59, 0.7) 100%);
            backdrop-filter: blur(15px);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 60px;
        }

        .properties-title {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            color: var(--text-white);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .properties-header-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .properties-collapse-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .properties-collapse-btn:hover {
            color: var(--text-white);
            background: rgba(255, 255, 255, 0.1);
        }

        .properties-width-indicator {
            font-size: var(--text-xs);
            color: var(--text-muted);
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            min-width: 50px;
            text-align: center;
        }

        .properties-content {
            flex: 1;
            overflow-y: auto;
            padding: 0;
            background: var(--bg-primary);
        }

        .properties-tabs {
            display: flex;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 5;
            margin: 0;
        }

        .properties-tab {
            flex: 1;
            padding: var(--spacing-md) var(--spacing-lg);
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-bottom: 3px solid transparent;
            font-size: var(--text-sm);
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .properties-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.1) 0%, 
                rgba(16, 185, 129, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .properties-tab:hover {
            color: var(--text-white);
            transform: translateY(-1px);
        }

        .properties-tab:hover::before {
            opacity: 1;
        }

        .properties-tab.active {
            color: var(--accent-green);
            border-bottom-color: var(--accent-green);
            background: rgba(16, 185, 129, 0.15);
            font-weight: 600;
        }

        .properties-tab.active::before {
            opacity: 1;
        }

        .tab-content {
            display: none;
            padding: var(--spacing-lg);
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .property-group {
            margin-bottom: var(--spacing-xl);
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .property-group:hover {
            border-color: var(--accent-green);
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.1);
        }

        .property-group h4 {
            color: var(--text-white);
            margin-bottom: var(--spacing-lg);
            font-size: var(--text-md);
            font-weight: var(--font-semibold);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            position: relative;
            padding-bottom: var(--spacing-sm);
        }

        .property-group h4::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-green), transparent);
            border-radius: 1px;
        }

        .property-group h4 i {
            color: var(--accent-green);
            font-size: 1.1em;
        }

        .property-field {
            margin-bottom: var(--spacing-md);
        }

        .property-label {
            display: block;
            color: var(--text-gray);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            margin-bottom: var(--spacing-xs);
        }

        .property-control {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .property-input {
            flex: 1;
            padding: var(--spacing-md);
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            color: var(--text-white);
            font-size: var(--text-sm);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .property-input:focus {
            outline: none;
            border-color: var(--accent-green);
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.15);
            transform: translateY(-1px);
        }

        .property-input:hover {
            border-color: rgba(16, 185, 129, 0.5);
        }

        .property-range {
            flex: 1;
            height: 6px;
            background: var(--bg-primary);
            outline: none;
            border-radius: 3px;
            -webkit-appearance: none;
        }

        .property-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--accent-green);
            border-radius: 50%;
            cursor: pointer;
        }

        .range-value {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: var(--border-radius);
            padding: 0.25rem 0.5rem;
            text-align: center;
            font-size: var(--text-xs);
            color: var(--accent-green);
            font-weight: var(--font-medium);
            min-width: 50px;
        }

        /* Viewer temps r√©el - Miroir du canvas */
        .editor-viewer {
            grid-area: viewer;
            background: var(--bg-card);
            border-top: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .viewer-header {
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .viewer-title {
            color: var(--text-white);
            font-weight: var(--font-semibold);
            font-size: var(--text-sm);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .viewer-controls {
            display: flex;
            gap: var(--spacing-xs);
        }

        .viewer-content {
            flex: 1;
            overflow: auto;
            padding: var(--spacing-md);
            background: var(--bg-primary);
            color: var(--text-white);
        }

        .presentation-preview {
            width: 100%;
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-template-rows: repeat(8, minmax(80px, 1fr));
            gap: 6px;
            padding: 12px;
            min-height: 600px;
        }
        
        .preview-widget {
            border-radius: 6px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Boutons et contr√¥les */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: var(--bg-card);
            color: var(--text-white);
            cursor: pointer;
            transition: var(--transition-normal);
            text-decoration: none;
            min-height: 32px;
        }

        .btn:hover {
            border-color: var(--border-hover);
            background: var(--bg-secondary);
        }

        .btn.btn-primary {
            background: var(--accent-green);
            border-color: var(--accent-green);
            color: white;
        }

        .btn.btn-primary:hover {
            background: #0d9488;
            border-color: #0d9488;
        }

        .btn.btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: var(--text-xs);
            min-height: 24px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* √âtat vide */
        .empty-state {
            grid-column: 1 / -1;
            grid-row: 1 / -1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: var(--text-muted);
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .empty-text {
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .empty-state.hidden {
            display: none;
        }

        /* Pied de page */
        .editor-footer {
            grid-area: footer;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--spacing-lg);
            font-size: var(--text-sm);
            color: var(--text-muted);
        }

        .footer-status {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success-green);
        }

        .status-indicator.error {
            background: var(--danger-red);
        }

        .status-indicator.warning {
            background: var(--warning-orange);
        }
        
        /* Animations */
        .widget-container {
            animation: slideInUp 0.3s ease-out;
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .properties-panel {
                --properties-width: 300px;
                width: 300px;
            }
        }
        
        @media (max-width: 1024px) {
            .widget-editor {
                grid-template-areas: 
                    "toolbar toolbar"
                    "canvas properties"
                    "viewer viewer"
                    "footer footer";
                grid-template-columns: 1fr 280px;
            }
            
            .widget-library {
                display: none;
            }
            
            .properties-panel {
                --properties-width: 280px;
                width: 280px;
            }
            
            .properties-panel.collapsed {
                width: 30px !important;
            }
        }
        
        @media (max-width: 768px) {
            .widget-editor {
                grid-template-areas: 
                    "toolbar"
                    "canvas"
                    "properties"
                    "viewer"
                    "footer";
                grid-template-columns: 1fr;
                grid-template-rows: 60px 1fr 250px 150px 40px;
            }
            
            .properties-panel {
                --properties-width: 100%;
                width: 100% !important;
                height: 250px;
                border-left: none;
                border-top: 1px solid var(--border-color);
                position: relative;
            }
            
            .properties-panel.collapsed {
                height: 40px !important;
                width: 100% !important;
            }
            
            .properties-panel.collapsed .properties-header {
                writing-mode: horizontal-tb;
                text-orientation: mixed;
                padding: var(--spacing-sm) var(--spacing-lg);
                justify-content: space-between;
            }
            
            .properties-panel.collapsed .properties-title {
                writing-mode: horizontal-tb;
                font-size: var(--text-md);
            }
            
            .properties-panel.collapsed .properties-header-actions {
                position: relative;
                top: auto;
                left: auto;
                transform: none;
            }
            
            .resize-handle {
                display: none;
            }
        }
        
        @media (max-width: 480px) {
            .widget-editor {
                grid-template-rows: 50px 1fr 200px 120px 35px;
            }
            
            .toolbar-title {
                font-size: var(--text-md);
            }
            
            .properties-panel {
                height: 200px;
            }
            
            .properties-panel.collapsed {
                height: 35px !important;
            }
            
            .properties-header {
                padding: var(--spacing-sm);
                min-height: 35px;
            }
        }
    </style>
</head>
<body>
    <div class="widget-editor">
        <!-- Barre d'outils -->
        <div class="editor-toolbar">
            <div class="toolbar-left">
                <div class="toolbar-title">
                    <i class="fas fa-puzzle-piece"></i>
                    √âditeur de Widgets Complet
                </div>
            </div>
            
            <div class="toolbar-center">
                <button class="btn btn-primary" id="addWidgetBtn">
                    <i class="fas fa-plus"></i>
                    Ajouter Widget
                </button>
            </div>
            
            <div class="toolbar-right">
                <button class="btn btn-primary" id="saveBtn">
                    <i class="fas fa-save"></i>
                    Sauvegarder
                </button>
                <button class="btn" id="exportBtn">
                    <i class="fas fa-download"></i>
                    Exporter
                </button>
            </div>
        </div>

        <!-- Biblioth√®que de widgets -->
        <div class="widget-library">
            <div class="library-header">
                <h3 class="library-title">Widgets Disponibles</h3>
                <input type="text" class="library-search" placeholder="Rechercher..." id="widgetSearch">
            </div>
            
            <div class="library-content" id="widgetLibrary">
                <!-- Widgets charg√©s dynamiquement -->
            </div>
        </div>

        <!-- Canvas d'√©dition -->
        <div class="editor-canvas">
            <div class="canvas-toolbar">
                <div class="canvas-tools">
                    <button class="btn btn-sm" id="selectModeBtn">
                        <i class="fas fa-mouse-pointer"></i>
                        √âdition
                    </button>
                    <button class="btn btn-sm" id="gridToggleBtn" onclick="widgetEditor.toggleGrid()">
                        <i class="fas fa-th"></i>
                        Grille
                    </button>
                </div>
                
                <div class="canvas-info">
                    <span>Widgets: <span id="widgetCount">0</span></span>
                </div>
            </div>
            
            <div class="canvas-workspace" id="canvasWorkspace">
                <div class="empty-state" id="emptyState">
                    <div class="empty-icon">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <div class="empty-text">
                        <strong>Canvas Vide</strong><br>
                        Cliquez sur "Ajouter Widget" ou glissez un widget depuis la biblioth√®que
                    </div>
                    <button class="btn btn-primary" id="firstWidgetBtn">
                        <i class="fas fa-plus"></i>
                        Ajouter le premier widget
                    </button>
                </div>
            </div>
        </div>

        <!-- Panneau de propri√©t√©s -->
        <div class="properties-panel">
            <div class="resize-handle" id="propertiesResizeHandle"></div>
            <div class="properties-header">
                <div class="properties-title">
                    <i class="fas fa-sliders-h"></i>
                    Propri√©t√©s
                </div>
                <div class="properties-header-actions">
                    <div class="properties-width-indicator" id="widthIndicator">350px</div>
                    <button class="properties-collapse-btn" id="collapsePropertiesBtn" title="R√©duire/Agrandir">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            
            <div class="properties-content" id="propertiesContent">
                <div class="properties-tabs">
                    <button class="properties-tab active" data-tab="properties">Propri√©t√©s</button>
                    <button class="properties-tab" data-tab="elements">√âl√©ments</button>
                    <button class="properties-tab" data-tab="organization">Organisation</button>
                </div>
                
                <div class="tab-content active" id="propertiesTab">
                    <div class="properties-empty">
                        <i class="fas fa-info-circle" style="font-size: 2rem; opacity: 0.3; margin-bottom: 1rem;"></i>
                        <p>S√©lectionnez un widget pour voir ses propri√©t√©s</p>
                    </div>
                </div>
                
                <div class="tab-content" id="elementsTab">
                    <div class="property-group">
                        <h4><i class="fas fa-list"></i> √âl√©ments du Widget</h4>
                        <div id="elementsContainer">
                            <p style="color: var(--text-muted); font-style: italic;">Aucun widget s√©lectionn√©</p>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="organizationTab">
                    <div class="property-group">
                        <h4><i class="fas fa-expand-arrows-alt"></i> Taille & Position</h4>
                        
                        <div class="property-field">
                            <label class="property-label">Pr√©r√©glages de taille</label>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button class="btn btn-sm" id="fullScreenBtn" disabled>
                                    <i class="fas fa-expand"></i>
                                    Plein √©cran
                                </button>
                                <button class="btn btn-sm" id="fillParentBtn" disabled>
                                    <i class="fas fa-arrows-alt"></i>
                                    Remplir parent
                                </button>
                            </div>
                        </div>
                        
                        <div class="property-field">
                            <label class="property-label">Largeur (colonnes)</label>
                            <div class="property-control">
                                <input type="range" id="widthSlider" class="property-range" 
                                       min="1" max="12" value="3" disabled
                                       oninput="widgetEditor.updateWidgetSize('width', this.value)">
                                <input type="number" id="widthInput" class="property-input" 
                                       min="1" max="12" value="3" disabled
                                       style="width: 60px; text-align: center;"
                                       onchange="widgetEditor.updateWidgetSize('width', this.value)">
                            </div>
                        </div>
                        
                        <div class="property-field">
                            <label class="property-label">Hauteur (rang√©es)</label>
                            <div class="property-control">
                                <input type="range" id="heightSlider" class="property-range" 
                                       min="1" max="8" value="2" disabled
                                       oninput="widgetEditor.updateWidgetSize('height', this.value)">
                                <input type="number" id="heightInput" class="property-input" 
                                       min="1" max="8" value="2" disabled
                                       style="width: 60px; text-align: center;"
                                       onchange="widgetEditor.updateWidgetSize('height', this.value)">
                            </div>
                        </div>
                        
                        <div class="property-field">
                            <label class="property-label">Position</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                <div>
                                    <label class="property-label" style="font-size: var(--text-xs); margin-bottom: 4px;">Colonne</label>
                                    <input type="number" id="positionColInput" class="property-input" 
                                           min="1" max="12" value="1" disabled
                                           style="text-align: center;"
                                           onchange="widgetEditor.updateWidgetPosition('col', this.value)">
                                </div>
                                <div>
                                    <label class="property-label" style="font-size: var(--text-xs); margin-bottom: 4px;">Rang√©e</label>
                                    <input type="number" id="positionRowInput" class="property-input" 
                                           min="1" max="8" value="1" disabled
                                           style="text-align: center;"
                                           onchange="widgetEditor.updateWidgetPosition('row', this.value)">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="property-group">
                        <h4><i class="fas fa-arrows-alt"></i> Organisation</h4>
                        <div class="property-field">
                            <button class="btn btn-sm" id="moveUpBtn" disabled>
                                <i class="fas fa-arrow-up"></i>
                                Monter
                            </button>
                            <button class="btn btn-sm" id="moveDownBtn" disabled>
                                <i class="fas fa-arrow-down"></i>
                                Descendre
                            </button>
                        </div>
                        <div class="property-field">
                            <button class="btn btn-sm" id="duplicateBtn" disabled>
                                <i class="fas fa-copy"></i>
                                Dupliquer
                            </button>
                            <button class="btn btn-sm" id="deleteBtn" disabled>
                                <i class="fas fa-trash"></i>
                                Supprimer
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Viewer temps r√©el -->
        <div class="editor-viewer">
            <div class="viewer-header">
                <div class="viewer-title">
                    <i class="fas fa-desktop"></i>
                    Aper√ßu Temps R√©el
                </div>
                <div class="viewer-controls">
                    <button class="btn btn-sm" id="refreshPreviewBtn">
                        <i class="fas fa-sync"></i>
                        Actualiser
                    </button>
                    <button class="btn btn-sm" id="fullscreenPreviewBtn">
                        <i class="fas fa-expand"></i>
                        Plein √©cran
                    </button>
                </div>
            </div>
            
            <div class="viewer-content" id="viewerContent">
                <div class="presentation-preview" id="presentationPreview">
                    <div style="padding: 2rem; text-align: center; color: #6b7280;">
                        <i class="fas fa-eye" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                        <div>L'aper√ßu temps r√©el appara√Ætra ici</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pied de page -->
        <div class="editor-footer">
            <div class="footer-status">
                <div class="status-item">
                    <div class="status-indicator" id="statusIndicator"></div>
                    <span id="statusText">Pr√™t</span>
                </div>
                <div class="status-item">
                    <span>Derni√®re sauvegarde: <span id="lastSave">Jamais</span></span>
                </div>
            </div>
            
            <div class="footer-actions">
                <span>√âditeur de Widgets Li-CUBE PRO‚Ñ¢ v2.0</span>
            </div>
        </div>
    </div>

    <script>
        // ========================================================================
        // WIDGETS INT√âGR√âS - Tous les widgets du test-simple.html
        // ========================================================================
        
        class LogoWidget {
            constructor() {
                this.id = 'logo';
                this.name = 'Logo';
                this.category = 'Navigation';
                this.icon = 'üè¢';
                this.description = 'Logo avec image et effets hover';
                
                this.defaultData = {
                    imagePath: '../assets/images/logo-eds.png',
                    altText: 'Logo EDS Qu√©bec',
                    width: 60,
                    height: 60,
                    link: '#',
                    hoverEffect: true
                };
            }

            render(data = {}) {
                const d = { ...this.defaultData, ...data };
                
                return `
                    <div class="logo-container" style="text-align: center; padding: 20px; height: 100%;">
                        <a href="${d.link}" 
                           class="nav-logo logo-image ${d.hoverEffect ? 'hover-effect' : ''}"
                           style="display: inline-block; width: ${d.width}px; height: ${d.height}px; 
                                  border-radius: 12px; background: rgba(16, 185, 129, 0.1);
                                  border: 2px solid rgba(16, 185, 129, 0.3);
                                  background-image: url('${d.imagePath}');
                                  background-size: 80%; background-repeat: no-repeat; 
                                  background-position: center; transition: all 0.3s ease;
                                  text-decoration: none;">
                            <span style="position: absolute; width: 1px; height: 1px; overflow: hidden;">
                                ${d.altText}
                            </span>
                        </a>
                    </div>
                `;
            }

            getEditableFields() {
                return [
                    { name: 'imagePath', label: 'Chemin image', type: 'text' },
                    { name: 'altText', label: 'Texte alternatif', type: 'text' },
                    { name: 'width', label: 'Largeur', type: 'range', min: 30, max: 150 },
                    { name: 'height', label: 'Hauteur', type: 'range', min: 30, max: 150 },
                    { name: 'link', label: 'Lien', type: 'text' },
                    { name: 'hoverEffect', label: 'Effet hover', type: 'checkbox' }
                ];
            }

            getElements() {
                return [
                    { id: 'container', name: 'Conteneur', editable: true },
                    { id: 'link', name: 'Lien', editable: true },
                    { id: 'image', name: 'Image', editable: true }
                ];
            }
        }

        class HeroTitleWidget {
            constructor() {
                this.id = 'hero-title';
                this.name = 'Titre Hero';
                this.category = 'Contenu';
                this.icon = '‚ú®';
                this.description = 'Titre principal avec gradient';
                
                this.defaultData = {
                    title: 'Li-CUBE PRO‚Ñ¢',
                    subtitle: 'LOCATION INTELLIGENTE Z√âRO RISQUE',
                    titleSize: 48,
                    subtitleSize: 24,
                    gradient: true,
                    animation: 'slide-up',
                    alignment: 'center',
                    backgroundColor: 'transparent',
                    borderRadius: 0
                };
            }

            render(data = {}) {
                const d = { ...this.defaultData, ...data };
                
                const gradientStyle = d.gradient ? 
                    'background: linear-gradient(135deg, #10b981, #0d9488); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;' : 
                    'color: #10b981;';
                
                const backgroundStyle = d.backgroundColor !== 'transparent' ? 
                    `background-color: ${d.backgroundColor}; ` : 
                    '';
                
                const borderRadiusStyle = d.borderRadius > 0 ? 
                    `border-radius: ${d.borderRadius}px; overflow: hidden; ` : 
                    '';
                
                return `
                    <div class="hero-section" style="text-align: ${d.alignment}; padding: 60px 20px; 
                                                   ${backgroundStyle}${borderRadiusStyle}
                                                   transition: all 0.3s ease;">
                        <h1 class="hero-title ${d.animation}" 
                            style="font-size: ${d.titleSize}px; font-weight: 900; 
                                   ${gradientStyle} margin-bottom: 20px; line-height: 1.1;
                                   animation-delay: 0.2s;">
                            ${d.title}
                        </h1>
                        <div class="hero-subtitle ${d.animation}"
                             style="font-size: ${d.subtitleSize}px; font-weight: 600; 
                                    color: #6b7280; line-height: 1.3; max-width: 600px; 
                                    margin: 0 auto; animation-delay: 0.4s;">
                            ${d.subtitle}
                        </div>
                    </div>
                `;
            }

            getEditableFields() {
                return [
                    { name: 'title', label: 'Titre', type: 'text', category: 'Contenu' },
                    { name: 'subtitle', label: 'Sous-titre', type: 'textarea', category: 'Contenu' },
                    { name: 'titleSize', label: 'Taille titre', type: 'range', min: 24, max: 72, category: 'Typographie' },
                    { name: 'subtitleSize', label: 'Taille sous-titre', type: 'range', min: 14, max: 36, category: 'Typographie' },
                    { name: 'gradient', label: 'Gradient', type: 'checkbox', category: 'Style' },
                    { name: 'alignment', label: 'Alignement', type: 'select', category: 'Layout', options: [
                        { value: 'left', label: 'Gauche' },
                        { value: 'center', label: 'Centre' },
                        { value: 'right', label: 'Droite' }
                    ]},
                    { name: 'backgroundColor', label: 'Couleur d\'arri√®re-plan', type: 'color', category: 'Style' },
                    { name: 'borderRadius', label: 'Arrondi des bords', type: 'range', min: 0, max: 50, category: 'Style' }
                ];
            }

            getElements() {
                return [
                    { id: 'section', name: 'Section Hero', editable: true },
                    { id: 'title', name: 'Titre principal', editable: true },
                    { id: 'subtitle', name: 'Sous-titre', editable: true }
                ];
            }
        }

        class PricingCardWidget {
            constructor() {
                this.id = 'pricing-card';
                this.name = 'Carte Tarification';
                this.category = 'Commerce';
                this.icon = 'üí∞';
                this.description = 'Carte de prix compl√®te';
                
                this.defaultData = {
                    planName: 'ESSENTIEL',
                    price: '299',
                    currency: '$',
                    period: '/mois',
                    ctaText: 'Choisir ce plan',
                    ctaLink: '#contact',
                    featured: false,
                    badge: '',
                    accentColor: '#10b981',
                    backgroundColor: '#1f2937',
                    textColor: '#ffffff',
                    features: [
                        'Installation gratuite',
                        'Maintenance incluse',
                        'Support par email',
                        'Jusqu\'√† 50 √©quipements'
                    ]
                };
            }

            render(data = {}) {
                const d = { ...this.defaultData, ...data };
                
                const featuresHtml = d.features.map(feature => 
                    `<li style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px; color: ${d.textColor || '#6b7280'};">
                        <span style="color: ${d.accentColor || '#10b981'}; font-size: 14px;">‚úì</span>
                        <span>${feature}</span>
                    </li>`
                ).join('');

                const badgeHtml = d.badge ? 
                    `<div class="pricing-badge" style="position: absolute; top: -10px; left: 50%; 
                                                      transform: translateX(-50%); background: ${d.accentColor || '#10b981'}; 
                                                      color: white; padding: 4px 12px; border-radius: 6px; 
                                                      font-size: 12px; font-weight: bold;">
                        ${d.badge}
                    </div>` : '';

                return `
                    <div class="pricing-card ${d.featured ? 'featured' : ''}" 
                         style="background: ${d.backgroundColor || '#1f2937'}; 
                                border: 2px solid ${d.featured ? (d.accentColor || '#10b981') : '#374151'}; 
                                border-radius: 12px; padding: 32px; text-align: center; position: relative; 
                                backdrop-filter: blur(10px); margin: 20px; color: ${d.textColor || '#ffffff'};">
                        ${badgeHtml}
                        
                        <div style="margin-bottom: 32px;">
                            <h3 style="font-size: 1.25rem; font-weight: bold; color: ${d.textColor || 'white'}; margin-bottom: 20px; 
                                       text-transform: uppercase; letter-spacing: 0.05em;">
                                ${d.planName}
                            </h3>
                            
                            <div style="display: flex; align-items: baseline; justify-content: center; gap: 8px; margin-bottom: 20px;">
                                <span style="font-size: 2rem; font-weight: 600; color: ${d.accentColor || '#10b981'};">${d.currency}</span>
                                <span style="font-size: 3.5rem; font-weight: 900; color: ${d.textColor || 'white'}; line-height: 1;">${d.price}</span>
                                <span style="font-size: 1.125rem; color: #9ca3af; font-weight: 500;">${d.period}</span>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 32px;">
                            <ul style="list-style: none; padding: 0; margin: 0; text-align: left;">
                                ${featuresHtml}
                            </ul>
                        </div>
                        
                        <div>
                            <a href="${d.ctaLink}" 
                               style="width: 100%; padding: 16px 24px; background: ${d.accentColor || '#10b981'}; color: white;
                                      border: none; border-radius: 8px; font-size: 1rem; font-weight: 600;
                                      text-transform: uppercase; letter-spacing: 0.05em; transition: all 0.3s;
                                      text-decoration: none; display: inline-block; cursor: pointer;">
                                ${d.ctaText}
                            </a>
                        </div>
                    </div>
                `;
            }

            getEditableFields() {
                return [
                    { name: 'planName', label: 'Nom du plan', type: 'text', category: 'Contenu' },
                    { name: 'price', label: 'Prix', type: 'text', category: 'Contenu' },
                    { name: 'currency', label: 'Devise', type: 'text', category: 'Contenu' },
                    { name: 'period', label: 'P√©riode', type: 'text', category: 'Contenu' },
                    { name: 'ctaText', label: 'Texte bouton', type: 'text', category: 'Contenu' },
                    { name: 'ctaLink', label: 'Lien bouton', type: 'text', category: 'Contenu' },
                    { name: 'featured', label: 'Plan vedette', type: 'checkbox', category: 'Contenu' },
                    { name: 'badge', label: 'Badge', type: 'text', category: 'Contenu' },
                    { name: 'accentColor', label: 'Couleur principale', type: 'color', category: 'Style' },
                    { name: 'backgroundColor', label: 'Couleur de fond', type: 'color', category: 'Style' },
                    { name: 'textColor', label: 'Couleur du texte', type: 'color', category: 'Style' }
                ];
            }

            getElements() {
                return [
                    { id: 'card', name: 'Carte principale', editable: true },
                    { id: 'header', name: 'En-t√™te', editable: true },
                    { id: 'price', name: 'Prix', editable: true },
                    { id: 'features', name: 'Fonctionnalit√©s', editable: true, manageable: true },
                    { id: 'cta', name: 'Bouton action', editable: true }
                ];
            }
            
            // M√©thodes pour gestion dynamique des fonctionnalit√©s
            addFeature(newFeature) {
                if (!newFeature || newFeature.trim() === '') return;
                this.defaultData.features.push(newFeature.trim());
            }
            
            removeFeature(index) {
                if (index >= 0 && index < this.defaultData.features.length) {
                    this.defaultData.features.splice(index, 1);
                }
            }
            
            updateFeature(index, newText) {
                if (index >= 0 && index < this.defaultData.features.length) {
                    this.defaultData.features[index] = newText;
                }
            }
        }

        class CallToActionWidget {
            constructor() {
                this.id = 'call-to-action';
                this.name = 'Call to Action';
                this.category = 'Action';
                this.icon = 'üéØ';
                this.description = 'Section d\'appel √† l\'action';
                
                this.defaultData = {
                    title: 'Pr√™t √† commencer ?',
                    description: 'Contactez-nous d√®s aujourd\'hui pour une consultation gratuite',
                    primaryButtonText: 'Nous Contacter',
                    primaryButtonLink: '#contact',
                    secondaryButtonText: 'En savoir plus',
                    secondaryButtonLink: '#info',
                    backgroundColor: '#10b981',
                    showSecondaryButton: true
                };
            }

            render(data = {}) {
                const d = { ...this.defaultData, ...data };
                
                const secondaryButton = d.showSecondaryButton ? 
                    `<a href="${d.secondaryButtonLink}" 
                       style="padding: 12px 24px; background: transparent; color: white; 
                              border: 2px solid white; border-radius: 8px; font-weight: 600; 
                              text-decoration: none; margin-left: 16px; display: inline-block;">
                        ${d.secondaryButtonText}
                    </a>` : '';

                return `
                    <div class="cta-section" 
                         style="background: ${d.backgroundColor}; color: white; padding: 80px 20px; 
                                text-align: center; margin: 40px 0;">
                        <h2 style="font-size: 2.5rem; font-weight: bold; margin-bottom: 20px;">
                            ${d.title}
                        </h2>
                        <p style="font-size: 1.25rem; margin-bottom: 40px; max-width: 600px; margin-left: auto; margin-right: auto;">
                            ${d.description}
                        </p>
                        <div class="cta-buttons">
                            <a href="${d.primaryButtonLink}" 
                               style="padding: 16px 32px; background: white; color: ${d.backgroundColor}; 
                                      border-radius: 8px; font-size: 1.125rem; font-weight: 600; 
                                      text-decoration: none; display: inline-block;">
                                ${d.primaryButtonText}
                            </a>
                            ${secondaryButton}
                        </div>
                    </div>
                `;
            }

            getEditableFields() {
                return [
                    { name: 'title', label: 'Titre', type: 'text' },
                    { name: 'description', label: 'Description', type: 'textarea' },
                    { name: 'primaryButtonText', label: 'Texte bouton principal', type: 'text' },
                    { name: 'primaryButtonLink', label: 'Lien bouton principal', type: 'text' },
                    { name: 'secondaryButtonText', label: 'Texte bouton secondaire', type: 'text' },
                    { name: 'secondaryButtonLink', label: 'Lien bouton secondaire', type: 'text' },
                    { name: 'showSecondaryButton', label: 'Afficher bouton secondaire', type: 'checkbox' },
                    { name: 'backgroundColor', label: 'Couleur de fond', type: 'color' }
                ];
            }

            getElements() {
                return [
                    { id: 'section', name: 'Section CTA', editable: true },
                    { id: 'title', name: 'Titre', editable: true },
                    { id: 'description', name: 'Description', editable: true },
                    { id: 'buttons', name: 'Boutons', editable: true }
                ];
            }
        }

        class FeatureGridWidget {
            constructor() {
                this.id = 'feature-grid';
                this.name = 'Grille de Fonctionnalit√©s';
                this.category = 'Contenu';
                this.icon = '‚≠ê';
                this.description = 'Grille de fonctionnalit√©s avec ic√¥nes √©ditables';
                
                this.defaultData = {
                    title: 'Pourquoi Nous Choisir ?',
                    features: [
                        {
                            icon: 'üöÄ',
                            title: 'Performance',
                            description: 'Des solutions rapides et efficaces',
                            iconSize: '3rem',
                            titleColor: 'white',
                            titleSize: '1.5rem',
                            descriptionColor: 'var(--text-gray)',
                            descriptionSize: '0.95rem',
                            backgroundColor: 'var(--bg-card)',
                            borderColor: 'var(--border-color)'
                        },
                        {
                            icon: 'üîí',
                            title: 'S√©curit√©',
                            description: 'Protection maximale de vos donn√©es',
                            iconSize: '3rem',
                            titleColor: 'white',
                            titleSize: '1.5rem',
                            descriptionColor: 'var(--text-gray)',
                            descriptionSize: '0.95rem',
                            backgroundColor: 'var(--bg-card)',
                            borderColor: 'var(--border-color)'
                        },
                        {
                            icon: 'üí°',
                            title: 'Innovation',
                            description: 'Technologies de pointe',
                            iconSize: '3rem',
                            titleColor: 'white',
                            titleSize: '1.5rem',
                            descriptionColor: 'var(--text-gray)',
                            descriptionSize: '0.95rem',
                            backgroundColor: 'var(--bg-card)',
                            borderColor: 'var(--border-color)'
                        },
                        {
                            icon: 'ü§ù',
                            title: 'Support',
                            description: '√âquipe d√©di√©e √† votre service',
                            iconSize: '3rem',
                            titleColor: 'white',
                            titleSize: '1.5rem',
                            descriptionColor: 'var(--text-gray)',
                            descriptionSize: '0.95rem',
                            backgroundColor: 'var(--bg-card)',
                            borderColor: 'var(--border-color)'
                        },
                        {
                            icon: 'üéØ',
                            title: 'Pr√©cision',
                            description: 'R√©sultats cibl√©s et mesurables',
                            iconSize: '3rem',
                            titleColor: 'white',
                            titleSize: '1.5rem',
                            descriptionColor: 'var(--text-gray)',
                            descriptionSize: '0.95rem',
                            backgroundColor: 'var(--bg-card)',
                            borderColor: 'var(--border-color)'
                        },
                        {
                            icon: 'üåü',
                            title: 'Excellence',
                            description: 'Standards de qualit√© √©lev√©s',
                            iconSize: '3rem',
                            titleColor: 'white',
                            titleSize: '1.5rem',
                            descriptionColor: 'var(--text-gray)',
                            descriptionSize: '0.95rem',
                            backgroundColor: 'var(--bg-card)',
                            borderColor: 'var(--border-color)'
                        }
                    ],
                    columns: 3,
                    featuresCount: 4
                };
            }

            render(data = {}) {
                const d = { ...this.defaultData, ...data };
                
                // Limiter les features affich√©es selon featuresCount
                const displayedFeatures = d.features.slice(0, d.featuresCount || 4);
                
                const featuresHtml = displayedFeatures.map(feature => 
                    `<div class="feature-card" 
                          style="background: ${feature.backgroundColor || 'var(--bg-card)'}; 
                                 padding: 32px; border-radius: 12px; 
                                 text-align: center; 
                                 border: 1px solid ${feature.borderColor || 'var(--border-color)'}; 
                                 transition: transform 0.3s ease, box-shadow 0.3s ease;">
                        <div style="font-size: ${feature.iconSize || '3rem'}; margin-bottom: 20px; line-height: 1;">${feature.icon || '‚≠ê'}</div>
                        <h3 style="color: ${feature.titleColor || 'white'}; 
                                   font-size: ${feature.titleSize || '1.5rem'}; 
                                   margin-bottom: 16px; font-weight: bold;">
                            ${feature.title || 'Titre'}
                        </h3>
                        <p style="color: ${feature.descriptionColor || 'var(--text-gray)'}; 
                                  line-height: 1.6; 
                                  font-size: ${feature.descriptionSize || '0.95rem'};">
                            ${feature.description || 'Description de la fonctionnalit√©'}
                        </p>
                    </div>`
                ).join('');

                return `
                    <div class="features-section" style="padding: 80px 20px; background: var(--bg-primary);">
                        <h2 style="text-align: center; font-size: 2.5rem; font-weight: bold; 
                                   color: white; margin-bottom: 60px; line-height: 1.2;">
                            ${d.title}
                        </h2>
                        <div class="features-grid" 
                             style="display: grid; grid-template-columns: repeat(${d.columns}, 1fr); 
                                    gap: 32px; max-width: 1400px; margin: 0 auto; width: 100%;">
                            ${featuresHtml}
                        </div>
                    </div>
                `;
            }

            getEditableFields() {
                return [
                    { name: 'title', label: 'Titre principal', type: 'text' },
                    { name: 'featuresCount', label: 'Nombre de fonctionnalit√©s', type: 'range', min: 1, max: 12 },
                    { name: 'columns', label: 'Colonnes dans la grille', type: 'range', min: 1, max: 4 }
                ];
            }

            getElements() {
                return [
                    { id: 'section', name: 'Section fonctionnalit√©s', editable: true },
                    { id: 'title', name: 'Titre principal', editable: true },
                    { id: 'grid', name: 'Grille', editable: true },
                    { id: 'features', name: 'Fonctionnalit√©s individuelles', editable: true }
                ];
            }
            
            // M√©thodes pour g√©rer les fonctionnalit√©s
            addFeature() {
                if (!this.defaultData.features) this.defaultData.features = [];
                this.defaultData.features.push({
                    icon: '‚≠ê',
                    title: 'Nouvelle fonctionnalit√©',
                    description: 'Description de la fonctionnalit√©'
                });
            }
            
            removeFeature(index) {
                if (this.defaultData.features && index >= 0 && index < this.defaultData.features.length) {
                    this.defaultData.features.splice(index, 1);
                }
            }
            
            updateFeature(index, field, value) {
                if (this.defaultData.features && index >= 0 && index < this.defaultData.features.length) {
                    this.defaultData.features[index][field] = value;
                }
            }
        }

        // ========================================================================
        // √âDITEUR DE WIDGETS COMPLET
        // ========================================================================

        class WidgetEditorComplete {
            constructor() {
                this.widgets = [];
                this.selectedWidget = null;
                
                // Widgets disponibles
                this.availableWidgets = [
                    LogoWidget,
                    HeroTitleWidget,
                    PricingCardWidget,
                    CallToActionWidget,
                    FeatureGridWidget
                ];
                
                this.widgetCategories = {
                    'Navigation': [],
                    'Contenu': [],
                    'Commerce': [],
                    'Action': []
                };
                
                this.init();
            }

            init() {
                this.setupWidgetCategories();
                this.setupEventListeners();
                this.renderWidgetLibrary();
                this.updatePreview();
                this.setStatus('√âditeur pr√™t', 'success');
            }

            setupWidgetCategories() {
                this.availableWidgets.forEach(WidgetClass => {
                    const instance = new WidgetClass();
                    if (!this.widgetCategories[instance.category]) {
                        this.widgetCategories[instance.category] = [];
                    }
                    this.widgetCategories[instance.category].push(instance);
                });
            }

            setupEventListeners() {
                // Boutons principaux
                document.getElementById('addWidgetBtn').addEventListener('click', () => this.showAddWidgetDialog());
                document.getElementById('firstWidgetBtn').addEventListener('click', () => this.showAddWidgetDialog());
                document.getElementById('saveBtn').addEventListener('click', () => this.saveProject());
                document.getElementById('exportBtn').addEventListener('click', () => this.exportProject());
                
                // Onglets propri√©t√©s
                document.querySelectorAll('.properties-tab').forEach(tab => {
                    tab.addEventListener('click', () => this.switchPropertiesTab(tab.dataset.tab));
                });
                
                // Boutons organisation
                document.getElementById('moveUpBtn').addEventListener('click', () => this.moveWidget(-1));
                document.getElementById('moveDownBtn').addEventListener('click', () => this.moveWidget(1));
                document.getElementById('duplicateBtn').addEventListener('click', () => this.duplicateWidget());
                document.getElementById('deleteBtn').addEventListener('click', () => this.deleteWidget());
                
                // Boutons pr√©r√©glages de taille
                document.getElementById('fullScreenBtn').addEventListener('click', () => this.setFullScreen());
                document.getElementById('fillParentBtn').addEventListener('click', () => this.fillParent());
                
                // Recherche
                const searchInput = document.getElementById('widgetSearch');
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => this.filterWidgets(e.target.value));
                }
                
                // Refresh preview
                document.getElementById('refreshPreviewBtn').addEventListener('click', () => this.updatePreview());
                
                // Syst√®me de redimensionnement du panneau propri√©t√©s
                this.setupPropertiesResize();
                
                // Bouton de collapse du panneau propri√©t√©s
                document.getElementById('collapsePropertiesBtn').addEventListener('click', () => this.togglePropertiesPanel());
                
                // Event pour clic sur workspace (d√©s√©lection)
                const workspace = document.getElementById('canvasWorkspace');
                if (workspace) {
                    workspace.addEventListener('click', (e) => {
                        if (e.target === workspace) {
                            this.selectWidget(null);
                        }
                    });
                }
            }

            renderWidgetLibrary() {
                const library = document.getElementById('widgetLibrary');
                library.innerHTML = '';
                
                Object.entries(this.widgetCategories).forEach(([category, widgets]) => {
                    if (widgets.length === 0) return;
                    
                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'widget-category';
                    
                    const categoryTitle = document.createElement('div');
                    categoryTitle.className = 'category-title';
                    categoryTitle.textContent = category;
                    categoryDiv.appendChild(categoryTitle);
                    
                    widgets.forEach(widget => {
                        const widgetItem = this.createWidgetItem(widget);
                        categoryDiv.appendChild(widgetItem);
                    });
                    
                    library.appendChild(categoryDiv);
                });
            }

            createWidgetItem(widget) {
                const item = document.createElement('div');
                item.className = 'widget-item';
                item.dataset.widgetType = widget.id;
                
                item.innerHTML = `
                    <div class="widget-icon">${widget.icon}</div>
                    <div class="widget-info">
                        <div class="widget-name">${widget.name}</div>
                        <div class="widget-description">${widget.description}</div>
                    </div>
                `;
                
                item.addEventListener('click', () => this.addWidget(widget.id));
                
                return item;
            }

            showAddWidgetDialog() {
                // Pour simplifier, ajouter directement un widget par d√©faut
                this.addWidget('hero-title');
            }

            addWidget(widgetType) {
                const WidgetClass = this.availableWidgets.find(w => new w().id === widgetType);
                if (!WidgetClass) return;
                
                const widgetInstance = new WidgetClass();
                
                // Position sera d√©finie apr√®s la taille
                let position;
                
                // D√©finir une taille par d√©faut selon le type de widget
                let defaultSize = { width: 3, height: 2 };
                switch (widgetType) {
                    case 'feature-grid':
                        defaultSize = { width: 8, height: 4 }; // Plus large pour √©viter le crop
                        break;
                    case 'hero-title':
                        defaultSize = { width: 6, height: 3 };
                        break;
                    case 'pricing-card':
                        defaultSize = { width: 4, height: 4 };
                        break;
                    case 'call-to-action':
                        defaultSize = { width: 8, height: 2 };
                        break;
                    case 'logo':
                        defaultSize = { width: 2, height: 1 };
                        break;
                    default:
                        defaultSize = { width: 3, height: 2 };
                }
                
                // Trouver une position libre avec la taille appropri√©e (centre vers l'ext√©rieur)
                position = this.findFreeGridPosition(defaultSize.width, defaultSize.height);
                
                const widgetData = {
                    id: `widget-${Date.now()}`,
                    type: widgetType,
                    instance: widgetInstance,
                    data: { ...widgetInstance.defaultData },
                    position: position,
                    size: defaultSize
                };
                
                this.widgets.push(widgetData);
                this.saveToHistory('Ajout widget');
                this.renderCanvas();
                this.selectWidget(widgetData.id);
                this.updatePreview();
                
                // Masquer l'√©tat vide
                const emptyState = document.getElementById('emptyState');
                if (emptyState) {
                    emptyState.classList.add('hidden');
                    emptyState.style.display = 'none';
                }
                
                document.getElementById('widgetCount').textContent = this.widgets.length;
                this.setStatus(`Widget ${widgetInstance.name} ajout√©`, 'success');
            }

            renderCanvas() {
                const workspace = document.getElementById('canvasWorkspace');
                const emptyState = document.getElementById('emptyState');
                
                // Toujours supprimer les widgets existants du DOM en premier
                workspace.querySelectorAll('.widget-container').forEach(w => w.remove());
                
                if (this.widgets.length === 0) {
                    emptyState.classList.remove('hidden');
                    emptyState.style.display = 'flex';
                    return;
                }
                
                emptyState.classList.add('hidden');
                emptyState.style.display = 'none';
                
                this.widgets.forEach((widget, index) => {
                    const container = this.createWidgetContainer(widget, index);
                    workspace.appendChild(container);
                });
            }

            createWidgetContainer(widget, index) {
                const container = document.createElement('div');
                container.className = 'widget-container';
                container.dataset.widgetId = widget.id;
                
                // Position sur la grille
                const pos = widget.position || { col: 1, row: 1 };
                const size = widget.size || { width: 3, height: 2 };
                
                container.style.gridColumnStart = pos.col;
                container.style.gridColumnEnd = pos.col + size.width;
                container.style.gridRowStart = pos.row;
                container.style.gridRowEnd = pos.row + size.height;
                
                const headerContent = `
                    <div class="widget-header-title">
                        <span>${widget.instance.icon}</span>
                        <span>${widget.instance.name}</span>
                    </div>
                    <div class="widget-header-controls">
                        <button class="widget-control-btn" onclick="widgetEditor.duplicateWidget('${widget.id}')" title="Dupliquer">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button class="widget-control-btn" onclick="widgetEditor.deleteWidget('${widget.id}')" title="Supprimer">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                container.innerHTML = `
                    <div class="widget-container-header">${headerContent}</div>
                    <div class="widget-content" style="flex: 1;">${widget.instance.render(widget.data)}</div>
                `;
                
                // Events
                container.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.selectWidget(widget.id);
                });
                
                // Drag & drop pour placement libre
                this.setupDragDrop(container, widget);
                
                return container;
            }

            selectWidget(widgetId) {
                // D√©s√©lectionner l'ancien
                document.querySelectorAll('.widget-container.selected').forEach(w => {
                    w.classList.remove('selected');
                });
                
                if (widgetId) {
                    // S√©lectionner le nouveau
                    const container = document.querySelector(`[data-widget-id="${widgetId}"]`);
                    if (container) {
                        container.classList.add('selected');
                        this.selectedWidget = this.widgets.find(w => w.id === widgetId);
                        this.updatePropertiesPanel();
                        this.updateOrganizationButtons();
                    }
                } else {
                    // D√©s√©lection
                    this.selectedWidget = null;
                    this.updatePropertiesPanel();
                    this.updateOrganizationButtons();
                }
            }

            updatePropertiesPanel() {
                if (!this.selectedWidget) {
                    document.getElementById('propertiesTab').innerHTML = `
                        <div class="properties-empty">
                            <i class="fas fa-info-circle" style="font-size: 2rem; opacity: 0.3; margin-bottom: 1rem;"></i>
                            <p>S√©lectionnez un widget pour voir ses propri√©t√©s</p>
                        </div>
                    `;
                    return;
                }
                
                const widget = this.selectedWidget;
                const fields = widget.instance.getEditableFields();
                
                let propertiesHtml = `
                    <div class="property-group">
                        <h4><i class="fas fa-info-circle"></i> Informations</h4>
                        <div style="color: var(--text-muted); margin-bottom: 1rem;">
                            Type: ${widget.instance.name}<br>
                            ID: ${widget.id}
                        </div>
                    </div>
                    
                    <div class="property-group">
                        <h4><i class="fas fa-sliders-h"></i> Propri√©t√©s</h4>
                `;
                
                fields.forEach(field => {
                    propertiesHtml += this.createPropertyField(field, widget);
                });
                
                propertiesHtml += '</div>';
                
                document.getElementById('propertiesTab').innerHTML = propertiesHtml;
                
                // Update elements tab
                this.updateElementsTab();
            }

            createPropertyField(field, widget) {
                const value = widget.data[field.name];
                const fieldId = `prop-${field.name}`;
                
                let inputHtml = '';
                
                switch (field.type) {
                    case 'text':
                        inputHtml = `
                            <input type="text" id="${fieldId}" class="property-input" 
                                   value="${value}" 
                                   onchange="widgetEditor.updateProperty('${field.name}', this.value)"
                                   oninput="widgetEditor.updateProperty('${field.name}', this.value)">
                        `;
                        break;
                        
                    case 'textarea':
                        inputHtml = `
                            <textarea id="${fieldId}" class="property-input" rows="3"
                                      onchange="widgetEditor.updateProperty('${field.name}', this.value)"
                                      oninput="widgetEditor.updateProperty('${field.name}', this.value)">${value}</textarea>
                        `;
                        break;
                        
                    case 'range':
                        inputHtml = `
                            <div class="property-control">
                                <input type="range" id="${fieldId}" class="property-range" 
                                       min="${field.min || 0}" max="${field.max || 100}" value="${value}"
                                       oninput="widgetEditor.updateProperty('${field.name}', this.value)"
                                       onchange="widgetEditor.updateProperty('${field.name}', this.value)">
                                <span class="range-value" id="${fieldId}-value">${value}</span>
                            </div>
                        `;
                        break;
                        
                    case 'checkbox':
                        inputHtml = `
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="${fieldId}" ${value ? 'checked' : ''} 
                                       onchange="widgetEditor.updateProperty('${field.name}', this.checked)">
                                <span>Activ√©</span>
                            </label>
                        `;
                        break;
                        
                    case 'select':
                        const options = field.options.map(opt => 
                            `<option value="${opt.value}" ${opt.value === value ? 'selected' : ''}>${opt.label}</option>`
                        ).join('');
                        inputHtml = `
                            <select id="${fieldId}" class="property-input" 
                                    onchange="widgetEditor.updateProperty('${field.name}', this.value)"
                                    oninput="widgetEditor.updateProperty('${field.name}', this.value)">
                                ${options}
                            </select>
                        `;
                        break;
                        
                    case 'color':
                        inputHtml = `
                            <div class="property-control">
                                <input type="color" id="${fieldId}" value="${value}" 
                                       onchange="widgetEditor.updateProperty('${field.name}', this.value)"
                                       oninput="widgetEditor.updateProperty('${field.name}', this.value)">
                                <input type="text" class="property-input" style="flex: 1; margin-left: 8px;" 
                                       value="${value}" 
                                       onchange="widgetEditor.updateProperty('${field.name}', this.value)"
                                       oninput="widgetEditor.updateProperty('${field.name}', this.value)">
                            </div>
                        `;
                        break;
                        
                    default:
                        inputHtml = `
                            <input type="text" id="${fieldId}" class="property-input" 
                                   value="${value}" 
                                   onchange="widgetEditor.updateProperty('${field.name}', this.value)"
                                   oninput="widgetEditor.updateProperty('${field.name}', this.value)">
                        `;
                }
                
                return `
                    <div class="property-field">
                        <label class="property-label" for="${fieldId}">${field.label}</label>
                        ${inputHtml}
                    </div>
                `;
            }

            updateElementsTab() {
                if (!this.selectedWidget) {
                    document.getElementById('elementsContainer').innerHTML = `
                        <p style="color: var(--text-muted); font-style: italic;">Aucun widget s√©lectionn√©</p>
                    `;
                    return;
                }
                
                const elements = this.selectedWidget.instance.getElements();
                let elementsHtml = '';
                
                elements.forEach(element => {
                    const isPricingFeatures = element.id === 'features' && this.selectedWidget.type === 'pricing-card';
                    const isGridFeatures = element.id === 'features' && this.selectedWidget.type === 'feature-grid';
                    
                    if (isPricingFeatures) {
                        // Interface sp√©ciale pour les fonctionnalit√©s du Pricing Card
                        const features = this.selectedWidget.data.features || [];
                        
                        elementsHtml += `
                            <div class="element-item" style="padding: 12px; background: var(--bg-card); 
                                                            border-radius: 8px; margin-bottom: 8px;">
                                <div style="margin-bottom: 12px;">
                                    <div style="color: white; font-weight: 500; margin-bottom: 8px;">
                                        <i class="fas fa-list"></i> ${element.name} (${features.length})
                                    </div>
                                    <div style="color: var(--text-muted); font-size: 12px;">Gestion dynamique des fonctionnalit√©s</div>
                                </div>
                                
                                <div class="features-manager" style="margin-bottom: 12px;">
                                    <div class="feature-input-group" style="display: flex; gap: 8px; margin-bottom: 12px;">
                                        <input type="text" id="newFeatureInput" placeholder="‚úì Nouvelle fonctionnalit√©..." 
                                               style="flex: 1; padding: 8px 12px; background: var(--bg-primary); 
                                                      border: 1px solid var(--border-color); border-radius: 6px; 
                                                      color: var(--text-white); font-size: 14px;">
                                        <button onclick="widgetEditor.addFeatureToSelected()" 
                                                style="padding: 8px 16px; background: var(--accent-green); 
                                                       color: white; border: none; border-radius: 6px; 
                                                       cursor: pointer; font-size: 14px; font-weight: 500;">
                                            <i class="fas fa-plus"></i> Ajouter
                                        </button>
                                    </div>
                                    
                                    <div class="features-list" style="max-height: 200px; overflow-y: auto;">
                                        ${features.map((feature, index) => `
                                            <div class="feature-item" style="display: flex; align-items: center; gap: 8px; 
                                                                           padding: 8px 12px; background: rgba(16, 185, 129, 0.1); 
                                                                           border: 1px solid rgba(16, 185, 129, 0.3); 
                                                                           border-radius: 6px; margin-bottom: 6px;">
                                                <span style="color: var(--accent-green); font-weight: bold; min-width: 16px;">‚úì</span>
                                                <input type="text" value="${feature}" 
                                                       onchange="widgetEditor.updateFeatureAtIndex(${index}, this.value)"
                                                       oninput="widgetEditor.updateFeatureAtIndex(${index}, this.value)"
                                                       style="flex: 1; background: transparent; border: none; 
                                                              color: var(--text-white); font-size: 14px; outline: none;">
                                                <button onclick="widgetEditor.removeFeatureAtIndex(${index})" 
                                                        title="Supprimer cette fonctionnalit√©"
                                                        style="background: rgba(239, 68, 68, 0.2); color: var(--danger-red); 
                                                               border: 1px solid var(--danger-red); border-radius: 4px; 
                                                               width: 24px; height: 24px; cursor: pointer; font-size: 12px;">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        `;
                    } else if (isGridFeatures) {
                        // Interface sp√©ciale pour les fonctionnalit√©s de la Grille
                        const features = this.selectedWidget.data.features || [];
                        const featuresCount = this.selectedWidget.data.featuresCount || 4;
                        
                        elementsHtml += `
                            <div class="element-item" style="padding: 12px; background: var(--bg-card); 
                                                            border-radius: 8px; margin-bottom: 8px;">
                                <div style="margin-bottom: 12px;">
                                    <div style="color: white; font-weight: 500; margin-bottom: 8px;">
                                        <i class="fas fa-th-large"></i> ${element.name} (${featuresCount} actives sur ${features.length} disponibles)
                                    </div>
                                    <div style="color: var(--text-muted); font-size: 12px;">√âdition avanc√©e des fonctionnalit√©s avec ic√¥nes</div>
                                </div>
                                
                                <div class="features-manager" style="margin-bottom: 12px;">
                                    <div class="feature-actions" style="display: flex; gap: 8px; margin-bottom: 12px;">
                                        <button onclick="widgetEditor.addFeatureToGrid()" 
                                                style="flex: 1; padding: 8px 16px; background: var(--accent-green); 
                                                       color: white; border: none; border-radius: 6px; 
                                                       cursor: pointer; font-size: 14px; font-weight: 500;">
                                            <i class="fas fa-plus"></i> Ajouter Fonctionnalit√©
                                        </button>
                                    </div>
                                    
                                    <div class="features-list" style="max-height: 300px; overflow-y: auto;">
                                        ${features.map((feature, index) => `
                                            <div class="feature-grid-item" style="padding: 12px; background: ${index < featuresCount ? 'rgba(16, 185, 129, 0.1)' : 'rgba(107, 114, 128, 0.1)'}; 
                                                                           border: 1px solid ${index < featuresCount ? 'rgba(16, 185, 129, 0.3)' : 'rgba(107, 114, 128, 0.3)'}; 
                                                                           border-radius: 8px; margin-bottom: 8px;">
                                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                                    <div style="display: flex; align-items: center; gap: 8px; flex: 1;">
                                                        <span style="color: var(--text-muted); font-size: 12px; font-weight: bold;">#${index + 1}</span>
                                                        <span style="color: ${index < featuresCount ? 'var(--accent-green)' : 'var(--text-muted)'}; font-weight: bold;">
                                                            ${index < featuresCount ? 'ACTIVE' : 'INACTIVE'}
                                                        </span>
                                                    </div>
                                                    <button onclick="widgetEditor.removeGridFeature(${index})" 
                                                            title="Supprimer cette fonctionnalit√©"
                                                            style="background: rgba(239, 68, 68, 0.2); color: var(--danger-red); 
                                                                   border: 1px solid var(--danger-red); border-radius: 4px; 
                                                                   width: 24px; height: 24px; cursor: pointer; font-size: 12px;">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                
                                                <div class="feature-fields">
                                                    <!-- Contenu Principal -->
                                                    <div style="display: grid; grid-template-columns: auto 1fr auto; gap: 8px; margin-bottom: 8px; align-items: center;">
                                                        <label style="color: var(--text-gray); font-size: 12px;">Ic√¥ne:</label>
                                                        <input type="text" value="${feature.icon || '‚≠ê'}" maxlength="2" 
                                                               onchange="widgetEditor.updateGridFeature(${index}, 'icon', this.value)"
                                                               oninput="widgetEditor.updateGridFeature(${index}, 'icon', this.value)"
                                                               style="padding: 6px 8px; background: var(--bg-primary); 
                                                                      border: 1px solid var(--border-color); border-radius: 4px; 
                                                                      color: var(--text-white); font-size: 16px; text-align: center; width: 50px;">
                                                        <select onchange="widgetEditor.updateGridFeature(${index}, 'iconSize', this.value)"
                                                                style="padding: 4px; background: var(--bg-primary); border: 1px solid var(--border-color); 
                                                                       border-radius: 4px; color: var(--text-white); font-size: 11px;">
                                                            <option value="2rem" ${(feature.iconSize || '3rem') === '2rem' ? 'selected' : ''}>Petite</option>
                                                            <option value="3rem" ${(feature.iconSize || '3rem') === '3rem' ? 'selected' : ''}>Normale</option>
                                                            <option value="4rem" ${(feature.iconSize || '3rem') === '4rem' ? 'selected' : ''}>Grande</option>
                                                        </select>
                                                    </div>
                                                    
                                                    <div style="display: grid; grid-template-columns: auto 1fr auto; gap: 8px; margin-bottom: 8px; align-items: center;">
                                                        <label style="color: var(--text-gray); font-size: 12px;">Titre:</label>
                                                        <input type="text" value="${feature.title || 'Titre'}" 
                                                               onchange="widgetEditor.updateGridFeature(${index}, 'title', this.value)"
                                                               oninput="widgetEditor.updateGridFeature(${index}, 'title', this.value)"
                                                               style="padding: 6px 8px; background: var(--bg-primary); 
                                                                      border: 1px solid var(--border-color); border-radius: 4px; 
                                                                      color: var(--text-white); font-size: 14px;">
                                                        <input type="color" value="${feature.titleColor?.replace('var(--text-white)', '#ffffff') || '#ffffff'}" 
                                                               onchange="widgetEditor.updateGridFeature(${index}, 'titleColor', this.value)"
                                                               style="width: 30px; height: 30px; border: none; border-radius: 4px; cursor: pointer;">
                                                    </div>
                                                    
                                                    <div style="display: grid; grid-template-columns: auto 1fr auto; gap: 8px; margin-bottom: 8px;">
                                                        <label style="color: var(--text-gray); font-size: 12px; align-self: start; padding-top: 6px;">Description:</label>
                                                        <textarea rows="2" placeholder="Description de la fonctionnalit√©"
                                                                  onchange="widgetEditor.updateGridFeature(${index}, 'description', this.value)"
                                                                  oninput="widgetEditor.updateGridFeature(${index}, 'description', this.value)"
                                                                  style="padding: 6px 8px; background: var(--bg-primary); 
                                                                         border: 1px solid var(--border-color); border-radius: 4px; 
                                                                         color: var(--text-white); font-size: 13px; resize: vertical; min-height: 40px;">${feature.description || 'Description'}</textarea>
                                                        <input type="color" value="${feature.descriptionColor?.replace('var(--text-gray)', '#94a3b8') || '#94a3b8'}" 
                                                               onchange="widgetEditor.updateGridFeature(${index}, 'descriptionColor', this.value)"
                                                               style="width: 30px; height: 30px; border: none; border-radius: 4px; cursor: pointer; align-self: start;">
                                                    </div>
                                                    
                                                    <!-- Couleurs de fond et bordure -->
                                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border-color);">
                                                        <div>
                                                            <label style="color: var(--text-gray); font-size: 11px; margin-bottom: 4px; display: block;">Fond:</label>
                                                            <input type="color" value="${feature.backgroundColor?.replace('var(--bg-card)', '#374151') || '#374151'}" 
                                                                   onchange="widgetEditor.updateGridFeature(${index}, 'backgroundColor', this.value)"
                                                                   style="width: 100%; height: 28px; border: 1px solid var(--border-color); border-radius: 4px; cursor: pointer;">
                                                        </div>
                                                        <div>
                                                            <label style="color: var(--text-gray); font-size: 11px; margin-bottom: 4px; display: block;">Bordure:</label>
                                                            <input type="color" value="${feature.borderColor?.replace('var(--border-color)', '#4b5563') || '#4b5563'}" 
                                                                   onchange="widgetEditor.updateGridFeature(${index}, 'borderColor', this.value)"
                                                                   style="width: 100%; height: 28px; border: 1px solid var(--border-color); border-radius: 4px; cursor: pointer;">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        // Interface standard pour les autres √©l√©ments
                        elementsHtml += `
                            <div class="element-item" style="padding: 12px; background: var(--bg-card); 
                                                            border-radius: 8px; margin-bottom: 8px; 
                                                            display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <div style="color: white; font-weight: 500;">${element.name}</div>
                                    <div style="color: var(--text-muted); font-size: 12px;">ID: ${element.id}</div>
                                </div>
                                <div class="element-controls" style="display: flex; gap: 4px; color: var(--text-muted); font-size: 12px;">
                                    <span>√âditible via propri√©t√©s</span>
                                </div>
                            </div>
                        `;
                    }
                });
                
                document.getElementById('elementsContainer').innerHTML = elementsHtml;
            }

            updateProperty(propertyName, value) {
                if (!this.selectedWidget) return;
                
                // Conversion des types
                if (value === 'true') value = true;
                if (value === 'false') value = false;
                if (!isNaN(value) && value !== '' && typeof this.selectedWidget.data[propertyName] === 'number') {
                    value = parseFloat(value);
                }
                
                // Gestion sp√©ciale pour featuresCount dans feature-grid
                if (propertyName === 'featuresCount' && this.selectedWidget.type === 'feature-grid') {
                    const currentCount = parseInt(value, 10);
                    const features = this.selectedWidget.data.features || [];
                    
                    // Si on augmente le nombre, ajouter des fonctionnalit√©s vides
                    while (features.length < currentCount) {
                        features.push({
                            icon: '‚≠ê',
                            title: `Fonctionnalit√© ${features.length + 1}`,
                            description: 'Description de cette fonctionnalit√©',
                            iconSize: '3rem',
                            titleColor: 'white',
                            titleSize: '1.5rem',
                            descriptionColor: 'var(--text-gray)',
                            descriptionSize: '0.95rem',
                            backgroundColor: 'var(--bg-card)',
                            borderColor: 'var(--border-color)'
                        });
                    }
                    
                    // Mettre √† jour le tableau des features
                    this.selectedWidget.data.features = features;
                    
                    // Mettre √† jour l'onglet Elements pour refl√©ter les changements
                    this.updateElementsTab();
                }
                
                // Sauvegarder la valeur
                this.selectedWidget.data[propertyName] = value;
                
                // Mettre √† jour l'affichage de la valeur pour les ranges
                const valueDisplay = document.getElementById(`prop-${propertyName}-value`);
                if (valueDisplay) {
                    const unit = propertyName.includes('Size') || propertyName.includes('width') || propertyName.includes('height') || propertyName.includes('Width') || propertyName.includes('Height') ? 'px' : '';
                    valueDisplay.textContent = value + unit;
                }
                
                // Mise √† jour temps r√©el sp√©cifique par type de widget et propri√©t√©
                const container = document.querySelector(`[data-widget-id="${this.selectedWidget.id}"]`);
                if (container) {
                    this.updateWidgetRealTime(container, propertyName, value);
                }
                
                // Mettre √† jour aussi le viewer
                this.updatePreview();
                
                // Pas de setStatus pour √©viter le spam lors de l'input continu
            }
            
            // Mise √† jour temps r√©el sp√©cifique selon le type de widget
            updateWidgetRealTime(container, propertyName, value) {
                const widgetType = this.selectedWidget.type;
                
                switch (widgetType) {
                    case 'logo':
                        this.updateLogoRealTime(container, propertyName, value);
                        break;
                    case 'hero-title':
                        this.updateHeroTitleRealTime(container, propertyName, value);
                        break;
                    case 'pricing-card':
                        this.updatePricingCardRealTime(container, propertyName, value);
                        break;
                    case 'call-to-action':
                        this.updateCTARealTime(container, propertyName, value);
                        break;
                    case 'feature-grid':
                        this.updateFeatureGridRealTime(container, propertyName, value);
                        break;
                }
            }
            
            // Mise √† jour temps r√©el pour le logo
            updateLogoRealTime(container, propertyName, value) {
                const logoImage = container.querySelector('.logo-image, .nav-logo');
                
                switch (propertyName) {
                    case 'imagePath':
                        if (logoImage) {
                            logoImage.style.backgroundImage = `url('${value}')`;
                        }
                        break;
                    case 'width':
                        if (logoImage) {
                            logoImage.style.width = `${value}px`;
                        }
                        break;
                    case 'height':
                        if (logoImage) {
                            logoImage.style.height = `${value}px`;
                        }
                        break;
                    case 'link':
                        if (logoImage) {
                            logoImage.href = value;
                        }
                        break;
                }
            }
            
            // Mise √† jour temps r√©el pour le hero title
            updateHeroTitleRealTime(container, propertyName, value) {
                const title = container.querySelector('.hero-title, h1');
                const subtitle = container.querySelector('.hero-subtitle, .hero-section div');
                const section = container.querySelector('.hero-section');
                
                switch (propertyName) {
                    case 'title':
                        if (title) {
                            title.textContent = value;
                        }
                        break;
                    case 'subtitle':
                        if (subtitle) {
                            subtitle.innerHTML = value;
                        }
                        break;
                    case 'titleSize':
                        if (title) {
                            title.style.fontSize = `${value}px`;
                        }
                        break;
                    case 'subtitleSize':
                        if (subtitle) {
                            subtitle.style.fontSize = `${value}px`;
                        }
                        break;
                    case 'alignment':
                        if (section) {
                            section.style.textAlign = value;
                        }
                        break;
                    case 'backgroundColor':
                        if (section) {
                            if (value === 'transparent' || value === '') {
                                section.style.backgroundColor = 'transparent';
                            } else {
                                section.style.backgroundColor = value;
                            }
                        }
                        break;
                    case 'borderRadius':
                        if (section) {
                            if (parseInt(value) > 0) {
                                section.style.borderRadius = `${value}px`;
                                section.style.overflow = 'hidden';
                            } else {
                                section.style.borderRadius = '0px';
                                section.style.overflow = 'visible';
                            }
                        }
                        break;
                    case 'gradient':
                        if (title) {
                            if (value) {
                                title.style.background = 'linear-gradient(135deg, #10b981, #0d9488)';
                                title.style.webkitBackgroundClip = 'text';
                                title.style.webkitTextFillColor = 'transparent';
                                title.style.backgroundClip = 'text';
                            } else {
                                title.style.background = 'none';
                                title.style.webkitBackgroundClip = 'initial';
                                title.style.webkitTextFillColor = 'initial';
                                title.style.backgroundClip = 'initial';
                                title.style.color = '#10b981';
                            }
                        }
                        break;
                }
            }
            
            // Mise √† jour temps r√©el pour pricing card
            updatePricingCardRealTime(container, propertyName, value) {
                const planName = container.querySelector('h3');
                const price = container.querySelector('.pricing-amount, [style*="font-size: 3.5rem"]');
                const currency = container.querySelector('[style*="font-size: 2rem"]');
                const ctaButton = container.querySelector('a[style*="width: 100%"]');
                const card = container.querySelector('.pricing-card');
                const badge = container.querySelector('.pricing-badge');
                const featuresList = container.querySelector('ul');
                
                switch (propertyName) {
                    case 'planName':
                        if (planName) {
                            planName.textContent = value;
                        }
                        break;
                    case 'price':
                        if (price) {
                            price.textContent = value;
                        }
                        break;
                    case 'currency':
                        if (currency) {
                            currency.textContent = value;
                        }
                        break;
                    case 'ctaText':
                        if (ctaButton) {
                            ctaButton.textContent = value;
                        }
                        break;
                    case 'ctaLink':
                        if (ctaButton) {
                            ctaButton.href = value;
                        }
                        break;
                    case 'accentColor':
                        if (currency) {
                            currency.style.color = value;
                        }
                        if (ctaButton) {
                            ctaButton.style.background = value;
                        }
                        if (badge) {
                            badge.style.background = value;
                        }
                        if (card) {
                            const isFeatured = this.selectedWidget.data.featured;
                            if (isFeatured) {
                                card.style.borderColor = value;
                            }
                        }
                        // Mettre √† jour les checkmarks des fonctionnalit√©s
                        if (featuresList) {
                            const checkmarks = featuresList.querySelectorAll('span[style*="color"]');
                            checkmarks.forEach(check => {
                                check.style.color = value;
                            });
                        }
                        break;
                    case 'backgroundColor':
                        if (card) {
                            card.style.background = value;
                        }
                        break;
                    case 'textColor':
                        if (card) {
                            card.style.color = value;
                        }
                        if (planName) {
                            planName.style.color = value;
                        }
                        if (featuresList) {
                            const textElements = featuresList.querySelectorAll('span:not([style*="color: #10b981"])');
                            textElements.forEach(el => {
                                if (!el.textContent.includes('‚úì')) {
                                    el.style.color = value;
                                }
                            });
                        }
                        break;
                    case 'badge':
                        // Re-render complet pour le badge car il peut √™tre ajout√©/supprim√©
                        this.renderSelectedWidget();
                        break;
                    case 'featured':
                        if (card) {
                            const accentColor = this.selectedWidget.data.accentColor || '#10b981';
                            card.style.borderColor = value ? accentColor : '#374151';
                            if (value) {
                                card.classList.add('featured');
                            } else {
                                card.classList.remove('featured');
                            }
                        }
                        break;
                }
            }
            
            // Mise √† jour temps r√©el pour CTA
            updateCTARealTime(container, propertyName, value) {
                const title = container.querySelector('h2');
                const description = container.querySelector('p');
                const primaryBtn = container.querySelector('a[style*="background: white"]');
                const secondaryBtn = container.querySelector('a[style*="background: transparent"]');
                const section = container.querySelector('.cta-section');
                
                switch (propertyName) {
                    case 'title':
                        if (title) title.textContent = value;
                        break;
                    case 'description':
                        if (description) description.textContent = value;
                        break;
                    case 'primaryButtonText':
                        if (primaryBtn) primaryBtn.textContent = value;
                        break;
                    case 'primaryButtonLink':
                        if (primaryBtn) primaryBtn.href = value;
                        break;
                    case 'secondaryButtonText':
                        if (secondaryBtn) secondaryBtn.textContent = value;
                        break;
                    case 'secondaryButtonLink':
                        if (secondaryBtn) secondaryBtn.href = value;
                        break;
                    case 'backgroundColor':
                        if (section) section.style.background = value;
                        break;
                }
            }
            
            // Mise √† jour temps r√©el pour feature grid
            updateFeatureGridRealTime(container, propertyName, value) {
                const title = container.querySelector('h2');
                const grid = container.querySelector('.features-grid');
                
                switch (propertyName) {
                    case 'title':
                        if (title) title.textContent = value;
                        break;
                    case 'columns':
                        if (grid) {
                            grid.style.gridTemplateColumns = `repeat(${value}, 1fr)`;
                        }
                        break;
                }
            }

            switchPropertiesTab(tabName) {
                // Mettre √† jour les boutons
                document.querySelectorAll('.properties-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                
                // Mettre √† jour le contenu
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabName + 'Tab').classList.add('active');
            }

            moveWidget(direction, widgetId = null) {
                const id = widgetId || (this.selectedWidget ? this.selectedWidget.id : null);
                if (!id) return;
                
                const currentIndex = this.widgets.findIndex(w => w.id === id);
                const newIndex = currentIndex + direction;
                
                if (newIndex < 0 || newIndex >= this.widgets.length) return;
                
                // √âchanger les widgets dans la liste de rendu
                [this.widgets[currentIndex], this.widgets[newIndex]] = [this.widgets[newIndex], this.widgets[currentIndex]];
                
                this.renderCanvas();
                this.selectWidget(id);
                this.updatePreview();
                
                this.setStatus('Ordre des widgets modifi√©', 'success');
            }

            duplicateWidget(widgetId = null) {
                const id = widgetId || (this.selectedWidget ? this.selectedWidget.id : null);
                if (!id) return;
                
                const originalWidget = this.widgets.find(w => w.id === id);
                if (!originalWidget) return;
                
                const duplicatedWidget = {
                    id: `widget-${Date.now()}`,
                    type: originalWidget.type,
                    instance: originalWidget.instance,
                    data: { ...originalWidget.data }
                };
                
                // Ins√©rer apr√®s l'original
                const index = this.widgets.findIndex(w => w.id === id);
                this.widgets.splice(index + 1, 0, duplicatedWidget);
                
                this.saveToHistory('Duplication widget');
                this.renderCanvas();
                this.selectWidget(duplicatedWidget.id);
                this.updatePreview();
                
                document.getElementById('widgetCount').textContent = this.widgets.length;
                this.setStatus('Widget dupliqu√©', 'success');
            }

            deleteWidget(widgetId = null) {
                const id = widgetId || (this.selectedWidget ? this.selectedWidget.id : null);
                if (!id) return;
                
                if (!confirm('√ätes-vous s√ªr de vouloir supprimer ce widget ?')) return;
                
                // Supprimer le widget
                this.widgets = this.widgets.filter(w => w.id !== id);
                
                // R√©initialiser la s√©lection
                this.selectedWidget = null;
                
                // Sauvegarder dans l'historique
                this.saveToHistory('Suppression widget');
                
                // Mettre √† jour l'interface
                this.renderCanvas();
                this.updatePropertiesPanel();
                this.updateOrganizationButtons();
                this.updatePreview();
                
                // Mettre √† jour le compteur
                document.getElementById('widgetCount').textContent = this.widgets.length;
                
                // Afficher l'√©tat vide si n√©cessaire
                const emptyState = document.getElementById('emptyState');
                if (this.widgets.length === 0 && emptyState) {
                    emptyState.classList.remove('hidden');
                    emptyState.style.display = 'flex';
                }
                
                this.setStatus('Widget supprim√©', 'success');
            }

            updateOrganizationButtons() {
                const hasSelection = this.selectedWidget !== null;
                const currentIndex = hasSelection ? this.widgets.findIndex(w => w.id === this.selectedWidget.id) : -1;
                
                // Boutons de mouvement et actions
                document.getElementById('moveUpBtn').disabled = !hasSelection || currentIndex <= 0;
                document.getElementById('moveDownBtn').disabled = !hasSelection || currentIndex >= this.widgets.length - 1;
                document.getElementById('duplicateBtn').disabled = !hasSelection;
                document.getElementById('deleteBtn').disabled = !hasSelection;
                
                // Contr√¥les de taille et position
                const sizeControls = ['widthSlider', 'heightSlider', 'widthInput', 'heightInput', 
                                    'positionColInput', 'positionRowInput', 'fullScreenBtn', 'fillParentBtn'];
                
                sizeControls.forEach(controlId => {
                    const control = document.getElementById(controlId);
                    if (control) {
                        control.disabled = !hasSelection;
                    }
                });
                
                // Mettre √† jour les valeurs si un widget est s√©lectionn√©
                if (hasSelection) {
                    this.updateSizeControls();
                }
            }
            
            updateSizeControls() {
                if (!this.selectedWidget) return;
                
                const widget = this.selectedWidget;
                const size = widget.size || { width: 3, height: 2 };
                const position = widget.position || { col: 1, row: 1 };
                
                // Mettre √† jour les sliders et inputs
                const widthSlider = document.getElementById('widthSlider');
                const heightSlider = document.getElementById('heightSlider');
                const widthInput = document.getElementById('widthInput');
                const heightInput = document.getElementById('heightInput');
                const positionColInput = document.getElementById('positionColInput');
                const positionRowInput = document.getElementById('positionRowInput');
                
                if (widthSlider) widthSlider.value = size.width;
                if (heightSlider) heightSlider.value = size.height;
                if (widthInput) widthInput.value = size.width;
                if (heightInput) heightInput.value = size.height;
                if (positionColInput) positionColInput.value = position.col;
                if (positionRowInput) positionRowInput.value = position.row;
            }

            updatePreview() {
                const preview = document.getElementById('presentationPreview');
                
                if (this.widgets.length === 0) {
                    preview.innerHTML = `
                        <div style="grid-column: 1 / -1; grid-row: 1 / -1; display: flex; 
                                    flex-direction: column; align-items: center; justify-content: center; 
                                    text-align: center; color: #6b7280;">
                            <i class="fas fa-eye" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                            <div>L'aper√ßu temps r√©el appara√Ætra ici</div>
                        </div>
                    `;
                    return;
                }
                
                let previewHtml = '';
                this.widgets.forEach(widget => {
                    const pos = widget.position || { col: 1, row: 1 };
                    const size = widget.size || { width: 3, height: 2 };
                    
                    previewHtml += `
                        <div class="preview-widget" 
                             style="grid-column: ${pos.col} / ${pos.col + size.width}; 
                                    grid-row: ${pos.row} / ${pos.row + size.height}; 
                                    background: rgba(248, 250, 252, 0.95); 
                                    border: 1px solid #e5e7eb;">
                            ${widget.instance.render(widget.data)}
                        </div>
                    `;
                });
                
                preview.innerHTML = previewHtml;
            }

            filterWidgets(searchTerm) {
                const term = searchTerm.toLowerCase().trim();
                const widgetItems = document.querySelectorAll('.widget-item');
                
                widgetItems.forEach(item => {
                    const name = item.querySelector('.widget-name').textContent.toLowerCase();
                    const description = item.querySelector('.widget-description').textContent.toLowerCase();
                    const matches = name.includes(term) || description.includes(term);
                    
                    item.style.display = matches ? 'flex' : 'none';
                });
                
                // Masquer les cat√©gories vides
                document.querySelectorAll('.widget-category').forEach(category => {
                    const visibleItems = category.querySelectorAll('.widget-item:not([style*="display: none"])');
                    category.style.display = visibleItems.length > 0 ? 'block' : 'none';
                });
            }

            // Historique simplifi√©
            saveToHistory(action) {
                // Sauvegarde simple pour r√©f√©rence future
                console.log(`Action: ${action} - ${new Date().toLocaleTimeString()}`);
            }

            updateHistoryButtons() {
                document.getElementById('undoBtn').disabled = this.historyIndex <= 0;
                document.getElementById('redoBtn').disabled = this.historyIndex >= this.history.length - 1;
            }

            saveProject() {
                const projectData = {
                    version: '2.0.0',
                    timestamp: new Date().toISOString(),
                    widgets: this.widgets.map(w => ({
                        id: w.id,
                        type: w.type,
                        data: w.data
                    }))
                };
                
                const blob = new Blob([JSON.stringify(projectData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `widget-project-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                document.getElementById('lastSave').textContent = new Date().toLocaleString();
                this.setStatus('Projet sauvegard√©', 'success');
            }

            exportProject() {
                let html = `<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pr√©sentation - Li-CUBE PRO‚Ñ¢</title>
    <style>
        body { font-family: system-ui, sans-serif; margin: 0; padding: 0; }
        .presentation { max-width: 1200px; margin: 0 auto; }
    </style>
</head>
<body>
    <div class="presentation">
`;
                
                this.widgets.forEach(widget => {
                    html += widget.instance.render(widget.data);
                });
                
                html += `
    </div>
</body>
</html>`;
                
                const blob = new Blob([html], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `presentation-${new Date().toISOString().split('T')[0]}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.setStatus('Export HTML g√©n√©r√©', 'success');
            }


            // Trouver une position libre sur la grille (placement intelligent centre-vers-ext√©rieur)
            findFreeGridPosition(width = 3, height = 2) {
                // Positions prioritaires : centre vers l'ext√©rieur
                const centerCol = Math.floor(12 / 2) - Math.floor(width / 2) + 1;
                const centerRow = Math.floor(8 / 2) - Math.floor(height / 2) + 1;
                
                // Positions candidates par priorit√© (centre vers ext√©rieur)
                const candidates = [];
                
                // Ajouter le centre en premier
                candidates.push({ col: centerCol, row: centerRow });
                
                // Puis ajouter les positions en spirale depuis le centre
                for (let radius = 1; radius <= 6; radius++) {
                    for (let row = Math.max(1, centerRow - radius); row <= Math.min(8, centerRow + radius); row++) {
                        for (let col = Math.max(1, centerCol - radius); col <= Math.min(12, centerCol + radius); col++) {
                            // √âviter les positions d√©j√† ajout√©es
                            if (!candidates.some(c => c.col === col && c.row === row)) {
                                candidates.push({ col, row });
                            }
                        }
                    }
                }
                
                // Tester chaque position candidate
                for (const pos of candidates) {
                    if (this.isPositionFree(pos.col, pos.row, width, height)) {
                        return pos;
                    }
                }
                
                // Fallback : premi√®re position disponible
                for (let row = 1; row <= 8; row++) {
                    for (let col = 1; col <= 12; col++) {
                        if (this.isPositionFree(col, row, width, height)) {
                            return { col, row };
                        }
                    }
                }
                
                // Si vraiment pas de place, placer au centre avec chevauchement
                return { col: centerCol, row: centerRow };
            }
            
            // V√©rifier si une position est libre
            isPositionFree(col, row, width, height) {
                // V√©rifier les limites de grille
                if (col + width - 1 > 12 || row + height - 1 > 8) {
                    return false;
                }
                
                // V√©rifier les collisions avec d'autres widgets
                for (const widget of this.widgets) {
                    const pos = widget.position || { col: 1, row: 1 };
                    const size = widget.size || { width: 3, height: 2 };
                    
                    // V√©rifier si les rectangles se chevauchent
                    if (!(col >= pos.col + size.width || 
                          col + width <= pos.col || 
                          row >= pos.row + size.height || 
                          row + height <= pos.row)) {
                        return false;
                    }
                }
                
                return true;
            }
            
            // Configuration du drag & drop
            setupDragDrop(container, widget) {
                container.draggable = true;
                
                container.addEventListener('dragstart', (e) => {
                    container.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', widget.id);
                });
                
                container.addEventListener('dragend', (e) => {
                    container.classList.remove('dragging');
                });
            }
            
            // Configuration du redimensionnement
            setupResize(container, widget) {
                const handles = container.querySelectorAll('.resize-handle');
                
                handles.forEach(handle => {
                    handle.addEventListener('mousedown', (e) => {
                        e.stopPropagation();
                        this.startResize(e, handle, container, widget);
                    });
                });
            }
            
            // D√©marrer le redimensionnement
            startResize(e, handle, container, widget) {
                const direction = handle.dataset.direction;
                const startX = e.clientX;
                const startY = e.clientY;
                const startSize = { ...widget.size } || { width: 3, height: 2 };
                const startPos = { ...widget.position } || { col: 1, row: 1 };
                
                const handleMouseMove = (e) => {
                    const deltaX = e.clientX - startX;
                    const deltaY = e.clientY - startY;
                    
                    // Calculer la nouvelle taille selon la direction
                    let newSize = { ...startSize };
                    let newPos = { ...startPos };
                    
                    if (direction.includes('e')) {
                        newSize.width = Math.max(1, startSize.width + Math.round(deltaX / 60));
                    }
                    if (direction.includes('w')) {
                        const deltaWidth = Math.round(deltaX / -60);
                        newSize.width = Math.max(1, startSize.width + deltaWidth);
                        newPos.col = Math.max(1, startPos.col - deltaWidth);
                    }
                    if (direction.includes('s')) {
                        newSize.height = Math.max(1, startSize.height + Math.round(deltaY / 60));
                    }
                    if (direction.includes('n')) {
                        const deltaHeight = Math.round(deltaY / -60);
                        newSize.height = Math.max(1, startSize.height + deltaHeight);
                        newPos.row = Math.max(1, startPos.row - deltaHeight);
                    }
                    
                    // V√©rifier les limites
                    if (newPos.col + newSize.width - 1 <= 12 && newPos.row + newSize.height - 1 <= 8) {
                        widget.size = newSize;
                        widget.position = newPos;
                        
                        // Mettre √† jour le style du conteneur
                        container.style.gridColumnStart = newPos.col;
                        container.style.gridColumnEnd = newPos.col + newSize.width;
                        container.style.gridRowStart = newPos.row;
                        container.style.gridRowEnd = newPos.row + newSize.height;
                    }
                };
                
                const handleMouseUp = () => {
                    document.removeEventListener('mousemove', handleMouseMove);
                    document.removeEventListener('mouseup', handleMouseUp);
                    
                    this.updatePreview();
                    this.setStatus('Widget redimensionn√©', 'success');
                };
                
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseUp);
            }
            
            setStatus(message, type = 'info') {
                const statusText = document.getElementById('statusText');
                const statusIndicator = document.getElementById('statusIndicator');
                
                if (statusText) statusText.textContent = message;
                if (statusIndicator) statusIndicator.className = `status-indicator ${type}`;
                
                if (type === 'success' || type === 'info') {
                    setTimeout(() => {
                        if (statusText && statusText.textContent === message) {
                            this.setStatus('Pr√™t', 'success');
                        }
                    }, 3000);
                }
                
                console.log(`[${type.toUpperCase()}] ${message}`);
            }
            
            // Gestion dynamique des fonctionnalit√©s pour Pricing Card
            addFeatureToSelected() {
                if (!this.selectedWidget || this.selectedWidget.type !== 'pricing-card') return;
                
                const input = document.getElementById('newFeatureInput');
                if (!input || !input.value.trim()) return;
                
                const newFeature = input.value.trim();
                this.selectedWidget.data.features.push(newFeature);
                
                // Vider l'input
                input.value = '';
                
                // Mettre √† jour l'interface
                this.updateElementsTab();
                this.renderSelectedWidget();
                this.updatePreview();
                
                this.setStatus(`Fonctionnalit√© "${newFeature}" ajout√©e`, 'success');
            }
            
            removeFeatureAtIndex(index) {
                if (!this.selectedWidget || this.selectedWidget.type !== 'pricing-card') return;
                
                const features = this.selectedWidget.data.features;
                if (index < 0 || index >= features.length) return;
                
                const removedFeature = features[index];
                features.splice(index, 1);
                
                // Mettre √† jour l'interface
                this.updateElementsTab();
                this.renderSelectedWidget();
                this.updatePreview();
                
                this.setStatus(`Fonctionnalit√© "${removedFeature}" supprim√©e`, 'success');
            }
            
            updateFeatureAtIndex(index, newValue) {
                if (!this.selectedWidget || this.selectedWidget.type !== 'pricing-card') return;
                
                const features = this.selectedWidget.data.features;
                if (index < 0 || index >= features.length) return;
                
                features[index] = newValue.trim();
                
                // Mettre √† jour uniquement l'affichage (pas l'onglet Elements pour √©viter la perte de focus)
                this.renderSelectedWidget();
                this.updatePreview();
            }
            
            // Fonction pour re-render un widget sp√©cifique
            renderSelectedWidget() {
                if (!this.selectedWidget) return;
                
                const container = document.querySelector(`[data-widget-id="${this.selectedWidget.id}"]`);
                if (!container) return;
                
                const contentDiv = container.querySelector('.widget-content');
                if (contentDiv) {
                    contentDiv.innerHTML = this.selectedWidget.instance.render(this.selectedWidget.data);
                }
            }

            // ================================================================
            // NOUVELLES FONCTIONS - GESTION TAILLE ET POSITION
            // ================================================================
            
            // Mettre √† jour la taille d'un widget
            updateWidgetSize(dimension, value) {
                if (!this.selectedWidget) return;
                
                const numValue = parseInt(value, 10);
                if (isNaN(numValue)) return;
                
                // Initialiser size si n√©cessaire
                if (!this.selectedWidget.size) {
                    this.selectedWidget.size = { width: 3, height: 2 };
                }
                
                // Mettre √† jour la dimension
                this.selectedWidget.size[dimension] = numValue;
                
                // Synchroniser les contr√¥les
                this.syncSizeControls(dimension, numValue);
                
                // V√©rifier que le widget reste dans les limites de la grille
                this.constrainWidgetToGrid();
                
                // Mettre √† jour l'affichage
                this.renderCanvas();
                this.updatePreview();
                
                this.setStatus(`${dimension === 'width' ? 'Largeur' : 'Hauteur'} mise √† jour: ${numValue}`, 'info');
            }
            
            // Mettre √† jour la position d'un widget
            updateWidgetPosition(dimension, value) {
                if (!this.selectedWidget) return;
                
                const numValue = parseInt(value, 10);
                if (isNaN(numValue)) return;
                
                // Initialiser position si n√©cessaire
                if (!this.selectedWidget.position) {
                    this.selectedWidget.position = { col: 1, row: 1 };
                }
                
                // Mettre √† jour la dimension
                this.selectedWidget.position[dimension] = numValue;
                
                // V√©rifier que le widget reste dans les limites de la grille
                this.constrainWidgetToGrid();
                
                // Mettre √† jour l'affichage
                this.renderCanvas();
                this.updatePreview();
                
                this.setStatus(`Position ${dimension === 'col' ? 'colonne' : 'rang√©e'} mise √† jour: ${numValue}`, 'info');
            }
            
            // Synchroniser les contr√¥les de taille
            syncSizeControls(changedDimension, value) {
                if (changedDimension === 'width') {
                    const widthSlider = document.getElementById('widthSlider');
                    const widthInput = document.getElementById('widthInput');
                    if (widthSlider && widthSlider.value != value) widthSlider.value = value;
                    if (widthInput && widthInput.value != value) widthInput.value = value;
                } else if (changedDimension === 'height') {
                    const heightSlider = document.getElementById('heightSlider');
                    const heightInput = document.getElementById('heightInput');
                    if (heightSlider && heightSlider.value != value) heightSlider.value = value;
                    if (heightInput && heightInput.value != value) heightInput.value = value;
                }
            }
            
            // Contraindre le widget aux limites de la grille
            constrainWidgetToGrid() {
                if (!this.selectedWidget) return;
                
                const size = this.selectedWidget.size || { width: 3, height: 2 };
                const position = this.selectedWidget.position || { col: 1, row: 1 };
                
                // Limiter la taille maximale
                size.width = Math.max(1, Math.min(12, size.width));
                size.height = Math.max(1, Math.min(8, size.height));
                
                // Ajuster la position si le widget d√©passe
                position.col = Math.max(1, Math.min(12 - size.width + 1, position.col));
                position.row = Math.max(1, Math.min(8 - size.height + 1, position.row));
                
                // Mettre √† jour l'objet
                this.selectedWidget.size = size;
                this.selectedWidget.position = position;
                
                // Mettre √† jour les contr√¥les
                this.updateSizeControls();
            }
            
            // D√©finir un widget en plein √©cran
            setFullScreen() {
                if (!this.selectedWidget) return;
                
                this.selectedWidget.size = { width: 12, height: 8 };
                this.selectedWidget.position = { col: 1, row: 1 };
                
                this.updateSizeControls();
                this.renderCanvas();
                this.updatePreview();
                
                this.setStatus('Widget mis en plein √©cran', 'success');
            }
            
            // Remplir le conteneur parent (version simplifi√©e - toute la largeur, hauteur adaptative)
            fillParent() {
                if (!this.selectedWidget) return;
                
                // Pour cette version, "remplir parent" = largeur maximale avec hauteur de 4 rang√©es
                this.selectedWidget.size = { width: 12, height: 4 };
                
                // Garder la position actuelle en colonne, mais v√©rifier les limites
                const currentPosition = this.selectedWidget.position || { col: 1, row: 1 };
                this.selectedWidget.position = { col: 1, row: currentPosition.row };
                
                this.constrainWidgetToGrid();
                this.updateSizeControls();
                this.renderCanvas();
                this.updatePreview();
                
                this.setStatus('Widget configur√© pour remplir le conteneur parent', 'success');
            }

            // ================================================================
            // GESTION DES FONCTIONNALIT√âS DE LA GRILLE
            // ================================================================
            
            // Ajouter une nouvelle fonctionnalit√© √† la grille
            addFeatureToGrid() {
                if (!this.selectedWidget || this.selectedWidget.type !== 'feature-grid') return;
                
                if (!this.selectedWidget.data.features) {
                    this.selectedWidget.data.features = [];
                }
                
                this.selectedWidget.data.features.push({
                    icon: '‚≠ê',
                    title: 'Nouvelle fonctionnalit√©',
                    description: 'Description de la nouvelle fonctionnalit√©',
                    iconSize: '3rem',
                    titleColor: 'white',
                    titleSize: '1.5rem',
                    descriptionColor: 'var(--text-gray)',
                    descriptionSize: '0.95rem',
                    backgroundColor: 'var(--bg-card)',
                    borderColor: 'var(--border-color)'
                });
                
                // Mettre √† jour l'interface
                this.updateElementsTab();
                this.renderCanvas();
                this.updatePreview();
                
                this.setStatus('Nouvelle fonctionnalit√© ajout√©e', 'success');
            }
            
            // Supprimer une fonctionnalit√© de la grille
            removeGridFeature(index) {
                if (!this.selectedWidget || this.selectedWidget.type !== 'feature-grid') return;
                
                const features = this.selectedWidget.data.features;
                if (!features || index < 0 || index >= features.length) return;
                
                if (confirm(`Supprimer la fonctionnalit√© "${features[index].title}" ?`)) {
                    features.splice(index, 1);
                    
                    // Ajuster le nombre de fonctionnalit√©s actives si n√©cessaire
                    if (this.selectedWidget.data.featuresCount > features.length) {
                        this.selectedWidget.data.featuresCount = features.length;
                    }
                    
                    // Mettre √† jour l'interface
                    this.updateElementsTab();
                    this.renderCanvas();
                    this.updatePreview();
                    
                    this.setStatus('Fonctionnalit√© supprim√©e', 'success');
                }
            }
            
            // Mettre √† jour une fonctionnalit√© de la grille
            updateGridFeature(index, field, value) {
                if (!this.selectedWidget || this.selectedWidget.type !== 'feature-grid') return;
                
                const features = this.selectedWidget.data.features;
                if (!features || index < 0 || index >= features.length) return;
                
                features[index][field] = value;
                
                // Mettre √† jour le rendu en temps r√©el
                this.renderCanvas();
                this.updatePreview();
                
                // Message de statut discret uniquement pour les changements importants
                if (field === 'title') {
                    this.setStatus(`Titre mis √† jour: ${value}`, 'info');
                }
            }

            // Fonction toggle grille avec indicateur visuel
            toggleGrid() {
                const workspace = document.getElementById('canvasWorkspace');
                const gridButton = document.getElementById('gridToggleBtn');
                
                if (workspace) {
                    const isGridVisible = workspace.classList.toggle('show-grid');
                    
                    // Mettre √† jour l'apparence du bouton
                    if (gridButton) {
                        if (isGridVisible) {
                            gridButton.classList.add('btn-primary');
                            gridButton.innerHTML = '<i class="fas fa-th"></i> Masquer Grille';
                            gridButton.style.background = 'var(--accent-green)';
                            gridButton.style.borderColor = 'var(--accent-green)';
                        } else {
                            gridButton.classList.remove('btn-primary');
                            gridButton.innerHTML = '<i class="fas fa-th"></i> Grille';
                            gridButton.style.background = '';
                            gridButton.style.borderColor = '';
                        }
                    }
                    
                    // Message de statut informatif
                    const statusMessage = isGridVisible ? 
                        'Grille 12√ó8 affich√©e - Positionnement visuel activ√©' : 
                        'Grille masqu√©e - Mode √©dition normal';
                    
                    this.setStatus(statusMessage, 'info');
                }
            }
            
            // R√¥le      : Configuration du syst√®me de redimensionnement du panneau propri√©t√©s
            // Type      : m√©thode (sans param√®tres)
            // Unit√©     : sans unit√©
            // Domaine   : m√©thode d'initialisation
            // Formule   : configuration des event listeners pour le handle de redimensionnement
            // Exemple   : setupPropertiesResize() - active le redimensionnement par glisser-d√©poser
            setupPropertiesResize() {
                // R√¥le      : Handle de redimensionnement du panneau
                // Type      : HTMLElement
                // Unit√©     : sans unit√©  
                // Domaine   : √©l√©ment DOM existant ou null
                // Formule   : s√©lecteur CSS .resize-handle
                // Exemple   : <div class="resize-handle"></div>
                const resizeHandle = document.querySelector('.resize-handle');
                if (!resizeHandle) return;
                
                // R√¥le      : Indicateur de redimensionnement actif
                // Type      : boolean
                // Unit√©     : sans unit√©
                // Domaine   : true/false
                // Formule   : √©tat = mousedown && mousemove
                // Exemple   : true pendant le glisser-d√©poser
                let isResizing = false;
                
                // R√¥le      : Position initiale de la souris
                // Type      : number
                // Unit√©     : pixels (px)
                // Domaine   : coordonn√©es √©cran >= 0
                // Formule   : position = event.clientX
                // Exemple   : 1200 (pixels depuis le bord gauche de l'√©cran)
                let startX = 0;
                
                // R√¥le      : Largeur initiale du panneau
                // Type      : number  
                // Unit√©     : pixels (px)
                // Domaine   : largeur >= 250px et <= 600px
                // Formule   : largeur = getComputedStyle(panel).width
                // Exemple   : 350 (largeur par d√©faut)
                let startWidth = 0;
                
                // Gestionnaire de d√©but de redimensionnement
                resizeHandle.addEventListener('mousedown', (e) => {
                    // R√¥le      : Activation du mode redimensionnement
                    // Type      : op√©ration (changement d'√©tat)
                    // Unit√©     : sans unit√©
                    // Domaine   : isResizing = false -> true
                    // Formule   : √©tat = true + capture position/taille initiales
                    // Exemple   : mousedown -> isResizing=true, startX=1200, startWidth=350
                    isResizing = true;
                    startX = e.clientX;
                    
                    const propertiesPanel = document.querySelector('.properties-panel');
                    if (propertiesPanel) {
                        // R√¥le      : R√©cup√©ration largeur actuelle
                        // Type      : number (conversion string->number)
                        // Unit√©     : pixels (px)
                        // Domaine   : largeur >= 0
                        // Formule   : parseInt(getComputedStyle().width)
                        // Exemple   : "350px" -> 350
                        startWidth = parseInt(getComputedStyle(propertiesPanel).width);
                    }
                    
                    // Ajout des classes visuelles
                    resizeHandle.classList.add('resizing');
                    document.body.style.cursor = 'ew-resize';
                    document.body.style.userSelect = 'none';
                    
                    e.preventDefault();
                });
                
                // Gestionnaire de mouvement de redimensionnement
                document.addEventListener('mousemove', (e) => {
                    if (!isResizing) return;
                    
                    // R√¥le      : Calcul du d√©placement de la souris
                    // Type      : number (diff√©rence)
                    // Unit√©     : pixels (px)
                    // Domaine   : delta peut √™tre n√©gatif ou positif
                    // Formule   : delta = position_actuelle - position_initiale
                    // Exemple   : 1150 - 1200 = -50 (souris vers la gauche)
                    const deltaX = e.clientX - startX;
                    
                    // R√¥le      : Nouvelle largeur calcul√©e
                    // Type      : number (soustraction car handle √† gauche)
                    // Unit√©     : pixels (px)  
                    // Domaine   : 250 <= newWidth <= 600
                    // Formule   : nouvelle_largeur = largeur_initiale - d√©placement
                    // Exemple   : 350 - (-50) = 400 (panneau plus large)
                    const newWidth = startWidth - deltaX;
                    
                    // R√¥le      : Largeur contrainte dans les limites
                    // Type      : number (application des bornes min/max)
                    // Unit√©     : pixels (px)
                    // Domaine   : 250 <= constrainedWidth <= 600
                    // Formule   : width = Math.max(min_width, Math.min(max_width, calculated_width))
                    // Exemple   : Math.max(250, Math.min(600, 400)) = 400
                    const constrainedWidth = Math.max(250, Math.min(600, newWidth));
                    
                    const propertiesPanel = document.querySelector('.properties-panel');
                    if (propertiesPanel) {
                        // Application de la nouvelle largeur
                        propertiesPanel.style.setProperty('--properties-width', `${constrainedWidth}px`);
                        propertiesPanel.style.width = `${constrainedWidth}px`;
                        
                        // Mise √† jour de l'indicateur de largeur
                        const widthIndicator = document.querySelector('.properties-width-indicator');
                        if (widthIndicator) {
                            widthIndicator.textContent = `${constrainedWidth}px`;
                        }
                    }
                });
                
                // Gestionnaire de fin de redimensionnement
                document.addEventListener('mouseup', () => {
                    if (!isResizing) return;
                    
                    // R√¥le      : D√©sactivation du mode redimensionnement
                    // Type      : op√©ration (remise √† l'√©tat initial)
                    // Unit√©     : sans unit√©
                    // Domaine   : isResizing = true -> false
                    // Formule   : √©tat = false + suppression classes/styles temporaires
                    // Exemple   : mouseup -> isResizing=false, cursor=default
                    isResizing = false;
                    resizeHandle.classList.remove('resizing');
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                });
            }
            
            // R√¥le      : Basculement de l'√©tat collapsed/expanded du panneau propri√©t√©s  
            // Type      : m√©thode (sans param√®tres)
            // Unit√©     : sans unit√©
            // Domaine   : m√©thode de toggle UI
            // Formule   : √©tat = !√©tat_actuel
            // Exemple   : togglePropertiesPanel() - panneau ouvert -> ferm√© ou ferm√© -> ouvert
            togglePropertiesPanel() {
                // R√¥le      : Panneau de propri√©t√©s √† basculer
                // Type      : HTMLElement
                // Unit√©     : sans unit√©
                // Domaine   : √©l√©ment DOM existant ou null
                // Formule   : s√©lecteur CSS .properties-panel
                // Exemple   : <div class="properties-panel">...</div>
                const propertiesPanel = document.querySelector('.properties-panel');
                if (!propertiesPanel) return;
                
                // R√¥le      : √âtat collapsed actuel du panneau
                // Type      : boolean
                // Unit√©     : sans unit√©
                // Domaine   : true/false
                // Formule   : isCollapsed = panel.classList.contains('collapsed')
                // Exemple   : false (panneau ouvert)
                const isCollapsed = propertiesPanel.classList.contains('collapsed');
                
                if (isCollapsed) {
                    // R√¥le      : Expansion du panneau (ouverture)
                    // Type      : op√©ration (changement de classe CSS)
                    // Unit√©     : sans unit√©
                    // Domaine   : suppression classe 'collapsed'
                    // Formule   : panel.classList.remove('collapsed')
                    // Exemple   : panneau ferm√© -> panneau ouvert (largeur normale)
                    propertiesPanel.classList.remove('collapsed');
                    propertiesPanel.style.width = propertiesPanel.style.getPropertyValue('--properties-width') || '350px';
                } else {
                    // R√¥le      : Collapse du panneau (fermeture)
                    // Type      : op√©ration (ajout de classe CSS)
                    // Unit√©     : sans unit√©
                    // Domaine   : ajout classe 'collapsed'
                    // Formule   : panel.classList.add('collapsed')
                    // Exemple   : panneau ouvert -> panneau ferm√© (largeur minimale 40px)
                    propertiesPanel.classList.add('collapsed');
                    propertiesPanel.style.width = '40px';
                }
                
                // R√¥le      : Ic√¥ne du bouton de collapse
                // Type      : HTMLElement
                // Unit√©     : sans unit√©
                // Domaine   : √©l√©ment DOM existant ou null
                // Formule   : s√©lecteur CSS du bouton collapse
                // Exemple   : <i class="fas fa-chevron-right"></i>
                const collapseIcon = document.querySelector('.properties-collapse-btn i');
                if (collapseIcon) {
                    // R√¥le      : Rotation de l'ic√¥ne selon l'√©tat
                    // Type      : string (classe CSS)
                    // Unit√©     : sans unit√©
                    // Domaine   : 'fa-chevron-right' ou 'fa-chevron-left'
                    // Formule   : classe = isCollapsed ? 'fa-chevron-left' : 'fa-chevron-right'
                    // Exemple   : panneau ferm√© -> 'fa-chevron-left' (fl√®che vers la gauche pour ouvrir)
                    collapseIcon.className = isCollapsed ? 'fas fa-chevron-left' : 'fas fa-chevron-right';
                }
            }
        }

        // Initialisation
        const widgetEditor = new WidgetEditorComplete();
        
        // Exposition globale
        window.widgetEditor = widgetEditor;
        
        // CSS pour les animations
        const style = document.createElement('style');
        style.textContent = `
            .slide-up {
                opacity: 0;
                transform: translateY(30px);
                animation: slideUp 0.6s ease-out forwards;
            }
            
            @keyframes slideUp {
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            .hover-effect:hover {
                transform: scale(1.1) !important;
                box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3) !important;
            }
        `;
        document.head.appendChild(style);
        
    </script>
</body>
</html>