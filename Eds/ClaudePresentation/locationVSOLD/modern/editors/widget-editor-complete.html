<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√âditeur de Widgets Complet - Li-CUBE PRO‚Ñ¢</title>
    <link rel="stylesheet" href="../assets/css/themes.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Polices pour le style de pr√©visualisation finale -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* √âditeur de widgets complet */
        
        .widget-editor {
            display: grid;
            grid-template-areas: 
                "toolbar toolbar toolbar"
                "library canvas properties"
                "viewer viewer viewer"
                "footer footer footer";
            grid-template-columns: 280px 1fr var(--properties-width, 300px);
            grid-template-rows: 60px 1fr 200px 40px;
            height: 100vh;
            background: var(--bg-primary);
            font-family: var(--font-primary);
        }

        /* Barre d'outils */
        .editor-toolbar {
            grid-area: toolbar;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--spacing-lg);
            backdrop-filter: blur(10px);
        }

        .toolbar-left, .toolbar-center, .toolbar-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .toolbar-title {
            font-size: var(--text-xl);
            font-weight: var(--font-semibold);
            color: var(--text-white);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .toolbar-title i {
            color: var(--accent-green);
            font-size: var(--text-2xl);
        }

        /* Biblioth√®que de widgets */
        .widget-library {
            grid-area: library;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .library-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
        }

        .library-title {
            font-size: var(--text-xl);
            font-weight: var(--font-bold);
            color: var(--text-white);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .library-title::before {
            content: "üé®";
            font-size: 1.5em;
        }

        .search-container {
            position: relative;
            margin-bottom: var(--spacing-sm);
        }

        .library-search {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-md) var(--spacing-md) 40px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-xl);
            color: var(--text-white);
            font-size: var(--text-sm);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .library-search:focus {
            outline: none;
            border-color: var(--accent-green);
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.15), 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            pointer-events: none;
        }

        .library-actions {
            display: flex;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-sm);
        }

        .action-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            color: var(--text-white);
            font-size: var(--text-xs);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .action-btn:hover {
            background: var(--accent-green);
            border-color: var(--accent-green);
            transform: translateY(-1px);
        }

        .library-content {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-md);
        }

        .widget-category {
            margin-bottom: var(--spacing-lg);
        }
        
        /* Syst√®me de dossiers hi√©rarchiques */
        .folder-structure {
            margin-bottom: var(--spacing-md);
        }
        
        .folder-item {
            display: flex;
            align-items: center;
            padding: var(--spacing-md) var(--spacing-lg);
            cursor: pointer;
            border-radius: var(--border-radius-xl);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: var(--text-sm);
            color: var(--text-muted);
            margin-bottom: var(--spacing-xs);
            border: 1px solid transparent;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .folder-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 0;
            height: 100%;
            background: linear-gradient(90deg, var(--accent-green), transparent);
            transition: width 0.3s ease;
            z-index: 0;
        }
        
        .folder-item:hover {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
            color: var(--text-white);
            border-color: rgba(16, 185, 129, 0.3);
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.1);
        }

        .folder-item:hover::before {
            width: 4px;
        }
        
        .folder-item.active {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
            color: var(--accent-green);
            border-color: var(--accent-green);
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.2);
        }

        .folder-item.active::before {
            width: 4px;
        }

        .folder-item.active .folder-icon {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .folder-icon {
            width: 16px;
            margin-right: var(--spacing-xs);
            text-align: center;
        }
        
        .folder-name {
            flex: 1;
            font-weight: var(--font-medium);
        }
        
        .folder-count {
            font-size: var(--text-xs);
            color: var(--text-muted);
            background: rgba(255, 255, 255, 0.05);
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 20px;
            text-align: center;
        }
        
        .folder-children {
            margin-left: var(--spacing-md);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            padding-left: var(--spacing-sm);
        }
        
        .folder-children.collapsed {
            display: none;
        }
        
        .saves-section {
            border-top: 1px solid var(--border-color);
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-md);
        }
        
        .save-item {
            display: flex;
            align-items: center;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius);
            transition: var(--transition-normal);
            font-size: var(--text-sm);
            color: var(--text-muted);
            margin-bottom: 2px;
            cursor: pointer;
        }
        
        .save-item:hover {
            background: rgba(59, 130, 246, 0.1);
            color: var(--text-white);
        }
        
        .save-icon {
            width: 16px;
            margin-right: var(--spacing-xs);
            text-align: center;
            color: #3b82f6;
        }
        
        .save-name {
            flex: 1;
        }
        
        .save-date {
            font-size: var(--text-xs);
            color: var(--text-muted);
        }
        
        /* Contr√¥les de dossier */
        .folder-controls {
            display: flex;
            gap: 4px;
        }
        
        .folder-control-btn {
            width: 20px;
            height: 20px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-normal);
        }
        
        .folder-control-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-white);
        }
        
        /* √âtat de recherche actif */
        .search-active .folder-structure {
            opacity: 0.3;
            pointer-events: none;
        }
        
        .search-results {
            display: none;
        }
        
        .search-active .search-results {
            display: block;
        }
        
        /* Popup de pr√©visualisation plein √©cran */
        .preview-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: var(--gradient-primary);
            z-index: 10000;
            display: none;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .preview-popup.active {
            display: flex;
        }
        
        /* Header de la popup */
        .preview-header {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 10001;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(16, 185, 129, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .preview-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-green);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .preview-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        .preview-close {
            background: transparent;
            border: 1px solid rgba(239, 68, 68, 0.5);
            color: #ef4444;
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .preview-close:hover {
            background: rgba(239, 68, 68, 0.1);
            border-color: #ef4444;
        }
        
        /* Contenu de la popup - exactement comme .viewer-content */
        .preview-content {
            margin-top: 80px;
            width: 100%;
            height: calc(100vh - 80px);
            background: var(--bg-primary);
            position: relative;
            overflow: auto;
            padding: var(--spacing-md);
            box-sizing: border-box;
            color: var(--text-white);
        }
        
        /* Grille de pr√©visualisation finale - exactement comme .presentation-preview */
        .preview-grid {
            width: 100%;
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-template-rows: repeat(8, minmax(80px, 1fr));
            gap: 6px;
            padding: 12px;
            min-height: 600px;
        }
        
        /* Les widgets du popup utilisent la m√™me classe que l'√©diteur : .preview-widget */
        /* Aucun style sp√©cifique n√©cessaire - ils h√©ritent des styles de .preview-widget */

        /* Styles pour l'aper√ßu du header dans l'onglet Viewer */
        .header-preview-container {
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: var(--bg-secondary);
            padding: var(--spacing-md);
            margin-top: var(--spacing-sm);
        }

        .header-preview {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-primary));
            border-bottom: 2px solid var(--accent-green);
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: var(--text-sm);
            color: var(--text-white);
        }

        .header-preview-logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-weight: var(--font-bold);
        }

        .header-preview-logo i {
            color: var(--accent-green);
            background: rgba(16, 185, 129, 0.1);
            padding: var(--spacing-xs);
            border-radius: 4px;
            font-size: 1.2em;
        }

        .header-preview-info {
            text-align: right;
            font-size: 0.8em;
            color: var(--text-gray);
        }

        .header-preview-date {
            font-weight: var(--font-medium);
            color: var(--text-white);
            margin-bottom: 2px;
        }

        .viewer-config-section {
            margin-bottom: var(--spacing-lg);
        }

        .config-preview-note {
            font-size: var(--text-xs);
            color: var(--text-muted);
            text-align: center;
            padding: var(--spacing-sm);
            background: rgba(16, 185, 129, 0.05);
            border-radius: var(--border-radius);
            margin-top: var(--spacing-sm);
        }
        
        /* Animation d'apparition */
        @keyframes fadeInPreview {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .preview-popup.active {
            animation: fadeInPreview 0.3s ease-out;
        }
        
        /* Message si aucun widget */
        .preview-empty {
            grid-column: 1 / -1;
            grid-row: 1 / -1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: var(--text-muted);
            font-size: 1.2rem;
        }
        
        .preview-empty i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .category-title {
            font-size: var(--text-sm);
            font-weight: var(--font-semibold);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--spacing-sm);
            padding: 0 var(--spacing-sm);
        }

        .widget-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm);
            margin-bottom: var(--spacing-xs);
            background: var(--bg-card);
            border: 1px solid transparent;
            border-radius: var(--border-radius);
            cursor: grab;
            transition: var(--transition-normal);
            user-select: none;
        }

        .widget-item:hover {
            border-color: var(--border-hover);
            background: rgba(16, 185, 129, 0.05);
            transform: translateX(4px);
        }

        .widget-icon {
            font-size: var(--text-xl);
            width: 32px;
            text-align: center;
        }

        .widget-info {
            flex: 1;
        }

        .widget-name {
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            color: var(--text-white);
            margin-bottom: 2px;
        }

        .widget-description {
            font-size: var(--text-xs);
            color: var(--text-muted);
            line-height: 1.3;
        }
        
        .widget-actions {
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: var(--transition-normal);
        }
        
        .widget-item:hover .widget-actions {
            opacity: 1;
        }
        
        /* Badge pour widgets personnalis√©s */
        .widget-custom-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: var(--accent-green);
            color: white;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            border: 1px solid var(--bg-secondary);
        }
        
        .widget-icon {
            position: relative;
        }

        /* Canvas d'√©dition */
        .editor-canvas {
            grid-area: canvas;
            background: var(--bg-primary);
            position: relative;
            overflow: auto;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
        }

        .canvas-toolbar {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            padding: var(--spacing-sm) var(--spacing-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .canvas-workspace {
            flex: 1;
            padding: var(--spacing-lg);
            background: var(--bg-primary);
            color: var(--text-white);
            position: relative;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-template-rows: repeat(8, minmax(100px, 1fr));
            gap: 8px;
            grid-auto-rows: minmax(100px, auto);
        }
        
        /* Grille visible - lignes de la grille CSS */
        .canvas-workspace.show-grid {
            background-image: 
                repeating-linear-gradient(
                    90deg,
                    transparent,
                    transparent calc(100% / 12 - 1px),
                    rgba(16, 185, 129, 0.3) calc(100% / 12 - 1px),
                    rgba(16, 185, 129, 0.3) calc(100% / 12)
                ),
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent calc(100px - 1px),
                    rgba(16, 185, 129, 0.3) calc(100px - 1px),
                    rgba(16, 185, 129, 0.3) 100px
                );
        }
        
        /* Indicateurs de grille sur chaque cellule */
        .canvas-workspace.show-grid::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            background-image: 
                linear-gradient(rgba(16, 185, 129, 0.2) 1px, transparent 1px),
                linear-gradient(90deg, rgba(16, 185, 129, 0.2) 1px, transparent 1px);
            background-size: calc(100% / 12) 100px;
            z-index: 1;
        }

        /* Widget containers dans le canvas - Grille 2D */
        .widget-container {
            position: relative;
            padding: var(--spacing-md);
            background: var(--bg-card);
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            transition: var(--transition-normal);
            cursor: move;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(5px);
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
            z-index: 10; /* Au-dessus de la grille */
        }
        
        .widget-container.dragging {
            opacity: 0.7;
            transform: rotate(2deg);
            z-index: 1000;
        }

        .widget-container:hover {
            border-color: var(--accent-green);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
            border-style: solid;
        }

        .widget-container.selected {
            border-color: var(--accent-green);
            border-style: solid;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
            background: rgba(16, 185, 129, 0.05);
        }
        
        /* Poign√©es de redimensionnement supprim√©es - utilisation des sliders dans l'onglet Organisation */
        
        /* Conteneur arri√®re-plan global adaptatif */
        .global-background-container {
            position: absolute;
            background: rgba(16, 185, 129, 0.05);
            border: 2px dashed rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            backdrop-filter: blur(2px);
            pointer-events: none;
            transition: all 0.3s ease;
            z-index: 0;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.1);
        }
        
        .global-background-container.active {
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.5);
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.2);
        }

        .widget-container-header {
            position: absolute;
            top: -30px;
            left: 0;
            right: 0;
            background: var(--accent-green);
            color: white;
            padding: 4px 8px;
            border-radius: 4px 4px 0 0;
            font-size: var(--text-xs);
            font-weight: var(--font-bold);
            display: flex;
            align-items: center;
            justify-content: space-between;
            opacity: 0;
            transition: var(--transition-normal);
        }

        .widget-container:hover .widget-container-header,
        .widget-container.selected .widget-container-header {
            opacity: 1;
        }

        .widget-header-title {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .widget-header-controls {
            display: flex;
            gap: 4px;
        }

        .widget-control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        .widget-control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Panneau de propri√©t√©s avanc√© */
        .properties-panel {
            grid-area: properties;
            background: var(--bg-secondary);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            min-width: 280px;
            max-width: 600px;
            width: var(--properties-width, 300px);
            border-left: 1px solid var(--border-color);
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Handle de redimensionnement */
        .resize-handle {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--border-color);
            cursor: ew-resize;
            z-index: 10;
            opacity: 0;
            transition: all 0.2s ease;
            border-radius: 2px;
        }

        .resize-handle:hover,
        .resize-handle.resizing {
            opacity: 1;
            background: var(--accent-green);
            width: 6px;
            left: -1px;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.3);
        }

        .resize-handle::after {
            content: '';
            position: absolute;
            left: -2px;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 30px;
            background: transparent;
        }

        .properties-panel:hover .resize-handle {
            opacity: 0.6;
        }
        
        /* √âtat collapsed du panneau propri√©t√©s */
        .properties-panel.collapsed {
            width: 40px !important;
            min-width: 40px;
            overflow: hidden;
        }
        
        .properties-panel.collapsed .properties-content {
            display: none;
        }
        
        .properties-panel.collapsed .properties-header {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            padding: var(--spacing-lg) var(--spacing-sm);
            justify-content: center;
            min-height: auto;
        }
        
        .properties-panel.collapsed .properties-title {
            font-size: var(--text-sm);
            writing-mode: vertical-rl;
        }
        
        .properties-panel.collapsed .properties-header-actions {
            position: absolute;
            top: var(--spacing-sm);
            left: 50%;
            transform: translateX(-50%);
        }
        
        .properties-panel.collapsed .properties-width-indicator {
            display: none;
        }

        .properties-header {
            padding: var(--spacing-md) var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, 
                rgba(30, 41, 59, 0.9) 0%, 
                rgba(30, 41, 59, 0.7) 100%);
            backdrop-filter: blur(15px);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 60px;
        }

        .properties-title {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            color: var(--text-white);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .properties-header-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .properties-collapse-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .properties-collapse-btn:hover {
            color: var(--text-white);
            background: rgba(255, 255, 255, 0.1);
        }

        .properties-width-indicator {
            font-size: var(--text-xs);
            color: var(--text-muted);
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            min-width: 50px;
            text-align: center;
        }

        .properties-content {
            flex: 1;
            overflow-y: auto;
            padding: 0;
            background: var(--bg-primary);
        }

        .properties-tabs {
            display: flex;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 5;
            margin: 0;
        }

        .properties-tab {
            flex: 1;
            padding: var(--spacing-md) var(--spacing-lg);
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-bottom: 3px solid transparent;
            font-size: var(--text-sm);
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .properties-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.1) 0%, 
                rgba(16, 185, 129, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .properties-tab:hover {
            color: var(--text-white);
            transform: translateY(-1px);
        }

        .properties-tab:hover::before {
            opacity: 1;
        }

        .properties-tab.active {
            color: var(--accent-green);
            border-bottom-color: var(--accent-green);
            background: rgba(16, 185, 129, 0.15);
            font-weight: 600;
        }

        .properties-tab.active::before {
            opacity: 1;
        }

        .tab-content {
            display: none;
            padding: var(--spacing-lg);
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .property-group {
            margin-bottom: var(--spacing-xl);
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .property-group:hover {
            border-color: var(--accent-green);
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.1);
        }

        .property-group h4 {
            color: var(--text-white);
            margin-bottom: var(--spacing-lg);
            font-size: var(--text-md);
            font-weight: var(--font-semibold);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            position: relative;
            padding-bottom: var(--spacing-sm);
        }

        .property-group h4::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-green), transparent);
            border-radius: 1px;
        }

        .property-group h4 i {
            color: var(--accent-green);
            font-size: 1.1em;
        }

        .property-field {
            margin-bottom: var(--spacing-md);
        }

        .property-label {
            display: block;
            color: var(--text-gray);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            margin-bottom: var(--spacing-xs);
        }

        .property-control {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        /* 
        # R√¥le      : Style sp√©cialis√© pour les contr√¥les de couleur verticaux
        # Type      : CSS classe
        # Unit√©     : sans unit√© 
        # Domaine   : √©l√©ments avec classe .property-color-control
        # Exemple   : bouton couleur au-dessus du champ hexad√©cimal
        */
        .property-color-control {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
            align-items: stretch;
        }

        /* 
        # R√¥le      : Bouton de s√©lection de couleur agrandi
        # Type      : CSS input[type="color"]
        # Unit√©     : pixels pour largeur/hauteur
        # Domaine   : 40px minimum pour accessibilit√©
        # Exemple   : 40x40px pour faciliter le clic
        */
        .property-color-control input[type="color"] {
            width: 100%;
            height: 40px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .property-color-control input[type="color"]:hover {
            border-color: var(--accent-green);
            transform: translateY(-1px);
        }

        .property-color-control input[type="color"]:focus {
            outline: none;
            border-color: var(--accent-green);
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.15);
        }

        .property-input {
            flex: 1;
            padding: var(--spacing-md);
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            color: var(--text-white);
            font-size: var(--text-sm);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .property-input:focus {
            outline: none;
            border-color: var(--accent-green);
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.15);
            transform: translateY(-1px);
        }

        .property-input:hover {
            border-color: rgba(16, 185, 129, 0.5);
        }

        .property-range {
            flex: 1;
            height: 6px;
            background: var(--bg-primary);
            outline: none;
            border-radius: 3px;
            -webkit-appearance: none;
        }

        .property-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--accent-green);
            border-radius: 50%;
            cursor: pointer;
        }

        .range-value {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: var(--border-radius);
            padding: 0.25rem 0.5rem;
            text-align: center;
            font-size: var(--text-xs);
            color: var(--accent-green);
            font-weight: var(--font-medium);
            min-width: 50px;
        }

        /* Viewer temps r√©el - Miroir du canvas */
        .editor-viewer {
            grid-area: viewer;
            background: var(--bg-card);
            border-top: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .viewer-header {
            padding: var(--spacing-sm) var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .viewer-title {
            color: var(--text-white);
            font-weight: var(--font-semibold);
            font-size: var(--text-sm);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .viewer-controls {
            display: flex;
            gap: var(--spacing-xs);
        }

        .viewer-content {
            flex: 1;
            overflow: auto;
            padding: var(--spacing-md);
            background: var(--bg-primary);
            color: var(--text-white);
        }

        .presentation-preview {
            width: 100%;
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-template-rows: repeat(8, minmax(80px, 1fr));
            gap: 6px;
            padding: 12px;
            min-height: 600px;
        }
        
        .preview-widget {
            border-radius: 6px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Boutons et contr√¥les */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: var(--bg-card);
            color: var(--text-white);
            cursor: pointer;
            transition: var(--transition-normal);
            text-decoration: none;
            min-height: 32px;
        }

        .btn:hover {
            border-color: var(--border-hover);
            background: var(--bg-secondary);
        }

        .btn.btn-primary {
            background: var(--accent-green);
            border-color: var(--accent-green);
            color: white;
        }

        .btn.btn-primary:hover {
            background: #0d9488;
            border-color: #0d9488;
        }

        .btn.btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: var(--text-xs);
            min-height: 24px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Classes utilitaires pour r√©duire la duplication */
        .title-semibold {
            font-weight: var(--font-semibold);
            color: var(--text-white);
        }
        
        .title-bold {
            font-weight: bold;
            color: var(--text-white);
        }
        
        .flex-center {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .flex-between {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .text-accent {
            color: var(--accent-green);
        }
        
        .text-muted {
            color: var(--text-muted);
        }
        
        .bg-card {
            background: var(--bg-card);
        }
        
        .border-accent {
            border-color: var(--accent-green);
        }
        
        .transition-normal {
            transition: var(--transition-normal);
        }

        /* √âtat vide */
        .empty-state {
            grid-column: 1 / -1;
            grid-row: 1 / -1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: var(--text-muted);
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .empty-text {
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .empty-state.hidden {
            display: none;
        }

        /* Pied de page */
        .editor-footer {
            grid-area: footer;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--spacing-lg);
            font-size: var(--text-sm);
            color: var(--text-muted);
        }

        .footer-status {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success-green);
        }

        .status-indicator.error {
            background: var(--danger-red);
        }

        .status-indicator.warning {
            background: var(--warning-orange);
        }
        
        /* Animations */
        .widget-container {
            animation: slideInUp 0.3s ease-out;
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .properties-panel {
                --properties-width: 300px;
                width: 300px;
            }
        }
        
        @media (max-width: 1024px) {
            .widget-editor {
                grid-template-areas: 
                    "toolbar toolbar"
                    "canvas properties"
                    "viewer viewer"
                    "footer footer";
                grid-template-columns: 1fr 280px;
            }
            
            .widget-library {
                display: none;
            }
            
            .properties-panel {
                --properties-width: 280px;
                width: 280px;
            }
            
            .properties-panel.collapsed {
                width: 30px !important;
            }
        }
        
        @media (max-width: 768px) {
            .widget-editor {
                grid-template-areas: 
                    "toolbar"
                    "canvas"
                    "properties"
                    "viewer"
                    "footer";
                grid-template-columns: 1fr;
                grid-template-rows: 60px 1fr 250px 150px 40px;
            }
            
            .properties-panel {
                --properties-width: 100%;
                width: 100% !important;
                height: 250px;
                border-left: none;
                border-top: 1px solid var(--border-color);
                position: relative;
            }
            
            .properties-panel.collapsed {
                height: 40px !important;
                width: 100% !important;
            }
            
            .properties-panel.collapsed .properties-header {
                writing-mode: horizontal-tb;
                text-orientation: mixed;
                padding: var(--spacing-sm) var(--spacing-lg);
                justify-content: space-between;
            }
            
            .properties-panel.collapsed .properties-title {
                writing-mode: horizontal-tb;
                font-size: var(--text-md);
            }
            
            .properties-panel.collapsed .properties-header-actions {
                position: relative;
                top: auto;
                left: auto;
                transform: none;
            }
            
            .resize-handle {
                display: none;
            }
        }
        
        @media (max-width: 480px) {
            .widget-editor {
                grid-template-rows: 50px 1fr 200px 120px 35px;
            }
            
            .toolbar-title {
                font-size: var(--text-md);
            }
            
            .properties-panel {
                height: 200px;
            }
            
            .properties-panel.collapsed {
                height: 35px !important;
            }
            
            .properties-header {
                padding: var(--spacing-sm);
                min-height: 35px;
            }
        }
    </style>
</head>
<body>
    <div class="widget-editor">
        <!-- Barre d'outils -->
        <div class="editor-toolbar">
            <div class="toolbar-left">
                <div class="toolbar-title">
                    <i class="fas fa-puzzle-piece"></i>
                    √âditeur de Widgets Complet
                </div>
            </div>
            
            <div class="toolbar-center">
                <button class="btn btn-primary" id="addWidgetBtn">
                    <i class="fas fa-plus"></i>
                    Ajouter Widget
                </button>
            </div>
            
            <div class="toolbar-right">
                <!-- Boutons de projet supprim√©s - Focus uniquement sur les widgets -->
            </div>
        </div>

        <!-- Biblioth√®que de widgets -->
        <div class="widget-library">
            <div class="library-header">
                <h3 class="library-title">Widgets Disponibles</h3>
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="library-search" placeholder="Rechercher widgets et dossiers..." id="widgetSearch">
                </div>
                <div class="library-actions">
                    <button class="action-btn" id="createFolderBtn" title="Cr√©er un dossier">
                        <i class="fas fa-folder-plus"></i>
                        <span>Nouveau dossier</span>
                    </button>
                    <button class="action-btn" id="refreshLibraryBtn" title="Actualiser la biblioth√®que">
                        <i class="fas fa-sync"></i>
                        <span>Actualiser</span>
                    </button>
                    <button class="action-btn" id="importWidgetBtn" title="Importer un widget">
                        <i class="fas fa-upload"></i>
                        <span>Importer</span>
                    </button>
                </div>
            </div>
            
            <!-- Structure de dossiers -->
            <div class="library-content" id="widgetLibrary">
                <!-- Navigation par dossiers -->
                <div class="folder-structure" id="folderStructure">
                    <div class="folder-item active" data-folder="root">
                        <i class="fas fa-home folder-icon"></i>
                        <span class="folder-name">Tous les widgets</span>
                        <span class="folder-count" id="totalWidgetCount">6</span>
                    </div>
                    
                    <div class="folder-item" data-folder="favorites">
                        <i class="fas fa-star folder-icon"></i>
                        <span class="folder-name">Favoris</span>
                        <span class="folder-count">0</span>
                    </div>
                    
                    <div class="folder-item" data-folder="recent">
                        <i class="fas fa-clock folder-icon"></i>
                        <span class="folder-name">R√©cents</span>
                        <span class="folder-count">0</span>
                    </div>
                    
                    <!-- Dossiers personnalis√©s -->
                    <div id="customFolders">
                        <!-- Dossiers ajout√©s dynamiquement -->
                    </div>
                </div>
                
                <!-- Section des projets sauvegard√©s supprim√©e - Focus uniquement sur les widgets -->
                
                <!-- Widgets du dossier s√©lectionn√© -->
                <div id="widgetContent">
                    <!-- Widgets charg√©s dynamiquement selon le dossier -->
                </div>
                
                <!-- R√©sultats de recherche -->
                <div class="search-results" id="searchResults">
                    <!-- R√©sultats de recherche -->
                </div>
            </div>
        </div>

        <!-- Canvas d'√©dition -->
        <div class="editor-canvas">
            <div class="canvas-toolbar">
                <div class="canvas-tools">
                    <button class="btn btn-sm" id="selectModeBtn">
                        <i class="fas fa-mouse-pointer"></i>
                        √âdition
                    </button>
                    <button class="btn btn-sm" id="gridToggleBtn" onclick="widgetEditor.toggleGrid()">
                        <i class="fas fa-th"></i>
                        Grille
                    </button>
                    <button class="btn btn-sm" id="backgroundToggleBtn" onclick="widgetEditor.toggleBackground()">
                        <i class="fas fa-square"></i>
                        Conteneur
                    </button>
                </div>
                
                <div class="canvas-info">
                    <span>Widgets: <span id="widgetCount">0</span></span>
                </div>
            </div>
            
            <div class="canvas-workspace" id="canvasWorkspace">
                <div class="empty-state" id="emptyState">
                    <div class="empty-icon">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <div class="empty-text">
                        <strong>Canvas Vide</strong><br>
                        Cliquez sur "Ajouter Widget" ou glissez un widget depuis la biblioth√®que
                    </div>
                    <button class="btn btn-primary" id="firstWidgetBtn">
                        <i class="fas fa-plus"></i>
                        Ajouter le premier widget
                    </button>
                </div>
            </div>
        </div>

        <!-- Panneau de propri√©t√©s -->
        <div class="properties-panel">
            <div class="resize-handle" id="propertiesResizeHandle"></div>
            <div class="properties-header">
                <div class="properties-title">
                    <i class="fas fa-sliders-h"></i>
                    Propri√©t√©s
                </div>
                <div class="properties-header-actions">
                    <div class="properties-width-indicator" id="widthIndicator"></div>
                    <button class="properties-collapse-btn" id="collapsePropertiesBtn" title="R√©duire/Agrandir">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            
            <div class="properties-content" id="propertiesContent">
                <div class="properties-tabs">
                    <button class="properties-tab active" data-tab="properties">Propri√©t√©s</button>
                    <button class="properties-tab" data-tab="elements">√âl√©ments</button>
                    <button class="properties-tab" data-tab="organization">Organisation</button>
                    <button class="properties-tab" data-tab="viewer">
                        <i class="fas fa-presentation"></i> Viewer
                    </button>
                </div>
                
                <div class="tab-content active" id="propertiesTab">
                    <div class="properties-empty">
                        <i class="fas fa-info-circle" style="font-size: 2rem; opacity: 0.3; margin-bottom: 1rem;"></i>
                        <p>S√©lectionnez un widget pour voir ses propri√©t√©s</p>
                    </div>
                </div>
                
                <div class="tab-content" id="elementsTab">
                    <div class="property-group">
                        <h4><i class="fas fa-list"></i> √âl√©ments du Widget</h4>
                        <div id="elementsContainer">
                            <p style="color: var(--text-muted); font-style: italic;">Aucun widget s√©lectionn√©</p>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="organizationTab">
                    <div class="property-group">
                        <h4><i class="fas fa-expand-arrows-alt"></i> Taille & Position</h4>
                        
                        <div class="property-field">
                            <label class="property-label">Pr√©r√©glages de taille</label>
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button class="btn btn-sm" id="fullScreenBtn">
                                    <i class="fas fa-expand"></i>
                                    Plein √©cran
                                </button>
                                <button class="btn btn-sm" id="fillParentBtn">
                                    <i class="fas fa-arrows-alt"></i>
                                    Remplir parent
                                </button>
                            </div>
                        </div>
                        
                        <div class="property-field">
                            <label class="property-label">Largeur (colonnes)</label>
                            <div class="property-control">
                                <input type="range" id="widthSlider" class="property-range" 
                                       min="1" max="12" value="3"
                                       oninput="widgetEditor.updateWidgetSize('width', this.value)">
                                <input type="number" id="widthInput" class="property-input" 
                                       min="1" max="12" value="3"
                                       style="width: 60px; text-align: center;"
                                       onchange="widgetEditor.updateWidgetSize('width', this.value)">
                            </div>
                        </div>
                        
                        <div class="property-field">
                            <label class="property-label">Hauteur (rang√©es)</label>
                            <div class="property-control">
                                <input type="range" id="heightSlider" class="property-range" 
                                       min="1" max="8" value="2"
                                       oninput="widgetEditor.updateWidgetSize('height', this.value)">
                                <input type="number" id="heightInput" class="property-input" 
                                       min="1" max="8" value="2"
                                       style="width: 60px; text-align: center;"
                                       onchange="widgetEditor.updateWidgetSize('height', this.value)">
                            </div>
                        </div>
                        
                        <div class="property-field">
                            <label class="property-label">Position - Colonne (1-12)</label>
                            <div class="property-control">
                                <input type="range" id="positionColSlider" class="property-range" 
                                       min="1" max="12" value="1"
                                       oninput="widgetEditor.updateWidgetPosition('col', this.value)">
                                <input type="number" id="positionColInput" class="property-input" 
                                       min="1" max="12" value="1"
                                       style="width: 60px; text-align: center;"
                                       onchange="widgetEditor.updateWidgetPosition('col', this.value)">
                            </div>
                        </div>
                        
                        <div class="property-field">
                            <label class="property-label">Position - Rang√©e (1-8)</label>
                            <div class="property-control">
                                <input type="range" id="positionRowSlider" class="property-range" 
                                       min="1" max="8" value="1"
                                       oninput="widgetEditor.updateWidgetPosition('row', this.value)">
                                <input type="number" id="positionRowInput" class="property-input" 
                                       min="1" max="8" value="1"
                                       style="width: 60px; text-align: center;"
                                       onchange="widgetEditor.updateWidgetPosition('row', this.value)">
                            </div>
                        </div>
                    </div>
                    
                    <div class="property-group">
                        <h4><i class="fas fa-arrows-alt"></i> Organisation</h4>
                        <div class="property-field">
                            <button class="btn btn-sm" id="duplicateBtn">
                                <i class="fas fa-copy"></i>
                                Dupliquer
                            </button>
                            <button class="btn btn-sm" id="deleteBtn">
                                <i class="fas fa-trash"></i>
                                Supprimer
                            </button>
                        </div>
                    </div>
                    
                    <div class="property-group">
                        <h4><i class="fas fa-save"></i> Widget Personnalis√©</h4>
                        <div class="property-field">
                            <label class="property-label">Nom du widget</label>
                            <input type="text" id="customWidgetName" class="property-input" 
                                   placeholder="Mon Widget Personnalis√©" disabled>
                        </div>
                        <div class="property-field" style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px;">
                            <button class="btn btn-sm" id="saveCustomWidgetBtn" disabled>
                                <i class="fas fa-save"></i>
                                Sauvegarder
                            </button>
                            <button class="btn btn-sm" id="updateCustomWidgetBtn" disabled style="display: none;">
                                <i class="fas fa-sync-alt"></i>
                                Mettre √† jour
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Onglet Viewer pour configuration header pr√©sentation -->
                <div class="tab-content" id="viewerTab">
                    <div class="property-group">
                        <h4><i class="fas fa-presentation"></i> Configuration Viewer</h4>
                        <div class="viewer-preview-header">
                            <div class="property-field">
                                <label class="property-label">Aper√ßu du Header</label>
                                <div id="headerPreview" class="header-preview-container">
                                    <!-- Aper√ßu du header sera g√©n√©r√© ici -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="property-group">
                        <h4><i class="fas fa-heading"></i> Titre Principal</h4>
                        <div class="property-field">
                            <label class="property-label">Titre de la pr√©sentation</label>
                            <input type="text" id="viewerTitle" class="property-input" 
                                   placeholder="Eds Qu√©bec - Pr√©sentation Marketing" 
                                   value="Eds Qu√©bec - Pr√©sentation Marketing">
                        </div>
                        <div class="property-field">
                            <label class="property-label">Sous-titre</label>
                            <input type="text" id="viewerSubtitle" class="property-input" 
                                   placeholder="Version Client - Confidentiel" 
                                   value="Version Client - Confidentiel">
                        </div>
                    </div>
                    
                    <div class="property-group">
                        <h4><i class="fas fa-building"></i> Informations Client</h4>
                        <div class="property-field">
                            <label class="property-label">Nom du client</label>
                            <input type="text" id="clientName" class="property-input" 
                                   placeholder="Nom de l'entreprise cliente">
                        </div>
                        <div class="property-field">
                            <label class="property-label">Projet</label>
                            <input type="text" id="projectName" class="property-input" 
                                   placeholder="Nom du projet">
                        </div>
                        <div class="property-field">
                            <label class="property-label">Date de pr√©sentation</label>
                            <input type="date" id="presentationDate" class="property-input">
                        </div>
                    </div>
                    
                    <div class="property-group">
                        <h4><i class="fas fa-palette"></i> Personnalisation</h4>
                        <div class="property-field">
                            <label class="property-label">Couleur d'accent</label>
                            <input type="color" id="accentColor" class="property-input" 
                                   value="#10b981">
                        </div>
                        <div class="property-field">
                            <label class="property-label">Logo personnalis√©</label>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <input type="url" id="customLogo" class="property-input" 
                                       placeholder="URL du logo (optionnel)" style="flex: 1;">
                                <button class="btn btn-sm" id="testLogoBtn">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="property-group">
                        <h4><i class="fas fa-info-circle"></i> Footer</h4>
                        <div class="property-field">
                            <label class="property-label">Copyright</label>
                            <input type="text" id="copyrightText" class="property-input" 
                                   placeholder="¬© 2024 Eds Qu√©bec - Pr√©sentation Marketing" 
                                   value="¬© 2024 Eds Qu√©bec - Pr√©sentation Marketing">
                        </div>
                        <div class="property-field">
                            <label class="property-label">Mentions l√©gales</label>
                            <input type="text" id="legalText" class="property-input" 
                                   placeholder="Document confidentiel - Ne pas diffuser" 
                                   value="Document confidentiel - Ne pas diffuser">
                        </div>
                    </div>
                    
                    <div class="property-group">
                        <h4><i class="fas fa-cog"></i> Actions</h4>
                        <div class="property-field" style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button class="btn btn-sm" id="updateHeaderPreviewBtn">
                                <i class="fas fa-sync"></i>
                                Actualiser Aper√ßu
                            </button>
                            <button class="btn btn-sm" id="resetViewerConfigBtn">
                                <i class="fas fa-undo"></i>
                                R√©initialiser
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Viewer temps r√©el -->
        <div class="editor-viewer">
            <div class="viewer-header">
                <div class="viewer-title">
                    <i class="fas fa-desktop"></i>
                    Aper√ßu Temps R√©el
                </div>
                <div class="viewer-controls">
                    <button class="btn btn-sm" id="refreshPreviewBtn">
                        <i class="fas fa-sync"></i>
                        Actualiser
                    </button>
                    <button class="btn btn-sm" id="fullscreenPreviewBtn">
                        <i class="fas fa-presentation"></i>
                        Pr√©visualisation finale
                    </button>
                </div>
            </div>
            
            <div class="viewer-content" id="viewerContent">
                <div class="presentation-preview" id="presentationPreview">
                    <div style="padding: 2rem; text-align: center; color: #6b7280;">
                        <i class="fas fa-eye" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                        <div>L'aper√ßu temps r√©el appara√Ætra ici</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pied de page -->
        <div class="editor-footer">
            <div class="footer-status">
                <div class="status-item">
                    <div class="status-indicator" id="statusIndicator"></div>
                    <span id="statusText">Pr√™t</span>
                </div>
                <div class="status-item">
                    <span>Derni√®re sauvegarde: <span id="lastSave">Jamais</span></span>
                </div>
            </div>
            
            <div class="footer-actions">
                <span>√âditeur de Widgets Li-CUBE PRO‚Ñ¢ v2.0</span>
            </div>
        </div>
    </div>

    <script>
        // WIDGETS INT√âGR√âS
        
        class TextSimpleWidget {
            constructor() {
                this.id = 'text-simple';
                this.name = 'Texte Simple';
                this.category = 'Contenu';
                this.icon = 'üìù';
                this.description = 'Texte format√© avec styles visuels';
                
                this.defaultData = {
                    text: 'Votre texte ici...',
                    textType: 'paragraph',
                    size: 'medium',
                    color: 'default',
                    customColor: '#F8FAFC',
                    alignment: 'left',
                    isBold: false,
                    isItalic: false,
                    marginTop: 'medium',
                    marginBottom: 'medium',
                    // Couleur de texte (pipette directe)
                    textColor: '#F8FAFC',
                    // Arri√®re-plan  
                    hasBackground: false,
                    backgroundColor: '#1E293B',
                    backgroundOpacity: 100,
                    // Contour
                    hasBorder: false,
                    borderColor: '#10B981',
                    borderWidth: 1,
                    borderStyle: 'solid',
                    // Coins arrondis
                    hasRoundedCorners: false,
                    borderRadius: 8,
                    // Organisation & Dimensions
                    width: 'auto',
                    height: 'auto',
                    paddingTop: 'medium',
                    paddingBottom: 'medium',
                    paddingLeft: 'medium',
                    paddingRight: 'medium',
                    // Sliders num√©riques pour contr√¥le pr√©cis
                    usePreciseSpacing: false,
                    paddingTopPx: 16,
                    paddingBottomPx: 16,
                    paddingLeftPx: 16,
                    paddingRightPx: 16,
                    marginTopPx: 16,
                    marginBottomPx: 16
                };

                this.stylePresets = {
                    paragraph: { fontSize: 'var(--text-base)', fontWeight: 'var(--font-normal)', lineHeight: '1.7', fontFamily: 'var(--font-primary)' },
                    title: { fontSize: 'var(--text-3xl)', fontWeight: 'var(--font-bold)', lineHeight: '1.2', fontFamily: 'var(--font-heading)' },
                    subtitle: { fontSize: 'var(--text-xl)', fontWeight: 'var(--font-semibold)', lineHeight: '1.4', fontFamily: 'var(--font-primary)' },
                    quote: { fontSize: 'var(--text-lg)', fontWeight: 'var(--font-medium)', lineHeight: '1.6', fontFamily: 'var(--font-primary)', fontStyle: 'italic' },
                    note: { fontSize: 'var(--text-sm)', fontWeight: 'var(--font-normal)', lineHeight: '1.5', fontFamily: 'var(--font-primary)' }
                };

                this.sizeScale = { small: 0.875, medium: 1, large: 1.25, xlarge: 1.5 };
                this.colorPalette = {
                    default: 'var(--text-white)', primary: 'var(--accent-green)', secondary: 'var(--text-gray)',
                    muted: 'var(--text-muted)', success: 'var(--success-green)', warning: 'var(--warning-orange)', danger: 'var(--danger-red)'
                };
                this.spacings = { none: '0', small: 'var(--spacing-sm)', medium: 'var(--spacing-md)', large: 'var(--spacing-lg)' };
            }

            render(data = {}) {
                const widgetData = { ...this.defaultData, ...data };
                const styles = this.generateInlineStyles(widgetData);
                const typeClass = `text-widget-${widgetData.textType}`;
                const processedText = this.processTextContent(widgetData.text);

                return `
                    <div class="text-simple-widget ${typeClass} editable" 
                         data-widget-id="${this.id}"
                         data-field="text-content"
                         style="${styles}">
                        ${processedText}
                    </div>
                `;
            }

            generateInlineStyles(data) {
                const baseStyle = this.stylePresets[data.textType];
                const sizeMultiplier = this.sizeScale[data.size];
                
                // Couleur de texte (directe avec pipette)
                const finalTextColor = data.textColor;

                const styleRules = [
                    `font-size: calc(${baseStyle.fontSize} * ${sizeMultiplier})`,
                    `font-weight: ${baseStyle.fontWeight}`,
                    `line-height: ${baseStyle.lineHeight}`,
                    `font-family: ${baseStyle.fontFamily}`,
                    `color: ${finalTextColor}`,
                    `text-align: ${data.alignment}`
                ];

                // Style de police
                if (data.isBold && data.textType !== 'title') styleRules.push('font-weight: var(--font-bold)');
                if (data.isItalic) styleRules.push('font-style: italic');
                if (baseStyle.fontStyle) styleRules.push(`font-style: ${baseStyle.fontStyle}`);

                // Arri√®re-plan (pipette moderne)
                if (data.hasBackground) {
                    const opacity = data.backgroundOpacity / 100;
                    if (data.backgroundColor.startsWith('#')) {
                        const r = parseInt(data.backgroundColor.slice(1, 3), 16);
                        const g = parseInt(data.backgroundColor.slice(3, 5), 16);
                        const b = parseInt(data.backgroundColor.slice(5, 7), 16);
                        styleRules.push(`background-color: rgba(${r}, ${g}, ${b}, ${opacity})`);
                    } else {
                        styleRules.push(`background-color: ${data.backgroundColor}`);
                    }
                }

                // Contour (pipette moderne)
                if (data.hasBorder) {
                    styleRules.push(`border: ${data.borderWidth}px ${data.borderStyle} ${data.borderColor}`);
                }

                // Coins arrondis
                if (data.hasRoundedCorners) {
                    styleRules.push(`border-radius: ${data.borderRadius}px`);
                }

                // Padding (organisation) - Mode adaptatif selon usePreciseSpacing
                if (data.usePreciseSpacing) {
                    // Mode pr√©cis avec sliders en pixels
                    styleRules.push(`padding-top: ${data.paddingTopPx}px`);
                    styleRules.push(`padding-bottom: ${data.paddingBottomPx}px`);
                    styleRules.push(`padding-left: ${data.paddingLeftPx}px`);
                    styleRules.push(`padding-right: ${data.paddingRightPx}px`);
                    
                    // Marges pr√©cises en pixels
                    styleRules.push(`margin-top: ${data.marginTopPx}px`);
                    styleRules.push(`margin-bottom: ${data.marginBottomPx}px`);
                } else {
                    // Mode rapide avec s√©lecteurs CSS variables  
                    styleRules.push(`padding-top: ${this.spacings[data.paddingTop]}`);
                    styleRules.push(`padding-bottom: ${this.spacings[data.paddingBottom]}`);
                    styleRules.push(`padding-left: ${this.spacings[data.paddingLeft]}`);
                    styleRules.push(`padding-right: ${this.spacings[data.paddingRight]}`);
                    
                    // Marges avec variables CSS (mode existant)
                    styleRules.push(`margin-top: ${this.spacings[data.marginTop]}`);
                    styleRules.push(`margin-bottom: ${this.spacings[data.marginBottom]}`);
                }

                // Dimensions (organisation)
                if (data.width !== 'auto') {
                    styleRules.push(`width: ${typeof data.width === 'number' ? data.width + 'px' : data.width}`);
                }
                if (data.height !== 'auto') {
                    styleRules.push(`height: ${typeof data.height === 'number' ? data.height + 'px' : data.height}`);
                }

                return styleRules.join('; ');
            }

            processTextContent(text) {
                const escapedText = text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                return escapedText.replace(/\n/g, '<br>');
            }

            getStyles() {
                return `
                    .text-simple-widget {
                        transition: var(--transition-normal);
                        cursor: default;
                        word-wrap: break-word;
                        hyphens: auto;
                    }
                    .text-simple-widget.editable:hover {
                        background: rgba(16, 185, 129, 0.05);
                        outline: 1px dashed rgba(16, 185, 129, 0.3);
                        outline-offset: 4px;
                        border-radius: var(--border-radius-sm);
                    }
                    .text-widget-title {
                        background: var(--gradient-green);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                    }
                    .text-widget-quote {
                        position: relative;
                        padding-left: var(--spacing-lg);
                        border-left: 4px solid var(--accent-green);
                        background: rgba(16, 185, 129, 0.05);
                        padding-top: var(--spacing-sm);
                        padding-bottom: var(--spacing-sm);
                        padding-right: var(--spacing-md);
                        border-radius: var(--border-radius-sm);
                    }
                    .text-widget-quote:before {
                        content: '"';
                        position: absolute;
                        left: var(--spacing-xs);
                        top: -var(--spacing-xs);
                        font-size: var(--text-2xl);
                        color: var(--accent-green);
                        font-weight: var(--font-bold);
                    }
                    .text-widget-note {
                        background: rgba(59, 130, 246, 0.1);
                        border: 1px solid rgba(59, 130, 246, 0.2);
                        border-radius: var(--border-radius-sm);
                        padding: var(--spacing-sm) var(--spacing-md);
                        position: relative;
                    }
                    .text-widget-note:before {
                        content: '‚ÑπÔ∏è';
                        margin-right: var(--spacing-xs);
                    }
                    .text-simple-widget {
                        opacity: 0;
                        transform: translateY(10px);
                        animation: textAppear 0.6s ease-out forwards;
                    }
                    @keyframes textAppear {
                        to {
                            opacity: 1;
                            transform: translateY(0);
                        }
                    }
                    @media (max-width: 768px) {
                        .text-widget-title { font-size: var(--text-2xl) !important; }
                        .text-widget-subtitle { font-size: var(--text-lg) !important; }
                        .text-widget-quote { padding-left: var(--spacing-md); margin-left: var(--spacing-sm); margin-right: var(--spacing-sm); }
                    }
                `;
            }

            getEditableFields() {
                return [
                    // Section 1: Contenu
                    { name: 'text', label: 'Texte', type: 'textarea', placeholder: 'Votre texte ici...', rows: 4, defaultValue: this.defaultData.text },
                    { name: 'textType', label: 'Type de texte', type: 'select', options: [
                        { value: 'paragraph', label: 'üìù Paragraphe' }, { value: 'title', label: 'üéØ Titre' },
                        { value: 'subtitle', label: 'üìã Sous-titre' }, { value: 'quote', label: 'üí≠ Citation' }, { value: 'note', label: 'üìù Note' }
                    ], defaultValue: this.defaultData.textType },
                    
                    // Section 2: Style de texte
                    { name: 'size', label: 'Taille', type: 'select', options: [
                        { value: 'small', label: 'Petit' }, { value: 'medium', label: 'Moyen' },
                        { value: 'large', label: 'Grand' }, { value: 'xlarge', label: 'Tr√®s grand' }
                    ], defaultValue: this.defaultData.size },
                    { name: 'textColor', label: 'Couleur du texte', type: 'color', defaultValue: this.defaultData.textColor },
                    { name: 'alignment', label: 'Alignement', type: 'select', options: [
                        { value: 'left', label: 'Gauche' }, { value: 'center', label: 'Centre' }, { value: 'right', label: 'Droite' }
                    ], defaultValue: this.defaultData.alignment },
                    { name: 'isBold', label: 'Gras', type: 'checkbox', defaultValue: this.defaultData.isBold },
                    { name: 'isItalic', label: 'Italique', type: 'checkbox', defaultValue: this.defaultData.isItalic },
                    
                    // Section 3: Arri√®re-plan
                    { name: 'hasBackground', label: 'Ajouter un arri√®re-plan', type: 'checkbox', defaultValue: this.defaultData.hasBackground },
                    { name: 'backgroundColor', label: 'Couleur de fond', type: 'color', defaultValue: this.defaultData.backgroundColor },
                    { name: 'backgroundOpacity', label: 'Transparence du fond', type: 'range', min: 0, max: 100, step: 5, defaultValue: this.defaultData.backgroundOpacity, condition: { field: 'hasBackground', value: true } },
                    
                    // Section 4: Contour
                    { name: 'hasBorder', label: 'Ajouter un contour', type: 'checkbox', defaultValue: this.defaultData.hasBorder },
                    { name: 'borderColor', label: 'Couleur du contour', type: 'color', defaultValue: this.defaultData.borderColor },
                    { name: 'borderWidth', label: '√âpaisseur du contour', type: 'range', min: 1, max: 10, step: 1, defaultValue: this.defaultData.borderWidth, condition: { field: 'hasBorder', value: true } },
                    { name: 'borderStyle', label: 'Style du contour', type: 'select', options: [
                        { value: 'solid', label: 'Solide' }, { value: 'dashed', label: 'Tirets' },
                        { value: 'dotted', label: 'Points' }, { value: 'double', label: 'Double' }
                    ], defaultValue: this.defaultData.borderStyle, condition: { field: 'hasBorder', value: true } },
                    
                    // Section 5: Coins arrondis
                    { name: 'hasRoundedCorners', label: 'Coins arrondis', type: 'checkbox', defaultValue: this.defaultData.hasRoundedCorners },
                    { name: 'borderRadius', label: 'Niveau d\'arrondi', type: 'range', min: 0, max: 50, step: 2, defaultValue: this.defaultData.borderRadius, condition: { field: 'hasRoundedCorners', value: true } },
                    
                    // Section 6: Espacement (Organisation)
                    { name: 'usePreciseSpacing', label: 'Contr√¥le pr√©cis des espacements', type: 'checkbox', defaultValue: this.defaultData.usePreciseSpacing },
                    
                    // Mode rapide (s√©lecteurs)
                    { name: 'paddingTop', label: 'Espacement haut', type: 'select', options: [
                        { value: 'none', label: 'Aucun' }, { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' }, { value: 'large', label: 'Grand' }
                    ], defaultValue: this.defaultData.paddingTop, condition: { field: 'usePreciseSpacing', value: false } },
                    { name: 'paddingBottom', label: 'Espacement bas', type: 'select', options: [
                        { value: 'none', label: 'Aucun' }, { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' }, { value: 'large', label: 'Grand' }
                    ], defaultValue: this.defaultData.paddingBottom, condition: { field: 'usePreciseSpacing', value: false } },
                    { name: 'paddingLeft', label: 'Espacement gauche', type: 'select', options: [
                        { value: 'none', label: 'Aucun' }, { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' }, { value: 'large', label: 'Grand' }
                    ], defaultValue: this.defaultData.paddingLeft, condition: { field: 'usePreciseSpacing', value: false } },
                    { name: 'paddingRight', label: 'Espacement droite', type: 'select', options: [
                        { value: 'none', label: 'Aucun' }, { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' }, { value: 'large', label: 'Grand' }
                    ], defaultValue: this.defaultData.paddingRight, condition: { field: 'usePreciseSpacing', value: false } },
                    
                    // Mode pr√©cis (sliders en pixels)
                    { name: 'paddingTopPx', label: 'Espacement haut (px)', type: 'range', min: 0, max: 100, step: 2, defaultValue: this.defaultData.paddingTopPx, condition: { field: 'usePreciseSpacing', value: true } },
                    { name: 'paddingBottomPx', label: 'Espacement bas (px)', type: 'range', min: 0, max: 100, step: 2, defaultValue: this.defaultData.paddingBottomPx, condition: { field: 'usePreciseSpacing', value: true } },
                    { name: 'paddingLeftPx', label: 'Espacement gauche (px)', type: 'range', min: 0, max: 100, step: 2, defaultValue: this.defaultData.paddingLeftPx, condition: { field: 'usePreciseSpacing', value: true } },
                    { name: 'paddingRightPx', label: 'Espacement droite (px)', type: 'range', min: 0, max: 100, step: 2, defaultValue: this.defaultData.paddingRightPx, condition: { field: 'usePreciseSpacing', value: true } },
                    
                    // Section 7: Marges
                    { name: 'marginTop', label: 'Marge du haut', type: 'select', options: [
                        { value: 'none', label: 'Aucune' }, { value: 'small', label: 'Petite' },
                        { value: 'medium', label: 'Moyenne' }, { value: 'large', label: 'Grande' }
                    ], defaultValue: this.defaultData.marginTop, condition: { field: 'usePreciseSpacing', value: false } },
                    { name: 'marginBottom', label: 'Marge du bas', type: 'select', options: [
                        { value: 'none', label: 'Aucune' }, { value: 'small', label: 'Petite' },
                        { value: 'medium', label: 'Moyenne' }, { value: 'large', label: 'Grande' }
                    ], defaultValue: this.defaultData.marginBottom, condition: { field: 'usePreciseSpacing', value: false } },
                    
                    // Marges pr√©cises (sliders en pixels)
                    { name: 'marginTopPx', label: 'Marge du haut (px)', type: 'range', min: 0, max: 100, step: 2, defaultValue: this.defaultData.marginTopPx, condition: { field: 'usePreciseSpacing', value: true } },
                    { name: 'marginBottomPx', label: 'Marge du bas (px)', type: 'range', min: 0, max: 100, step: 2, defaultValue: this.defaultData.marginBottomPx, condition: { field: 'usePreciseSpacing', value: true } }
                ];
            }

            validate(data) {
                const errors = [];
                if (!data.text || data.text.trim() === '') errors.push('Le texte ne peut pas √™tre vide');
                if (data.text && data.text.length > 2000) errors.push('Texte trop long (max 2000 caract√®res)');
                return { isValid: errors.length === 0, errors: errors };
            }
        }

        class LogoWidget {
            constructor() {
                this.id = 'logo';
                this.name = 'Logo';
                this.category = 'Navigation';
                this.icon = 'üè¢';
                this.description = 'Logo avec image et effets hover';
                
                this.defaultData = {
                    imagePath: '../assets/images/logo-eds.png',
                    altText: 'Logo EDS Qu√©bec',
                    width: 60,
                    height: 60,
                    link: '#',
                    hoverEffect: true,
                    
                    // Propri√©t√©s d'arri√®re-plan avanc√©es
                    backgroundColor: '#10b981',
                    backgroundOpacity: 10,
                    backgroundType: 'solid', // solid, gradient, transparent
                    gradientStart: '#10b981',
                    gradientEnd: '#065f46',
                    gradientDirection: 'to bottom',
                    
                    // Propri√©t√©s de bordure
                    borderColor: '#10b981',
                    borderWidth: 2,
                    borderStyle: 'solid', // solid, dashed, dotted, none
                    borderRadius: 12,
                    borderOpacity: 30,
                    
                    // Propri√©t√©s de l'image
                    imageSize: 80, // en pourcentage
                    imagePosition: 'center',
                    imageFit: 'contain', // contain, cover, fill
                    
                    // Propri√©t√©s d'ombrage
                    shadowEnabled: false,
                    shadowColor: '#000000',
                    shadowOpacity: 20,
                    shadowOffsetX: 0,
                    shadowOffsetY: 4,
                    shadowBlur: 8,
                    
                    // Propri√©t√©s de conteneur
                    /* 
                    # R√¥le      : Espacement horizontal du conteneur (gauche et droite)
                    # Type      : number
                    # Unit√©     : pixels
                    # Domaine   : 0 ‚â§ valeur ‚â§ 50
                    # Exemple   : 20 pour 20px de chaque c√¥t√©
                    */
                    containerPaddingX: 20,
                    
                    /* 
                    # R√¥le      : Espacement vertical du conteneur (haut et bas)
                    # Type      : number
                    # Unit√©     : pixels
                    # Domaine   : 0 ‚â§ valeur ‚â§ 50
                    # Exemple   : 20 pour 20px en haut et en bas
                    */
                    containerPaddingY: 20,
                    
                    containerAlignment: 'center'
                };
            }

            render(data = {}) {
                // R√¥le      : Fusion des donn√©es par d√©faut avec les donn√©es fournies
                // Type      : Object
                // Unit√©     : sans unit√©
                // Domaine   : objet contenant toutes les propri√©t√©s du logo
                // Formule   : d = {...defaultData, ...data}
                // Exemple   : {width: 60, backgroundColor: '#ff0000', ...}
                const d = { ...this.defaultData, ...data };
                
                /* 
                # R√¥le      : Migration des anciennes donn√©es containerPadding vers containerPaddingX/Y
                # Type      : compatibility check
                # Unit√©     : pixels
                # Formule   : Si containerPadding existe et pas containerPaddingX/Y, copier la valeur
                # Exemple   : containerPadding=25 ‚Üí containerPaddingX=25, containerPaddingY=25
                */
                if (data.containerPadding !== undefined && data.containerPaddingX === undefined) {
                    d.containerPaddingX = data.containerPadding;
                    d.containerPaddingY = data.containerPadding;
                    console.log(`üì¶ Migration containerPadding: ${data.containerPadding} ‚Üí X=${d.containerPaddingX}, Y=${d.containerPaddingY}`);
                }
                
                // R√¥le      : Calcul de la couleur d'arri√®re-plan selon le type choisi
                // Type      : string (CSS)
                // Unit√©     : sans unit√©
                // Domaine   : couleur CSS valide ou transparent
                // Formule   : backgroundStyle = type === 'transparent' ? 'transparent' : (type === 'gradient' ? gradientCSS : solidColorCSS)
                // Exemple   : 'rgba(16, 185, 129, 0.1)' ou 'linear-gradient(to bottom, #10b981, #065f46)' ou 'transparent'
                let backgroundStyle;
                if (d.backgroundType === 'transparent') {
                    backgroundStyle = 'transparent';
                } else if (d.backgroundType === 'gradient') {
                    // R√¥le      : Style CSS pour gradient lin√©aire
                    // Type      : string
                    // Unit√©     : sans unit√©
                    // Domaine   : gradient CSS valide
                    // Formule   : linear-gradient(direction, couleur_d√©but, couleur_fin)
                    // Exemple   : 'linear-gradient(to bottom, #10b981, #065f46)'
                    backgroundStyle = `linear-gradient(${d.gradientDirection}, ${d.gradientStart}, ${d.gradientEnd})`;
                } else {
                    // R√¥le      : Conversion de la couleur de base et opacit√© en rgba
                    // Type      : string
                    // Unit√©     : sans unit√©
                    // Domaine   : couleur rgba CSS
                    // Formule   : rgba bas√©e sur backgroundColor et backgroundOpacity
                    // Exemple   : 'rgba(16, 185, 129, 0.1)' pour opacity=10%
                    const opacity = d.backgroundOpacity / 100;
                    if (d.backgroundColor.startsWith('#')) {
                        // R√¥le      : Conversion hexad√©cimal vers RGB
                        // Type      : Object {r, g, b}
                        // Unit√©     : sans unit√© (valeurs 0-255)
                        // Domaine   : couleurs RGB valides
                        // Formule   : hex = parseInt(hex.slice(1,3), 16) pour chaque composante
                        // Exemple   : '#10b981' -> {r: 16, g: 185, b: 129}
                        const hex = d.backgroundColor.slice(1);
                        const r = parseInt(hex.slice(0, 2), 16);
                        const g = parseInt(hex.slice(2, 4), 16);
                        const b = parseInt(hex.slice(4, 6), 16);
                        backgroundStyle = `rgba(${r}, ${g}, ${b}, ${opacity})`;
                    } else {
                        backgroundStyle = d.backgroundColor;
                    }
                }
                
                // R√¥le      : Calcul de la couleur de bordure avec opacit√©
                // Type      : string (CSS)
                // Unit√©     : sans unit√©
                // Domaine   : couleur CSS avec opacit√©
                // Formule   : rgba bas√©e sur borderColor et borderOpacity
                // Exemple   : 'rgba(16, 185, 129, 0.3)' pour borderOpacity=30%
                let borderColorStyle;
                const borderOpacity = d.borderOpacity / 100;
                if (d.borderColor.startsWith('#')) {
                    const hex = d.borderColor.slice(1);
                    const r = parseInt(hex.slice(0, 2), 16);
                    const g = parseInt(hex.slice(2, 4), 16);
                    const b = parseInt(hex.slice(4, 6), 16);
                    borderColorStyle = `rgba(${r}, ${g}, ${b}, ${borderOpacity})`;
                } else {
                    borderColorStyle = d.borderColor;
                }
                
                // R√¥le      : Style de bordure complet selon les param√®tres
                // Type      : string (CSS)
                // Unit√©     : pixels pour width, style et couleur
                // Domaine   : border CSS valide ou 'none'
                // Formule   : border = width + ' ' + style + ' ' + color ou 'none'
                // Exemple   : '2px solid rgba(16, 185, 129, 0.3)' ou 'none'
                const borderStyle = d.borderStyle === 'none' ? 'none' : `${d.borderWidth}px ${d.borderStyle} ${borderColorStyle}`;
                
                // R√¥le      : Style d'ombrage si activ√©
                // Type      : string (CSS)
                // Unit√©     : pixels pour offset et blur, sans unit√© pour opacit√©
                // Domaine   : box-shadow CSS valide ou 'none'
                // Formule   : box-shadow = offsetX + 'px ' + offsetY + 'px ' + blur + 'px ' + color
                // Exemple   : '0px 4px 8px rgba(0, 0, 0, 0.2)' ou 'none'
                let shadowStyle = 'none';
                if (d.shadowEnabled) {
                    const shadowOpacity = d.shadowOpacity / 100;
                    let shadowColor;
                    if (d.shadowColor.startsWith('#')) {
                        const hex = d.shadowColor.slice(1);
                        const r = parseInt(hex.slice(0, 2), 16);
                        const g = parseInt(hex.slice(2, 4), 16);
                        const b = parseInt(hex.slice(4, 6), 16);
                        shadowColor = `rgba(${r}, ${g}, ${b}, ${shadowOpacity})`;
                    } else {
                        shadowColor = d.shadowColor;
                    }
                    shadowStyle = `${d.shadowOffsetX}px ${d.shadowOffsetY}px ${d.shadowBlur}px ${shadowColor}`;
                }
                
                /* 
                # R√¥le      : Log de d√©bogage pour tracer les valeurs d'espacement
                # Type      : console.log
                # Unit√©     : pixels
                # Formule   : padding = paddingY + 'px ' + paddingX + 'px'
                # Exemple   : "Espacement: Y=20px X=15px ‚Üí padding: 20px 15px"
                */
                console.log(`üîß Espacement Logo: Y=${d.containerPaddingY}px X=${d.containerPaddingX}px ‚Üí CSS g√©n√©r√©`);
                console.log(`üìê D√©tail CSS:`, {
                    'padding-top': `${d.containerPaddingY}px`,
                    'padding-bottom': `${d.containerPaddingY}px`, 
                    'padding-left': `${d.containerPaddingX}px`,
                    'padding-right': `${d.containerPaddingX}px`
                });
                console.log(`üìã Donn√©es compl√®tes du logo:`, d);
                
                return `
                    <div class="logo-container" style="text-align: ${d.containerAlignment}; 
                                                       padding-top: ${d.containerPaddingY}px;
                                                       padding-bottom: ${d.containerPaddingY}px;
                                                       padding-left: ${d.containerPaddingX}px;
                                                       padding-right: ${d.containerPaddingX}px; 
                                                       height: 100%;">
                        <a href="${d.link}" 
                           class="nav-logo logo-image ${d.hoverEffect ? 'hover-effect' : ''}"
                           style="display: inline-block; 
                                  width: ${d.width}px; 
                                  height: ${d.height}px; 
                                  border-radius: ${d.borderRadius}px; 
                                  background: ${backgroundStyle};
                                  border: ${borderStyle};
                                  background-image: url('${d.imagePath}');
                                  background-size: ${d.imageSize}%; 
                                  background-repeat: no-repeat; 
                                  background-position: ${d.imagePosition};
                                  object-fit: ${d.imageFit};
                                  box-shadow: ${shadowStyle};
                                  transition: all 0.3s ease;
                                  text-decoration: none;">
                            <span style="position: absolute; width: 1px; height: 1px; overflow: hidden;">
                                ${d.altText}
                            </span>
                        </a>
                    </div>
                `;
            }

            getEditableFields() {
                return [
                    // Configuration de base
                    { name: 'imagePath', label: 'Chemin de l\'image', type: 'text', category: 'Configuration' },
                    { name: 'altText', label: 'Texte alternatif', type: 'text', category: 'Configuration' },
                    { name: 'link', label: 'Lien de destination', type: 'text', category: 'Configuration' },
                    { name: 'hoverEffect', label: 'Effet au survol', type: 'checkbox', category: 'Configuration' },
                    
                    // Dimensions et position
                    { name: 'width', label: 'Largeur (px)', type: 'range', min: 30, max: 200, category: 'Dimensions' },
                    { name: 'height', label: 'Hauteur (px)', type: 'range', min: 30, max: 200, category: 'Dimensions' },
                    { name: 'containerPaddingY', label: 'Espacement hauteur (px)', type: 'range', min: 0, max: 50, category: 'Dimensions' },
                    { name: 'containerAlignment', label: 'Alignement', type: 'select', category: 'Dimensions', options: [
                        { value: 'left', label: 'Gauche' },
                        { value: 'center', label: 'Centre' },
                        { value: 'right', label: 'Droite' }
                    ]},
                    
                    // Arri√®re-plan
                    { name: 'backgroundType', label: 'Type d\'arri√®re-plan', type: 'select', category: 'Arri√®re-plan', options: [
                        { value: 'solid', label: 'Couleur unie' },
                        { value: 'gradient', label: 'D√©grad√©' },
                        { value: 'transparent', label: 'Transparent' }
                    ]},
                    { name: 'backgroundColor', label: 'Couleur de base', type: 'color', category: 'Arri√®re-plan' },
                    { name: 'backgroundOpacity', label: 'Opacit√© arri√®re-plan (%)', type: 'range', min: 0, max: 100, category: 'Arri√®re-plan' },
                    { name: 'gradientStart', label: 'Couleur d√©but d√©grad√©', type: 'color', category: 'Arri√®re-plan' },
                    { name: 'gradientEnd', label: 'Couleur fin d√©grad√©', type: 'color', category: 'Arri√®re-plan' },
                    { name: 'gradientDirection', label: 'Direction d√©grad√©', type: 'select', category: 'Arri√®re-plan', options: [
                        { value: 'to bottom', label: 'Vers le bas' },
                        { value: 'to top', label: 'Vers le haut' },
                        { value: 'to right', label: 'Vers la droite' },
                        { value: 'to left', label: 'Vers la gauche' },
                        { value: 'to bottom right', label: 'Diagonal bas-droite' },
                        { value: 'to bottom left', label: 'Diagonal bas-gauche' }
                    ]},
                    
                    // Bordures
                    { name: 'borderStyle', label: 'Style de bordure', type: 'select', category: 'Bordures', options: [
                        { value: 'none', label: 'Aucune' },
                        { value: 'solid', label: 'Solide' },
                        { value: 'dashed', label: 'Tirets' },
                        { value: 'dotted', label: 'Pointill√©s' }
                    ]},
                    { name: 'borderWidth', label: '√âpaisseur bordure (px)', type: 'range', min: 0, max: 10, category: 'Bordures' },
                    { name: 'borderColor', label: 'Couleur bordure', type: 'color', category: 'Bordures' },
                    { name: 'borderOpacity', label: 'Opacit√© bordure (%)', type: 'range', min: 0, max: 100, category: 'Bordures' },
                    { name: 'borderRadius', label: 'Arrondi des coins (px)', type: 'range', min: 0, max: 50, category: 'Bordures' },
                    
                    // Propri√©t√©s de l'image
                    { name: 'imageSize', label: 'Taille image (%)', type: 'range', min: 20, max: 100, category: 'Image' },
                    { name: 'imagePosition', label: 'Position de l\'image', type: 'select', category: 'Image', options: [
                        { value: 'center', label: 'Centre' },
                        { value: 'top', label: 'Haut' },
                        { value: 'bottom', label: 'Bas' },
                        { value: 'left', label: 'Gauche' },
                        { value: 'right', label: 'Droite' },
                        { value: 'top left', label: 'Haut-gauche' },
                        { value: 'top right', label: 'Haut-droite' },
                        { value: 'bottom left', label: 'Bas-gauche' },
                        { value: 'bottom right', label: 'Bas-droite' }
                    ]},
                    { name: 'imageFit', label: 'Ajustement image', type: 'select', category: 'Image', options: [
                        { value: 'contain', label: 'Contenir (proportions)' },
                        { value: 'cover', label: 'Couvrir (remplir)' },
                        { value: 'fill', label: '√âtirer (d√©former)' }
                    ]},
                    
                    // Ombres
                    { name: 'shadowEnabled', label: 'Activer l\'ombre', type: 'checkbox', category: 'Ombres' },
                    { name: 'shadowColor', label: 'Couleur de l\'ombre', type: 'color', category: 'Ombres' },
                    { name: 'shadowOpacity', label: 'Opacit√© ombre (%)', type: 'range', min: 0, max: 100, category: 'Ombres' },
                    { name: 'shadowOffsetX', label: 'D√©calage X (px)', type: 'range', min: -20, max: 20, category: 'Ombres' },
                    { name: 'shadowOffsetY', label: 'D√©calage Y (px)', type: 'range', min: -20, max: 20, category: 'Ombres' },
                    { name: 'shadowBlur', label: 'Flou de l\'ombre (px)', type: 'range', min: 0, max: 30, category: 'Ombres' }
                ];
            }

            getElements() {
                return [
                    { id: 'container', name: 'Conteneur', editable: true },
                    { id: 'link', name: 'Lien', editable: true },
                    { id: 'image', name: 'Image', editable: true }
                ];
            }
        }

        class HeroTitleWidget {
            constructor() {
                this.id = 'hero-title';
                this.name = 'Titre Hero';
                this.category = 'Contenu';
                this.icon = '‚ú®';
                this.description = 'Titre principal avec gradient';
                
                this.defaultData = {
                    title: 'Li-CUBE PRO‚Ñ¢',
                    // Propri√©t√©s avanc√©es du titre principal (inspir√©es du TextSimple)
                    titleSize: 48,
                    titleColor: '#10b981',
                    titleAlignment: 'center',
                    titleIsBold: true,
                    titleIsItalic: false,
                    titleHasBackground: false,
                    titleBackgroundColor: '#10b981',
                    titleBackgroundOpacity: 20,
                    titleHasBorder: false,
                    titleBorderColor: '#10b981',
                    titleBorderWidth: 2,
                    titleBorderStyle: 'solid',
                    titleHasRoundedCorners: false,
                    titleBorderRadius: 8,
                    titlePaddingTop: 'none',
                    titlePaddingBottom: 'small',
                    titlePaddingLeft: 'none',
                    titlePaddingRight: 'none',
                    titleMarginBottom: 'small',
                    subtitle: 'LOCATION INTELLIGENTE Z√âRO RISQUE',
                    text: 'D√©couvrez nos solutions innovantes pour votre entreprise. Nos √©quipements de derni√®re g√©n√©ration vous accompagnent dans tous vos projets avec une fiabilit√© exceptionnelle.',
                    subtitleSize: 24,
                    textSize: 16,
                    gradient: true,
                    animation: 'slide-up',
                    alignment: 'center',
                    backgroundColor: 'transparent',
                    borderRadius: 0
                };
            }

            // Helper pour convertir les valeurs d'espacement en pixels (inspir√© du TextSimple)
            getSpacingValue(spacingType) {
                const spacingMap = {
                    'none': '0px',
                    'small': '20px',
                    'medium': '30px', 
                    'large': '40px'
                };
                return spacingMap[spacingType] || '20px';
            }

            // G√©n√®re les styles CSS pour le titre Hero
            generateTitleStyles(data) {
                const styleRules = [];
                
                // Style de base
                styleRules.push('text-align: ' + (data.titleAlignment || 'center'));
                styleRules.push('font-size: ' + (data.titleSize || 48) + 'px');
                styleRules.push('font-weight: ' + (data.titleIsBold ? '900' : 'normal'));
                styleRules.push('font-style: ' + (data.titleIsItalic ? 'italic' : 'normal'));
                styleRules.push('line-height: 1.1');
                styleRules.push('animation-delay: 0.2s');
                
                // Couleur et gradient
                if (data.gradient) {
                    styleRules.push('background: linear-gradient(135deg, #10b981, #0d9488)');
                    styleRules.push('-webkit-background-clip: text');
                    styleRules.push('-webkit-text-fill-color: transparent');
                    styleRules.push('background-clip: text');
                } else {
                    styleRules.push('color: ' + (data.titleColor || '#10b981'));
                }
                
                // Arri√®re-plan (ind√©pendant du gradient)
                if (data.titleHasBackground) {
                    const opacity = (data.titleBackgroundOpacity || 20) / 100;
                    const bgColor = data.titleBackgroundColor || '#10b981';
                    // Convertir hex en rgba
                    const hex = bgColor.replace('#', '');
                    const r = parseInt(hex.substr(0, 2), 16);
                    const g = parseInt(hex.substr(2, 2), 16);
                    const b = parseInt(hex.substr(4, 2), 16);
                    styleRules.push(`background-color: rgba(${r}, ${g}, ${b}, ${opacity})`);
                    // Si gradient ET background, on utilise un background composite
                    if (data.gradient) {
                        styleRules.pop(); // Enlever la r√®gle background-color
                        styleRules.push(`background: linear-gradient(135deg, #10b981, #0d9488), rgba(${r}, ${g}, ${b}, ${opacity})`);
                        styleRules.push('background-blend-mode: overlay');
                    }
                }
                
                // Contour
                if (data.titleHasBorder) {
                    const borderWidth = data.titleBorderWidth || 2;
                    const borderStyle = data.titleBorderStyle || 'solid';
                    const borderColor = data.titleBorderColor || '#10b981';
                    styleRules.push(`border: ${borderWidth}px ${borderStyle} ${borderColor}`);
                }
                
                // Coins arrondis
                if (data.titleHasRoundedCorners) {
                    const borderRadius = data.titleBorderRadius || 8;
                    styleRules.push(`border-radius: ${borderRadius}px`);
                }
                
                // Espacement interne (padding)
                const paddingTop = this.getSpacingValue(data.titlePaddingTop || 'none');
                const paddingBottom = this.getSpacingValue(data.titlePaddingBottom || 'small');
                const paddingLeft = this.getSpacingValue(data.titlePaddingLeft || 'none');
                const paddingRight = this.getSpacingValue(data.titlePaddingRight || 'none');
                styleRules.push(`padding: ${paddingTop} ${paddingRight} ${paddingBottom} ${paddingLeft}`);
                
                // Marge du bas
                const marginBottom = this.getSpacingValue(data.titleMarginBottom || 'small');
                styleRules.push(`margin-bottom: ${marginBottom}`);
                
                return styleRules.join('; ');
            }

            render(data = {}) {
                const d = { ...this.defaultData, ...data };
                
                // G√©n√©rer les styles du titre Hero
                const titleStyles = this.generateTitleStyles(d);
                
                const backgroundStyle = d.backgroundColor !== 'transparent' ? 
                    `background-color: ${d.backgroundColor}; ` : 
                    '';
                
                const borderRadiusStyle = d.borderRadius > 0 ? 
                    `border-radius: ${d.borderRadius}px; overflow: hidden; ` : 
                    '';
                
                return `
                    <div class="hero-section" style="text-align: ${d.alignment}; padding: 60px 20px; 
                                                   ${backgroundStyle}${borderRadiusStyle}
                                                   transition: all 0.3s ease;">
                        <h1 class="hero-title ${d.animation}" style="${titleStyles}">
                            ${d.title}
                        </h1>
                        <div class="hero-subtitle ${d.animation}"
                             style="font-size: ${d.subtitleSize}px; font-weight: 600; 
                                    color: #6b7280; line-height: 1.3; max-width: 600px; 
                                    margin: 0 auto 30px auto; animation-delay: 0.4s;">
                            ${d.subtitle}
                        </div>
                        <div class="hero-text ${d.animation}"
                             style="font-size: ${d.textSize}px; font-weight: 400; 
                                    color: #9ca3af; line-height: 1.6; max-width: 700px; 
                                    margin: 0 auto; animation-delay: 0.6s;">
                            ${d.text}
                        </div>
                    </div>
                `;
            }

            getEditableFields() {
                return [
                    // Section 1: Contenu
                    { name: 'title', label: 'Titre', type: 'text', category: 'Contenu' },
                    
                    // Section 2: Style du titre principal
                    { name: 'titleSize', label: 'Taille du titre', type: 'range', min: 24, max: 96, category: 'Titre - Typographie' },
                    { name: 'titleColor', label: 'Couleur du titre', type: 'color', category: 'Titre - Typographie', condition: { field: 'gradient', value: false } },
                    { name: 'titleAlignment', label: 'Alignement du titre', type: 'select', options: [
                        { value: 'left', label: 'Gauche' },
                        { value: 'center', label: 'Centre' },
                        { value: 'right', label: 'Droite' }
                    ], category: 'Titre - Typographie' },
                    { name: 'titleIsBold', label: 'Titre en gras', type: 'checkbox', category: 'Titre - Typographie' },
                    { name: 'titleIsItalic', label: 'Titre en italique', type: 'checkbox', category: 'Titre - Typographie' },
                    { name: 'gradient', label: 'Gradient sur le titre', type: 'checkbox', category: 'Titre - Typographie' },
                    
                    // Section 3: Arri√®re-plan du titre
                    { name: 'titleHasBackground', label: 'Arri√®re-plan du titre', type: 'checkbox', category: 'Titre - Arri√®re-plan' },
                    { name: 'titleBackgroundColor', label: 'Couleur de fond du titre', type: 'color', category: 'Titre - Arri√®re-plan', condition: { field: 'titleHasBackground', value: true } },
                    { name: 'titleBackgroundOpacity', label: 'Transparence du fond', type: 'range', min: 0, max: 100, step: 5, category: 'Titre - Arri√®re-plan', condition: { field: 'titleHasBackground', value: true } },
                    
                    // Section 4: Contour du titre
                    { name: 'titleHasBorder', label: 'Contour du titre', type: 'checkbox', category: 'Titre - Contour' },
                    { name: 'titleBorderColor', label: 'Couleur du contour', type: 'color', category: 'Titre - Contour', condition: { field: 'titleHasBorder', value: true } },
                    { name: 'titleBorderWidth', label: '√âpaisseur du contour', type: 'range', min: 1, max: 10, step: 1, category: 'Titre - Contour', condition: { field: 'titleHasBorder', value: true } },
                    { name: 'titleBorderStyle', label: 'Style du contour', type: 'select', options: [
                        { value: 'solid', label: 'Solide' },
                        { value: 'dashed', label: 'Tirets' },
                        { value: 'dotted', label: 'Points' },
                        { value: 'double', label: 'Double' }
                    ], category: 'Titre - Contour', condition: { field: 'titleHasBorder', value: true } },
                    
                    // Section 5: Coins arrondis du titre
                    { name: 'titleHasRoundedCorners', label: 'Coins arrondis du titre', type: 'checkbox', category: 'Titre - Forme' },
                    { name: 'titleBorderRadius', label: 'Niveau d\'arrondi', type: 'range', min: 0, max: 50, step: 2, category: 'Titre - Forme', condition: { field: 'titleHasRoundedCorners', value: true } },
                    
                    // Section 6: Espacement du titre
                    { name: 'titlePaddingTop', label: 'Espacement haut du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucun' },
                        { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' },
                        { value: 'large', label: 'Grand' }
                    ], category: 'Titre - Espacement' },
                    { name: 'titlePaddingBottom', label: 'Espacement bas du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucun' },
                        { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' },
                        { value: 'large', label: 'Grand' }
                    ], category: 'Titre - Espacement' },
                    { name: 'titlePaddingLeft', label: 'Espacement gauche du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucun' },
                        { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' },
                        { value: 'large', label: 'Grand' }
                    ], category: 'Titre - Espacement' },
                    { name: 'titlePaddingRight', label: 'Espacement droite du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucun' },
                        { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' },
                        { value: 'large', label: 'Grand' }
                    ], category: 'Titre - Espacement' },
                    { name: 'titleMarginBottom', label: 'Marge du bas du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucune' },
                        { value: 'small', label: 'Petite' },
                        { value: 'medium', label: 'Moyenne' },
                        { value: 'large', label: 'Grande' }
                    ], category: 'Titre - Espacement' },
                    
                    // Section 7: Autres √©l√©ments
                    { name: 'subtitle', label: 'Sous-titre', type: 'textarea', category: 'Contenu' },
                    { name: 'text', label: 'Texte descriptif', type: 'textarea', category: 'Contenu' },
                    { name: 'subtitleSize', label: 'Taille sous-titre', type: 'range', min: 14, max: 36, category: 'Typographie' },
                    { name: 'textSize', label: 'Taille texte', type: 'range', min: 12, max: 24, category: 'Typographie' },
                    { name: 'alignment', label: 'Alignement global', type: 'select', category: 'Layout', options: [
                        { value: 'left', label: 'Gauche' },
                        { value: 'center', label: 'Centre' },
                        { value: 'right', label: 'Droite' }
                    ]},
                    { name: 'backgroundColor', label: 'Couleur d\'arri√®re-plan', type: 'color', category: 'Style' },
                    { name: 'borderRadius', label: 'Arrondi des bords', type: 'range', min: 0, max: 50, category: 'Style' }
                ];
            }

            getElements() {
                return [
                    { id: 'section', name: 'Section Hero', editable: true },
                    { id: 'title', name: 'Titre principal', editable: true },
                    { id: 'subtitle', name: 'Sous-titre', editable: true },
                    { id: 'text', name: 'Texte descriptif', editable: true }
                ];
            }
        }

        class PricingCardWidget {
            constructor() {
                this.id = 'pricing-card';
                this.name = 'Carte Tarification';
                this.category = 'Commerce';
                this.icon = 'üí∞';
                this.description = 'Carte de prix compl√®te';
                
                this.defaultData = {
                    planName: 'ESSENTIEL',
                    // Propri√©t√©s du titre principal (planName) - inspir√©es du TextSimple
                    planNameSize: 20,
                    planNameColor: '#ffffff',
                    planNameAlignment: 'center',
                    planNameIsBold: true,
                    planNameIsItalic: false,
                    planNameHasBackground: false,
                    planNameBackgroundColor: '#10b981',
                    planNameBackgroundOpacity: 20,
                    planNameHasBorder: false,
                    planNameBorderColor: '#10b981',
                    planNameBorderWidth: 2,
                    planNameBorderStyle: 'solid',
                    planNameHasRoundedCorners: false,
                    planNameBorderRadius: 8,
                    planNamePaddingTop: 'small',
                    planNamePaddingBottom: 'large',
                    planNamePaddingLeft: 'medium',
                    planNamePaddingRight: 'medium',
                    planNameMarginBottom: 'large',
                    price: '299',
                    currency: '$',
                    period: '/mois',
                    ctaText: 'Choisir ce plan',
                    ctaLink: '#contact',
                    featured: false,
                    badge: '',
                    accentColor: '#10b981',
                    backgroundColor: '#1f2937',
                    textColor: '#ffffff',
                    features: [
                        'Installation gratuite',
                        'Maintenance incluse',
                        'Support par email',
                        'Jusqu\'√† 50 √©quipements'
                    ]
                };
            }

            // Helper pour convertir les valeurs d'espacement en pixels (inspir√© du TextSimple)
            getSpacingValue(spacingType) {
                const spacingMap = {
                    'none': '0px',
                    'small': '8px',
                    'medium': '16px',
                    'large': '32px'
                };
                return spacingMap[spacingType] || '16px';
            }

            // G√©n√®re les styles CSS pour le titre du plan
            generatePlanNameStyles(data) {
                const styleRules = [];
                
                // Style de base
                styleRules.push('text-align: ' + (data.planNameAlignment || 'center'));
                styleRules.push('font-size: ' + (data.planNameSize || 20) + 'px');
                styleRules.push('color: ' + (data.planNameColor || '#ffffff'));
                styleRules.push('font-weight: ' + (data.planNameIsBold ? 'bold' : 'normal'));
                styleRules.push('font-style: ' + (data.planNameIsItalic ? 'italic' : 'normal'));
                styleRules.push('text-transform: uppercase');
                styleRules.push('letter-spacing: 0.05em');
                
                // Arri√®re-plan
                if (data.planNameHasBackground) {
                    const opacity = (data.planNameBackgroundOpacity || 20) / 100;
                    const bgColor = data.planNameBackgroundColor || '#10b981';
                    // Convertir hex en rgba
                    const hex = bgColor.replace('#', '');
                    const r = parseInt(hex.substr(0, 2), 16);
                    const g = parseInt(hex.substr(2, 2), 16);
                    const b = parseInt(hex.substr(4, 2), 16);
                    styleRules.push(`background-color: rgba(${r}, ${g}, ${b}, ${opacity})`);
                }
                
                // Contour
                if (data.planNameHasBorder) {
                    const borderWidth = data.planNameBorderWidth || 2;
                    const borderStyle = data.planNameBorderStyle || 'solid';
                    const borderColor = data.planNameBorderColor || '#10b981';
                    styleRules.push(`border: ${borderWidth}px ${borderStyle} ${borderColor}`);
                }
                
                // Coins arrondis
                if (data.planNameHasRoundedCorners) {
                    const borderRadius = data.planNameBorderRadius || 8;
                    styleRules.push(`border-radius: ${borderRadius}px`);
                }
                
                // Espacement interne (padding)
                const paddingTop = this.getSpacingValue(data.planNamePaddingTop || 'small');
                const paddingBottom = this.getSpacingValue(data.planNamePaddingBottom || 'large');
                const paddingLeft = this.getSpacingValue(data.planNamePaddingLeft || 'medium');
                const paddingRight = this.getSpacingValue(data.planNamePaddingRight || 'medium');
                styleRules.push(`padding: ${paddingTop} ${paddingRight} ${paddingBottom} ${paddingLeft}`);
                
                // Marge du bas
                const marginBottom = this.getSpacingValue(data.planNameMarginBottom || 'large');
                styleRules.push(`margin-bottom: ${marginBottom}`);
                
                return styleRules.join('; ');
            }

            render(data = {}) {
                const d = { ...this.defaultData, ...data };
                
                // G√©n√©rer les styles du titre du plan
                const planNameStyles = this.generatePlanNameStyles(d);
                
                const featuresHtml = d.features.map(feature => 
                    `<li style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px; color: ${d.textColor || '#6b7280'};">
                        <span style="color: ${d.accentColor || '#10b981'}; font-size: 14px;">‚úì</span>
                        <span>${feature}</span>
                    </li>`
                ).join('');

                const badgeHtml = d.badge ? 
                    `<div class="pricing-badge" style="position: absolute; top: -10px; left: 50%; 
                                                      transform: translateX(-50%); background: ${d.accentColor || '#10b981'}; 
                                                      color: white; padding: 4px 12px; border-radius: 6px; 
                                                      font-size: 12px; font-weight: bold;">
                        ${d.badge}
                    </div>` : '';

                return `
                    <div class="pricing-card ${d.featured ? 'featured' : ''}" 
                         style="background: ${d.backgroundColor || '#1f2937'}; 
                                border: 2px solid ${d.featured ? (d.accentColor || '#10b981') : '#374151'}; 
                                border-radius: 12px; padding: 32px; text-align: center; position: relative; 
                                backdrop-filter: blur(10px); margin: 20px; color: ${d.textColor || '#ffffff'};">
                        ${badgeHtml}
                        
                        <div style="margin-bottom: 32px;">
                            <h3 class="pricing-plan-name" style="${planNameStyles}">
                                ${d.planName}
                            </h3>
                            
                            <div style="display: flex; align-items: baseline; justify-content: center; gap: 8px; margin-bottom: 20px;">
                                <span style="font-size: 2rem; font-weight: 600; color: ${d.accentColor || '#10b981'};">${d.currency}</span>
                                <span style="font-size: 3.5rem; font-weight: 900; color: ${d.textColor || 'white'}; line-height: 1;">${d.price}</span>
                                <span style="font-size: 1.125rem; color: #9ca3af; font-weight: 500;">${d.period}</span>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 32px;">
                            <ul style="list-style: none; padding: 0; margin: 0; text-align: left;">
                                ${featuresHtml}
                            </ul>
                        </div>
                        
                        <div>
                            <a href="${d.ctaLink}" 
                               style="width: 100%; padding: 16px 24px; background: ${d.accentColor || '#10b981'}; color: white;
                                      border: none; border-radius: 8px; font-size: 1rem; font-weight: 600;
                                      text-transform: uppercase; letter-spacing: 0.05em; transition: all 0.3s;
                                      text-decoration: none; display: inline-block; cursor: pointer;">
                                ${d.ctaText}
                            </a>
                        </div>
                    </div>
                `;
            }

            getEditableFields() {
                return [
                    // Section 1: Contenu
                    { name: 'planName', label: 'Nom du plan', type: 'text', category: 'Contenu' },
                    
                    // Section 2: Style du titre du plan
                    { name: 'planNameSize', label: 'Taille du titre', type: 'range', min: 12, max: 40, category: 'Titre - Typographie' },
                    { name: 'planNameColor', label: 'Couleur du titre', type: 'color', category: 'Titre - Typographie' },
                    { name: 'planNameAlignment', label: 'Alignement du titre', type: 'select', options: [
                        { value: 'left', label: 'Gauche' },
                        { value: 'center', label: 'Centre' },
                        { value: 'right', label: 'Droite' }
                    ], category: 'Titre - Typographie' },
                    { name: 'planNameIsBold', label: 'Titre en gras', type: 'checkbox', category: 'Titre - Typographie' },
                    { name: 'planNameIsItalic', label: 'Titre en italique', type: 'checkbox', category: 'Titre - Typographie' },
                    
                    // Section 3: Arri√®re-plan du titre
                    { name: 'planNameHasBackground', label: 'Arri√®re-plan du titre', type: 'checkbox', category: 'Titre - Arri√®re-plan' },
                    { name: 'planNameBackgroundColor', label: 'Couleur de fond du titre', type: 'color', category: 'Titre - Arri√®re-plan', condition: { field: 'planNameHasBackground', value: true } },
                    { name: 'planNameBackgroundOpacity', label: 'Transparence du fond', type: 'range', min: 0, max: 100, step: 5, category: 'Titre - Arri√®re-plan', condition: { field: 'planNameHasBackground', value: true } },
                    
                    // Section 4: Contour du titre
                    { name: 'planNameHasBorder', label: 'Contour du titre', type: 'checkbox', category: 'Titre - Contour' },
                    { name: 'planNameBorderColor', label: 'Couleur du contour', type: 'color', category: 'Titre - Contour', condition: { field: 'planNameHasBorder', value: true } },
                    { name: 'planNameBorderWidth', label: '√âpaisseur du contour', type: 'range', min: 1, max: 10, step: 1, category: 'Titre - Contour', condition: { field: 'planNameHasBorder', value: true } },
                    { name: 'planNameBorderStyle', label: 'Style du contour', type: 'select', options: [
                        { value: 'solid', label: 'Solide' },
                        { value: 'dashed', label: 'Tirets' },
                        { value: 'dotted', label: 'Points' },
                        { value: 'double', label: 'Double' }
                    ], category: 'Titre - Contour', condition: { field: 'planNameHasBorder', value: true } },
                    
                    // Section 5: Coins arrondis du titre
                    { name: 'planNameHasRoundedCorners', label: 'Coins arrondis du titre', type: 'checkbox', category: 'Titre - Forme' },
                    { name: 'planNameBorderRadius', label: 'Niveau d\'arrondi', type: 'range', min: 0, max: 50, step: 2, category: 'Titre - Forme', condition: { field: 'planNameHasRoundedCorners', value: true } },
                    
                    // Section 6: Espacement du titre
                    { name: 'planNamePaddingTop', label: 'Espacement haut du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucun' },
                        { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' },
                        { value: 'large', label: 'Grand' }
                    ], category: 'Titre - Espacement' },
                    { name: 'planNamePaddingBottom', label: 'Espacement bas du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucun' },
                        { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' },
                        { value: 'large', label: 'Grand' }
                    ], category: 'Titre - Espacement' },
                    { name: 'planNamePaddingLeft', label: 'Espacement gauche du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucun' },
                        { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' },
                        { value: 'large', label: 'Grand' }
                    ], category: 'Titre - Espacement' },
                    { name: 'planNamePaddingRight', label: 'Espacement droite du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucun' },
                        { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' },
                        { value: 'large', label: 'Grand' }
                    ], category: 'Titre - Espacement' },
                    { name: 'planNameMarginBottom', label: 'Marge du bas du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucune' },
                        { value: 'small', label: 'Petite' },
                        { value: 'medium', label: 'Moyenne' },
                        { value: 'large', label: 'Grande' }
                    ], category: 'Titre - Espacement' },
                    
                    // Section 7: Autres √©l√©ments de la carte
                    { name: 'price', label: 'Prix', type: 'text', category: 'Contenu' },
                    { name: 'currency', label: 'Devise', type: 'text', category: 'Contenu' },
                    { name: 'period', label: 'P√©riode', type: 'text', category: 'Contenu' },
                    { name: 'ctaText', label: 'Texte bouton', type: 'text', category: 'Contenu' },
                    { name: 'ctaLink', label: 'Lien bouton', type: 'text', category: 'Contenu' },
                    { name: 'featured', label: 'Plan vedette', type: 'checkbox', category: 'Contenu' },
                    { name: 'badge', label: 'Badge', type: 'text', category: 'Contenu' },
                    { name: 'accentColor', label: 'Couleur principale', type: 'color', category: 'Style' },
                    { name: 'backgroundColor', label: 'Couleur de fond', type: 'color', category: 'Style' },
                    { name: 'textColor', label: 'Couleur du texte', type: 'color', category: 'Style' }
                ];
            }

            getElements() {
                return [
                    { id: 'card', name: 'Carte principale', editable: true },
                    { id: 'header', name: 'En-t√™te', editable: true },
                    { id: 'price', name: 'Prix', editable: true },
                    { id: 'features', name: 'Fonctionnalit√©s', editable: true, manageable: true },
                    { id: 'cta', name: 'Bouton action', editable: true }
                ];
            }
            
            // M√©thodes pour gestion dynamique des fonctionnalit√©s
            addFeature(newFeature) {
                if (!newFeature || newFeature.trim() === '') return;
                this.defaultData.features.push(newFeature.trim());
            }
            
            removeFeature(index) {
                if (index >= 0 && index < this.defaultData.features.length) {
                    this.defaultData.features.splice(index, 1);
                }
            }
            
            updateFeature(index, newText) {
                if (index >= 0 && index < this.defaultData.features.length) {
                    this.defaultData.features[index] = newText;
                }
            }
        }

        class CallToActionWidget {
            constructor() {
                this.id = 'call-to-action';
                this.name = 'Call to Action';
                this.category = 'Action';
                this.icon = 'üöÄ';
                this.description = 'Section compl√®te d\'appel √† l\'action avec toutes les informations de contact';
                
                this.defaultData = {
                    // Configuration widget
                    defaultWidth: 9,
                    
                    // Titre principal
                    mainTitle: 'LOUEZ VOTRE Li-CUBE PRO‚Ñ¢ MAINTENANT',
                    mainTitleSize: 48,
                    mainTitleColor: '#ffffff',
                    mainTitleAlignment: 'center',
                    mainTitleIsBold: true,
                    mainTitleIsItalic: false,
                    mainTitleHasBackground: false,
                    mainTitleBackgroundColor: '#10b981',
                    mainTitleBackgroundOpacity: 20,
                    mainTitleHasBorder: false,
                    mainTitleBorderColor: '#10b981',
                    mainTitleBorderWidth: 2,
                    mainTitleBorderStyle: 'solid',
                    mainTitleHasRoundedCorners: false,
                    mainTitleBorderRadius: 8,
                    mainTitlePaddingTop: 'medium',
                    mainTitlePaddingBottom: 'small',
                    mainTitlePaddingLeft: 'medium',
                    mainTitlePaddingRight: 'medium',
                    mainTitleMarginBottom: 'medium',
                    
                    // Sous-titre
                    subtitle: 'Z√©ro risque, z√©ro surprise, performance maximale garantie',
                    subtitleSize: 24,
                    subtitleColor: '#e0e7ff',
                    subtitleAlignment: 'center',
                    subtitleIsBold: false,
                    subtitleIsItalic: false,
                    subtitleHasBackground: false,
                    subtitleBackgroundColor: '#10b981',
                    subtitleBackgroundOpacity: 20,
                    subtitleHasBorder: false,
                    subtitleBorderColor: '#10b981',
                    subtitleBorderWidth: 2,
                    subtitleBorderStyle: 'solid',
                    subtitleHasRoundedCorners: false,
                    subtitleBorderRadius: 8,
                    subtitlePaddingTop: 'none',
                    subtitlePaddingBottom: 'large',
                    subtitlePaddingLeft: 'medium',
                    subtitlePaddingRight: 'medium',
                    subtitleMarginBottom: 'large',
                    
                    // Section Contact
                    phoneIcon: 'üìû',
                    phoneTitle: 'Division Location',
                    phoneNumber: '819-323-5622',
                    phoneSubtitle: 'Service commercial 8h-17h',
                    phoneTitleSize: 20,
                    phoneTitleColor: '#ffffff',
                    phoneNumberSize: 28,
                    phoneNumberColor: '#10b981',
                    phoneSubtitleSize: 16,
                    phoneSubtitleColor: '#e0e7ff',
                    
                    // Section Email
                    emailIcon: '‚úâÔ∏è',
                    emailTitle: 'Email Location',
                    emailAddress: 'location@edsquebec.com',
                    emailSubtitle: 'Devis sous 2h ouvr√©es',
                    emailTitleSize: 20,
                    emailTitleColor: '#ffffff',
                    emailAddressSize: 22,
                    emailAddressColor: '#10b981',
                    emailSubtitleSize: 16,
                    emailSubtitleColor: '#e0e7ff',
                    
                    // Section D√©lai
                    deliveryIcon: 'üöÄ',
                    deliveryTitle: 'Mise en Service',
                    deliveryTime: '48h',
                    deliverySubtitle: 'Apr√®s signature du contrat',
                    deliveryTitleSize: 20,
                    deliveryTitleColor: '#ffffff',
                    deliveryTimeSize: 32,
                    deliveryTimeColor: '#10b981',
                    deliverySubtitleSize: 16,
                    deliverySubtitleColor: '#e0e7ff',
                    
                    // Boutons d'action
                    primaryButtonText: 'CONCLURE LA VENTE',
                    primaryButtonLink: '#contact',
                    primaryButtonColor: '#10b981',
                    primaryButtonTextColor: '#ffffff',
                    
                    secondaryButtonText: 'PR√âPARER CONTRAT',
                    secondaryButtonLink: '#contract',
                    secondaryButtonColor: '#374151',
                    secondaryButtonTextColor: '#ffffff',
                    
                    // Section Avantages
                    advantages: [
                        { text: 'Devis gratuit et sans engagement', emoji: '‚úÖ', color: '#10b981' },
                        { text: 'Installation par techniciens certifi√©s EDS', emoji: '‚úÖ', color: '#10b981' },
                        { text: 'Contrat flexible adapt√© √† vos besoins', emoji: '‚úÖ', color: '#10b981' },
                        { text: 'Support qu√©b√©cois en fran√ßais 24/7', emoji: '‚úÖ', color: '#10b981' }
                    ],
                    advantagesColumns: 2,
                    
                    // Style g√©n√©ral
                    backgroundColor: '#1e40af',
                    containerPadding: 60,
                    borderRadius: 16,
                    hasShadow: true,
                    shadowColor: '#000000',
                    shadowOpacity: 30
                };
            }

            // Helper pour convertir les valeurs d'espacement en pixels (inspir√© du TextSimple)
            getSpacingValue(spacingType) {
                const spacingMap = {
                    'none': '0px',
                    'small': '20px',
                    'medium': '30px', 
                    'large': '40px'
                };
                return spacingMap[spacingType] || '20px';
            }

            // G√©n√®re les styles CSS pour un texte avec personnalisation compl√®te
            generateTextStyles(data, prefix) {
                const styleRules = [];
                
                // Style de base
                styleRules.push('text-align: ' + (data[prefix + 'Alignment'] || 'center'));
                styleRules.push('font-size: ' + (data[prefix + 'Size'] || 20) + 'px');
                styleRules.push('color: ' + (data[prefix + 'Color'] || '#ffffff'));
                styleRules.push('font-weight: ' + (data[prefix + 'IsBold'] ? 'bold' : 'normal'));
                styleRules.push('font-style: ' + (data[prefix + 'IsItalic'] ? 'italic' : 'normal'));
                
                // Arri√®re-plan
                if (data[prefix + 'HasBackground']) {
                    const opacity = (data[prefix + 'BackgroundOpacity'] || 20) / 100;
                    const bgColor = data[prefix + 'BackgroundColor'] || '#10b981';
                    const hex = bgColor.replace('#', '');
                    const r = parseInt(hex.substr(0, 2), 16);
                    const g = parseInt(hex.substr(2, 2), 16);
                    const b = parseInt(hex.substr(4, 2), 16);
                    styleRules.push(`background-color: rgba(${r}, ${g}, ${b}, ${opacity})`);
                }
                
                // Contour
                if (data[prefix + 'HasBorder']) {
                    const borderWidth = data[prefix + 'BorderWidth'] || 2;
                    const borderStyle = data[prefix + 'BorderStyle'] || 'solid';
                    const borderColor = data[prefix + 'BorderColor'] || '#10b981';
                    styleRules.push(`border: ${borderWidth}px ${borderStyle} ${borderColor}`);
                }
                
                // Coins arrondis
                if (data[prefix + 'HasRoundedCorners']) {
                    const borderRadius = data[prefix + 'BorderRadius'] || 8;
                    styleRules.push(`border-radius: ${borderRadius}px`);
                }
                
                // Espacement interne (padding)
                const paddingTop = this.getSpacingValue(data[prefix + 'PaddingTop'] || 'none');
                const paddingBottom = this.getSpacingValue(data[prefix + 'PaddingBottom'] || 'none');
                const paddingLeft = this.getSpacingValue(data[prefix + 'PaddingLeft'] || 'none');
                const paddingRight = this.getSpacingValue(data[prefix + 'PaddingRight'] || 'none');
                styleRules.push(`padding: ${paddingTop} ${paddingRight} ${paddingBottom} ${paddingLeft}`);
                
                // Marge du bas
                if (data[prefix + 'MarginBottom']) {
                    const marginBottom = this.getSpacingValue(data[prefix + 'MarginBottom']);
                    styleRules.push(`margin-bottom: ${marginBottom}`);
                }
                
                return styleRules.join('; ');
            }

            render(data = {}) {
                const d = { ...this.defaultData, ...data };
                
                // G√©n√©rer les styles des textes
                const mainTitleStyles = this.generateTextStyles(d, 'mainTitle');
                const subtitleStyles = this.generateTextStyles(d, 'subtitle');
                
                // Cr√©er la liste des avantages avec syst√®me de colonnes
                const columnsCount = Math.min(Math.max(d.advantagesColumns || 2, 1), 4);
                const advantagesHtml = d.advantages.map(advantage => `
                    <div class="advantage-item" style="display: flex; align-items: center; margin-bottom: 15px; font-size: 16px;">
                        <span class="advantage-emoji" style="font-size: 20px; margin-right: 12px;">${advantage.emoji}</span>
                        <span class="advantage-text" style="color: ${advantage.color}; font-weight: 500;">${advantage.text}</span>
                    </div>
                `).join('');
                
                // Style du conteneur avec ombre
                const containerShadow = d.hasShadow ? 
                    `box-shadow: 0 20px 40px rgba(${parseInt((d.shadowColor || '#000000').substring(1, 3), 16)}, ${parseInt((d.shadowColor || '#000000').substring(3, 5), 16)}, ${parseInt((d.shadowColor || '#000000').substring(5, 7), 16)}, ${(d.shadowOpacity || 30) / 100});` : '';

                return `
                    <div class="cta-location-section" 
                         style="background: ${d.backgroundColor}; color: white; 
                                padding: ${d.containerPadding}px; border-radius: ${d.borderRadius}px; 
                                margin: 40px 0; ${containerShadow}">
                        
                        <!-- Titre principal -->
                        <h1 style="${mainTitleStyles}">
                            ${d.mainTitle}
                        </h1>
                        
                        <!-- Sous-titre -->
                        <p style="${subtitleStyles}">
                            ${d.subtitle}
                        </p>
                        
                        <!-- Sections d'information -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 40px; margin-bottom: 50px;">
                            
                            <!-- Section T√©l√©phone -->
                            <div style="text-align: center; padding: 30px; background: rgba(255,255,255,0.1); border-radius: 12px;">
                                <div style="font-size: 48px; margin-bottom: 15px;">${d.phoneIcon}</div>
                                <h3 style="font-size: ${d.phoneTitleSize}px; color: ${d.phoneTitleColor}; margin-bottom: 10px;">${d.phoneTitle}</h3>
                                <a href="tel:${d.phoneNumber.replace(/[^0-9]/g, '')}" style="font-size: ${d.phoneNumberSize}px; color: ${d.phoneNumberColor}; font-weight: bold; text-decoration: none; display: block; margin-bottom: 10px;">${d.phoneNumber}</a>
                                <p style="font-size: ${d.phoneSubtitleSize}px; color: ${d.phoneSubtitleColor}; margin: 0;">${d.phoneSubtitle}</p>
                            </div>
                            
                            <!-- Section Email -->
                            <div style="text-align: center; padding: 30px; background: rgba(255,255,255,0.1); border-radius: 12px;">
                                <div style="font-size: 48px; margin-bottom: 15px;">${d.emailIcon}</div>
                                <h3 style="font-size: ${d.emailTitleSize}px; color: ${d.emailTitleColor}; margin-bottom: 10px;">${d.emailTitle}</h3>
                                <a href="mailto:${d.emailAddress}" style="font-size: ${d.emailAddressSize}px; color: ${d.emailAddressColor}; font-weight: bold; text-decoration: none; display: block; margin-bottom: 10px;">${d.emailAddress}</a>
                                <p style="font-size: ${d.emailSubtitleSize}px; color: ${d.emailSubtitleColor}; margin: 0;">${d.emailSubtitle}</p>
                            </div>
                            
                            <!-- Section D√©lai -->
                            <div style="text-align: center; padding: 30px; background: rgba(255,255,255,0.1); border-radius: 12px;">
                                <div style="font-size: 48px; margin-bottom: 15px;">${d.deliveryIcon}</div>
                                <h3 style="font-size: ${d.deliveryTitleSize}px; color: ${d.deliveryTitleColor}; margin-bottom: 10px;">${d.deliveryTitle}</h3>
                                <div style="font-size: ${d.deliveryTimeSize}px; color: ${d.deliveryTimeColor}; font-weight: bold; display: block; margin-bottom: 10px;">${d.deliveryTime}</div>
                                <p style="font-size: ${d.deliverySubtitleSize}px; color: ${d.deliverySubtitleColor}; margin: 0;">${d.deliverySubtitle}</p>
                            </div>
                            
                        </div>
                        
                        <!-- Boutons d'action -->
                        <div style="text-align: center; margin-bottom: 40px;">
                            <a href="${d.primaryButtonLink}" 
                               style="padding: 16px 32px; background: ${d.primaryButtonColor}; color: ${d.primaryButtonTextColor}; 
                                      border-radius: 8px; font-size: 18px; font-weight: 700; 
                                      text-decoration: none; display: inline-block; margin: 0 10px; 
                                      border: 3px solid ${d.primaryButtonColor}; transition: all 0.3s ease;">
                                ${d.primaryButtonText}
                            </a>
                            <a href="${d.secondaryButtonLink}" 
                               style="padding: 16px 32px; background: ${d.secondaryButtonColor}; color: ${d.secondaryButtonTextColor}; 
                                      border-radius: 8px; font-size: 18px; font-weight: 700; 
                                      text-decoration: none; display: inline-block; margin: 0 10px; 
                                      border: 3px solid ${d.secondaryButtonColor}; transition: all 0.3s ease;">
                                ${d.secondaryButtonText}
                            </a>
                        </div>
                        
                        <!-- Section Avantages -->
                        <div class="advantages-container" style="max-width: 1000px; margin: 0 auto; display: grid; grid-template-columns: repeat(${columnsCount}, 1fr); gap: 20px; align-items: start;">
                            ${advantagesHtml}
                        </div>
                        
                    </div>
                `;
            }

            getEditableFields() {
                return [
                    // 1. Titre principal
                    { name: 'mainTitle', label: 'Titre principal', type: 'text', category: 'Titre Principal' },
                    { name: 'mainTitleSize', label: 'Taille du titre', type: 'range', min: 20, max: 72, category: 'Titre Principal' },
                    { name: 'mainTitleColor', label: 'Couleur du titre', type: 'color', category: 'Titre Principal' },
                    { name: 'mainTitleAlignment', label: 'Alignement', type: 'select', options: [
                        { value: 'left', label: 'Gauche' }, { value: 'center', label: 'Centre' }, { value: 'right', label: 'Droite' }
                    ], category: 'Titre Principal' },
                    { name: 'mainTitleIsBold', label: 'Gras', type: 'checkbox', category: 'Titre Principal' },
                    { name: 'mainTitleIsItalic', label: 'Italique', type: 'checkbox', category: 'Titre Principal' },
                    
                    // Style titre principal
                    { name: 'mainTitleHasBackground', label: 'Arri√®re-plan', type: 'checkbox', category: 'Titre - Style' },
                    { name: 'mainTitleBackgroundColor', label: 'Couleur fond', type: 'color', category: 'Titre - Style', condition: { field: 'mainTitleHasBackground', value: true } },
                    { name: 'mainTitleBackgroundOpacity', label: 'Opacit√© fond (%)', type: 'range', min: 0, max: 100, category: 'Titre - Style', condition: { field: 'mainTitleHasBackground', value: true } },
                    { name: 'mainTitleHasBorder', label: 'Contour', type: 'checkbox', category: 'Titre - Style' },
                    { name: 'mainTitleBorderColor', label: 'Couleur contour', type: 'color', category: 'Titre - Style', condition: { field: 'mainTitleHasBorder', value: true } },
                    { name: 'mainTitleBorderWidth', label: '√âpaisseur contour', type: 'range', min: 1, max: 10, category: 'Titre - Style', condition: { field: 'mainTitleHasBorder', value: true } },
                    { name: 'mainTitlePaddingTop', label: 'Espacement haut', type: 'select', options: [
                        { value: 'none', label: 'Aucun' }, { value: 'small', label: 'Petit' }, { value: 'medium', label: 'Moyen' }, { value: 'large', label: 'Grand' }
                    ], category: 'Titre - Espacement' },
                    { name: 'mainTitlePaddingBottom', label: 'Espacement bas', type: 'select', options: [
                        { value: 'none', label: 'Aucun' }, { value: 'small', label: 'Petit' }, { value: 'medium', label: 'Moyen' }, { value: 'large', label: 'Grand' }
                    ], category: 'Titre - Espacement' },
                    { name: 'mainTitleMarginBottom', label: 'Marge du bas', type: 'select', options: [
                        { value: 'none', label: 'Aucune' }, { value: 'small', label: 'Petite' }, { value: 'medium', label: 'Moyenne' }, { value: 'large', label: 'Grande' }
                    ], category: 'Titre - Espacement' },
                    
                    // 2. Sous-titre
                    { name: 'subtitle', label: 'Sous-titre', type: 'text', category: 'Sous-titre' },
                    { name: 'subtitleSize', label: 'Taille sous-titre', type: 'range', min: 14, max: 48, category: 'Sous-titre' },
                    { name: 'subtitleColor', label: 'Couleur sous-titre', type: 'color', category: 'Sous-titre' },
                    { name: 'subtitleAlignment', label: 'Alignement', type: 'select', options: [
                        { value: 'left', label: 'Gauche' }, { value: 'center', label: 'Centre' }, { value: 'right', label: 'Droite' }
                    ], category: 'Sous-titre' },
                    { name: 'subtitleIsBold', label: 'Gras', type: 'checkbox', category: 'Sous-titre' },
                    { name: 'subtitleIsItalic', label: 'Italique', type: 'checkbox', category: 'Sous-titre' },
                    { name: 'subtitleMarginBottom', label: 'Marge du bas', type: 'select', options: [
                        { value: 'none', label: 'Aucune' }, { value: 'small', label: 'Petite' }, { value: 'medium', label: 'Moyenne' }, { value: 'large', label: 'Grande' }
                    ], category: 'Sous-titre' },
                    
                    // 3. Section Contact (T√©l√©phone)
                    { name: 'phoneIcon', label: 'Ic√¥ne t√©l√©phone', type: 'text', category: 'Contact - T√©l√©phone' },
                    { name: 'phoneTitle', label: 'Titre section', type: 'text', category: 'Contact - T√©l√©phone' },
                    { name: 'phoneNumber', label: 'Num√©ro t√©l√©phone', type: 'text', category: 'Contact - T√©l√©phone' },
                    { name: 'phoneSubtitle', label: 'Sous-titre', type: 'text', category: 'Contact - T√©l√©phone' },
                    { name: 'phoneTitleSize', label: 'Taille titre', type: 'range', min: 14, max: 32, category: 'Contact - T√©l√©phone' },
                    { name: 'phoneTitleColor', label: 'Couleur titre', type: 'color', category: 'Contact - T√©l√©phone' },
                    { name: 'phoneNumberSize', label: 'Taille num√©ro', type: 'range', min: 16, max: 40, category: 'Contact - T√©l√©phone' },
                    { name: 'phoneNumberColor', label: 'Couleur num√©ro', type: 'color', category: 'Contact - T√©l√©phone' },
                    { name: 'phoneSubtitleSize', label: 'Taille sous-titre', type: 'range', min: 12, max: 24, category: 'Contact - T√©l√©phone' },
                    { name: 'phoneSubtitleColor', label: 'Couleur sous-titre', type: 'color', category: 'Contact - T√©l√©phone' },
                    
                    // 4. Section Email
                    { name: 'emailIcon', label: 'Ic√¥ne email', type: 'text', category: 'Contact - Email' },
                    { name: 'emailTitle', label: 'Titre section', type: 'text', category: 'Contact - Email' },
                    { name: 'emailAddress', label: 'Adresse email', type: 'text', category: 'Contact - Email' },
                    { name: 'emailSubtitle', label: 'Sous-titre', type: 'text', category: 'Contact - Email' },
                    { name: 'emailTitleSize', label: 'Taille titre', type: 'range', min: 14, max: 32, category: 'Contact - Email' },
                    { name: 'emailTitleColor', label: 'Couleur titre', type: 'color', category: 'Contact - Email' },
                    { name: 'emailAddressSize', label: 'Taille email', type: 'range', min: 16, max: 32, category: 'Contact - Email' },
                    { name: 'emailAddressColor', label: 'Couleur email', type: 'color', category: 'Contact - Email' },
                    { name: 'emailSubtitleSize', label: 'Taille sous-titre', type: 'range', min: 12, max: 24, category: 'Contact - Email' },
                    { name: 'emailSubtitleColor', label: 'Couleur sous-titre', type: 'color', category: 'Contact - Email' },
                    
                    // 5. Section D√©lai
                    { name: 'deliveryIcon', label: 'Ic√¥ne d√©lai', type: 'text', category: 'Contact - D√©lai' },
                    { name: 'deliveryTitle', label: 'Titre section', type: 'text', category: 'Contact - D√©lai' },
                    { name: 'deliveryTime', label: 'Temps d√©lai', type: 'text', category: 'Contact - D√©lai' },
                    { name: 'deliverySubtitle', label: 'Sous-titre', type: 'text', category: 'Contact - D√©lai' },
                    { name: 'deliveryTitleSize', label: 'Taille titre', type: 'range', min: 14, max: 32, category: 'Contact - D√©lai' },
                    { name: 'deliveryTitleColor', label: 'Couleur titre', type: 'color', category: 'Contact - D√©lai' },
                    { name: 'deliveryTimeSize', label: 'Taille d√©lai', type: 'range', min: 20, max: 48, category: 'Contact - D√©lai' },
                    { name: 'deliveryTimeColor', label: 'Couleur d√©lai', type: 'color', category: 'Contact - D√©lai' },
                    { name: 'deliverySubtitleSize', label: 'Taille sous-titre', type: 'range', min: 12, max: 24, category: 'Contact - D√©lai' },
                    { name: 'deliverySubtitleColor', label: 'Couleur sous-titre', type: 'color', category: 'Contact - D√©lai' },
                    
                    // 6. Boutons d'action
                    { name: 'primaryButtonText', label: 'Texte bouton principal', type: 'text', category: 'Boutons' },
                    { name: 'primaryButtonLink', label: 'Lien bouton principal', type: 'text', category: 'Boutons' },
                    { name: 'primaryButtonColor', label: 'Couleur bouton principal', type: 'color', category: 'Boutons' },
                    { name: 'primaryButtonTextColor', label: 'Couleur texte principal', type: 'color', category: 'Boutons' },
                    { name: 'secondaryButtonText', label: 'Texte bouton secondaire', type: 'text', category: 'Boutons' },
                    { name: 'secondaryButtonLink', label: 'Lien bouton secondaire', type: 'text', category: 'Boutons' },
                    { name: 'secondaryButtonColor', label: 'Couleur bouton secondaire', type: 'color', category: 'Boutons' },
                    { name: 'secondaryButtonTextColor', label: 'Couleur texte secondaire', type: 'color', category: 'Boutons' },
                    
                    // 7. Avantages - Mise en page
                    { name: 'advantagesColumns', label: 'Nombre de colonnes', type: 'range', min: 1, max: 4, category: 'Avantages - Affichage' },
                    
                    // 8. Style g√©n√©ral
                    { name: 'backgroundColor', label: 'Couleur de fond', type: 'color', category: 'Style G√©n√©ral' },
                    { name: 'containerPadding', label: 'Espacement conteneur', type: 'range', min: 20, max: 120, category: 'Style G√©n√©ral' },
                    { name: 'borderRadius', label: 'Coins arrondis', type: 'range', min: 0, max: 32, category: 'Style G√©n√©ral' },
                    { name: 'hasShadow', label: 'Ombre', type: 'checkbox', category: 'Style G√©n√©ral' },
                    { name: 'shadowColor', label: 'Couleur ombre', type: 'color', category: 'Style G√©n√©ral', condition: { field: 'hasShadow', value: true } },
                    { name: 'shadowOpacity', label: 'Opacit√© ombre (%)', type: 'range', min: 0, max: 100, category: 'Style G√©n√©ral', condition: { field: 'hasShadow', value: true } }
                ];
            }

            // M√©thodes pour gestion dynamique des avantages (inspir√©es du PricingCard et TarifLocation)
            addAdvantage(newAdvantage) {
                console.log('üöÄ addAdvantage called with:', newAdvantage);
                if (!newAdvantage || newAdvantage.trim() === '') return;
                this.defaultData.advantages.push({
                    text: newAdvantage.trim(),
                    emoji: '‚úÖ',
                    color: '#10b981'
                });
                console.log('‚úÖ Added advantage:', newAdvantage.trim());
                console.log('üîç Current advantages:', this.defaultData.advantages);
            }
            
            removeAdvantage(index) {
                console.log('üóëÔ∏è removeAdvantage called with index:', index);
                if (index < 0 || index >= this.defaultData.advantages.length) return;
                const removed = this.defaultData.advantages.splice(index, 1);
                console.log('‚úÖ Removed advantage:', removed[0]);
                console.log('üîç Remaining advantages:', this.defaultData.advantages);
            }
            
            updateAdvantageText(index, newText) {
                console.log('üìù updateAdvantageText called:', index, newText);
                if (index < 0 || index >= this.defaultData.advantages.length) return;
                if (!newText || newText.trim() === '') return;
                this.defaultData.advantages[index].text = newText.trim();
                console.log('‚úÖ Updated advantage text:', this.defaultData.advantages[index]);
            }
            
            updateAdvantageEmoji(index, newEmoji) {
                console.log('üòä updateAdvantageEmoji called:', index, newEmoji);
                if (index < 0 || index >= this.defaultData.advantages.length) return;
                if (!newEmoji || newEmoji.trim() === '') return;
                this.defaultData.advantages[index].emoji = newEmoji.trim();
                console.log('‚úÖ Updated advantage emoji:', this.defaultData.advantages[index]);
            }
            
            updateAdvantageColor(index, newColor) {
                console.log('üé® updateAdvantageColor called:', index, newColor);
                if (index < 0 || index >= this.defaultData.advantages.length) return;
                if (!newColor || newColor.trim() === '') return;
                this.defaultData.advantages[index].color = newColor.trim();
                console.log('‚úÖ Updated advantage color:', this.defaultData.advantages[index]);
            }

            getElements() {
                return [
                    { id: 'main-section', name: 'Section principale', editable: true },
                    { id: 'main-title', name: 'Titre principal', editable: true },
                    { id: 'subtitle', name: 'Sous-titre', editable: true },
                    { id: 'contact-sections', name: 'Sections de contact', editable: true },
                    { id: 'buttons', name: 'Boutons d\'action', editable: true },
                    { id: 'advantages', name: 'Liste des avantages', editable: true }
                ];
            }
        }

        class ImageAnimatedWidget {
            constructor() {
                this.id = 'image-animated';
                this.name = 'Image Anim√©e';
                this.category = 'M√©dias';
                this.icon = 'üé¨';
                this.description = 'Image avec animations flottantes et effets visuels avanc√©s';
                
                this.defaultData = {
                    // Configuration widget
                    defaultWidth: 6,
                    
                    // Propri√©t√©s de l'image
                    imagePath: './images/Li-CUBE PRO.png',
                    altText: 'Image anim√©e',
                    
                    // Dimensions
                    width: 500,
                    height: 400,
                    
                    // Animations
                    floatAnimation: true,
                    floatDuration: 6,
                    floatDistance: 20,
                    shineAnimation: true,
                    shineDuration: 4,
                    
                    // Style du conteneur
                    borderRadius: 24,
                    border: true,
                    borderWidth: 3,
                    borderColor: '#10b981',
                    borderOpacity: 30,
                    
                    // Arri√®re-plan
                    backgroundType: 'gradient', // solid, gradient, transparent
                    backgroundColor: '#10b981',
                    gradientStart: '#10b981',
                    gradientEnd: '#065f46',
                    gradientDirection: 'to bottom',
                    backgroundOpacity: 100,
                    
                    // Ombre
                    shadowEnabled: true,
                    shadowColor: '#000000',
                    shadowOpacity: 50,
                    shadowBlur: 15,
                    shadowOffsetX: 0,
                    shadowOffsetY: 10,
                    
                    // Image
                    imageSize: 100, // pourcentage de la taille du conteneur
                    imageFit: 'contain', // contain, cover, fill
                    imagePosition: 'center',
                    
                    // Positioning
                    containerAlignment: 'center',
                    containerPaddingTop: 20,
                    containerPaddingBottom: 20,
                    containerPaddingLeft: 20,
                    containerPaddingRight: 20
                };
            }

            render(data = {}) {
                const d = { ...this.defaultData, ...data };
                
                // G√©n√©rer les styles d'arri√®re-plan
                let backgroundStyle;
                if (d.backgroundType === 'transparent') {
                    backgroundStyle = 'transparent';
                } else if (d.backgroundType === 'gradient') {
                    backgroundStyle = `linear-gradient(${d.gradientDirection}, ${d.gradientStart}, ${d.gradientEnd})`;
                } else {
                    const opacity = (d.backgroundOpacity || 100) / 100;
                    const hex = d.backgroundColor.replace('#', '');
                    const r = parseInt(hex.substr(0, 2), 16);
                    const g = parseInt(hex.substr(2, 2), 16);
                    const b = parseInt(hex.substr(4, 2), 16);
                    backgroundStyle = `rgba(${r}, ${g}, ${b}, ${opacity})`;
                }
                
                // G√©n√©rer les styles de bordure
                let borderStyle = 'none';
                if (d.border) {
                    const borderOpacity = (d.borderOpacity || 30) / 100;
                    const hex = d.borderColor.replace('#', '');
                    const r = parseInt(hex.substr(0, 2), 16);
                    const g = parseInt(hex.substr(2, 2), 16);
                    const b = parseInt(hex.substr(4, 2), 16);
                    borderStyle = `${d.borderWidth}px solid rgba(${r}, ${g}, ${b}, ${borderOpacity})`;
                }
                
                // G√©n√©rer les styles d'ombre
                let boxShadowStyle = 'none';
                if (d.shadowEnabled) {
                    const shadowOpacity = (d.shadowOpacity || 50) / 100;
                    const hex = d.shadowColor.replace('#', '');
                    const r = parseInt(hex.substr(0, 2), 16);
                    const g = parseInt(hex.substr(2, 2), 16);
                    const b = parseInt(hex.substr(4, 2), 16);
                    boxShadowStyle = `${d.shadowOffsetX}px ${d.shadowOffsetY}px ${d.shadowBlur}px rgba(${r}, ${g}, ${b}, ${shadowOpacity})`;
                }
                
                // G√©n√©rer les animations CSS
                const floatAnimation = d.floatAnimation ? `
                    @keyframes image-float-${Date.now()} {
                        0%, 100% { transform: translateY(0px); }
                        50% { transform: translateY(-${d.floatDistance}px); }
                    }
                ` : '';
                
                const shineAnimation = d.shineAnimation ? `
                    @keyframes image-shine-${Date.now()} {
                        0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
                        100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
                    }
                ` : '';
                
                const animationStyle = d.floatAnimation ? `animation: image-float-${Date.now()} ${d.floatDuration}s ease-in-out infinite;` : '';
                const shineAnimationStyle = d.shineAnimation ? `animation: image-shine-${Date.now()} ${d.shineDuration}s infinite;` : '';
                
                return `
                    <style>
                        ${floatAnimation}
                        ${shineAnimation}
                    </style>
                    <div style="text-align: ${d.containerAlignment}; padding: ${d.containerPaddingTop}px ${d.containerPaddingRight}px ${d.containerPaddingBottom}px ${d.containerPaddingLeft}px;">
                        <div class="image-animated-showcase" 
                             style="width: ${d.width}px; 
                                    height: ${d.height}px; 
                                    background: ${backgroundStyle};
                                    border-radius: ${d.borderRadius}px; 
                                    position: relative; 
                                    overflow: hidden;
                                    box-shadow: ${boxShadowStyle};
                                    ${animationStyle}
                                    background-image: url('${d.imagePath}');
                                    background-size: ${d.imageSize}%;
                                    background-repeat: no-repeat; 
                                    background-position: ${d.imagePosition};
                                    object-fit: ${d.imageFit};
                                    border: ${borderStyle};
                                    display: inline-block;">
                            ${d.shineAnimation ? `
                                <div style="content: ''; 
                                           position: absolute; 
                                           top: -50%; 
                                           left: -50%;
                                           width: 200%; 
                                           height: 200%;
                                           background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
                                           ${shineAnimationStyle}
                                           pointer-events: none;"></div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            getEditableFields() {
                return [
                    // Image
                    { name: 'imagePath', label: 'Chemin de l\'image', type: 'text', category: 'Image' },
                    { name: 'altText', label: 'Texte alternatif', type: 'text', category: 'Image' },
                    { name: 'imageSize', label: 'Taille image (%)', type: 'range', min: 20, max: 150, category: 'Image' },
                    { name: 'imageFit', label: 'Ajustement', type: 'select', options: [
                        { value: 'contain', label: 'Contenir (proportions)' },
                        { value: 'cover', label: 'Couvrir (remplir)' },
                        { value: 'fill', label: '√âtirer (d√©former)' }
                    ], category: 'Image' },
                    { name: 'imagePosition', label: 'Position', type: 'select', options: [
                        { value: 'center', label: 'Centre' },
                        { value: 'top', label: 'Haut' },
                        { value: 'bottom', label: 'Bas' },
                        { value: 'left', label: 'Gauche' },
                        { value: 'right', label: 'Droite' },
                        { value: 'top left', label: 'Haut-gauche' },
                        { value: 'top right', label: 'Haut-droite' },
                        { value: 'bottom left', label: 'Bas-gauche' },
                        { value: 'bottom right', label: 'Bas-droite' }
                    ], category: 'Image' },
                    
                    // Dimensions
                    { name: 'width', label: 'Largeur (px)', type: 'range', min: 200, max: 800, category: 'Dimensions' },
                    { name: 'height', label: 'Hauteur (px)', type: 'range', min: 150, max: 600, category: 'Dimensions' },
                    { name: 'borderRadius', label: 'Coins arrondis (px)', type: 'range', min: 0, max: 50, category: 'Dimensions' },
                    
                    // Animations
                    { name: 'floatAnimation', label: 'Animation flottante', type: 'checkbox', category: 'Animations' },
                    { name: 'floatDuration', label: 'Dur√©e flottement (s)', type: 'range', min: 2, max: 12, category: 'Animations', condition: { field: 'floatAnimation', value: true } },
                    { name: 'floatDistance', label: 'Distance flottement (px)', type: 'range', min: 5, max: 50, category: 'Animations', condition: { field: 'floatAnimation', value: true } },
                    { name: 'shineAnimation', label: 'Effet brillant', type: 'checkbox', category: 'Animations' },
                    { name: 'shineDuration', label: 'Dur√©e brillant (s)', type: 'range', min: 2, max: 8, category: 'Animations', condition: { field: 'shineAnimation', value: true } },
                    
                    // Bordure
                    { name: 'border', label: 'Bordure', type: 'checkbox', category: 'Bordure' },
                    { name: 'borderWidth', label: '√âpaisseur (px)', type: 'range', min: 1, max: 10, category: 'Bordure', condition: { field: 'border', value: true } },
                    { name: 'borderColor', label: 'Couleur bordure', type: 'color', category: 'Bordure', condition: { field: 'border', value: true } },
                    { name: 'borderOpacity', label: 'Opacit√© bordure (%)', type: 'range', min: 0, max: 100, category: 'Bordure', condition: { field: 'border', value: true } },
                    
                    // Arri√®re-plan
                    { name: 'backgroundType', label: 'Type arri√®re-plan', type: 'select', options: [
                        { value: 'solid', label: 'Couleur unie' },
                        { value: 'gradient', label: 'D√©grad√©' },
                        { value: 'transparent', label: 'Transparent' }
                    ], category: 'Arri√®re-plan' },
                    { name: 'backgroundColor', label: 'Couleur de base', type: 'color', category: 'Arri√®re-plan', condition: { field: 'backgroundType', value: 'solid' } },
                    { name: 'gradientStart', label: 'Couleur d√©but', type: 'color', category: 'Arri√®re-plan', condition: { field: 'backgroundType', value: 'gradient' } },
                    { name: 'gradientEnd', label: 'Couleur fin', type: 'color', category: 'Arri√®re-plan', condition: { field: 'backgroundType', value: 'gradient' } },
                    { name: 'gradientDirection', label: 'Direction', type: 'select', options: [
                        { value: 'to bottom', label: 'Vers le bas' },
                        { value: 'to top', label: 'Vers le haut' },
                        { value: 'to right', label: 'Vers la droite' },
                        { value: 'to left', label: 'Vers la gauche' },
                        { value: '45deg', label: 'Diagonal (45¬∞)' },
                        { value: '135deg', label: 'Diagonal (135¬∞)' }
                    ], category: 'Arri√®re-plan', condition: { field: 'backgroundType', value: 'gradient' } },
                    { name: 'backgroundOpacity', label: 'Opacit√© (%)', type: 'range', min: 0, max: 100, category: 'Arri√®re-plan' },
                    
                    // Ombre
                    { name: 'shadowEnabled', label: 'Ombre', type: 'checkbox', category: 'Ombre' },
                    { name: 'shadowColor', label: 'Couleur ombre', type: 'color', category: 'Ombre', condition: { field: 'shadowEnabled', value: true } },
                    { name: 'shadowOpacity', label: 'Opacit√© ombre (%)', type: 'range', min: 0, max: 100, category: 'Ombre', condition: { field: 'shadowEnabled', value: true } },
                    { name: 'shadowBlur', label: 'Flou (px)', type: 'range', min: 0, max: 30, category: 'Ombre', condition: { field: 'shadowEnabled', value: true } },
                    { name: 'shadowOffsetX', label: 'D√©calage X (px)', type: 'range', min: -20, max: 20, category: 'Ombre', condition: { field: 'shadowEnabled', value: true } },
                    { name: 'shadowOffsetY', label: 'D√©calage Y (px)', type: 'range', min: -20, max: 20, category: 'Ombre', condition: { field: 'shadowEnabled', value: true } },
                    
                    // Position
                    { name: 'containerAlignment', label: 'Alignement', type: 'select', options: [
                        { value: 'left', label: 'Gauche' },
                        { value: 'center', label: 'Centre' },
                        { value: 'right', label: 'Droite' }
                    ], category: 'Position' },
                    { name: 'containerPaddingTop', label: 'Espacement haut (px)', type: 'range', min: 0, max: 100, category: 'Position' },
                    { name: 'containerPaddingBottom', label: 'Espacement bas (px)', type: 'range', min: 0, max: 100, category: 'Position' },
                    { name: 'containerPaddingLeft', label: 'Espacement gauche (px)', type: 'range', min: 0, max: 100, category: 'Position' },
                    { name: 'containerPaddingRight', label: 'Espacement droite (px)', type: 'range', min: 0, max: 100, category: 'Position' }
                ];
            }

            getElements() {
                return [
                    { id: 'image-container', name: 'Conteneur image', editable: true },
                    { id: 'animated-image', name: 'Image anim√©e', editable: true },
                    { id: 'shine-effect', name: 'Effet brillant', editable: true }
                ];
            }

            validate(data) {
                const errors = [];
                if (!data.imagePath || data.imagePath.trim() === '') {
                    errors.push('Le chemin de l\'image ne peut pas √™tre vide');
                }
                if (data.width < 100) errors.push('La largeur doit √™tre d\'au moins 100px');
                if (data.height < 75) errors.push('La hauteur doit √™tre d\'au moins 75px');
                return { isValid: errors.length === 0, errors: errors };
            }
        }

        class ComparisonWidget {
            constructor() {
                this.id = 'comparison';
                this.name = 'Comparaison Produits';
                this.category = 'Commerce';
                this.icon = '‚öñÔ∏è';
                this.description = 'Comparaison entre produit obsol√®te et moderne';
                
                this.defaultData = {
                    title: 'Li-CUBE PRO‚Ñ¢ vs BATTERIES Ni-Cd OBSOL√àTES',
                    // Propri√©t√©s avanc√©es du titre principal (inspir√©es du TextSimple)
                    titleSize: 32,
                    titleColor: '#ffffff',
                    titleAlignment: 'center',
                    titleIsBold: true,
                    titleIsItalic: false,
                    titleHasBackground: false,
                    titleBackgroundColor: '#10b981',
                    titleBackgroundOpacity: 20,
                    titleHasBorder: false,
                    titleBorderColor: '#10b981',
                    titleBorderWidth: 2,
                    titleBorderStyle: 'solid',
                    titleHasRoundedCorners: false,
                    titleBorderRadius: 8,
                    titlePaddingTop: 'small',
                    titlePaddingBottom: 'large',
                    titlePaddingLeft: 'medium',
                    titlePaddingRight: 'medium',
                    titleMarginBottom: 'large',
                    
                    subtitle: 'Pourquoi payer plus cher pour une technologie obsol√®te ? Li-CUBE PRO‚Ñ¢ √©crase la concurrence sur tous les crit√®res techniques.',
                    
                    // Colonne Obsol√®te - SIMPLIFI√â COMME PRICING CARD
                    obsoleteTitle: 'Batteries Ni-Cd (Obsol√®tes)',
                    obsoleteTitleColor: '#ef4444',
                    obsoleteBackgroundColor: '#1f1f1f',
                    obsoleteBorderColor: '#ef4444',
                    obsoleteIcon: '‚ùå',
                    obsoleteDisadvantages: [
                        { text: 'Cadmium Hautement Toxique', emoji: '‚ò†Ô∏è', color: '#ff6b6b' },
                        { text: 'Maintenance Obligatoire Co√ªteuse', emoji: 'üîß', color: '#ff8c42' },
                        { text: 'Dur√©e de Vie Limit√©e', emoji: '‚è≥', color: '#ffd93d' },
                        { text: 'Poids et Encombrement', emoji: 'üèãÔ∏è', color: '#ff6b6b' },
                        { text: 'Charge Lente 8-12h', emoji: 'üêå', color: '#ff8c42' },
                        { text: 'Aucune Connectivit√©', emoji: 'üìµ', color: '#ff6b6b' },
                        { text: 'R√©glementation Transport Stricte', emoji: '‚öñÔ∏è', color: '#ffd93d' }
                    ],
                    
                    // Colonne Moderne - SIMPLIFI√â COMME PRICING CARD
                    modernTitle: 'Li-CUBE PRO‚Ñ¢ (Technologie Moderne)',
                    modernTitleColor: '#10b981',
                    modernBackgroundColor: '#0f1419',
                    modernBorderColor: '#10b981',
                    modernIcon: '‚úÖ',
                    modernAdvantages: [
                        { text: 'Dur√©e Vie Exceptionnelle', emoji: 'üîã', color: '#4ecdc4' },
                        { text: 'Z√©ro Maintenance', emoji: 'üõ°Ô∏è', color: '#45b7d1' },
                        { text: 'Surveillance Temps R√©el', emoji: 'üì°', color: '#96ceb4' },
                        { text: 'Performance √ânerg√©tique', emoji: '‚ö°', color: '#ffeaa7' },
                        { text: 'Climat Canadien', emoji: 'üå°Ô∏è', color: '#74b9ff' },
                        { text: '100% √âcologique', emoji: 'üçÉ', color: '#00b894' },
                        { text: 'S√©curit√© BMS Multi-niveau', emoji: 'üõ°Ô∏è', color: '#6c5ce7' }
                    ],
                    
                    // Section VS (S√©parateur central) - Inspir√©e du TextSimple
                    vsText: 'VS',
                    vsSize: 20,
                    vsColor: '#ffffff',
                    vsAlignment: 'center',
                    vsIsBold: true,
                    vsIsItalic: false,
                    vsHasBackground: true,
                    vsBackgroundColor: '#10b981',
                    vsBackgroundOpacity: 100,
                    vsBackgroundGradient: true,
                    vsGradientStart: '#ef4444',
                    vsGradientEnd: '#10b981',
                    vsGradientDirection: '135deg',
                    vsHasBorder: false,
                    vsBorderColor: '#ffffff',
                    vsBorderWidth: 2,
                    vsBorderStyle: 'solid',
                    vsHasRoundedCorners: true,
                    vsBorderRadius: 12,
                    vsPaddingTop: 12,
                    vsPaddingBottom: 12,
                    vsPaddingLeft: 8,
                    vsPaddingRight: 8,
                    vsHasShadow: true,
                    vsShadowColor: '#000000',
                    vsShadowOpacity: 30,
                    vsShadowOffsetX: 0,
                    vsShadowOffsetY: 4,
                    vsShadowBlur: 12,
                    
                    conclusion: 'Li-CUBE PRO‚Ñ¢ LOCATION = 25% PLUS √âCONOMIQUE !',
                    conclusionDetails: 'Location Li-CUBE PRO‚Ñ¢ 150-200$/mois vs Ni-Cd 250$/mois + maintenance = minimum 25% d\'√©conomies + performance sup√©rieure + z√©ro risque technique. Le choix rationnel est √©vident : Li-CUBE PRO‚Ñ¢ domine sur TOUS les crit√®res √©conomiques, techniques et environnementaux.'
                };
            }

            // M√©thodes pour gestion dynamique - COPI√âES EXACTEMENT DE PRICING CARD
            addObsoleteDisadvantage(newDisadvantage) {
                console.log('üöÄ addObsoleteDisadvantage called with:', newDisadvantage);
                if (!newDisadvantage || newDisadvantage.trim() === '') return;
                this.defaultData.obsoleteDisadvantages.push(newDisadvantage.trim());
                console.log('‚úÖ Added disadvantage:', newDisadvantage.trim());
                console.log('üîç Current disadvantages:', this.defaultData.obsoleteDisadvantages);
            }
            
            removeObsoleteDisadvantage(index) {
                console.log('üóëÔ∏è removeObsoleteDisadvantage called with index:', index);
                if (index >= 0 && index < this.defaultData.obsoleteDisadvantages.length) {
                    const removed = this.defaultData.obsoleteDisadvantages[index];
                    this.defaultData.obsoleteDisadvantages.splice(index, 1);
                    console.log('‚úÖ Removed disadvantage:', removed);
                    console.log('üîç Remaining disadvantages:', this.defaultData.obsoleteDisadvantages);
                }
            }
            
            updateObsoleteDisadvantage(index, newText) {
                console.log('‚úèÔ∏è updateObsoleteDisadvantage called with:', index, newText);
                if (index >= 0 && index < this.defaultData.obsoleteDisadvantages.length) {
                    this.defaultData.obsoleteDisadvantages[index] = newText.trim();
                    console.log('‚úÖ Updated disadvantage at index', index, ':', newText.trim());
                }
            }

            addModernAdvantage(newAdvantage) {
                console.log('üöÄ addModernAdvantage called with:', newAdvantage);
                if (!newAdvantage || newAdvantage.trim() === '') return;
                this.defaultData.modernAdvantages.push(newAdvantage.trim());
                console.log('‚úÖ Added advantage:', newAdvantage.trim());
                console.log('üîç Current advantages:', this.defaultData.modernAdvantages);
            }
            
            removeModernAdvantage(index) {
                console.log('üóëÔ∏è removeModernAdvantage called with index:', index);
                if (index >= 0 && index < this.defaultData.modernAdvantages.length) {
                    const removed = this.defaultData.modernAdvantages[index];
                    this.defaultData.modernAdvantages.splice(index, 1);
                    console.log('‚úÖ Removed advantage:', removed);
                    console.log('üîç Remaining advantages:', this.defaultData.modernAdvantages);
                }
            }
            
            updateModernAdvantage(index, newText) {
                console.log('‚úèÔ∏è updateModernAdvantage called with:', index, newText);
                if (index >= 0 && index < this.defaultData.modernAdvantages.length) {
                    this.defaultData.modernAdvantages[index] = newText.trim();
                    console.log('‚úÖ Updated advantage at index', index, ':', newText.trim());
                }
            }

            // Helper pour convertir les valeurs d'espacement en pixels
            getSpacingValue(spacingType) {
                const spacingMap = {
                    'none': '0px',
                    'small': '8px',
                    'medium': '16px',
                    'large': '32px'
                };
                return spacingMap[spacingType] || '16px';
            }

            // G√©n√®re les styles CSS pour la section VS
            generateVSStyles(data) {
                const styleRules = [];
                
                // Style de base
                styleRules.push('text-align: ' + (data.vsAlignment || 'center'));
                styleRules.push('font-size: ' + (data.vsSize || 20) + 'px');
                styleRules.push('color: ' + (data.vsColor || '#ffffff'));
                styleRules.push('font-weight: ' + (data.vsIsBold ? 'bold' : 'normal'));
                styleRules.push('font-style: ' + (data.vsIsItalic ? 'italic' : 'normal'));
                styleRules.push('line-height: 1.2');
                
                // Arri√®re-plan
                if (data.vsHasBackground) {
                    if (data.vsBackgroundGradient) {
                        // Gradient lin√©aire
                        const gradientStart = data.vsGradientStart || '#ef4444';
                        const gradientEnd = data.vsGradientEnd || '#10b981';
                        const direction = data.vsGradientDirection || '135deg';
                        styleRules.push(`background: linear-gradient(${direction}, ${gradientStart}, ${gradientEnd})`);
                    } else {
                        // Couleur unie avec opacit√©
                        const opacity = (data.vsBackgroundOpacity || 100) / 100;
                        const bgColor = data.vsBackgroundColor || '#10b981';
                        // Convertir hex en rgba
                        const hex = bgColor.replace('#', '');
                        const r = parseInt(hex.substr(0, 2), 16);
                        const g = parseInt(hex.substr(2, 2), 16);
                        const b = parseInt(hex.substr(4, 2), 16);
                        styleRules.push(`background-color: rgba(${r}, ${g}, ${b}, ${opacity})`);
                    }
                }
                
                // Contour
                if (data.vsHasBorder) {
                    const borderWidth = data.vsBorderWidth || 2;
                    const borderStyle = data.vsBorderStyle || 'solid';
                    const borderColor = data.vsBorderColor || '#ffffff';
                    styleRules.push(`border: ${borderWidth}px ${borderStyle} ${borderColor}`);
                }
                
                // Coins arrondis
                if (data.vsHasRoundedCorners) {
                    const borderRadius = data.vsBorderRadius || 12;
                    styleRules.push(`border-radius: ${borderRadius}px`);
                }
                
                // Espacement interne (padding)
                const paddingTop = data.vsPaddingTop || 12;
                const paddingBottom = data.vsPaddingBottom || 12;
                const paddingLeft = data.vsPaddingLeft || 8;
                const paddingRight = data.vsPaddingRight || 8;
                styleRules.push(`padding: ${paddingTop}px ${paddingRight}px ${paddingBottom}px ${paddingLeft}px`);
                
                // Ombre
                if (data.vsHasShadow) {
                    const shadowColor = data.vsShadowColor || '#000000';
                    const shadowOpacity = (data.vsShadowOpacity || 30) / 100;
                    const offsetX = data.vsShadowOffsetX || 0;
                    const offsetY = data.vsShadowOffsetY || 4;
                    const blur = data.vsShadowBlur || 12;
                    
                    // Convertir couleur hex en rgba
                    const hex = shadowColor.replace('#', '');
                    const r = parseInt(hex.substr(0, 2), 16);
                    const g = parseInt(hex.substr(2, 2), 16);
                    const b = parseInt(hex.substr(4, 2), 16);
                    
                    styleRules.push(`box-shadow: ${offsetX}px ${offsetY}px ${blur}px rgba(${r}, ${g}, ${b}, ${shadowOpacity})`);
                }
                
                return styleRules.join('; ');
            }

            // G√©n√®re les styles CSS pour le titre principal
            generateTitleStyles(data) {
                const styleRules = [];
                
                // Style de base
                styleRules.push('text-align: ' + (data.titleAlignment || 'center'));
                styleRules.push('font-size: ' + (data.titleSize || 32) + 'px');
                styleRules.push('color: ' + (data.titleColor || '#ffffff'));
                styleRules.push('font-weight: ' + (data.titleIsBold ? 'bold' : 'normal'));
                styleRules.push('font-style: ' + (data.titleIsItalic ? 'italic' : 'normal'));
                styleRules.push('line-height: 1.2');
                
                // Arri√®re-plan
                if (data.titleHasBackground) {
                    const opacity = (data.titleBackgroundOpacity || 20) / 100;
                    const bgColor = data.titleBackgroundColor || '#10b981';
                    // Convertir hex en rgba
                    const hex = bgColor.replace('#', '');
                    const r = parseInt(hex.substr(0, 2), 16);
                    const g = parseInt(hex.substr(2, 2), 16);
                    const b = parseInt(hex.substr(4, 2), 16);
                    styleRules.push(`background-color: rgba(${r}, ${g}, ${b}, ${opacity})`);
                }
                
                // Contour
                if (data.titleHasBorder) {
                    const borderWidth = data.titleBorderWidth || 2;
                    const borderStyle = data.titleBorderStyle || 'solid';
                    const borderColor = data.titleBorderColor || '#10b981';
                    styleRules.push(`border: ${borderWidth}px ${borderStyle} ${borderColor}`);
                }
                
                // Coins arrondis
                if (data.titleHasRoundedCorners) {
                    const borderRadius = data.titleBorderRadius || 8;
                    styleRules.push(`border-radius: ${borderRadius}px`);
                }
                
                // Espacement interne (padding)
                const paddingTop = this.getSpacingValue(data.titlePaddingTop || 'small');
                const paddingBottom = this.getSpacingValue(data.titlePaddingBottom || 'large');
                const paddingLeft = this.getSpacingValue(data.titlePaddingLeft || 'medium');
                const paddingRight = this.getSpacingValue(data.titlePaddingRight || 'medium');
                styleRules.push(`padding: ${paddingTop} ${paddingRight} ${paddingBottom} ${paddingLeft}`);
                
                // Marge du bas
                const marginBottom = this.getSpacingValue(data.titleMarginBottom || 'large');
                styleRules.push(`margin-bottom: ${marginBottom}`);
                
                return styleRules.join('; ');
            }

            render(data = {}) {
                const d = { ...this.defaultData, ...data };
                
                // G√©n√©rer les styles du titre et de la section VS
                const titleStyles = this.generateTitleStyles(d);
                const vsStyles = this.generateVSStyles(d);
                
                // Cr√©er les listes d'inconv√©nients (obsol√®te) - AVEC EMOJI ET COULEUR PERSONNALIS√âS
                const disadvantagesHtml = d.obsoleteDisadvantages.map((item, index) => {
                    // Support r√©trocompatibilit√© : si item est string, le convertir en objet
                    const itemData = typeof item === 'string' ? { text: item, emoji: d.obsoleteIcon, color: '#ffffff' } : item;
                    const displayEmoji = itemData.emoji && itemData.emoji.trim() !== '' ? itemData.emoji : d.obsoleteIcon;
                    const textColor = itemData.color || '#ffffff';
                    
                    return `
                        <div class="comparison-item obsolete-item" style="margin-bottom: 16px; padding: 12px; 
                                                                           background: rgba(239, 68, 68, 0.1); 
                                                                           border-left: 3px solid #ef4444; 
                                                                           border-radius: 6px; display: flex; align-items: center; gap: 12px;">
                            <div class="item-emoji" style="font-size: 1.4rem; min-width: 24px; text-align: center;">${displayEmoji}</div>
                            <div class="item-text" style="color: ${textColor}; font-size: 0.95rem; line-height: 1.4; flex: 1;">
                                ${itemData.text}
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Cr√©er les listes d'avantages (moderne) - AVEC EMOJI ET COULEUR PERSONNALIS√âS
                const advantagesHtml = d.modernAdvantages.map((item, index) => {
                    // Support r√©trocompatibilit√© : si item est string, le convertir en objet
                    const itemData = typeof item === 'string' ? { text: item, emoji: d.modernIcon, color: '#ffffff' } : item;
                    const displayEmoji = itemData.emoji && itemData.emoji.trim() !== '' ? itemData.emoji : d.modernIcon;
                    const textColor = itemData.color || '#ffffff';
                    
                    return `
                        <div class="comparison-item modern-item" style="margin-bottom: 16px; padding: 12px; 
                                                                        background: rgba(16, 185, 129, 0.1); 
                                                                        border-left: 3px solid #10b981; 
                                                                        border-radius: 6px; display: flex; align-items: center; gap: 12px;">
                            <div class="item-emoji" style="font-size: 1.4rem; min-width: 24px; text-align: center;">${displayEmoji}</div>
                            <div class="item-text" style="color: ${textColor}; font-size: 0.95rem; line-height: 1.4; flex: 1;">
                                ${itemData.text}
                            </div>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="comparison-widget" style="max-width: 1200px; margin: 0 auto; padding: 40px 20px;">
                        <!-- Titre principal -->
                        <h2 class="comparison-title" style="${titleStyles}">
                            ${d.title}
                        </h2>
                        
                        <!-- Sous-titre -->
                        <p style="text-align: center; font-size: 1.1rem; color: #9ca3af; margin-bottom: 40px; line-height: 1.6; max-width: 800px; margin-left: auto; margin-right: auto;">
                            ${d.subtitle}
                        </p>
                        
                        <!-- Grille de comparaison -->
                        <div style="display: grid; grid-template-columns: 1fr 40px 1fr; gap: 20px; margin-bottom: 40px;">
                            
                            <!-- Colonne Obsol√®te -->
                            <div class="obsolete-column" style="background: ${d.obsoleteBackgroundColor}; 
                                                                border: 2px solid ${d.obsoleteBorderColor}; 
                                                                border-radius: 16px; padding: 32px;">
                                <div style="text-align: center; margin-bottom: 32px;">
                                    <div style="font-size: 2rem; margin-bottom: 16px;">${d.obsoleteIcon}</div>
                                    <h3 style="color: ${d.obsoleteTitleColor}; font-size: 1.5rem; font-weight: bold; margin: 0;">
                                        ${d.obsoleteTitle}
                                    </h3>
                                </div>
                                <div class="disadvantages-list">
                                    ${disadvantagesHtml}
                                </div>
                            </div>
                            
                            <!-- S√©parateur VS - MAINTENANT √âDITABLE -->
                            <div style="display: flex; align-items: center; justify-content: center;">
                                <div class="vs-section" style="${vsStyles}">
                                    ${d.vsText}
                                </div>
                            </div>
                            
                            <!-- Colonne Moderne -->
                            <div class="modern-column" style="background: ${d.modernBackgroundColor}; 
                                                              border: 2px solid ${d.modernBorderColor}; 
                                                              border-radius: 16px; padding: 32px;">
                                <div style="text-align: center; margin-bottom: 32px;">
                                    <div style="font-size: 2rem; margin-bottom: 16px;">${d.modernIcon}</div>
                                    <h3 style="color: ${d.modernTitleColor}; font-size: 1.5rem; font-weight: bold; margin: 0;">
                                        ${d.modernTitle}
                                    </h3>
                                </div>
                                <div class="advantages-list">
                                    ${advantagesHtml}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Conclusion -->
                        <div style="text-align: center; padding: 32px; background: linear-gradient(135deg, #10b981, #0d9488); 
                                   border-radius: 16px; margin-top: 40px;">
                            <h3 style="color: white; font-size: 2rem; font-weight: bold; margin: 0 0 16px 0; text-transform: uppercase;">
                                ${d.conclusion}
                            </h3>
                            <p style="color: rgba(255,255,255,0.9); font-size: 1.1rem; line-height: 1.6; margin: 0; max-width: 900px; margin-left: auto; margin-right: auto;">
                                ${d.conclusionDetails}
                            </p>
                        </div>
                    </div>
                `;
            }

            getEditableFields() {
                return [
                    // Section 1: Contenu principal
                    { name: 'title', label: 'Titre principal', type: 'text', category: 'Contenu Principal' },
                    { name: 'subtitle', label: 'Sous-titre', type: 'textarea', category: 'Contenu Principal' },
                    { name: 'conclusion', label: 'Conclusion', type: 'text', category: 'Contenu Principal' },
                    { name: 'conclusionDetails', label: 'D√©tails conclusion', type: 'textarea', category: 'Contenu Principal' },
                    
                    // Section 2: Style du titre principal
                    { name: 'titleSize', label: 'Taille du titre', type: 'range', min: 20, max: 60, category: 'Titre - Typographie' },
                    { name: 'titleColor', label: 'Couleur du titre', type: 'color', category: 'Titre - Typographie' },
                    { name: 'titleAlignment', label: 'Alignement du titre', type: 'select', options: [
                        { value: 'left', label: 'Gauche' },
                        { value: 'center', label: 'Centre' },
                        { value: 'right', label: 'Droite' }
                    ], category: 'Titre - Typographie' },
                    { name: 'titleIsBold', label: 'Titre en gras', type: 'checkbox', category: 'Titre - Typographie' },
                    { name: 'titleIsItalic', label: 'Titre en italique', type: 'checkbox', category: 'Titre - Typographie' },
                    
                    // Section 3: Arri√®re-plan du titre
                    { name: 'titleHasBackground', label: 'Arri√®re-plan du titre', type: 'checkbox', category: 'Titre - Arri√®re-plan' },
                    { name: 'titleBackgroundColor', label: 'Couleur de fond du titre', type: 'color', category: 'Titre - Arri√®re-plan', condition: { field: 'titleHasBackground', value: true } },
                    { name: 'titleBackgroundOpacity', label: 'Transparence du fond', type: 'range', min: 0, max: 100, step: 5, category: 'Titre - Arri√®re-plan', condition: { field: 'titleHasBackground', value: true } },
                    
                    // Section 4: Contour du titre
                    { name: 'titleHasBorder', label: 'Contour du titre', type: 'checkbox', category: 'Titre - Contour' },
                    { name: 'titleBorderColor', label: 'Couleur du contour', type: 'color', category: 'Titre - Contour', condition: { field: 'titleHasBorder', value: true } },
                    { name: 'titleBorderWidth', label: '√âpaisseur du contour', type: 'range', min: 1, max: 10, step: 1, category: 'Titre - Contour', condition: { field: 'titleHasBorder', value: true } },
                    { name: 'titleBorderStyle', label: 'Style du contour', type: 'select', options: [
                        { value: 'solid', label: 'Solide' },
                        { value: 'dashed', label: 'Tirets' },
                        { value: 'dotted', label: 'Points' },
                        { value: 'double', label: 'Double' }
                    ], category: 'Titre - Contour', condition: { field: 'titleHasBorder', value: true } },
                    
                    // Section 5: Coins arrondis du titre
                    { name: 'titleHasRoundedCorners', label: 'Coins arrondis du titre', type: 'checkbox', category: 'Titre - Forme' },
                    { name: 'titleBorderRadius', label: 'Niveau d\'arrondi', type: 'range', min: 0, max: 50, step: 2, category: 'Titre - Forme', condition: { field: 'titleHasRoundedCorners', value: true } },
                    
                    // Section 6: Espacement du titre
                    { name: 'titlePaddingTop', label: 'Espacement haut du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucun' },
                        { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' },
                        { value: 'large', label: 'Grand' }
                    ], category: 'Titre - Espacement' },
                    { name: 'titlePaddingBottom', label: 'Espacement bas du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucun' },
                        { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' },
                        { value: 'large', label: 'Grand' }
                    ], category: 'Titre - Espacement' },
                    { name: 'titlePaddingLeft', label: 'Espacement gauche du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucun' },
                        { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' },
                        { value: 'large', label: 'Grand' }
                    ], category: 'Titre - Espacement' },
                    { name: 'titlePaddingRight', label: 'Espacement droite du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucun' },
                        { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' },
                        { value: 'large', label: 'Grand' }
                    ], category: 'Titre - Espacement' },
                    { name: 'titleMarginBottom', label: 'Marge du bas du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucune' },
                        { value: 'small', label: 'Petite' },
                        { value: 'medium', label: 'Moyenne' },
                        { value: 'large', label: 'Grande' }
                    ], category: 'Titre - Espacement' },
                    
                    // Section 7: Configuration Obsol√®te
                    { name: 'obsoleteTitle', label: 'Titre colonne obsol√®te', type: 'text', category: 'Colonne Obsol√®te' },
                    { name: 'obsoleteTitleColor', label: 'Couleur titre obsol√®te', type: 'color', category: 'Colonne Obsol√®te' },
                    { name: 'obsoleteBackgroundColor', label: 'Fond colonne obsol√®te', type: 'color', category: 'Colonne Obsol√®te' },
                    { name: 'obsoleteBorderColor', label: 'Bordure colonne obsol√®te', type: 'color', category: 'Colonne Obsol√®te' },
                    { name: 'obsoleteIcon', label: 'Ic√¥ne obsol√®te', type: 'text', category: 'Colonne Obsol√®te' },
                    
                    // Section 8: Configuration Moderne
                    { name: 'modernTitle', label: 'Titre colonne moderne', type: 'text', category: 'Colonne Moderne' },
                    { name: 'modernTitleColor', label: 'Couleur titre moderne', type: 'color', category: 'Colonne Moderne' },
                    { name: 'modernBackgroundColor', label: 'Fond colonne moderne', type: 'color', category: 'Colonne Moderne' },
                    { name: 'modernBorderColor', label: 'Bordure colonne moderne', type: 'color', category: 'Colonne Moderne' },
                    { name: 'modernIcon', label: 'Ic√¥ne moderne', type: 'text', category: 'Colonne Moderne' },
                    
                    // Section 9: Section VS (S√©parateur) - Inspir√©e du TextSimple
                    { name: 'vsText', label: 'Texte VS', type: 'text', category: 'Section VS' },
                    { name: 'vsSize', label: 'Taille du texte VS', type: 'range', min: 10, max: 40, category: 'Section VS - Typographie' },
                    { name: 'vsColor', label: 'Couleur du texte VS', type: 'color', category: 'Section VS - Typographie' },
                    { name: 'vsAlignment', label: 'Alignement du texte VS', type: 'select', options: [
                        { value: 'left', label: 'Gauche' },
                        { value: 'center', label: 'Centre' },
                        { value: 'right', label: 'Droite' }
                    ], category: 'Section VS - Typographie' },
                    { name: 'vsIsBold', label: 'Texte VS en gras', type: 'checkbox', category: 'Section VS - Typographie' },
                    { name: 'vsIsItalic', label: 'Texte VS en italique', type: 'checkbox', category: 'Section VS - Typographie' },
                    
                    // Section 10: Arri√®re-plan VS
                    { name: 'vsHasBackground', label: 'Arri√®re-plan VS', type: 'checkbox', category: 'Section VS - Arri√®re-plan' },
                    { name: 'vsBackgroundGradient', label: 'Gradient VS', type: 'checkbox', category: 'Section VS - Arri√®re-plan', condition: { field: 'vsHasBackground', value: true } },
                    { name: 'vsBackgroundColor', label: 'Couleur de fond VS', type: 'color', category: 'Section VS - Arri√®re-plan', condition: { field: 'vsBackgroundGradient', value: false } },
                    { name: 'vsBackgroundOpacity', label: 'Transparence du fond VS', type: 'range', min: 0, max: 100, step: 5, category: 'Section VS - Arri√®re-plan', condition: { field: 'vsBackgroundGradient', value: false } },
                    { name: 'vsGradientStart', label: 'Couleur d√©but gradient VS', type: 'color', category: 'Section VS - Arri√®re-plan', condition: { field: 'vsBackgroundGradient', value: true } },
                    { name: 'vsGradientEnd', label: 'Couleur fin gradient VS', type: 'color', category: 'Section VS - Arri√®re-plan', condition: { field: 'vsBackgroundGradient', value: true } },
                    { name: 'vsGradientDirection', label: 'Direction gradient VS', type: 'select', options: [
                        { value: '90deg', label: 'Vertical' },
                        { value: '0deg', label: 'Horizontal' },
                        { value: '135deg', label: 'Diagonal (d√©faut)' },
                        { value: '45deg', label: 'Diagonal invers√©' }
                    ], category: 'Section VS - Arri√®re-plan', condition: { field: 'vsBackgroundGradient', value: true } },
                    
                    // Section 11: Contour VS
                    { name: 'vsHasBorder', label: 'Contour VS', type: 'checkbox', category: 'Section VS - Contour' },
                    { name: 'vsBorderColor', label: 'Couleur du contour VS', type: 'color', category: 'Section VS - Contour', condition: { field: 'vsHasBorder', value: true } },
                    { name: 'vsBorderWidth', label: '√âpaisseur du contour VS', type: 'range', min: 1, max: 10, step: 1, category: 'Section VS - Contour', condition: { field: 'vsHasBorder', value: true } },
                    { name: 'vsBorderStyle', label: 'Style du contour VS', type: 'select', options: [
                        { value: 'solid', label: 'Solide' },
                        { value: 'dashed', label: 'Tirets' },
                        { value: 'dotted', label: 'Points' },
                        { value: 'double', label: 'Double' }
                    ], category: 'Section VS - Contour', condition: { field: 'vsHasBorder', value: true } },
                    
                    // Section 12: Forme VS
                    { name: 'vsHasRoundedCorners', label: 'Coins arrondis VS', type: 'checkbox', category: 'Section VS - Forme' },
                    { name: 'vsBorderRadius', label: 'Niveau d\'arrondi VS', type: 'range', min: 0, max: 50, step: 2, category: 'Section VS - Forme', condition: { field: 'vsHasRoundedCorners', value: true } },
                    
                    // Section 13: Espacement VS
                    { name: 'vsPaddingTop', label: 'Espacement haut VS', type: 'range', min: 0, max: 50, category: 'Section VS - Espacement' },
                    { name: 'vsPaddingBottom', label: 'Espacement bas VS', type: 'range', min: 0, max: 50, category: 'Section VS - Espacement' },
                    { name: 'vsPaddingLeft', label: 'Espacement gauche VS', type: 'range', min: 0, max: 50, category: 'Section VS - Espacement' },
                    { name: 'vsPaddingRight', label: 'Espacement droite VS', type: 'range', min: 0, max: 50, category: 'Section VS - Espacement' },
                    
                    // Section 14: Ombre VS
                    { name: 'vsHasShadow', label: 'Ombre VS', type: 'checkbox', category: 'Section VS - Ombres' },
                    { name: 'vsShadowColor', label: 'Couleur de l\'ombre VS', type: 'color', category: 'Section VS - Ombres', condition: { field: 'vsHasShadow', value: true } },
                    { name: 'vsShadowOpacity', label: 'Opacit√© ombre VS', type: 'range', min: 0, max: 100, category: 'Section VS - Ombres', condition: { field: 'vsHasShadow', value: true } },
                    { name: 'vsShadowOffsetX', label: 'D√©calage X ombre VS', type: 'range', min: -20, max: 20, category: 'Section VS - Ombres', condition: { field: 'vsHasShadow', value: true } },
                    { name: 'vsShadowOffsetY', label: 'D√©calage Y ombre VS', type: 'range', min: -20, max: 20, category: 'Section VS - Ombres', condition: { field: 'vsHasShadow', value: true } },
                    { name: 'vsShadowBlur', label: 'Flou de l\'ombre VS', type: 'range', min: 0, max: 30, category: 'Section VS - Ombres', condition: { field: 'vsHasShadow', value: true } }
                ];
            }

            getElements() {
                return [
                    { id: 'widget', name: 'Widget complet', editable: true },
                    { id: 'title', name: 'Titre principal', editable: true },
                    { id: 'obsolete-column', name: 'Colonne obsol√®te', editable: true, manageable: true },
                    { id: 'vs-section', name: 'Section VS (S√©parateur)', editable: true },
                    { id: 'modern-column', name: 'Colonne moderne', editable: true, manageable: true },
                    { id: 'conclusion', name: 'Section conclusion', editable: true }
                ];
            }
            
            // M√©thodes pour gestion dynamique des inconv√©nients (obsol√®te)
            addObsoleteDisadvantage(newItem) {
                if (!newItem || newItem.trim() === '') return;
                // Format attendu: "Titre|Description"
                this.defaultData.obsoleteDisadvantages.push(newItem.trim());
            }
            
            removeObsoleteDisadvantage(index) {
                if (index >= 0 && index < this.defaultData.obsoleteDisadvantages.length) {
                    this.defaultData.obsoleteDisadvantages.splice(index, 1);
                }
            }
            
            updateObsoleteDisadvantage(index, newText) {
                if (index >= 0 && index < this.defaultData.obsoleteDisadvantages.length) {
                    this.defaultData.obsoleteDisadvantages[index] = newText;
                }
            }
            
            // M√©thodes pour gestion dynamique des avantages (moderne)
            addModernAdvantage(newItem) {
                if (!newItem || newItem.trim() === '') return;
                // Format attendu: "Titre|Description"
                this.defaultData.modernAdvantages.push(newItem.trim());
            }
            
            removeModernAdvantage(index) {
                if (index >= 0 && index < this.defaultData.modernAdvantages.length) {
                    this.defaultData.modernAdvantages.splice(index, 1);
                }
            }
            
            updateModernAdvantage(index, newText) {
                if (index >= 0 && index < this.defaultData.modernAdvantages.length) {
                    this.defaultData.modernAdvantages[index] = newText;
                }
            }
        }

        class TarifLocationWidget {
            constructor() {
                this.id = 'tarif-location';
                this.name = 'Tarifs de Location';
                this.category = 'Commerce';
                this.icon = 'üí∞';
                this.description = 'Grille tarifaire 3 colonnes avec fonctionnalit√©s par plan';
                
                this.defaultData = {
                    // Configuration widget
                    defaultWidth: 9,
                    
                    // Titre principal
                    title: 'TARIFS DE LOCATION TRANSPARENTS',
                    titleSize: 32,
                    titleColor: '#ffffff',
                    titleAlignment: 'center',
                    titleIsBold: true,
                    titleIsItalic: false,
                    titleHasBackground: false,
                    titleBackgroundColor: '#10b981',
                    titleBackgroundOpacity: 20,
                    titleHasBorder: false,
                    titleBorderColor: '#10b981',
                    titleBorderWidth: 2,
                    titleBorderStyle: 'solid',
                    titleHasRoundedCorners: false,
                    titleBorderRadius: 8,
                    titlePaddingTop: 'small',
                    titlePaddingBottom: 'large',
                    titlePaddingLeft: 'medium',
                    titlePaddingRight: 'medium',
                    titleMarginBottom: 'large',
                    
                    // Sous-titre
                    subtitle: 'Prix tout inclus, sans surprise. Plus vous louez longtemps, moins vous payez !',
                    subtitleColor: '#9ca3af',
                    subtitleSize: 18,
                    
                    // Colonne 1 : ESSAI 6 MOIS
                    plan1Title: 'ESSAI 6 MOIS',
                    plan1Price: '175',
                    plan1Currency: '$',
                    plan1Period: 'par mois',
                    plan1TitleColor: '#fbbf24',
                    plan1BackgroundColor: '#1f1f1f',
                    plan1BorderColor: '#fbbf24',
                    plan1Featured: false,
                    plan1Badge: '',
                    plan1CtaText: 'Commencer l\'essai',
                    plan1CtaLink: '#essai',
                    plan1Features: [
                        { text: 'Installation gratuite', emoji: 'üîß', color: '#ffffff' },
                        { text: 'Maintenance incluse', emoji: 'üõ†Ô∏è', color: '#ffffff' },
                        { text: 'Support 8h-17h', emoji: 'üìû', color: '#ffffff' },
                        { text: 'Monitoring de base', emoji: 'üìä', color: '#ffffff' }
                    ],
                    
                    // Colonne 2 : STANDARD 2 ANS
                    plan2Title: 'STANDARD 2 ANS',
                    plan2Price: '150',
                    plan2Currency: '$',
                    plan2Period: 'par mois',
                    plan2TitleColor: '#3b82f6',
                    plan2BackgroundColor: '#1f1f1f',
                    plan2BorderColor: '#3b82f6',
                    plan2Featured: true,
                    plan2Badge: 'POPULAIRE',
                    plan2CtaText: 'Choisir Standard',
                    plan2CtaLink: '#standard',
                    plan2Features: [
                        { text: 'Installation gratuite', emoji: 'üîß', color: '#ffffff' },
                        { text: 'Maintenance incluse', emoji: 'üõ†Ô∏è', color: '#ffffff' },
                        { text: 'Support 24/7', emoji: 'üìû', color: '#ffffff' },
                        { text: 'Monitoring avanc√© IoT', emoji: 'üì°', color: '#ffffff' },
                        { text: 'Remplacement imm√©diat', emoji: '‚ö°', color: '#ffffff' }
                    ],
                    
                    // Colonne 3 : PREMIUM 5 ANS
                    plan3Title: 'PREMIUM 5 ANS',
                    plan3Price: '125',
                    plan3Currency: '$',
                    plan3Period: 'par mois',
                    plan3TitleColor: '#10b981',
                    plan3BackgroundColor: '#1f1f1f',
                    plan3BorderColor: '#10b981',
                    plan3Featured: false,
                    plan3Badge: 'MEILLEURE VALEUR',
                    plan3CtaText: 'Choisir Premium',
                    plan3CtaLink: '#premium',
                    plan3Features: [
                        { text: 'Installation gratuite', emoji: 'üîß', color: '#ffffff' },
                        { text: 'Maintenance incluse', emoji: 'üõ†Ô∏è', color: '#ffffff' },
                        { text: 'Support premium 24/7', emoji: 'üëë', color: '#ffffff' },
                        { text: 'Monitoring IA pr√©dictif', emoji: 'ü§ñ', color: '#ffffff' },
                        { text: 'Upgrade technologique inclus', emoji: 'üöÄ', color: '#ffffff' },
                        { text: 'Option d\'achat privil√©gi√©e', emoji: 'üèÜ', color: '#ffffff' }
                    ],
                    
                    // Section bonus/astuce
                    bonusTitle: 'üí° Astuce : Tarifs d√©gressifs pour multiple unit√©s !',
                    bonusDetails: '2-4 unit√©s : -10% | 5-9 unit√©s : -15% | 10+ unit√©s : -20% | 20+ unit√©s : sur devis personnalis√©',
                    bonusBackgroundColor: '#0f172a',
                    bonusTitleColor: '#fbbf24'
                };
            }

            // M√©thodes de gestion dynamique des fonctionnalit√©s - Plan 1
            addPlan1Feature(newFeature) {
                console.log('üöÄ addPlan1Feature called with:', newFeature);
                if (!newFeature || newFeature.trim() === '') return;
                this.defaultData.plan1Features.push({ text: newFeature.trim(), emoji: '‚úÖ', color: '#ffffff' });
                console.log('‚úÖ Added plan1 feature:', newFeature.trim());
            }
            
            removePlan1Feature(index) {
                console.log('üóëÔ∏è removePlan1Feature called with index:', index);
                if (index >= 0 && index < this.defaultData.plan1Features.length) {
                    const removed = this.defaultData.plan1Features[index];
                    this.defaultData.plan1Features.splice(index, 1);
                    console.log('‚úÖ Removed plan1 feature:', removed);
                }
            }

            // M√©thodes de gestion dynamique des fonctionnalit√©s - Plan 2
            addPlan2Feature(newFeature) {
                console.log('üöÄ addPlan2Feature called with:', newFeature);
                if (!newFeature || newFeature.trim() === '') return;
                this.defaultData.plan2Features.push({ text: newFeature.trim(), emoji: '‚úÖ', color: '#ffffff' });
                console.log('‚úÖ Added plan2 feature:', newFeature.trim());
            }
            
            removePlan2Feature(index) {
                console.log('üóëÔ∏è removePlan2Feature called with index:', index);
                if (index >= 0 && index < this.defaultData.plan2Features.length) {
                    const removed = this.defaultData.plan2Features[index];
                    this.defaultData.plan2Features.splice(index, 1);
                    console.log('‚úÖ Removed plan2 feature:', removed);
                }
            }

            // M√©thodes de gestion dynamique des fonctionnalit√©s - Plan 3
            addPlan3Feature(newFeature) {
                console.log('üöÄ addPlan3Feature called with:', newFeature);
                if (!newFeature || newFeature.trim() === '') return;
                this.defaultData.plan3Features.push({ text: newFeature.trim(), emoji: '‚úÖ', color: '#ffffff' });
                console.log('‚úÖ Added plan3 feature:', newFeature.trim());
            }
            
            removePlan3Feature(index) {
                console.log('üóëÔ∏è removePlan3Feature called with index:', index);
                if (index >= 0 && index < this.defaultData.plan3Features.length) {
                    const removed = this.defaultData.plan3Features[index];
                    this.defaultData.plan3Features.splice(index, 1);
                    console.log('‚úÖ Removed plan3 feature:', removed);
                }
            }

            // Helper pour convertir les valeurs d'espacement en pixels
            getSpacingValue(spacingType) {
                const spacingMap = {
                    'none': '0px',
                    'small': '8px',
                    'medium': '16px',
                    'large': '32px'
                };
                return spacingMap[spacingType] || '16px';
            }

            // G√©n√®re les styles CSS pour le titre principal
            generateTitleStyles(data) {
                const styleRules = [];
                
                // Style de base
                styleRules.push('text-align: ' + (data.titleAlignment || 'center'));
                styleRules.push('font-size: ' + (data.titleSize || 32) + 'px');
                styleRules.push('color: ' + (data.titleColor || '#ffffff'));
                styleRules.push('font-weight: ' + (data.titleIsBold ? 'bold' : 'normal'));
                styleRules.push('font-style: ' + (data.titleIsItalic ? 'italic' : 'normal'));
                styleRules.push('line-height: 1.2');
                
                // Arri√®re-plan
                if (data.titleHasBackground) {
                    const opacity = (data.titleBackgroundOpacity || 20) / 100;
                    const bgColor = data.titleBackgroundColor || '#10b981';
                    const hex = bgColor.replace('#', '');
                    const r = parseInt(hex.substr(0, 2), 16);
                    const g = parseInt(hex.substr(2, 2), 16);
                    const b = parseInt(hex.substr(4, 2), 16);
                    styleRules.push(`background-color: rgba(${r}, ${g}, ${b}, ${opacity})`);
                }
                
                // Contour
                if (data.titleHasBorder) {
                    const borderWidth = data.titleBorderWidth || 2;
                    const borderStyle = data.titleBorderStyle || 'solid';
                    const borderColor = data.titleBorderColor || '#10b981';
                    styleRules.push(`border: ${borderWidth}px ${borderStyle} ${borderColor}`);
                }
                
                // Coins arrondis
                if (data.titleHasRoundedCorners) {
                    const borderRadius = data.titleBorderRadius || 8;
                    styleRules.push(`border-radius: ${borderRadius}px`);
                }
                
                // Espacement
                const paddingTop = this.getSpacingValue(data.titlePaddingTop || 'small');
                const paddingBottom = this.getSpacingValue(data.titlePaddingBottom || 'large');
                const paddingLeft = this.getSpacingValue(data.titlePaddingLeft || 'medium');
                const paddingRight = this.getSpacingValue(data.titlePaddingRight || 'medium');
                styleRules.push(`padding: ${paddingTop} ${paddingRight} ${paddingBottom} ${paddingLeft}`);
                
                const marginBottom = this.getSpacingValue(data.titleMarginBottom || 'large');
                styleRules.push(`margin-bottom: ${marginBottom}`);
                
                return styleRules.join('; ');
            }

            render(data = {}) {
                const d = { ...this.defaultData, ...data };
                
                // G√©n√©rer les styles du titre
                const titleStyles = this.generateTitleStyles(d);
                
                // Cr√©er les listes de fonctionnalit√©s pour chaque plan
                const renderFeatures = (features, planNumber) => {
                    return features.map((item, index) => {
                        const itemData = typeof item === 'string' ? { text: item, emoji: '‚úÖ', color: '#ffffff' } : item;
                        const displayEmoji = itemData.emoji && itemData.emoji.trim() !== '' ? itemData.emoji : '‚úÖ';
                        const textColor = itemData.color || '#ffffff';
                        
                        return `
                            <div class="tarif-feature plan${planNumber}-feature" style="margin-bottom: 12px; padding: 8px; 
                                                                                         background: rgba(255,255,255,0.05); 
                                                                                         border-radius: 6px; display: flex; align-items: center; gap: 12px;">
                                <div class="feature-emoji" style="font-size: 1.2rem; min-width: 20px; text-align: center;">${displayEmoji}</div>
                                <div class="feature-text" style="color: ${textColor}; font-size: 0.9rem; line-height: 1.3; flex: 1;">
                                    ${itemData.text}
                                </div>
                            </div>
                        `;
                    }).join('');
                };

                const plan1FeaturesHtml = renderFeatures(d.plan1Features, 1);
                const plan2FeaturesHtml = renderFeatures(d.plan2Features, 2);
                const plan3FeaturesHtml = renderFeatures(d.plan3Features, 3);

                return `
                    <div class="tarif-location-widget" style="max-width: 1200px; margin: 0 auto; padding: 40px 20px;">
                        <!-- Titre principal -->
                        <h2 class="tarif-title" style="${titleStyles}">
                            ${d.title}
                        </h2>
                        
                        <!-- Sous-titre -->
                        <p style="text-align: center; font-size: ${d.subtitleSize || 18}px; color: ${d.subtitleColor || '#9ca3af'}; 
                                  margin-bottom: 40px; line-height: 1.6; max-width: 800px; margin-left: auto; margin-right: auto;">
                            ${d.subtitle}
                        </p>
                        
                        <!-- Grille de tarifs (3 colonnes) -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 24px; margin-bottom: 40px;">
                            
                            <!-- Plan 1: ESSAI 6 MOIS -->
                            <div class="tarif-card plan1-card ${d.plan1Featured ? 'featured-plan' : ''}" 
                                 style="background: ${d.plan1BackgroundColor}; 
                                        border: 2px solid ${d.plan1BorderColor}; 
                                        border-radius: 16px; padding: 32px; position: relative;
                                        ${d.plan1Featured ? 'transform: scale(1.05); z-index: 2;' : ''}">
                                
                                ${d.plan1Badge ? `<div class="plan-badge" style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); 
                                                                                   background: ${d.plan1BorderColor}; color: white; padding: 6px 20px; 
                                                                                   border-radius: 20px; font-size: 0.75rem; font-weight: bold; 
                                                                                   text-transform: uppercase; letter-spacing: 1px;">${d.plan1Badge}</div>` : ''}
                                
                                <div style="text-align: center; margin-bottom: 24px;">
                                    <h3 style="color: ${d.plan1TitleColor}; font-size: 1.25rem; font-weight: bold; margin: 0 0 16px 0; text-transform: uppercase; letter-spacing: 1px;">
                                        ${d.plan1Title}
                                    </h3>
                                    <div class="price-display" style="margin-bottom: 8px;">
                                        <span style="color: ${d.plan1TitleColor}; font-size: 3rem; font-weight: bold;">${d.plan1Price}</span>
                                        <span style="color: ${d.plan1TitleColor}; font-size: 1.5rem; margin-left: 4px;">${d.plan1Currency}</span>
                                    </div>
                                    <div style="color: #9ca3af; font-size: 1rem;">${d.plan1Period}</div>
                                </div>
                                
                                <div class="features-list plan1-features">
                                    ${plan1FeaturesHtml}
                                </div>
                                
                                <div style="margin-top: 24px;">
                                    <a href="${d.plan1CtaLink}" 
                                       style="width: 100%; padding: 16px 24px; background: ${d.plan1BorderColor}; color: white;
                                              border: none; border-radius: 8px; font-size: 1rem; font-weight: 600;
                                              text-transform: uppercase; letter-spacing: 0.05em; transition: all 0.3s;
                                              text-decoration: none; display: inline-block; cursor: pointer; text-align: center;">
                                        ${d.plan1CtaText}
                                    </a>
                                </div>
                            </div>
                            
                            <!-- Plan 2: STANDARD 2 ANS -->
                            <div class="tarif-card plan2-card ${d.plan2Featured ? 'featured-plan' : ''}" 
                                 style="background: ${d.plan2BackgroundColor}; 
                                        border: 2px solid ${d.plan2BorderColor}; 
                                        border-radius: 16px; padding: 32px; position: relative;
                                        ${d.plan2Featured ? 'transform: scale(1.05); z-index: 2;' : ''}">
                                
                                ${d.plan2Badge ? `<div class="plan-badge" style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); 
                                                                                   background: ${d.plan2BorderColor}; color: white; padding: 6px 20px; 
                                                                                   border-radius: 20px; font-size: 0.75rem; font-weight: bold; 
                                                                                   text-transform: uppercase; letter-spacing: 1px;">${d.plan2Badge}</div>` : ''}
                                
                                <div style="text-align: center; margin-bottom: 24px;">
                                    <h3 style="color: ${d.plan2TitleColor}; font-size: 1.25rem; font-weight: bold; margin: 0 0 16px 0; text-transform: uppercase; letter-spacing: 1px;">
                                        ${d.plan2Title}
                                    </h3>
                                    <div class="price-display" style="margin-bottom: 8px;">
                                        <span style="color: ${d.plan2TitleColor}; font-size: 3rem; font-weight: bold;">${d.plan2Price}</span>
                                        <span style="color: ${d.plan2TitleColor}; font-size: 1.5rem; margin-left: 4px;">${d.plan2Currency}</span>
                                    </div>
                                    <div style="color: #9ca3af; font-size: 1rem;">${d.plan2Period}</div>
                                </div>
                                
                                <div class="features-list plan2-features">
                                    ${plan2FeaturesHtml}
                                </div>
                                
                                <div style="margin-top: 24px;">
                                    <a href="${d.plan2CtaLink}" 
                                       style="width: 100%; padding: 16px 24px; background: ${d.plan2BorderColor}; color: white;
                                              border: none; border-radius: 8px; font-size: 1rem; font-weight: 600;
                                              text-transform: uppercase; letter-spacing: 0.05em; transition: all 0.3s;
                                              text-decoration: none; display: inline-block; cursor: pointer; text-align: center;">
                                        ${d.plan2CtaText}
                                    </a>
                                </div>
                            </div>
                            
                            <!-- Plan 3: PREMIUM 5 ANS -->
                            <div class="tarif-card plan3-card ${d.plan3Featured ? 'featured-plan' : ''}" 
                                 style="background: ${d.plan3BackgroundColor}; 
                                        border: 2px solid ${d.plan3BorderColor}; 
                                        border-radius: 16px; padding: 32px; position: relative;
                                        ${d.plan3Featured ? 'transform: scale(1.05); z-index: 2;' : ''}">
                                
                                ${d.plan3Badge ? `<div class="plan-badge" style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); 
                                                                                   background: ${d.plan3BorderColor}; color: white; padding: 6px 20px; 
                                                                                   border-radius: 20px; font-size: 0.75rem; font-weight: bold; 
                                                                                   text-transform: uppercase; letter-spacing: 1px;">${d.plan3Badge}</div>` : ''}
                                
                                <div style="text-align: center; margin-bottom: 24px;">
                                    <h3 style="color: ${d.plan3TitleColor}; font-size: 1.25rem; font-weight: bold; margin: 0 0 16px 0; text-transform: uppercase; letter-spacing: 1px;">
                                        ${d.plan3Title}
                                    </h3>
                                    <div class="price-display" style="margin-bottom: 8px;">
                                        <span style="color: ${d.plan3TitleColor}; font-size: 3rem; font-weight: bold;">${d.plan3Price}</span>
                                        <span style="color: ${d.plan3TitleColor}; font-size: 1.5rem; margin-left: 4px;">${d.plan3Currency}</span>
                                    </div>
                                    <div style="color: #9ca3af; font-size: 1rem;">${d.plan3Period}</div>
                                </div>
                                
                                <div class="features-list plan3-features">
                                    ${plan3FeaturesHtml}
                                </div>
                                
                                <div style="margin-top: 24px;">
                                    <a href="${d.plan3CtaLink}" 
                                       style="width: 100%; padding: 16px 24px; background: ${d.plan3BorderColor}; color: white;
                                              border: none; border-radius: 8px; font-size: 1rem; font-weight: 600;
                                              text-transform: uppercase; letter-spacing: 0.05em; transition: all 0.3s;
                                              text-decoration: none; display: inline-block; cursor: pointer; text-align: center;">
                                        ${d.plan3CtaText}
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Section Bonus/Astuce -->
                        <div class="bonus-section" style="text-align: center; padding: 24px; background: ${d.bonusBackgroundColor || '#0f172a'}; 
                                                          border-radius: 12px; margin-top: 32px; border: 1px solid rgba(59, 130, 246, 0.3);">
                            <h4 style="color: ${d.bonusTitleColor || '#fbbf24'}; font-size: 1.25rem; font-weight: bold; margin: 0 0 12px 0;">
                                ${d.bonusTitle}
                            </h4>
                            <p style="color: rgba(255,255,255,0.8); font-size: 1rem; line-height: 1.5; margin: 0;">
                                ${d.bonusDetails}
                            </p>
                        </div>
                    </div>
                `;
            }

            getEditableFields() {
                return [
                    // Section 1: Contenu principal
                    { name: 'title', label: 'Titre principal', type: 'text', category: 'Contenu Principal' },
                    { name: 'subtitle', label: 'Sous-titre', type: 'textarea', category: 'Contenu Principal' },
                    { name: 'subtitleColor', label: 'Couleur sous-titre', type: 'color', category: 'Contenu Principal' },
                    { name: 'subtitleSize', label: 'Taille sous-titre', type: 'range', min: 14, max: 24, category: 'Contenu Principal' },
                    
                    // Section 2: Style du titre principal (comme TextSimple)
                    { name: 'titleSize', label: 'Taille du titre', type: 'range', min: 20, max: 60, category: 'Titre - Typographie' },
                    { name: 'titleColor', label: 'Couleur du titre', type: 'color', category: 'Titre - Typographie' },
                    { name: 'titleAlignment', label: 'Alignement du titre', type: 'select', options: [
                        { value: 'left', label: 'Gauche' },
                        { value: 'center', label: 'Centre' },
                        { value: 'right', label: 'Droite' }
                    ], category: 'Titre - Typographie' },
                    { name: 'titleIsBold', label: 'Titre en gras', type: 'checkbox', category: 'Titre - Typographie' },
                    { name: 'titleIsItalic', label: 'Titre en italique', type: 'checkbox', category: 'Titre - Typographie' },
                    
                    // Section 3: Plan 1 (ESSAI)
                    { name: 'plan1Title', label: 'Titre Plan 1', type: 'text', category: 'Plan 1 - Essai' },
                    { name: 'plan1Price', label: 'Prix Plan 1', type: 'text', category: 'Plan 1 - Essai' },
                    { name: 'plan1Currency', label: 'Devise Plan 1', type: 'text', category: 'Plan 1 - Essai' },
                    { name: 'plan1Period', label: 'P√©riode Plan 1', type: 'text', category: 'Plan 1 - Essai' },
                    { name: 'plan1TitleColor', label: 'Couleur titre Plan 1', type: 'color', category: 'Plan 1 - Essai' },
                    { name: 'plan1BackgroundColor', label: 'Fond Plan 1', type: 'color', category: 'Plan 1 - Essai' },
                    { name: 'plan1BorderColor', label: 'Bordure Plan 1', type: 'color', category: 'Plan 1 - Essai' },
                    { name: 'plan1Featured', label: 'Plan 1 vedette', type: 'checkbox', category: 'Plan 1 - Essai' },
                    { name: 'plan1Badge', label: 'Badge Plan 1', type: 'text', category: 'Plan 1 - Essai' },
                    { name: 'plan1CtaText', label: 'Bouton Plan 1', type: 'text', category: 'Plan 1 - Essai' },
                    { name: 'plan1CtaLink', label: 'Lien Plan 1', type: 'text', category: 'Plan 1 - Essai' },
                    
                    // Section 4: Plan 2 (STANDARD)
                    { name: 'plan2Title', label: 'Titre Plan 2', type: 'text', category: 'Plan 2 - Standard' },
                    { name: 'plan2Price', label: 'Prix Plan 2', type: 'text', category: 'Plan 2 - Standard' },
                    { name: 'plan2Currency', label: 'Devise Plan 2', type: 'text', category: 'Plan 2 - Standard' },
                    { name: 'plan2Period', label: 'P√©riode Plan 2', type: 'text', category: 'Plan 2 - Standard' },
                    { name: 'plan2TitleColor', label: 'Couleur titre Plan 2', type: 'color', category: 'Plan 2 - Standard' },
                    { name: 'plan2BackgroundColor', label: 'Fond Plan 2', type: 'color', category: 'Plan 2 - Standard' },
                    { name: 'plan2BorderColor', label: 'Bordure Plan 2', type: 'color', category: 'Plan 2 - Standard' },
                    { name: 'plan2Featured', label: 'Plan 2 vedette', type: 'checkbox', category: 'Plan 2 - Standard' },
                    { name: 'plan2Badge', label: 'Badge Plan 2', type: 'text', category: 'Plan 2 - Standard' },
                    { name: 'plan2CtaText', label: 'Bouton Plan 2', type: 'text', category: 'Plan 2 - Standard' },
                    { name: 'plan2CtaLink', label: 'Lien Plan 2', type: 'text', category: 'Plan 2 - Standard' },
                    
                    // Section 5: Plan 3 (PREMIUM)
                    { name: 'plan3Title', label: 'Titre Plan 3', type: 'text', category: 'Plan 3 - Premium' },
                    { name: 'plan3Price', label: 'Prix Plan 3', type: 'text', category: 'Plan 3 - Premium' },
                    { name: 'plan3Currency', label: 'Devise Plan 3', type: 'text', category: 'Plan 3 - Premium' },
                    { name: 'plan3Period', label: 'P√©riode Plan 3', type: 'text', category: 'Plan 3 - Premium' },
                    { name: 'plan3TitleColor', label: 'Couleur titre Plan 3', type: 'color', category: 'Plan 3 - Premium' },
                    { name: 'plan3BackgroundColor', label: 'Fond Plan 3', type: 'color', category: 'Plan 3 - Premium' },
                    { name: 'plan3BorderColor', label: 'Bordure Plan 3', type: 'color', category: 'Plan 3 - Premium' },
                    { name: 'plan3Featured', label: 'Plan 3 vedette', type: 'checkbox', category: 'Plan 3 - Premium' },
                    { name: 'plan3Badge', label: 'Badge Plan 3', type: 'text', category: 'Plan 3 - Premium' },
                    { name: 'plan3CtaText', label: 'Bouton Plan 3', type: 'text', category: 'Plan 3 - Premium' },
                    { name: 'plan3CtaLink', label: 'Lien Plan 3', type: 'text', category: 'Plan 3 - Premium' },
                    
                    // Section 6: Section Bonus
                    { name: 'bonusTitle', label: 'Titre bonus', type: 'text', category: 'Section Bonus' },
                    { name: 'bonusDetails', label: 'D√©tails bonus', type: 'textarea', category: 'Section Bonus' },
                    { name: 'bonusBackgroundColor', label: 'Fond bonus', type: 'color', category: 'Section Bonus' },
                    { name: 'bonusTitleColor', label: 'Couleur titre bonus', type: 'color', category: 'Section Bonus' }
                ];
            }

            getElements() {
                return [
                    { id: 'plan1-features', name: 'Fonctionnalit√©s Plan 1', editable: true },
                    { id: 'plan2-features', name: 'Fonctionnalit√©s Plan 2', editable: true },
                    { id: 'plan3-features', name: 'Fonctionnalit√©s Plan 3', editable: true },
                    { id: 'tarif-card', name: 'Cartes tarifaires', editable: true }
                ];
            }
        }

        class FeatureGridWidget {
            constructor() {
                this.id = 'feature-grid';
                this.name = 'Grille de Fonctionnalit√©s';
                this.category = 'Contenu';
                this.icon = '‚≠ê';
                this.description = 'Grille de fonctionnalit√©s avec ic√¥nes √©ditables';
                
                this.defaultData = {
                    title: 'Pourquoi Nous Choisir ?',
                    // Propri√©t√©s du titre principal (inspir√©es du TextSimple)
                    titleSize: 32,
                    titleColor: '#ffffff',
                    titleAlignment: 'center',
                    titleIsBold: true,
                    titleIsItalic: false,
                    titleHasBackground: false,
                    titleBackgroundColor: '#10b981',
                    titleBackgroundOpacity: 20,
                    titleHasBorder: false,
                    titleBorderColor: '#10b981',
                    titleBorderWidth: 2,
                    titleBorderStyle: 'solid',
                    titleHasRoundedCorners: false,
                    titleBorderRadius: 8,
                    titlePaddingTop: 'medium',
                    titlePaddingBottom: 'medium',
                    titlePaddingLeft: 'medium',
                    titlePaddingRight: 'medium',
                    titleMarginBottom: 'large',
                    features: [
                        {
                            icon: 'üöÄ',
                            title: 'Performance',
                            description: 'Des solutions rapides et efficaces',
                            iconSize: '3rem',
                            titleColor: 'white',
                            titleSize: '1.5rem',
                            descriptionColor: 'var(--text-gray)',
                            descriptionSize: '0.95rem',
                            backgroundColor: 'var(--bg-card)',
                            borderColor: 'var(--border-color)'
                        },
                        {
                            icon: 'üîí',
                            title: 'S√©curit√©',
                            description: 'Protection maximale de vos donn√©es',
                            iconSize: '3rem',
                            titleColor: 'white',
                            titleSize: '1.5rem',
                            descriptionColor: 'var(--text-gray)',
                            descriptionSize: '0.95rem',
                            backgroundColor: 'var(--bg-card)',
                            borderColor: 'var(--border-color)'
                        },
                        {
                            icon: 'üí°',
                            title: 'Innovation',
                            description: 'Technologies de pointe',
                            iconSize: '3rem',
                            titleColor: 'white',
                            titleSize: '1.5rem',
                            descriptionColor: 'var(--text-gray)',
                            descriptionSize: '0.95rem',
                            backgroundColor: 'var(--bg-card)',
                            borderColor: 'var(--border-color)'
                        },
                        {
                            icon: 'ü§ù',
                            title: 'Support',
                            description: '√âquipe d√©di√©e √† votre service',
                            iconSize: '3rem',
                            titleColor: 'white',
                            titleSize: '1.5rem',
                            descriptionColor: 'var(--text-gray)',
                            descriptionSize: '0.95rem',
                            backgroundColor: 'var(--bg-card)',
                            borderColor: 'var(--border-color)'
                        },
                        {
                            icon: 'üéØ',
                            title: 'Pr√©cision',
                            description: 'R√©sultats cibl√©s et mesurables',
                            iconSize: '3rem',
                            titleColor: 'white',
                            titleSize: '1.5rem',
                            descriptionColor: 'var(--text-gray)',
                            descriptionSize: '0.95rem',
                            backgroundColor: 'var(--bg-card)',
                            borderColor: 'var(--border-color)'
                        },
                        {
                            icon: 'üåü',
                            title: 'Excellence',
                            description: 'Standards de qualit√© √©lev√©s',
                            iconSize: '3rem',
                            titleColor: 'white',
                            titleSize: '1.5rem',
                            descriptionColor: 'var(--text-gray)',
                            descriptionSize: '0.95rem',
                            backgroundColor: 'var(--bg-card)',
                            borderColor: 'var(--border-color)'
                        }
                    ],
                    columns: 2,
                    featuresCount: 4,
                    
                    // Propri√©t√©s d'arri√®re-plan de la section
                    hasBackground: false,
                    backgroundColor: '#1e293b',
                    backgroundOpacity: 80,
                    backgroundType: 'solid', // solid, gradient, transparent
                    gradientStart: '#1e293b',
                    gradientEnd: '#0f172a',
                    gradientDirection: 'to bottom',
                    
                    // Propri√©t√©s de bordure de la section
                    hasBorder: false,
                    borderColor: '#10b981',
                    borderWidth: 2,
                    borderStyle: 'solid',
                    
                    // Propri√©t√©s de coins arrondis de la section
                    hasRoundedCorners: false,
                    borderRadius: 12
                };
            }

            // Helper pour convertir les valeurs d'espacement en pixels (inspir√© du TextSimple)
            getSpacingValue(spacingType) {
                const spacingMap = {
                    'none': '0px',
                    'small': '8px',
                    'medium': '16px',
                    'large': '32px'
                };
                return spacingMap[spacingType] || '16px';
            }

            // G√©n√®re les styles CSS pour le titre
            generateTitleStyles(data) {
                const styleRules = [];
                
                // Style de base
                styleRules.push('text-align: ' + (data.titleAlignment || 'center'));
                styleRules.push('font-size: ' + (data.titleSize || 32) + 'px');
                styleRules.push('color: ' + (data.titleColor || '#ffffff'));
                styleRules.push('font-weight: ' + (data.titleIsBold ? 'bold' : 'normal'));
                styleRules.push('font-style: ' + (data.titleIsItalic ? 'italic' : 'normal'));
                styleRules.push('line-height: 1.2');
                
                // Arri√®re-plan
                if (data.titleHasBackground) {
                    const opacity = (data.titleBackgroundOpacity || 20) / 100;
                    const bgColor = data.titleBackgroundColor || '#10b981';
                    // Convertir hex en rgba
                    const hex = bgColor.replace('#', '');
                    const r = parseInt(hex.substr(0, 2), 16);
                    const g = parseInt(hex.substr(2, 2), 16);
                    const b = parseInt(hex.substr(4, 2), 16);
                    styleRules.push(`background-color: rgba(${r}, ${g}, ${b}, ${opacity})`);
                }
                
                // Contour
                if (data.titleHasBorder) {
                    const borderWidth = data.titleBorderWidth || 2;
                    const borderStyle = data.titleBorderStyle || 'solid';
                    const borderColor = data.titleBorderColor || '#10b981';
                    styleRules.push(`border: ${borderWidth}px ${borderStyle} ${borderColor}`);
                }
                
                // Coins arrondis
                if (data.titleHasRoundedCorners) {
                    const borderRadius = data.titleBorderRadius || 8;
                    styleRules.push(`border-radius: ${borderRadius}px`);
                }
                
                // Espacement interne (padding)
                const paddingTop = this.getSpacingValue(data.titlePaddingTop || 'medium');
                const paddingBottom = this.getSpacingValue(data.titlePaddingBottom || 'medium');
                const paddingLeft = this.getSpacingValue(data.titlePaddingLeft || 'medium');
                const paddingRight = this.getSpacingValue(data.titlePaddingRight || 'medium');
                styleRules.push(`padding: ${paddingTop} ${paddingRight} ${paddingBottom} ${paddingLeft}`);
                
                // Marge du bas
                const marginBottom = this.getSpacingValue(data.titleMarginBottom || 'large');
                styleRules.push(`margin-bottom: ${marginBottom}`);
                
                return styleRules.join('; ');
            }

            // G√©n√®re les styles CSS pour la section compl√®te
            generateSectionStyles(data) {
                const styleRules = [];
                
                // Style de base par d√©faut
                styleRules.push('padding: 80px 20px');
                
                // Arri√®re-plan
                if (data.hasBackground) {
                    let backgroundStyle;
                    if (data.backgroundType === 'transparent') {
                        backgroundStyle = 'transparent';
                    } else if (data.backgroundType === 'gradient') {
                        backgroundStyle = `linear-gradient(${data.gradientDirection}, ${data.gradientStart}, ${data.gradientEnd})`;
                    } else {
                        const opacity = (data.backgroundOpacity || 80) / 100;
                        const bgColor = data.backgroundColor || '#1e293b';
                        const hex = bgColor.replace('#', '');
                        const r = parseInt(hex.substr(0, 2), 16);
                        const g = parseInt(hex.substr(2, 2), 16);
                        const b = parseInt(hex.substr(4, 2), 16);
                        backgroundStyle = `rgba(${r}, ${g}, ${b}, ${opacity})`;
                    }
                    styleRules.push(`background: ${backgroundStyle}`);
                } else {
                    styleRules.push('background: var(--bg-primary)');
                }
                
                // Contour
                if (data.hasBorder) {
                    const borderWidth = data.borderWidth || 2;
                    const borderStyle = data.borderStyle || 'solid';
                    const borderColor = data.borderColor || '#10b981';
                    styleRules.push(`border: ${borderWidth}px ${borderStyle} ${borderColor}`);
                }
                
                // Coins arrondis
                if (data.hasRoundedCorners) {
                    const borderRadius = data.borderRadius || 12;
                    styleRules.push(`border-radius: ${borderRadius}px`);
                }
                
                return styleRules.join('; ');
            }

            render(data = {}) {
                const d = { ...this.defaultData, ...data };
                
                // G√©n√©rer les styles du titre
                const titleStyles = this.generateTitleStyles(d);
                
                // G√©n√©rer les styles de la section
                const sectionStyles = this.generateSectionStyles(d);
                
                // Limiter les features affich√©es selon featuresCount
                const displayedFeatures = d.features.slice(0, d.featuresCount || 4);
                
                const featuresHtml = displayedFeatures.map(feature => 
                    `<div class="feature-card" 
                          style="background: ${feature.backgroundColor || 'var(--bg-card)'}; 
                                 padding: 32px; border-radius: 12px; 
                                 text-align: center; 
                                 border: 1px solid ${feature.borderColor || 'var(--border-color)'}; 
                                 transition: transform 0.3s ease, box-shadow 0.3s ease;">
                        <div style="font-size: ${feature.iconSize || '3rem'}; margin-bottom: 20px; line-height: 1;">${feature.icon || '‚≠ê'}</div>
                        <h3 style="color: ${feature.titleColor || 'white'}; 
                                   font-size: ${feature.titleSize || '1.5rem'}; 
                                   margin-bottom: 16px; font-weight: bold;">
                            ${feature.title || 'Titre'}
                        </h3>
                        <p style="color: ${feature.descriptionColor || 'var(--text-gray)'}; 
                                  line-height: 1.6; 
                                  font-size: ${feature.descriptionSize || '0.95rem'};">
                            ${feature.description || 'Description de la fonctionnalit√©'}
                        </p>
                    </div>`
                ).join('');

                return `
                    <div class="features-section" style="${sectionStyles}">
                        <h2 class="features-main-title" style="${titleStyles}">
                            ${d.title}
                        </h2>
                        <div class="features-grid" 
                             style="display: grid; grid-template-columns: repeat(${d.columns}, 1fr); 
                                    gap: 32px; max-width: 1400px; margin: 0 auto; width: 100%;">
                            ${featuresHtml}
                        </div>
                    </div>
                `;
            }

            getEditableFields() {
                return [
                    // Section 1: Contenu
                    { name: 'title', label: 'Titre principal', type: 'text', category: 'Contenu' },
                    
                    // Section 2: Style du titre principal
                    { name: 'titleSize', label: 'Taille du titre', type: 'range', min: 16, max: 60, category: 'Titre - Typographie' },
                    { name: 'titleColor', label: 'Couleur du titre', type: 'color', category: 'Titre - Typographie' },
                    { name: 'titleAlignment', label: 'Alignement du titre', type: 'select', options: [
                        { value: 'left', label: 'Gauche' },
                        { value: 'center', label: 'Centre' },
                        { value: 'right', label: 'Droite' }
                    ], category: 'Titre - Typographie' },
                    { name: 'titleIsBold', label: 'Titre en gras', type: 'checkbox', category: 'Titre - Typographie' },
                    { name: 'titleIsItalic', label: 'Titre en italique', type: 'checkbox', category: 'Titre - Typographie' },
                    
                    // Section 3: Arri√®re-plan du titre
                    { name: 'titleHasBackground', label: 'Arri√®re-plan du titre', type: 'checkbox', category: 'Titre - Arri√®re-plan' },
                    { name: 'titleBackgroundColor', label: 'Couleur de fond du titre', type: 'color', category: 'Titre - Arri√®re-plan', condition: { field: 'titleHasBackground', value: true } },
                    { name: 'titleBackgroundOpacity', label: 'Transparence du fond', type: 'range', min: 0, max: 100, step: 5, category: 'Titre - Arri√®re-plan', condition: { field: 'titleHasBackground', value: true } },
                    
                    // Section 4: Contour du titre
                    { name: 'titleHasBorder', label: 'Contour du titre', type: 'checkbox', category: 'Titre - Contour' },
                    { name: 'titleBorderColor', label: 'Couleur du contour', type: 'color', category: 'Titre - Contour', condition: { field: 'titleHasBorder', value: true } },
                    { name: 'titleBorderWidth', label: '√âpaisseur du contour', type: 'range', min: 1, max: 10, step: 1, category: 'Titre - Contour', condition: { field: 'titleHasBorder', value: true } },
                    { name: 'titleBorderStyle', label: 'Style du contour', type: 'select', options: [
                        { value: 'solid', label: 'Solide' },
                        { value: 'dashed', label: 'Tirets' },
                        { value: 'dotted', label: 'Points' },
                        { value: 'double', label: 'Double' }
                    ], category: 'Titre - Contour', condition: { field: 'titleHasBorder', value: true } },
                    
                    // Section 5: Coins arrondis du titre
                    { name: 'titleHasRoundedCorners', label: 'Coins arrondis du titre', type: 'checkbox', category: 'Titre - Forme' },
                    { name: 'titleBorderRadius', label: 'Niveau d\'arrondi', type: 'range', min: 0, max: 50, step: 2, category: 'Titre - Forme', condition: { field: 'titleHasRoundedCorners', value: true } },
                    
                    // Section 6: Espacement du titre
                    { name: 'titlePaddingTop', label: 'Espacement haut du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucun' },
                        { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' },
                        { value: 'large', label: 'Grand' }
                    ], category: 'Titre - Espacement' },
                    { name: 'titlePaddingBottom', label: 'Espacement bas du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucun' },
                        { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' },
                        { value: 'large', label: 'Grand' }
                    ], category: 'Titre - Espacement' },
                    { name: 'titlePaddingLeft', label: 'Espacement gauche du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucun' },
                        { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' },
                        { value: 'large', label: 'Grand' }
                    ], category: 'Titre - Espacement' },
                    { name: 'titlePaddingRight', label: 'Espacement droite du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucun' },
                        { value: 'small', label: 'Petit' },
                        { value: 'medium', label: 'Moyen' },
                        { value: 'large', label: 'Grand' }
                    ], category: 'Titre - Espacement' },
                    { name: 'titleMarginBottom', label: 'Marge du bas du titre', type: 'select', options: [
                        { value: 'none', label: 'Aucune' },
                        { value: 'small', label: 'Petite' },
                        { value: 'medium', label: 'Moyenne' },
                        { value: 'large', label: 'Grande' }
                    ], category: 'Titre - Espacement' },
                    
                    // Section 7: Configuration de la grille
                    { name: 'featuresCount', label: 'Nombre de fonctionnalit√©s', type: 'range', min: 1, max: 12, category: 'Grille' },
                    { name: 'columns', label: 'Colonnes dans la grille', type: 'range', min: 1, max: 4, category: 'Grille' },
                    
                    // Section 8: Arri√®re-plan de la section
                    { name: 'hasBackground', label: 'Arri√®re-plan personnalis√©', type: 'checkbox', category: 'Section - Arri√®re-plan' },
                    { name: 'backgroundType', label: 'Type d\'arri√®re-plan', type: 'select', options: [
                        { value: 'solid', label: 'Couleur unie' },
                        { value: 'gradient', label: 'D√©grad√©' },
                        { value: 'transparent', label: 'Transparent' }
                    ], category: 'Section - Arri√®re-plan', condition: { field: 'hasBackground', value: true } },
                    { name: 'backgroundColor', label: 'Couleur de fond', type: 'color', category: 'Section - Arri√®re-plan', condition: { field: 'hasBackground', value: true } },
                    { name: 'backgroundOpacity', label: 'Transparence du fond (%)', type: 'range', min: 0, max: 100, step: 5, category: 'Section - Arri√®re-plan', condition: { field: 'hasBackground', value: true } },
                    { name: 'gradientStart', label: 'Couleur de d√©but (d√©grad√©)', type: 'color', category: 'Section - Arri√®re-plan', condition: { field: 'backgroundType', value: 'gradient' } },
                    { name: 'gradientEnd', label: 'Couleur de fin (d√©grad√©)', type: 'color', category: 'Section - Arri√®re-plan', condition: { field: 'backgroundType', value: 'gradient' } },
                    { name: 'gradientDirection', label: 'Direction du d√©grad√©', type: 'select', options: [
                        { value: 'to bottom', label: 'Haut vers bas' },
                        { value: 'to top', label: 'Bas vers haut' },
                        { value: 'to right', label: 'Gauche vers droite' },
                        { value: 'to left', label: 'Droite vers gauche' },
                        { value: 'to bottom right', label: 'Diagonale (bas-droite)' },
                        { value: 'to bottom left', label: 'Diagonale (bas-gauche)' }
                    ], category: 'Section - Arri√®re-plan', condition: { field: 'backgroundType', value: 'gradient' } },
                    
                    // Section 9: Bordure de la section
                    { name: 'hasBorder', label: 'Bordure personnalis√©e', type: 'checkbox', category: 'Section - Bordure' },
                    { name: 'borderColor', label: 'Couleur de bordure', type: 'color', category: 'Section - Bordure', condition: { field: 'hasBorder', value: true } },
                    { name: 'borderWidth', label: '√âpaisseur bordure (px)', type: 'range', min: 1, max: 10, step: 1, category: 'Section - Bordure', condition: { field: 'hasBorder', value: true } },
                    { name: 'borderStyle', label: 'Style de bordure', type: 'select', options: [
                        { value: 'solid', label: 'Solide' },
                        { value: 'dashed', label: 'Tirets' },
                        { value: 'dotted', label: 'Points' },
                        { value: 'double', label: 'Double' }
                    ], category: 'Section - Bordure', condition: { field: 'hasBorder', value: true } },
                    
                    // Section 10: Coins arrondis de la section
                    { name: 'hasRoundedCorners', label: 'Coins arrondis', type: 'checkbox', category: 'Section - Forme' },
                    { name: 'borderRadius', label: 'Niveau d\'arrondi (px)', type: 'range', min: 0, max: 50, step: 2, category: 'Section - Forme', condition: { field: 'hasRoundedCorners', value: true } }
                ];
            }

            getElements() {
                return [
                    { id: 'section', name: 'Section fonctionnalit√©s', editable: true },
                    { id: 'title', name: 'Titre principal', editable: true },
                    { id: 'grid', name: 'Grille', editable: true },
                    { id: 'features', name: 'Fonctionnalit√©s individuelles', editable: true }
                ];
            }
            
            // M√©thodes pour g√©rer les fonctionnalit√©s
            addFeature() {
                if (!this.defaultData.features) this.defaultData.features = [];
                this.defaultData.features.push({
                    icon: '‚≠ê',
                    title: 'Nouvelle fonctionnalit√©',
                    description: 'Description de la fonctionnalit√©'
                });
            }
            
            removeFeature(index) {
                if (this.defaultData.features && index >= 0 && index < this.defaultData.features.length) {
                    this.defaultData.features.splice(index, 1);
                }
            }
            
            updateFeature(index, field, value) {
                if (this.defaultData.features && index >= 0 && index < this.defaultData.features.length) {
                    this.defaultData.features[index][field] = value;
                }
            }
        }

        // √âDITEUR DE WIDGETS COMPLET

        class WidgetEditorComplete {
            constructor() {
                this.widgets = [];
                this.selectedWidget = null;
                
                // Widgets disponibles (classes de base + widgets personnalis√©s)
                this.baseWidgets = [
                    TextSimpleWidget,
                    LogoWidget,
                    ImageAnimatedWidget,
                    HeroTitleWidget,
                    PricingCardWidget,
                    CallToActionWidget,
                    ComparisonWidget,
                    TarifLocationWidget,
                    FeatureGridWidget
                ];
                
                // Charger les widgets disponibles (base + personnalis√©s)
                this.availableWidgets = this.loadAvailableWidgets();
                
                // Syst√®me de dossiers et de recherche
                this.currentFolder = 'root';
                this.searchTerm = '';
                this.folders = {
                    root: { name: 'Tous les widgets', widgets: [], type: 'system' },
                    favorites: { name: 'Favoris', widgets: [], type: 'system' },
                    recent: { name: 'R√©cents', widgets: [], type: 'system' }
                };
                // savedProjects supprim√© - Focus uniquement sur les widgets
                this.recentWidgets = new Set();
                this.favoriteWidgets = new Set();
                
                this.widgetCategories = {
                    'Navigation': [],
                    'Contenu': [],
                    'M√©dias': [],
                    'Commerce': [],
                    'Action': []
                };
                
                this.init();
            }

            init() {
                this.setupWidgetCategories();
                this.setupEventListeners();
                this.renderWidgetLibrary();
                this.updatePreview();
                
                // Restaurer l'√©tat pr√©c√©dent si disponible
                this.restoreState();
                
                // Initialiser l'indicateur de largeur du panneau
                this.updateWidthIndicator();
                
                this.setStatus('√âditeur pr√™t', 'success');
            }

            // R√¥le      : Charger tous les widgets disponibles (classes de base + widgets personnalis√©s)
            // Type      : function
            // Unit√©     : sans unit√©
            // Formule   : widgets_disponibles = widgets_base + widgets_personnalis√©s_localStorage
            // Exemple   : [LogoWidget, HeroTitleWidget, MonLogoPersonnalis√©, MonTitreCustom]
            loadAvailableWidgets() {
                // Commencer avec les widgets de base
                let widgets = [...this.baseWidgets];
                
                // Ajouter les widgets personnalis√©s depuis localStorage
                const customWidgets = JSON.parse(localStorage.getItem('customWidgets') || '[]');
                
                customWidgets.forEach(customWidget => {
                    // Cr√©er une classe dynamique pour le widget personnalis√©
                    const CustomWidgetClass = class extends (this.baseWidgets.find(w => new w().id === customWidget.originalType)) {
                        constructor() {
                            super();
                            this.id = customWidget.id;
                            this.name = customWidget.name;
                            this.description = `Widget personnalis√© bas√© sur ${customWidget.originalType}`;
                            this.category = 'Personnalis√©s';
                            this.isCustom = true;
                            this.customId = customWidget.id;
                            this.originalType = customWidget.originalType;
                            
                            // Remplacer les donn√©es par d√©faut par celles du widget personnalis√©
                            this.defaultData = { ...customWidget.data };
                        }
                        
                        // Permettre la suppression depuis la biblioth√®que
                        getActions() {
                            return [
                                {
                                    icon: 'fas fa-trash text-red-400',
                                    action: () => widgetEditor.deleteCustomWidget(this.customId),
                                    title: 'Supprimer ce widget personnalis√©'
                                }
                            ];
                        }
                    };
                    
                    widgets.push(CustomWidgetClass);
                });
                
                return widgets;
            }

            setupWidgetCategories() {
                this.availableWidgets.forEach(WidgetClass => {
                    const instance = new WidgetClass();
                    if (!this.widgetCategories[instance.category]) {
                        this.widgetCategories[instance.category] = [];
                    }
                    this.widgetCategories[instance.category].push(instance);
                });
            }

            // R√¥le      : Obtenir la largeur actuelle du panneau propri√©t√©s
            // Type      : function
            // Unit√©     : pixels (avec unit√© 'px')
            // Formule   : largeur = propertiesPanel.style.width || variable_CSS || d√©faut
            // Exemple   : '350px'
            getCurrentPropertiesWidth() {
                const propertiesPanel = document.querySelector('.properties-panel');
                if (propertiesPanel) {
                    // Priorit√© 1: largeur directement appliqu√©e au style
                    if (propertiesPanel.style.width) {
                        console.log(`üìè Largeur depuis style.width: ${propertiesPanel.style.width}`);
                        return propertiesPanel.style.width;
                    }
                    
                    // Priorit√© 2: variable CSS custom
                    const cssVar = getComputedStyle(document.documentElement).getPropertyValue('--properties-width').trim();
                    if (cssVar) {
                        console.log(`üìè Largeur depuis CSS var: ${cssVar}`);
                        return cssVar;
                    }
                    
                    // Priorit√© 3: largeur calcul√©e actuelle
                    const offsetWidth = `${propertiesPanel.offsetWidth}px`;
                    console.log(`üìè Largeur depuis offsetWidth: ${offsetWidth}`);
                    return offsetWidth;
                }
                
                // D√©faut si aucun panneau trouv√©
                console.log('üìè Largeur par d√©faut: 300px');
                return '300px';
            }

            // R√¥le      : Restaurer la largeur du panneau propri√©t√©s
            // Type      : function
            // Unit√©     : pixels (string avec 'px')
            // Formule   : application compl√®te largeur = variable_CSS + style_direct + grid + indicateur
            // Exemple   : restorePropertiesWidth('420px')
            restorePropertiesWidth(width) {
                const propertiesPanel = document.querySelector('.properties-panel');
                const widgetEditor = document.querySelector('.widget-editor');
                
                if (!propertiesPanel || !widgetEditor || !width) {
                    console.warn('‚ùå restorePropertiesWidth: √âl√©ments manquants', {propertiesPanel, widgetEditor, width});
                    return;
                }
                
                // Extraire la valeur num√©rique (enlever 'px' si pr√©sent)
                const numericWidth = parseInt(width);
                const widthWithPx = `${numericWidth}px`;
                
                console.log(`üîß Restauration largeur: ${width} ‚Üí ${widthWithPx}`);
                
                // 1. D√©finir la variable CSS custom
                document.documentElement.style.setProperty('--properties-width', widthWithPx);
                
                // 2. Appliquer le style direct au panneau
                propertiesPanel.style.width = widthWithPx;
                
                // 3. Mettre √† jour le grid layout principal
                widgetEditor.style.gridTemplateColumns = `280px 1fr ${widthWithPx}`;
                
                // 4. Force un reflow pour s'assurer que les changements sont appliqu√©s
                propertiesPanel.offsetWidth;
                
                // 5. Mettre √† jour l'indicateur de largeur apr√®s le reflow
                setTimeout(() => {
                    const widthIndicator = document.querySelector('.properties-width-indicator');
                    if (widthIndicator) {
                        widthIndicator.textContent = widthWithPx;
                    }
                    console.log(`‚úÖ Largeur appliqu√©e: ${widthWithPx}`);
                }, 10);
            }

            // R√¥le      : Mettre √† jour l'indicateur de largeur du panneau
            // Type      : function
            // Unit√©     : sans unit√©
            // Formule   : indicateur.textContent = largeur_actuelle
            // Exemple   : Met √† jour l'indicateur avec '420px'
            updateWidthIndicator() {
                const widthIndicator = document.querySelector('.properties-width-indicator');
                if (widthIndicator) {
                    const currentWidth = this.getCurrentPropertiesWidth();
                    widthIndicator.textContent = currentWidth;
                }
            }

            // R√¥le      : Sauvegarder automatiquement l'√©tat actuel de l'√©diteur
            // Type      : function
            // Unit√©     : sans unit√©
            // Formule   : localStorage = JSON.stringify(√©tat_complet)
            // Exemple   : Sauvegarde widgets, panneau, s√©lection dans le localStorage
            autoSave() {
                try {
                    const state = {
                        // √âtat des widgets
                        widgets: this.widgets.map(widget => ({
                            id: widget.id,
                            type: widget.type,
                            data: widget.data,
                            position: widget.position,
                            size: widget.size
                        })),
                        
                        // Widget s√©lectionn√©
                        selectedWidgetId: this.selectedWidget ? this.selectedWidget.id : null,
                        
                        // Largeur du panneau propri√©t√©s
                        propertiesWidth: this.getCurrentPropertiesWidth(),
                        
                        // √âtat de l'interface
                        currentFolder: this.currentFolder,
                        searchTerm: this.searchTerm,
                        favoriteWidgets: Array.from(this.favoriteWidgets),
                        recentWidgets: Array.from(this.recentWidgets),
                        
                        // Timestamp de sauvegarde
                        savedAt: Date.now()
                    };
                    
                    localStorage.setItem('widgetEditor_autoSave', JSON.stringify(state));
                } catch (error) {
                    console.warn('Erreur lors de la sauvegarde automatique:', error);
                }
            }

            // R√¥le      : Restaurer l'√©tat pr√©c√©demment sauvegard√©
            // Type      : function  
            // Unit√©     : sans unit√©
            // Formule   : √©tat_restaur√© = JSON.parse(localStorage)
            // Exemple   : Recharge widgets, panneau, s√©lection depuis localStorage
            restoreState() {
                try {
                    const savedState = localStorage.getItem('widgetEditor_autoSave');
                    if (!savedState) return;
                    
                    const state = JSON.parse(savedState);
                    
                    // Restaurer PREMI√àREMENT la largeur du panneau propri√©t√©s
                    // pour √©viter qu'elle soit r√©initialis√©e lors de la s√©lection
                    if (state.propertiesWidth) {
                        this.restorePropertiesWidth(state.propertiesWidth);
                    }
                    
                    // Restaurer les widgets
                    if (state.widgets && state.widgets.length > 0) {
                        this.widgets = [];
                        
                        state.widgets.forEach(widgetData => {
                            const WidgetClass = this.availableWidgets.find(w => new w().id === widgetData.type);
                            if (WidgetClass) {
                                const widget = {
                                    id: widgetData.id,
                                    type: widgetData.type,
                                    data: widgetData.data || {},
                                    position: widgetData.position || { col: 1, row: 1 },
                                    size: widgetData.size || { width: 3, height: 2 },
                                    instance: new WidgetClass()
                                };
                                this.widgets.push(widget);
                            }
                        });
                        
                        // Re-rendre la grille avec les widgets restaur√©s
                        this.renderCanvas();
                        
                        // Restaurer la s√©lection
                        if (state.selectedWidgetId) {
                            this.selectWidget(state.selectedWidgetId);
                        }
                        
                        
                        // Masquer l'√©tat vide
                        const emptyState = document.getElementById('emptyState');
                        if (emptyState) {
                            emptyState.classList.add('hidden');
                            emptyState.style.display = 'none';
                        }
                    }
                    
                    // Restaurer l'√©tat de l'interface
                    if (state.currentFolder) this.currentFolder = state.currentFolder;
                    if (state.searchTerm) this.searchTerm = state.searchTerm;
                    if (state.favoriteWidgets) this.favoriteWidgets = new Set(state.favoriteWidgets);
                    if (state.recentWidgets) this.recentWidgets = new Set(state.recentWidgets);
                    
                } catch (error) {
                    console.warn('Erreur lors de la restauration:', error);
                }
            }

            setupEventListeners() {
                // Boutons principaux (utilisation directe des widgets)
                document.getElementById('addWidgetBtn').addEventListener('click', () => this.addWidget('hero-title'));
                document.getElementById('firstWidgetBtn').addEventListener('click', () => this.addWidget('hero-title'));
                // √âv√©nements de projet supprim√©s - Focus uniquement sur les widgets
                
                // Onglets propri√©t√©s
                document.querySelectorAll('.properties-tab').forEach(tab => {
                    tab.addEventListener('click', () => this.switchPropertiesTab(tab.dataset.tab));
                });
                
                // Boutons organisation
                document.getElementById('duplicateBtn').addEventListener('click', () => this.duplicateWidget());
                document.getElementById('deleteBtn').addEventListener('click', () => this.deleteWidget());
                
                // Boutons widgets personnalis√©s
                document.getElementById('saveCustomWidgetBtn').addEventListener('click', () => this.saveCustomWidget());
                document.getElementById('updateCustomWidgetBtn').addEventListener('click', () => this.updateCustomWidget());
                
                // Boutons pr√©r√©glages de taille
                document.getElementById('fullScreenBtn').addEventListener('click', () => this.setFullScreen());
                document.getElementById('fillParentBtn').addEventListener('click', () => this.fillParent());
                
                // Recherche et navigation par dossiers
                const searchInput = document.getElementById('widgetSearch');
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => this.handleSearch(e.target.value));
                }
                
                // Gestion des dossiers
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.folder-item')) {
                        const folderItem = e.target.closest('.folder-item');
                        const folderId = folderItem.dataset.folder;
                        if (folderId) {
                            this.selectFolder(folderId);
                        }
                    }
                });
                
                // Cr√©ation de dossier
                const createFolderBtn = document.getElementById('createFolderBtn');
                if (createFolderBtn) {
                    createFolderBtn.addEventListener('click', () => this.createNewFolder());
                }
                
                // Chargement des donn√©es locales
                this.loadLocalData();
                
                // Refresh preview
                document.getElementById('refreshPreviewBtn').addEventListener('click', () => this.updatePreview());
                
                // Pr√©visualisation plein √©cran
                document.getElementById('fullscreenPreviewBtn').addEventListener('click', () => this.openFullscreenPreview());
                document.getElementById('closePreviewBtn').addEventListener('click', () => this.closeFullscreenPreview());
                
                // Ajouter bouton d'export vers viewer
                this.createExportButton();
                
                // Initialiser l'onglet Viewer
                this.initializeViewerConfig();
                
                // Fermer la popup avec √âchap
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.closeFullscreenPreview();
                    }
                });
                
                // Syst√®me de redimensionnement du panneau propri√©t√©s
                this.setupPropertiesResize();
                
                // Bouton de collapse du panneau propri√©t√©s
                document.getElementById('collapsePropertiesBtn').addEventListener('click', () => this.togglePropertiesPanel());
                
                // Event pour clic sur workspace (d√©s√©lection)
                const workspace = document.getElementById('canvasWorkspace');
                if (workspace) {
                    workspace.addEventListener('click', (e) => {
                        if (e.target === workspace) {
                            this.selectWidget(null);
                        }
                    });
                }
            }

            // Nouvelle m√©thode : rendu de la biblioth√®que avec dossiers
            renderWidgetLibrary() {
                // Recharger les widgets disponibles pour inclure les nouveaux widgets personnalis√©s
                this.availableWidgets = this.loadAvailableWidgets();
                
                // R√©initialiser les cat√©gories
                this.widgetCategories = {};
                this.setupWidgetCategories();
                
                this.updateFolderStructure();
                this.renderCurrentFolder();
                // loadSavedProjects() supprim√© - Focus uniquement sur les widgets
            }
            
            // Mise √† jour de la structure des dossiers
            updateFolderStructure() {
                // Mettre √† jour les compteurs
                const totalWidgetCountEl = document.getElementById('totalWidgetCount');
                if (totalWidgetCountEl) {
                    totalWidgetCountEl.textContent = this.availableWidgets.length;
                }
                
                // R√©partir les widgets dans les dossiers
                this.folders.root.widgets = this.availableWidgets;
                this.folders.favorites.widgets = this.availableWidgets.filter(w => this.favoriteWidgets.has(w.id));
                this.folders.recent.widgets = Array.from(this.recentWidgets).map(id => 
                    this.availableWidgets.find(w => w.id === id)).filter(Boolean);
                    
                // Mettre √† jour les compteurs dans l'UI
                const favoritesCountEl = document.querySelector('.folder-item[data-folder="favorites"] .folder-count');
                if (favoritesCountEl) {
                    favoritesCountEl.textContent = this.folders.favorites.widgets.length || '0';
                }
                const recentCountEl = document.querySelector('.folder-item[data-folder="recent"] .folder-count');
                if (recentCountEl) {
                    recentCountEl.textContent = this.folders.recent.widgets.length || '0';
                }
            }
            
            // Rendu du dossier actuel
            renderCurrentFolder() {
                const content = document.getElementById('widgetContent');
                if (!content) return;
                
                const currentFolderData = this.folders[this.currentFolder];
                
                if (!currentFolderData) {
                    content.innerHTML = '<div style="padding: 1rem; color: var(--text-muted);">Dossier introuvable</div>';
                    return;
                }
                
                content.innerHTML = '';
                
                if (this.currentFolder === 'root') {
                    // Afficher par cat√©gories pour "Tous les widgets"
                    Object.entries(this.widgetCategories).forEach(([category, widgets]) => {
                        if (widgets.length === 0) return;
                        
                        const categoryDiv = document.createElement('div');
                        categoryDiv.className = 'widget-category';
                        
                        const categoryTitle = document.createElement('div');
                        categoryTitle.className = 'category-title';
                        categoryTitle.textContent = category;
                        categoryDiv.appendChild(categoryTitle);
                        
                        widgets.forEach(widget => {
                            const widgetItem = this.createWidgetItem(widget);
                            categoryDiv.appendChild(widgetItem);
                        });
                        
                        content.appendChild(categoryDiv);
                    });
                } else {
                    // Afficher les widgets du dossier s√©lectionn√©
                    const widgets = currentFolderData.widgets;
                    if (widgets.length === 0) {
                        content.innerHTML = `
                            <div style="padding: 2rem; text-align: center; color: var(--text-muted);">
                                <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                                <div>Aucun widget dans ce dossier</div>
                            </div>
                        `;
                        return;
                    }
                    
                    widgets.forEach(widget => {
                        const widgetItem = this.createWidgetItem(widget);
                        content.appendChild(widgetItem);
                    });
                }
            }

            createWidgetItem(widget) {
                const item = document.createElement('div');
                item.className = 'widget-item';
                item.dataset.widgetType = widget.id;
                
                const isFavorite = this.favoriteWidgets.has(widget.id);
                const isRecent = this.recentWidgets.has(widget.id);
                
                // G√©n√©rer les actions personnalis√©es si disponibles
                let customActionsHtml = '';
                if (widget.getActions && typeof widget.getActions === 'function') {
                    const actions = widget.getActions();
                    actions.forEach(action => {
                        customActionsHtml += `
                            <button class="btn btn-sm" onclick="event.stopPropagation(); (${action.action.toString()})()" title="${action.title}">
                                <i class="${action.icon}"></i>
                            </button>
                        `;
                    });
                }
                
                // Marquer visuellement les widgets personnalis√©s
                const customBadge = widget.isCustom ? '<div class="widget-custom-badge" title="Widget personnalis√©"><i class="fas fa-user"></i></div>' : '';
                
                item.innerHTML = `
                    <div class="widget-icon">
                        <i class="${widget.icon || 'fas fa-puzzle-piece'}"></i>
                        ${customBadge}
                    </div>
                    <div class="widget-info">
                        <div class="widget-name">${widget.name}</div>
                        <div class="widget-description">${widget.description}</div>
                    </div>
                    <div class="widget-actions">
                        ${customActionsHtml}
                        <button class="btn btn-sm" onclick="event.stopPropagation(); widgetEditor.toggleFavorite('${widget.id}')" 
                                title="${isFavorite ? 'Retirer des favoris' : 'Ajouter aux favoris'}">
                            <i class="fas fa-star" style="color: ${isFavorite ? '#fbbf24' : 'var(--text-muted)'}"></i>
                        </button>
                        <button class="btn btn-sm" onclick="event.stopPropagation(); widgetEditor.addWidget('${widget.id}')" title="Ajouter">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                `;
                
                // Clic sur l'item entier = ajouter le widget
                item.addEventListener('click', (e) => {
                    if (!e.target.closest('.widget-actions')) {
                        this.addWidget(widget.id);
                    }
                });
                
                return item;
            }

            // M√©thode showAddWidgetDialog supprim√©e - utilisation directe de addWidget dans les √©v√©nements

            addWidget(widgetType) {
                const WidgetClass = this.availableWidgets.find(w => new w().id === widgetType);
                if (!WidgetClass) return;
                
                // Ajouter aux r√©cents
                this.addToRecent(widgetType);
                
                const widgetInstance = new WidgetClass();
                
                // R√¥le      : V√©rifier s'il s'agit d'un widget personnalis√© pour restaurer ses propri√©t√©s
                // Type      : boolean check et object retrieval
                // Unit√©     : sans unit√©
                // Exemple   : Widget "Mon Logo" avec size: {width: 6, height: 4}, position: {col: 2, row: 1}
                let customWidget = null;
                if (widgetInstance.isCustom && widgetInstance.customId) {
                    const customWidgets = JSON.parse(localStorage.getItem('customWidgets') || '[]');
                    customWidget = customWidgets.find(w => w.id === widgetInstance.customId);
                }
                
                // Position sera d√©finie apr√®s la taille
                let position;
                
                // D√©finir une taille par d√©faut selon le type de widget ou restaurer depuis le widget personnalis√©
                let defaultSize = { width: 3, height: 2 };
                
                // Si c'est un widget personnalis√©, utiliser ses dimensions sauvegard√©es
                if (customWidget && customWidget.size) {
                    defaultSize = customWidget.size;
                } else {
                switch (widgetType) {
                    case 'feature-grid':
                        defaultSize = { width: 8, height: 4 }; // Plus large pour √©viter le crop
                        break;
                    case 'hero-title':
                        defaultSize = { width: 6, height: 3 };
                        break;
                    case 'pricing-card':
                        defaultSize = { width: 4, height: 4 };
                        break;
                    case 'call-to-action':
                        defaultSize = { width: 8, height: 2 };
                        break;
                    case 'comparison':
                        defaultSize = { width: 12, height: 6 };
                        break;
                    case 'logo':
                        defaultSize = { width: 2, height: 1 };
                        break;
                    default:
                        defaultSize = { width: 3, height: 2 };
                }
                }
                
                // Trouver une position libre avec la taille appropri√©e (centre vers l'ext√©rieur)
                // ou utiliser la position sauvegard√©e pour les widgets personnalis√©s
                if (customWidget && customWidget.position) {
                    position = customWidget.position;
                } else {
                    position = this.findFreeGridPosition(defaultSize.width, defaultSize.height);
                }
                
                // R√¥le      : Cr√©er l'objet widgetData avec toutes les propri√©t√©s restaur√©es
                // Type      : object creation
                // Unit√©     : sans unit√©  
                // Formule   : widget = donn√©es_par_d√©faut + propri√©t√©s_personnalis√©es_si_pr√©sentes
                // Exemple   : Widget personnalis√© avec data, size, position, elements, organization restaur√©es
                const widgetData = {
                    id: `widget-${Date.now()}`,
                    type: widgetType,
                    instance: widgetInstance,
                    data: customWidget ? { ...customWidget.data } : { ...widgetInstance.defaultData },
                    position: position,
                    size: defaultSize
                };
                
                // Restaurer les propri√©t√©s suppl√©mentaires des widgets personnalis√©s
                if (customWidget) {
                    // Restaurer les √©l√©ments personnalis√©s si pr√©sents
                    if (customWidget.elements) {
                        widgetData.elements = customWidget.elements;
                    }
                    
                    // Restaurer les propri√©t√©s d'organisation si pr√©sentes
                    if (customWidget.organization) {
                        widgetData.organization = customWidget.organization;
                    }
                    
                    // Marquer comme widget personnalis√© pour permettre la suppression
                    widgetData.isCustom = true;
                    widgetData.customName = customWidget.name;
                    widgetData.customId = customWidget.id;
                }
                
                this.widgets.push(widgetData);
                // Historique supprim√©
                this.renderCanvas();
                this.selectWidget(widgetData.id);
                this.updatePreview();
                
                // Masquer l'√©tat vide
                const emptyState = document.getElementById('emptyState');
                if (emptyState) {
                    emptyState.classList.add('hidden');
                    emptyState.style.display = 'none';
                }
                
                document.getElementById('widgetCount').textContent = this.widgets.length;
                
                // Mettre √† jour le conteneur arri√®re-plan si activ√©
                this.updateBackgroundContainer();
                
                this.setStatus(`Widget ${widgetInstance.name} ajout√©`, 'success');
                
                // Sauvegarde automatique apr√®s ajout du widget
                this.autoSave();
            }

            renderCanvas() {
                const workspace = document.getElementById('canvasWorkspace');
                const emptyState = document.getElementById('emptyState');
                
                // Toujours supprimer les widgets existants du DOM en premier
                workspace.querySelectorAll('.widget-container').forEach(w => w.remove());
                
                if (this.widgets.length === 0) {
                    emptyState.classList.remove('hidden');
                    emptyState.style.display = 'flex';
                    return;
                }
                
                emptyState.classList.add('hidden');
                emptyState.style.display = 'none';
                
                this.widgets.forEach((widget, index) => {
                    const container = this.createWidgetContainer(widget, index);
                    workspace.appendChild(container);
                });
            }

            createWidgetContainer(widget, index) {
                const container = document.createElement('div');
                container.className = 'widget-container';
                container.dataset.widgetId = widget.id;
                
                // Position sur la grille
                const pos = widget.position || { col: 1, row: 1 };
                const size = widget.size || { width: 3, height: 2 };
                
                container.style.gridColumnStart = pos.col;
                container.style.gridColumnEnd = pos.col + size.width;
                container.style.gridRowStart = pos.row;
                container.style.gridRowEnd = pos.row + size.height;
                
                const headerContent = `
                    <div class="widget-header-title">
                        <span>${widget.instance.icon}</span>
                        <span>${widget.instance.name}</span>
                    </div>
                    <div class="widget-header-controls">
                        <button class="widget-control-btn" onclick="widgetEditor.duplicateWidget('${widget.id}')" title="Dupliquer">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button class="widget-control-btn" onclick="widgetEditor.deleteWidget('${widget.id}')" title="Supprimer">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                container.innerHTML = `
                    <div class="widget-container-header">${headerContent}</div>
                    <div class="widget-content" style="flex: 1;">${widget.instance.render(widget.data)}</div>
                `;
                
                // Events
                container.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.selectWidget(widget.id);
                });
                
                // Drag & drop pour placement libre
                this.setupDragDrop(container, widget);
                
                return container;
            }

            selectWidget(widgetId) {
                // D√©s√©lectionner l'ancien
                document.querySelectorAll('.widget-container.selected').forEach(w => {
                    w.classList.remove('selected');
                });
                
                if (widgetId) {
                    // S√©lectionner le nouveau
                    const container = document.querySelector(`[data-widget-id="${widgetId}"]`);
                    if (container) {
                        container.classList.add('selected');
                        this.selectedWidget = this.widgets.find(w => w.id === widgetId);
                        this.updatePropertiesPanel();
                    }
                } else {
                    // D√©s√©lection
                    this.selectedWidget = null;
                    this.updatePropertiesPanel();
                }
                
                // Mise √† jour de l'indicateur de largeur apr√®s s√©lection
                this.updateWidthIndicator();
                
                // Sauvegarde automatique apr√®s s√©lection/d√©s√©lection
                this.autoSave();
            }

            updatePropertiesPanel() {
                if (!this.selectedWidget) {
                    document.getElementById('propertiesTab').innerHTML = `
                        <div class="properties-empty">
                            <i class="fas fa-info-circle" style="font-size: 2rem; opacity: 0.3; margin-bottom: 1rem;"></i>
                            <p>S√©lectionnez un widget pour voir ses propri√©t√©s</p>
                        </div>
                    `;
                    return;
                }
                
                const widget = this.selectedWidget;
                const fields = widget.instance.getEditableFields();
                
                let propertiesHtml = `
                    <div class="property-group">
                        <h4><i class="fas fa-info-circle"></i> Informations</h4>
                        <div style="color: var(--text-muted); margin-bottom: 1rem;">
                            Type: ${widget.instance.name}<br>
                            ID: ${widget.id}
                        </div>
                    </div>
                    
                    <div class="property-group">
                        <h4><i class="fas fa-sliders-h"></i> Propri√©t√©s</h4>
                `;
                
                fields.forEach(field => {
                    propertiesHtml += this.createPropertyField(field, widget);
                });
                
                propertiesHtml += '</div>';
                
                document.getElementById('propertiesTab').innerHTML = propertiesHtml;
                
                // Update elements tab
                this.updateElementsTab();
                
                // Activer les contr√¥les de l'onglet Organisation
                this.updateOrganizationControls();
            }

            createPropertyField(field, widget) {
                // R√¥le      : Obtenir la valeur de la propri√©t√© (donn√©e actuelle ou d√©faut)
                // Type      : any
                // Formule   : valeur = widget.data[nom] ?? field.defaultValue
                // Exemple   : imagePath = widget.data.imagePath ?? '../assets/logo.png'
                const value = widget.data[field.name] !== undefined ? widget.data[field.name] : field.defaultValue;
                const fieldId = `prop-${field.name}`;
                
                let inputHtml = '';
                
                switch (field.type) {
                    case 'text':
                        inputHtml = `
                            <input type="text" id="${fieldId}" class="property-input" 
                                   value="${value}" 
                                   onchange="widgetEditor.updateProperty('${field.name}', this.value)"
                                   oninput="widgetEditor.updateProperty('${field.name}', this.value)">
                        `;
                        break;
                        
                    case 'textarea':
                        inputHtml = `
                            <textarea id="${fieldId}" class="property-input" rows="3"
                                      onchange="widgetEditor.updateProperty('${field.name}', this.value)"
                                      oninput="widgetEditor.updateProperty('${field.name}', this.value)">${value}</textarea>
                        `;
                        break;
                        
                    case 'range':
                        inputHtml = `
                            <div class="property-control">
                                <input type="range" id="${fieldId}" class="property-range" 
                                       min="${field.min || 0}" max="${field.max || 100}" value="${value}"
                                       oninput="widgetEditor.updateProperty('${field.name}', this.value)"
                                       onchange="widgetEditor.updateProperty('${field.name}', this.value)">
                                <span class="range-value" id="${fieldId}-value">${value}</span>
                            </div>
                        `;
                        break;
                        
                    case 'checkbox':
                        inputHtml = `
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                <input type="checkbox" id="${fieldId}" ${value ? 'checked' : ''} 
                                       onchange="widgetEditor.updateProperty('${field.name}', this.checked)">
                                <span>Activ√©</span>
                            </label>
                        `;
                        break;
                        
                    case 'select':
                        const options = field.options.map(opt => 
                            `<option value="${opt.value}" ${opt.value === value ? 'selected' : ''}>${opt.label}</option>`
                        ).join('');
                        inputHtml = `
                            <select id="${fieldId}" class="property-input" 
                                    onchange="widgetEditor.updateProperty('${field.name}', this.value)"
                                    oninput="widgetEditor.updateProperty('${field.name}', this.value)">
                                ${options}
                            </select>
                        `;
                        break;
                        
                    case 'color':
                        /* 
                        # R√¥le      : G√©n√©ration HTML pour contr√¥le de couleur vertical
                        # Type      : string (HTML)
                        # Unit√©     : sans unit√©
                        # Formule   : bouton_couleur + champ_hexadecimal en colonne
                        # Exemple   : bouton 40px au-dessus, puis input hex en dessous
                        */
                        inputHtml = `
                            <div class="property-color-control">
                                <input type="color" id="${fieldId}" value="${value}" 
                                       onchange="widgetEditor.updateProperty('${field.name}', this.value)"
                                       oninput="widgetEditor.updateProperty('${field.name}', this.value)"
                                       title="Cliquer pour ouvrir le s√©lecteur de couleur">
                                <input type="text" class="property-input" 
                                       value="${value}" 
                                       onchange="widgetEditor.updateProperty('${field.name}', this.value)"
                                       oninput="widgetEditor.updateProperty('${field.name}', this.value)"
                                       placeholder="#FFFFFF"
                                       title="Code hexad√©cimal de la couleur">
                            </div>
                        `;
                        break;
                        
                    default:
                        inputHtml = `
                            <input type="text" id="${fieldId}" class="property-input" 
                                   value="${value}" 
                                   onchange="widgetEditor.updateProperty('${field.name}', this.value)"
                                   oninput="widgetEditor.updateProperty('${field.name}', this.value)">
                        `;
                }
                
                return `
                    <div class="property-field">
                        <label class="property-label" for="${fieldId}">${field.label}</label>
                        ${inputHtml}
                    </div>
                `;
            }

            updateElementsTab() {
                if (!this.selectedWidget) {
                    document.getElementById('elementsContainer').innerHTML = `
                        <p style="color: var(--text-muted); font-style: italic;">Aucun widget s√©lectionn√©</p>
                    `;
                    return;
                }
                
                const elements = this.selectedWidget.instance.getElements();
                let elementsHtml = '';
                
                elements.forEach(element => {
                    const isPricingFeatures = element.id === 'features' && this.selectedWidget.type === 'pricing-card';
                    const isGridFeatures = element.id === 'features' && this.selectedWidget.type === 'feature-grid';
                    const isObsoleteColumn = element.id === 'obsolete-column' && this.selectedWidget.type === 'comparison';
                    const isModernColumn = element.id === 'modern-column' && this.selectedWidget.type === 'comparison';
                    const isPlan1Features = element.id === 'plan1-features' && this.selectedWidget.type === 'tarif-location';
                    const isPlan2Features = element.id === 'plan2-features' && this.selectedWidget.type === 'tarif-location';
                    const isPlan3Features = element.id === 'plan3-features' && this.selectedWidget.type === 'tarif-location';
                    const isCallToActionAdvantages = element.id === 'advantages' && this.selectedWidget.type === 'call-to-action';
                    
                    if (isPricingFeatures) {
                        // Interface sp√©ciale pour les fonctionnalit√©s du Pricing Card
                        const features = this.selectedWidget.data.features || [];
                        
                        elementsHtml += `
                            <div class="element-item" style="padding: 12px; background: var(--bg-card); 
                                                            border-radius: 8px; margin-bottom: 8px;">
                                <div style="margin-bottom: 12px;">
                                    <div style="color: white; font-weight: 500; margin-bottom: 8px;">
                                        <i class="fas fa-list"></i> ${element.name} (${features.length})
                                    </div>
                                    <div style="color: var(--text-muted); font-size: 12px;">Gestion dynamique des fonctionnalit√©s</div>
                                </div>
                                
                                <div class="features-manager" style="margin-bottom: 12px;">
                                    <div class="feature-input-group" style="display: flex; gap: 8px; margin-bottom: 12px;">
                                        <input type="text" id="newFeatureInput" placeholder="‚úì Nouvelle fonctionnalit√©..." 
                                               style="flex: 1; padding: 8px 12px; background: var(--bg-primary); 
                                                      border: 1px solid var(--border-color); border-radius: 6px; 
                                                      color: var(--text-white); font-size: 14px;">
                                        <button onclick="widgetEditor.addFeatureToSelected()" 
                                                style="padding: 8px 16px; background: var(--accent-green); 
                                                       color: white; border: none; border-radius: 6px; 
                                                       cursor: pointer; font-size: 14px; font-weight: 500;">
                                            <i class="fas fa-plus"></i> Ajouter
                                        </button>
                                    </div>
                                    
                                    <div class="features-list" style="max-height: 200px; overflow-y: auto;">
                                        ${features.map((feature, index) => `
                                            <div class="feature-item" style="display: flex; align-items: center; gap: 8px; 
                                                                           padding: 8px 12px; background: rgba(16, 185, 129, 0.1); 
                                                                           border: 1px solid rgba(16, 185, 129, 0.3); 
                                                                           border-radius: 6px; margin-bottom: 6px;">
                                                <span style="color: var(--accent-green); font-weight: bold; min-width: 16px;">‚úì</span>
                                                <input type="text" value="${feature}" 
                                                       onchange="widgetEditor.updateFeatureAtIndex(${index}, this.value)"
                                                       oninput="widgetEditor.updateFeatureAtIndex(${index}, this.value)"
                                                       style="flex: 1; background: transparent; border: none; 
                                                              color: var(--text-white); font-size: 14px; outline: none;">
                                                <button onclick="widgetEditor.removeFeatureAtIndex(${index})" 
                                                        title="Supprimer cette fonctionnalit√©"
                                                        style="background: rgba(239, 68, 68, 0.2); color: var(--danger-red); 
                                                               border: 1px solid var(--danger-red); border-radius: 4px; 
                                                               width: 24px; height: 24px; cursor: pointer; font-size: 12px;">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        `;
                    } else if (isGridFeatures) {
                        // Interface sp√©ciale pour les fonctionnalit√©s de la Grille
                        const features = this.selectedWidget.data.features || [];
                        const featuresCount = this.selectedWidget.data.featuresCount || 4;
                        
                        elementsHtml += `
                            <div class="element-item" style="padding: 12px; background: var(--bg-card); 
                                                            border-radius: 8px; margin-bottom: 8px;">
                                <div style="margin-bottom: 12px;">
                                    <div style="color: white; font-weight: 500; margin-bottom: 8px;">
                                        <i class="fas fa-th-large"></i> ${element.name} (${featuresCount} actives sur ${features.length} disponibles)
                                    </div>
                                    <div style="color: var(--text-muted); font-size: 12px;">√âdition avanc√©e des fonctionnalit√©s avec ic√¥nes</div>
                                </div>
                                
                                <div class="features-manager" style="margin-bottom: 12px;">
                                    <div class="feature-actions" style="display: flex; gap: 8px; margin-bottom: 12px;">
                                        <button onclick="widgetEditor.addFeatureToGrid()" 
                                                style="flex: 1; padding: 8px 16px; background: var(--accent-green); 
                                                       color: white; border: none; border-radius: 6px; 
                                                       cursor: pointer; font-size: 14px; font-weight: 500;">
                                            <i class="fas fa-plus"></i> Ajouter Fonctionnalit√©
                                        </button>
                                    </div>
                                    
                                    <div class="features-list" style="max-height: 300px; overflow-y: auto;">
                                        ${features.map((feature, index) => `
                                            <div class="feature-grid-item" style="padding: 12px; background: ${index < featuresCount ? 'rgba(16, 185, 129, 0.1)' : 'rgba(107, 114, 128, 0.1)'}; 
                                                                           border: 1px solid ${index < featuresCount ? 'rgba(16, 185, 129, 0.3)' : 'rgba(107, 114, 128, 0.3)'}; 
                                                                           border-radius: 8px; margin-bottom: 8px;">
                                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                                    <div style="display: flex; align-items: center; gap: 8px; flex: 1;">
                                                        <span style="color: var(--text-muted); font-size: 12px; font-weight: bold;">#${index + 1}</span>
                                                        <span style="color: ${index < featuresCount ? 'var(--accent-green)' : 'var(--text-muted)'}; font-weight: bold;">
                                                            ${index < featuresCount ? 'ACTIVE' : 'INACTIVE'}
                                                        </span>
                                                    </div>
                                                    <button onclick="widgetEditor.removeGridFeature(${index})" 
                                                            title="Supprimer cette fonctionnalit√©"
                                                            style="background: rgba(239, 68, 68, 0.2); color: var(--danger-red); 
                                                                   border: 1px solid var(--danger-red); border-radius: 4px; 
                                                                   width: 24px; height: 24px; cursor: pointer; font-size: 12px;">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                
                                                <div class="feature-fields">
                                                    <!-- Contenu Principal -->
                                                    <div style="display: grid; grid-template-columns: auto 1fr auto; gap: 8px; margin-bottom: 8px; align-items: center;">
                                                        <label style="color: var(--text-gray); font-size: 12px;">Ic√¥ne:</label>
                                                        <input type="text" value="${feature.icon || '‚≠ê'}" maxlength="2" 
                                                               onchange="widgetEditor.updateGridFeature(${index}, 'icon', this.value)"
                                                               oninput="widgetEditor.updateGridFeature(${index}, 'icon', this.value)"
                                                               style="padding: 6px 8px; background: var(--bg-primary); 
                                                                      border: 1px solid var(--border-color); border-radius: 4px; 
                                                                      color: var(--text-white); font-size: 16px; text-align: center; width: 50px;">
                                                        <select onchange="widgetEditor.updateGridFeature(${index}, 'iconSize', this.value)"
                                                                style="padding: 4px; background: var(--bg-primary); border: 1px solid var(--border-color); 
                                                                       border-radius: 4px; color: var(--text-white); font-size: 11px;">
                                                            <option value="2rem" ${(feature.iconSize || '3rem') === '2rem' ? 'selected' : ''}>Petite</option>
                                                            <option value="3rem" ${(feature.iconSize || '3rem') === '3rem' ? 'selected' : ''}>Normale</option>
                                                            <option value="4rem" ${(feature.iconSize || '3rem') === '4rem' ? 'selected' : ''}>Grande</option>
                                                        </select>
                                                    </div>
                                                    
                                                    <div style="display: grid; grid-template-columns: auto 1fr auto; gap: 8px; margin-bottom: 8px; align-items: center;">
                                                        <label style="color: var(--text-gray); font-size: 12px;">Titre:</label>
                                                        <input type="text" value="${feature.title || 'Titre'}" 
                                                               onchange="widgetEditor.updateGridFeature(${index}, 'title', this.value)"
                                                               oninput="widgetEditor.updateGridFeature(${index}, 'title', this.value)"
                                                               style="padding: 6px 8px; background: var(--bg-primary); 
                                                                      border: 1px solid var(--border-color); border-radius: 4px; 
                                                                      color: var(--text-white); font-size: 14px;">
                                                        <input type="color" value="${feature.titleColor?.replace('var(--text-white)', '#ffffff') || '#ffffff'}" 
                                                               onchange="widgetEditor.updateGridFeature(${index}, 'titleColor', this.value)"
                                                               style="width: 30px; height: 30px; border: none; border-radius: 4px; cursor: pointer;">
                                                    </div>
                                                    
                                                    <div style="display: grid; grid-template-columns: auto 1fr auto; gap: 8px; margin-bottom: 8px;">
                                                        <label style="color: var(--text-gray); font-size: 12px; align-self: start; padding-top: 6px;">Description:</label>
                                                        <textarea rows="2" placeholder="Description de la fonctionnalit√©"
                                                                  onchange="widgetEditor.updateGridFeature(${index}, 'description', this.value)"
                                                                  oninput="widgetEditor.updateGridFeature(${index}, 'description', this.value)"
                                                                  style="padding: 6px 8px; background: var(--bg-primary); 
                                                                         border: 1px solid var(--border-color); border-radius: 4px; 
                                                                         color: var(--text-white); font-size: 13px; resize: vertical; min-height: 40px;">${feature.description || 'Description'}</textarea>
                                                        <input type="color" value="${feature.descriptionColor?.replace('var(--text-gray)', '#94a3b8') || '#94a3b8'}" 
                                                               onchange="widgetEditor.updateGridFeature(${index}, 'descriptionColor', this.value)"
                                                               style="width: 30px; height: 30px; border: none; border-radius: 4px; cursor: pointer; align-self: start;">
                                                    </div>
                                                    
                                                    <!-- Couleurs de fond et bordure -->
                                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border-color);">
                                                        <div>
                                                            <label style="color: var(--text-gray); font-size: 11px; margin-bottom: 4px; display: block;">Fond:</label>
                                                            <input type="color" value="${feature.backgroundColor?.replace('var(--bg-card)', '#374151') || '#374151'}" 
                                                                   onchange="widgetEditor.updateGridFeature(${index}, 'backgroundColor', this.value)"
                                                                   style="width: 100%; height: 28px; border: 1px solid var(--border-color); border-radius: 4px; cursor: pointer;">
                                                        </div>
                                                        <div>
                                                            <label style="color: var(--text-gray); font-size: 11px; margin-bottom: 4px; display: block;">Bordure:</label>
                                                            <input type="color" value="${feature.borderColor?.replace('var(--border-color)', '#4b5563') || '#4b5563'}" 
                                                                   onchange="widgetEditor.updateGridFeature(${index}, 'borderColor', this.value)"
                                                                   style="width: 100%; height: 28px; border: 1px solid var(--border-color); border-radius: 4px; cursor: pointer;">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        `;
                    } else if (isObsoleteColumn) {
                        // Interface sp√©ciale pour la colonne obsol√®te (inconv√©nients)
                        const obsoleteDisadvantages = this.selectedWidget.data.obsoleteDisadvantages || [];
                        
                        elementsHtml += `
                            <div class="element-item" style="padding: 12px; background: var(--bg-card); 
                                                            border-radius: 8px; margin-bottom: 8px;">
                                <div style="margin-bottom: 12px;">
                                    <div style="color: #ef4444; font-weight: 500; margin-bottom: 8px;">
                                        <i class="fas fa-times-circle"></i> ${element.name} (${obsoleteDisadvantages.length})
                                    </div>
                                    <div style="color: var(--text-muted); font-size: 12px;">Gestion des inconv√©nients de l'ancienne technologie</div>
                                </div>
                                
                                <div class="disadvantages-manager" style="margin-bottom: 12px;">
                                    <div class="disadvantage-input-group" style="display: flex; gap: 8px; margin-bottom: 12px;">
                                        <input type="text" id="newObsoleteInput" placeholder="‚ö†Ô∏è Titre|Description du probl√®me..." 
                                               style="flex: 1; padding: 8px 12px; background: var(--bg-primary); 
                                                      border: 1px solid #ef4444; border-radius: 6px; 
                                                      color: var(--text-white); font-size: 14px;">
                                        <button onclick="widgetEditor.addObsoleteDisadvantage()" 
                                                style="padding: 8px 16px; background: #ef4444; 
                                                       color: white; border: none; border-radius: 6px; 
                                                       cursor: pointer; font-size: 14px; font-weight: 500;">
                                            <i class="fas fa-plus"></i> Ajouter
                                        </button>
                                    </div>
                                    
                                    <div class="disadvantages-list" style="max-height: 200px; overflow-y: auto;">
                                        ${obsoleteDisadvantages.map((item, index) => {
                                            // Support r√©trocompatibilit√© : si item est string, le convertir en objet
                                            const itemData = typeof item === 'string' ? { text: item, emoji: '‚ùå', color: '#ffffff' } : item;
                                            return `
                                            <div class="disadvantage-item" style="padding: 12px; background: rgba(239, 68, 68, 0.1); 
                                                                                   border: 1px solid rgba(239, 68, 68, 0.3); 
                                                                                   border-radius: 8px; margin-bottom: 12px;">
                                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                                    <input type="text" value="${itemData.emoji}" placeholder="üì±" 
                                                           onchange="widgetEditor.updateObsoleteDisadvantageEmoji(${index}, this.value)"
                                                           oninput="widgetEditor.updateObsoleteDisadvantageEmoji(${index}, this.value)"
                                                           style="width: 40px; background: rgba(0,0,0,0.3); border: 1px solid rgba(239, 68, 68, 0.5); 
                                                                  border-radius: 4px; color: var(--text-white); font-size: 16px; text-align: center; padding: 4px;"
                                                           title="Emoji ou caract√®re (ex: ‚ò†Ô∏è, üîß, ou logo)">
                                                    <input type="text" value="${itemData.text}" 
                                                           onchange="widgetEditor.updateObsoleteDisadvantageText(${index}, this.value)"
                                                           oninput="widgetEditor.updateObsoleteDisadvantageText(${index}, this.value)"
                                                           style="flex: 1; background: rgba(0,0,0,0.3); border: 1px solid rgba(239, 68, 68, 0.5); 
                                                                  border-radius: 4px; color: var(--text-white); font-size: 14px; padding: 6px;"
                                                           placeholder="Texte de l'inconv√©nient">
                                                    <button onclick="widgetEditor.removeObsoleteDisadvantage(${index})" 
                                                            title="Supprimer cet inconv√©nient"
                                                            style="background: rgba(239, 68, 68, 0.2); color: var(--danger-red); 
                                                                   border: 1px solid var(--danger-red); border-radius: 4px; 
                                                                   width: 28px; height: 28px; cursor: pointer; font-size: 12px;">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                <div style="display: flex; align-items: center; gap: 8px;">
                                                    <label style="color: var(--text-muted); font-size: 12px; min-width: 60px;">Couleur :</label>
                                                    <input type="color" value="${itemData.color || '#ffffff'}" 
                                                           onchange="widgetEditor.updateObsoleteDisadvantageColor(${index}, this.value)"
                                                           style="width: 40px; height: 24px; border-radius: 4px; border: none; cursor: pointer;">
                                                    <span style="color: var(--text-muted); font-size: 11px;">Couleur du texte</span>
                                                </div>
                                            </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            </div>
                        `;
                    } else if (isModernColumn) {
                        // Interface sp√©ciale pour la colonne moderne (avantages)
                        const modernAdvantages = this.selectedWidget.data.modernAdvantages || [];
                        
                        elementsHtml += `
                            <div class="element-item" style="padding: 12px; background: var(--bg-card); 
                                                            border-radius: 8px; margin-bottom: 8px;">
                                <div style="margin-bottom: 12px;">
                                    <div style="color: #10b981; font-weight: 500; margin-bottom: 8px;">
                                        <i class="fas fa-check-circle"></i> ${element.name} (${modernAdvantages.length})
                                    </div>
                                    <div style="color: var(--text-muted); font-size: 12px;">Gestion des avantages de la nouvelle technologie</div>
                                </div>
                                
                                <div class="advantages-manager" style="margin-bottom: 12px;">
                                    <div class="advantage-input-group" style="display: flex; gap: 8px; margin-bottom: 12px;">
                                        <input type="text" id="newModernInput" placeholder="‚úÖ Titre|Description de l'avantage..." 
                                               style="flex: 1; padding: 8px 12px; background: var(--bg-primary); 
                                                      border: 1px solid #10b981; border-radius: 6px; 
                                                      color: var(--text-white); font-size: 14px;">
                                        <button onclick="widgetEditor.addModernAdvantage()" 
                                                style="padding: 8px 16px; background: #10b981; 
                                                       color: white; border: none; border-radius: 6px; 
                                                       cursor: pointer; font-size: 14px; font-weight: 500;">
                                            <i class="fas fa-plus"></i> Ajouter
                                        </button>
                                    </div>
                                    
                                    <div class="advantages-list" style="max-height: 200px; overflow-y: auto;">
                                        ${modernAdvantages.map((item, index) => {
                                            // Support r√©trocompatibilit√© : si item est string, le convertir en objet
                                            const itemData = typeof item === 'string' ? { text: item, emoji: '‚úÖ', color: '#ffffff' } : item;
                                            return `
                                            <div class="advantage-item" style="padding: 12px; background: rgba(16, 185, 129, 0.1); 
                                                                                 border: 1px solid rgba(16, 185, 129, 0.3); 
                                                                                 border-radius: 8px; margin-bottom: 12px;">
                                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                                    <input type="text" value="${itemData.emoji}" placeholder="‚úÖ" 
                                                           onchange="widgetEditor.updateModernAdvantageEmoji(${index}, this.value)"
                                                           oninput="widgetEditor.updateModernAdvantageEmoji(${index}, this.value)"
                                                           style="width: 40px; background: rgba(0,0,0,0.3); border: 1px solid rgba(16, 185, 129, 0.5); 
                                                                  border-radius: 4px; color: var(--text-white); font-size: 16px; text-align: center; padding: 4px;"
                                                           title="Emoji ou caract√®re (ex: üîã, ‚ö°, ou logo)">
                                                    <input type="text" value="${itemData.text}" 
                                                           onchange="widgetEditor.updateModernAdvantageText(${index}, this.value)"
                                                           oninput="widgetEditor.updateModernAdvantageText(${index}, this.value)"
                                                           style="flex: 1; background: rgba(0,0,0,0.3); border: 1px solid rgba(16, 185, 129, 0.5); 
                                                                  border-radius: 4px; color: var(--text-white); font-size: 14px; padding: 6px;"
                                                           placeholder="Texte de l'avantage">
                                                    <button onclick="widgetEditor.removeModernAdvantage(${index})" 
                                                            title="Supprimer cet avantage"
                                                            style="background: rgba(239, 68, 68, 0.2); color: var(--danger-red); 
                                                                   border: 1px solid var(--danger-red); border-radius: 4px; 
                                                                   width: 28px; height: 28px; cursor: pointer; font-size: 12px;">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                <div style="display: flex; align-items: center; gap: 8px;">
                                                    <label style="color: var(--text-muted); font-size: 12px; min-width: 60px;">Couleur :</label>
                                                    <input type="color" value="${itemData.color || '#ffffff'}" 
                                                           onchange="widgetEditor.updateModernAdvantageColor(${index}, this.value)"
                                                           style="width: 40px; height: 24px; border-radius: 4px; border: none; cursor: pointer;">
                                                    <span style="color: var(--text-muted); font-size: 11px;">Couleur du texte</span>
                                                </div>
                                            </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            </div>
                        `;
                    } else if (isPlan1Features) {
                        // Interface sp√©ciale pour les fonctionnalit√©s Plan 1 (ESSAI)
                        const plan1Features = this.selectedWidget.data.plan1Features || [];
                        
                        elementsHtml += `
                            <div class="element-item" style="padding: 12px; background: var(--bg-card); 
                                                            border-radius: 8px; margin-bottom: 8px;">
                                <div style="margin-bottom: 12px;">
                                    <div style="color: #fbbf24; font-weight: 500; margin-bottom: 8px;">
                                        <i class="fas fa-calendar-alt"></i> ${element.name} (${plan1Features.length})
                                    </div>
                                    <div style="color: var(--text-muted); font-size: 12px;">Gestion des fonctionnalit√©s du plan Essai 6 Mois</div>
                                </div>
                                
                                <div class="plan1-manager" style="margin-bottom: 12px;">
                                    <div class="plan1-input-group" style="display: flex; gap: 8px; margin-bottom: 12px;">
                                        <input type="text" id="newPlan1Input" placeholder="üîß Nouvelle fonctionnalit√©..." 
                                               style="flex: 1; padding: 8px 12px; background: var(--bg-primary); 
                                                      border: 1px solid #fbbf24; border-radius: 6px; 
                                                      color: var(--text-white); font-size: 14px;">
                                        <button onclick="widgetEditor.addPlan1Feature()" 
                                                style="padding: 8px 16px; background: #fbbf24; 
                                                       color: white; border: none; border-radius: 6px; 
                                                       cursor: pointer; font-size: 14px; font-weight: 500;">
                                            <i class="fas fa-plus"></i> Ajouter
                                        </button>
                                    </div>
                                    
                                    <div class="plan1-list" style="max-height: 200px; overflow-y: auto;">
                                        ${plan1Features.map((item, index) => {
                                            // Support r√©trocompatibilit√© : si item est string, le convertir en objet
                                            const itemData = typeof item === 'string' ? { text: item, emoji: '‚úÖ', color: '#ffffff' } : item;
                                            return `
                                            <div class="plan1-item" style="padding: 12px; background: rgba(251, 191, 36, 0.1); 
                                                                              border: 1px solid rgba(251, 191, 36, 0.3); 
                                                                              border-radius: 8px; margin-bottom: 12px;">
                                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                                    <input type="text" value="${itemData.emoji}" placeholder="üîß" 
                                                           onchange="widgetEditor.updatePlan1FeatureEmoji(${index}, this.value)"
                                                           oninput="widgetEditor.updatePlan1FeatureEmoji(${index}, this.value)"
                                                           style="width: 40px; background: rgba(0,0,0,0.3); border: 1px solid rgba(251, 191, 36, 0.5); 
                                                                  border-radius: 4px; color: var(--text-white); font-size: 16px; text-align: center; padding: 4px;"
                                                           title="Emoji ou caract√®re (ex: üîß, üìû, ou logo)">
                                                    <input type="text" value="${itemData.text}" 
                                                           onchange="widgetEditor.updatePlan1FeatureText(${index}, this.value)"
                                                           oninput="widgetEditor.updatePlan1FeatureText(${index}, this.value)"
                                                           style="flex: 1; background: rgba(0,0,0,0.3); border: 1px solid rgba(251, 191, 36, 0.5); 
                                                                  border-radius: 4px; color: var(--text-white); font-size: 14px; padding: 6px;"
                                                           placeholder="Texte de la fonctionnalit√©">
                                                    <button onclick="widgetEditor.removePlan1Feature(${index})" 
                                                            title="Supprimer cette fonctionnalit√©"
                                                            style="background: rgba(239, 68, 68, 0.2); color: var(--danger-red); 
                                                                   border: 1px solid var(--danger-red); border-radius: 4px; 
                                                                   width: 28px; height: 28px; cursor: pointer; font-size: 12px;">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                <div style="display: flex; align-items: center; gap: 8px;">
                                                    <label style="color: var(--text-muted); font-size: 12px; min-width: 60px;">Couleur :</label>
                                                    <input type="color" value="${itemData.color || '#ffffff'}" 
                                                           onchange="widgetEditor.updatePlan1FeatureColor(${index}, this.value)"
                                                           style="width: 40px; height: 24px; border-radius: 4px; border: none; cursor: pointer;">
                                                    <span style="color: var(--text-muted); font-size: 11px;">Couleur du texte</span>
                                                </div>
                                            </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            </div>
                        `;
                    } else if (isPlan2Features) {
                        // Interface sp√©ciale pour les fonctionnalit√©s Plan 2 (STANDARD)
                        const plan2Features = this.selectedWidget.data.plan2Features || [];
                        
                        elementsHtml += `
                            <div class="element-item" style="padding: 12px; background: var(--bg-card); 
                                                            border-radius: 8px; margin-bottom: 8px;">
                                <div style="margin-bottom: 12px;">
                                    <div style="color: #3b82f6; font-weight: 500; margin-bottom: 8px;">
                                        <i class="fas fa-star"></i> ${element.name} (${plan2Features.length})
                                    </div>
                                    <div style="color: var(--text-muted); font-size: 12px;">Gestion des fonctionnalit√©s du plan Standard 2 Ans</div>
                                </div>
                                
                                <div class="plan2-manager" style="margin-bottom: 12px;">
                                    <div class="plan2-input-group" style="display: flex; gap: 8px; margin-bottom: 12px;">
                                        <input type="text" id="newPlan2Input" placeholder="üì° Nouvelle fonctionnalit√©..." 
                                               style="flex: 1; padding: 8px 12px; background: var(--bg-primary); 
                                                      border: 1px solid #3b82f6; border-radius: 6px; 
                                                      color: var(--text-white); font-size: 14px;">
                                        <button onclick="widgetEditor.addPlan2Feature()" 
                                                style="padding: 8px 16px; background: #3b82f6; 
                                                       color: white; border: none; border-radius: 6px; 
                                                       cursor: pointer; font-size: 14px; font-weight: 500;">
                                            <i class="fas fa-plus"></i> Ajouter
                                        </button>
                                    </div>
                                    
                                    <div class="plan2-list" style="max-height: 200px; overflow-y: auto;">
                                        ${plan2Features.map((item, index) => {
                                            // Support r√©trocompatibilit√© : si item est string, le convertir en objet
                                            const itemData = typeof item === 'string' ? { text: item, emoji: '‚úÖ', color: '#ffffff' } : item;
                                            return `
                                            <div class="plan2-item" style="padding: 12px; background: rgba(59, 130, 246, 0.1); 
                                                                              border: 1px solid rgba(59, 130, 246, 0.3); 
                                                                              border-radius: 8px; margin-bottom: 12px;">
                                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                                    <input type="text" value="${itemData.emoji}" placeholder="üì°" 
                                                           onchange="widgetEditor.updatePlan2FeatureEmoji(${index}, this.value)"
                                                           oninput="widgetEditor.updatePlan2FeatureEmoji(${index}, this.value)"
                                                           style="width: 40px; background: rgba(0,0,0,0.3); border: 1px solid rgba(59, 130, 246, 0.5); 
                                                                  border-radius: 4px; color: var(--text-white); font-size: 16px; text-align: center; padding: 4px;"
                                                           title="Emoji ou caract√®re (ex: üì°, ‚ö°, ou logo)">
                                                    <input type="text" value="${itemData.text}" 
                                                           onchange="widgetEditor.updatePlan2FeatureText(${index}, this.value)"
                                                           oninput="widgetEditor.updatePlan2FeatureText(${index}, this.value)"
                                                           style="flex: 1; background: rgba(0,0,0,0.3); border: 1px solid rgba(59, 130, 246, 0.5); 
                                                                  border-radius: 4px; color: var(--text-white); font-size: 14px; padding: 6px;"
                                                           placeholder="Texte de la fonctionnalit√©">
                                                    <button onclick="widgetEditor.removePlan2Feature(${index})" 
                                                            title="Supprimer cette fonctionnalit√©"
                                                            style="background: rgba(239, 68, 68, 0.2); color: var(--danger-red); 
                                                                   border: 1px solid var(--danger-red); border-radius: 4px; 
                                                                   width: 28px; height: 28px; cursor: pointer; font-size: 12px;">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                <div style="display: flex; align-items: center; gap: 8px;">
                                                    <label style="color: var(--text-muted); font-size: 12px; min-width: 60px;">Couleur :</label>
                                                    <input type="color" value="${itemData.color || '#ffffff'}" 
                                                           onchange="widgetEditor.updatePlan2FeatureColor(${index}, this.value)"
                                                           style="width: 40px; height: 24px; border-radius: 4px; border: none; cursor: pointer;">
                                                    <span style="color: var(--text-muted); font-size: 11px;">Couleur du texte</span>
                                                </div>
                                            </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            </div>
                        `;
                    } else if (isPlan3Features) {
                        // Interface sp√©ciale pour les fonctionnalit√©s Plan 3 (PREMIUM)
                        const plan3Features = this.selectedWidget.data.plan3Features || [];
                        
                        elementsHtml += `
                            <div class="element-item" style="padding: 12px; background: var(--bg-card); 
                                                            border-radius: 8px; margin-bottom: 8px;">
                                <div style="margin-bottom: 12px;">
                                    <div style="color: #10b981; font-weight: 500; margin-bottom: 8px;">
                                        <i class="fas fa-crown"></i> ${element.name} (${plan3Features.length})
                                    </div>
                                    <div style="color: var(--text-muted); font-size: 12px;">Gestion des fonctionnalit√©s du plan Premium 5 Ans</div>
                                </div>
                                
                                <div class="plan3-manager" style="margin-bottom: 12px;">
                                    <div class="plan3-input-group" style="display: flex; gap: 8px; margin-bottom: 12px;">
                                        <input type="text" id="newPlan3Input" placeholder="üöÄ Nouvelle fonctionnalit√©..." 
                                               style="flex: 1; padding: 8px 12px; background: var(--bg-primary); 
                                                      border: 1px solid #10b981; border-radius: 6px; 
                                                      color: var(--text-white); font-size: 14px;">
                                        <button onclick="widgetEditor.addPlan3Feature()" 
                                                style="padding: 8px 16px; background: #10b981; 
                                                       color: white; border: none; border-radius: 6px; 
                                                       cursor: pointer; font-size: 14px; font-weight: 500;">
                                            <i class="fas fa-plus"></i> Ajouter
                                        </button>
                                    </div>
                                    
                                    <div class="plan3-list" style="max-height: 200px; overflow-y: auto;">
                                        ${plan3Features.map((item, index) => {
                                            // Support r√©trocompatibilit√© : si item est string, le convertir en objet
                                            const itemData = typeof item === 'string' ? { text: item, emoji: '‚úÖ', color: '#ffffff' } : item;
                                            return `
                                            <div class="plan3-item" style="padding: 12px; background: rgba(16, 185, 129, 0.1); 
                                                                              border: 1px solid rgba(16, 185, 129, 0.3); 
                                                                              border-radius: 8px; margin-bottom: 12px;">
                                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                                    <input type="text" value="${itemData.emoji}" placeholder="üöÄ" 
                                                           onchange="widgetEditor.updatePlan3FeatureEmoji(${index}, this.value)"
                                                           oninput="widgetEditor.updatePlan3FeatureEmoji(${index}, this.value)"
                                                           style="width: 40px; background: rgba(0,0,0,0.3); border: 1px solid rgba(16, 185, 129, 0.5); 
                                                                  border-radius: 4px; color: var(--text-white); font-size: 16px; text-align: center; padding: 4px;"
                                                           title="Emoji ou caract√®re (ex: üöÄ, ü§ñ, ou logo)">
                                                    <input type="text" value="${itemData.text}" 
                                                           onchange="widgetEditor.updatePlan3FeatureText(${index}, this.value)"
                                                           oninput="widgetEditor.updatePlan3FeatureText(${index}, this.value)"
                                                           style="flex: 1; background: rgba(0,0,0,0.3); border: 1px solid rgba(16, 185, 129, 0.5); 
                                                                  border-radius: 4px; color: var(--text-white); font-size: 14px; padding: 6px;"
                                                           placeholder="Texte de la fonctionnalit√©">
                                                    <button onclick="widgetEditor.removePlan3Feature(${index})" 
                                                            title="Supprimer cette fonctionnalit√©"
                                                            style="background: rgba(239, 68, 68, 0.2); color: var(--danger-red); 
                                                                   border: 1px solid var(--danger-red); border-radius: 4px; 
                                                                   width: 28px; height: 28px; cursor: pointer; font-size: 12px;">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                <div style="display: flex; align-items: center; gap: 8px;">
                                                    <label style="color: var(--text-muted); font-size: 12px; min-width: 60px;">Couleur :</label>
                                                    <input type="color" value="${itemData.color || '#ffffff'}" 
                                                           onchange="widgetEditor.updatePlan3FeatureColor(${index}, this.value)"
                                                           style="width: 40px; height: 24px; border-radius: 4px; border: none; cursor: pointer;">
                                                    <span style="color: var(--text-muted); font-size: 11px;">Couleur du texte</span>
                                                </div>
                                            </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            </div>
                        `;
                    } else if (isCallToActionAdvantages) {
                        // Interface sp√©ciale pour les avantages du Call to Action
                        const advantages = this.selectedWidget.data.advantages || [];
                        
                        elementsHtml += `
                            <div class="element-item" style="padding: 12px; background: var(--bg-card); 
                                                            border-radius: 8px; margin-bottom: 8px;">
                                <div style="margin-bottom: 12px;">
                                    <div style="color: #10b981; font-weight: 500; margin-bottom: 8px;">
                                        <i class="fas fa-check-circle"></i> ${element.name} (${advantages.length})
                                    </div>
                                    <div style="color: var(--text-muted); font-size: 12px;">Gestion des avantages avec emoji et couleur personnalisables</div>
                                </div>
                                
                                <div class="advantages-manager" style="margin-bottom: 12px;">
                                    <div class="advantage-input-group" style="display: flex; gap: 8px; margin-bottom: 12px;">
                                        <input type="text" id="newAdvantageInput" placeholder="‚úÖ Nouvel avantage..." 
                                               style="flex: 1; padding: 8px 12px; background: var(--bg-primary); 
                                                      border: 1px solid #10b981; border-radius: 6px; 
                                                      color: var(--text-white); font-size: 14px;">
                                        <button onclick="widgetEditor.addCallToActionAdvantage()" 
                                                style="padding: 8px 16px; background: #10b981; 
                                                       color: white; border: none; border-radius: 6px; 
                                                       cursor: pointer; font-size: 14px; font-weight: 500;">
                                            <i class="fas fa-plus"></i> Ajouter
                                        </button>
                                    </div>
                                    
                                    <div class="advantages-list" style="max-height: 200px; overflow-y: auto;">
                                        ${advantages.map((item, index) => {
                                            return `
                                            <div class="advantage-item" data-advantage-index="${index}" style="padding: 12px; background: rgba(16, 185, 129, 0.1); 
                                                                              border: 1px solid rgba(16, 185, 129, 0.3); 
                                                                              border-radius: 8px; margin-bottom: 12px;">
                                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                                    <input type="text" value="${item.emoji}" placeholder="‚úÖ" 
                                                           onchange="widgetEditor.updateCallToActionAdvantageEmoji(${index}, this.value)"
                                                           oninput="widgetEditor.updateCallToActionAdvantageEmoji(${index}, this.value)"
                                                           class="advantage-emoji"
                                                           style="width: 40px; background: rgba(0,0,0,0.3); border: 1px solid rgba(16, 185, 129, 0.5); 
                                                                  border-radius: 4px; color: var(--text-white); font-size: 16px; text-align: center; padding: 4px;"
                                                           title="Emoji ou caract√®re (ex: ‚úÖ, üéØ, üöÄ)">
                                                    <input type="text" value="${item.text}" 
                                                           onchange="widgetEditor.updateCallToActionAdvantageText(${index}, this.value)"
                                                           oninput="widgetEditor.updateCallToActionAdvantageText(${index}, this.value)"
                                                           class="advantage-text"
                                                           style="flex: 1; background: rgba(0,0,0,0.3); border: 1px solid rgba(16, 185, 129, 0.5); 
                                                                  border-radius: 4px; color: var(--text-white); font-size: 14px; padding: 6px;"
                                                           placeholder="Texte de l'avantage">
                                                    <button onclick="widgetEditor.removeCallToActionAdvantage(${index})" 
                                                            title="Supprimer cet avantage"
                                                            style="background: rgba(239, 68, 68, 0.2); color: var(--danger-red); 
                                                                   border: 1px solid var(--danger-red); border-radius: 4px; 
                                                                   width: 28px; height: 28px; cursor: pointer; font-size: 12px;">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                <div style="display: flex; align-items: center; gap: 8px;">
                                                    <label style="color: var(--text-muted); font-size: 12px; min-width: 60px;">Couleur :</label>
                                                    <input type="color" value="${item.color || '#10b981'}" 
                                                           onchange="widgetEditor.updateCallToActionAdvantageColor(${index}, this.value)"
                                                           class="advantage-color"
                                                           style="width: 40px; height: 24px; border-radius: 4px; border: none; cursor: pointer;">
                                                    <span style="color: var(--text-muted); font-size: 11px;">Couleur du texte</span>
                                                </div>
                                            </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        // Interface standard pour les autres √©l√©ments
                        elementsHtml += `
                            <div class="element-item" style="padding: 12px; background: var(--bg-card); 
                                                            border-radius: 8px; margin-bottom: 8px; 
                                                            display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <div style="color: white; font-weight: 500;">${element.name}</div>
                                    <div style="color: var(--text-muted); font-size: 12px;">ID: ${element.id}</div>
                                </div>
                                <div class="element-controls" style="display: flex; gap: 4px; color: var(--text-muted); font-size: 12px;">
                                    <span>√âditible via propri√©t√©s</span>
                                </div>
                            </div>
                        `;
                    }
                });
                
                document.getElementById('elementsContainer').innerHTML = elementsHtml;
            }

            // R√¥le      : Activer/d√©sactiver et mettre √† jour les contr√¥les de l'onglet Organisation
            // Type      : function
            // Unit√©     : sans unit√©
            // Formule   : Si widget s√©lectionn√©, activer tous les contr√¥les et mettre √† jour les valeurs
            // Exemple   : Slider largeur activ√© avec valeur 3, position col activ√©e avec valeur 1
            updateOrganizationControls() {
                if (!this.selectedWidget) {
                    // D√©sactiver tous les contr√¥les si aucun widget s√©lectionn√©
                    const controls = [
                        'widthSlider', 'heightSlider', 'widthInput', 'heightInput',
                        'positionColSlider', 'positionRowSlider', 'positionColInput', 'positionRowInput',
                        'duplicateBtn', 'deleteBtn', 'fullScreenBtn', 'fillParentBtn',
                        'customWidgetName', 'saveCustomWidgetBtn', 'updateCustomWidgetBtn'
                    ];
                    
                    controls.forEach(id => {
                        const element = document.getElementById(id);
                        if (element) {
                            element.disabled = true;
                        }
                    });
                    return;
                }
                
                /* 
                # R√¥le      : Initialisation des valeurs par d√©faut pour taille et position
                # Type      : object initialization
                # Unit√©     : colonnes (width), rang√©es (height), position (col, row)
                # Formule   : taille = widget.size || d√©faut, position = widget.position || d√©faut
                # Exemple   : {width: 3, height: 2} et {col: 1, row: 1}
                */
                const size = this.selectedWidget.size || { width: 3, height: 2 };
                const position = this.selectedWidget.position || { col: 1, row: 1 };
                
                // Sauvegarder les valeurs dans le widget si elles n'existent pas
                if (!this.selectedWidget.size) {
                    this.selectedWidget.size = size;
                }
                if (!this.selectedWidget.position) {
                    this.selectedWidget.position = position;
                }
                
                /* 
                # R√¥le      : Activation et mise √† jour des contr√¥les de taille
                # Type      : DOM manipulation
                # Unit√©     : colonnes (1-12) et rang√©es (1-8)
                # Formule   : slider.value = taille_widget, input.value = taille_widget, disabled = false
                # Exemple   : widthSlider.value = 3, widthInput.value = 3, disabled = false
                */
                const widthSlider = document.getElementById('widthSlider');
                const heightSlider = document.getElementById('heightSlider');
                const widthInput = document.getElementById('widthInput');
                const heightInput = document.getElementById('heightInput');
                
                if (widthSlider) {
                    widthSlider.disabled = false;
                    widthSlider.value = size.width;
                }
                if (heightSlider) {
                    heightSlider.disabled = false;
                    heightSlider.value = size.height;
                }
                if (widthInput) {
                    widthInput.disabled = false;
                    widthInput.value = size.width;
                }
                if (heightInput) {
                    heightInput.disabled = false;
                    heightInput.value = size.height;
                }
                
                /* 
                # R√¥le      : Activation et mise √† jour des contr√¥les de position
                # Type      : DOM manipulation
                # Unit√©     : colonnes (1-12) et rang√©es (1-8)
                # Formule   : slider.value = position_widget, input.value = position_widget, disabled = false
                # Exemple   : positionColSlider.value = 1, positionRowInput.value = 1, disabled = false
                */
                const positionColSlider = document.getElementById('positionColSlider');
                const positionRowSlider = document.getElementById('positionRowSlider');
                const positionColInput = document.getElementById('positionColInput');
                const positionRowInput = document.getElementById('positionRowInput');
                
                if (positionColSlider) {
                    positionColSlider.disabled = false;
                    positionColSlider.value = position.col;
                }
                if (positionRowSlider) {
                    positionRowSlider.disabled = false;
                    positionRowSlider.value = position.row;
                }
                if (positionColInput) {
                    positionColInput.disabled = false;
                    positionColInput.value = position.col;
                }
                if (positionRowInput) {
                    positionRowInput.disabled = false;
                    positionRowInput.value = position.row;
                }
                
                /* 
                # R√¥le      : Activation des boutons d'action
                # Type      : DOM manipulation
                # Unit√©     : sans unit√©
                # Formule   : button.disabled = false
                # Exemple   : duplicateBtn.disabled = false, deleteBtn.disabled = false
                */
                const duplicateBtn = document.getElementById('duplicateBtn');
                const deleteBtn = document.getElementById('deleteBtn');
                const fullScreenBtn = document.getElementById('fullScreenBtn');
                const fillParentBtn = document.getElementById('fillParentBtn');
                const customWidgetName = document.getElementById('customWidgetName');
                const saveCustomWidgetBtn = document.getElementById('saveCustomWidgetBtn');
                const updateCustomWidgetBtn = document.getElementById('updateCustomWidgetBtn');
                
                if (duplicateBtn) duplicateBtn.disabled = false;
                if (deleteBtn) deleteBtn.disabled = false;
                if (fullScreenBtn) fullScreenBtn.disabled = false;
                if (fillParentBtn) fillParentBtn.disabled = false;
                if (customWidgetName) customWidgetName.disabled = false;
                if (saveCustomWidgetBtn) saveCustomWidgetBtn.disabled = false;
                
                // V√©rifier si le widget est d√©j√† un widget personnalis√© pour afficher le bouton "Mettre √† jour"
                if (updateCustomWidgetBtn) {
                    if (this.selectedWidget.isCustom) {
                        updateCustomWidgetBtn.style.display = 'inline-block';
                        updateCustomWidgetBtn.disabled = false;
                        if (customWidgetName) customWidgetName.value = this.selectedWidget.customName || '';
                    } else {
                        updateCustomWidgetBtn.style.display = 'none';
                        if (customWidgetName) customWidgetName.value = '';
                    }
                }
                
                console.log(`‚úÖ Contr√¥les Organisation activ√©s pour widget ${this.selectedWidget.id}`);
                console.log(`üìä Taille: ${size.width}x${size.height}, Position: col=${position.col}, row=${position.row}`);
            }

            updateProperty(propertyName, value) {
                if (!this.selectedWidget) return;
                
                console.log(`üîß updateProperty: ${propertyName} = ${value} (type: ${typeof value})`);
                
                // Conversion des types
                if (value === 'true') value = true;
                if (value === 'false') value = false;
                
                // R√¥le      : Conversion en nombre pour les propri√©t√©s num√©riques
                // Type      : number conversion  
                // Unit√©     : sans unit√©
                // Formule   : Si valeur est num√©rique, convertir en float
                // Exemple   : "25" ‚Üí 25 pour containerPaddingX
                const isNumericProperty = ['width', 'height', 'containerPaddingX', 'containerPaddingY', 'containerPadding', 
                                          'backgroundOpacity', 'borderWidth', 'borderRadius', 'borderOpacity', 
                                          'imageSize', 'shadowOpacity', 'shadowOffsetX', 'shadowOffsetY', 'shadowBlur'].includes(propertyName);
                
                if (!isNaN(value) && value !== '' && (typeof this.selectedWidget.data[propertyName] === 'number' || isNumericProperty)) {
                    value = parseFloat(value);
                    console.log(`üìä Converti en nombre: ${propertyName} = ${value}`);
                }
                
                // Gestion sp√©ciale pour featuresCount dans feature-grid
                if (propertyName === 'featuresCount' && this.selectedWidget.type === 'feature-grid') {
                    const currentCount = parseInt(value, 10);
                    const features = this.selectedWidget.data.features || [];
                    
                    // Si on augmente le nombre, ajouter des fonctionnalit√©s vides
                    while (features.length < currentCount) {
                        features.push({
                            icon: '‚≠ê',
                            title: `Fonctionnalit√© ${features.length + 1}`,
                            description: 'Description de cette fonctionnalit√©',
                            iconSize: '3rem',
                            titleColor: 'white',
                            titleSize: '1.5rem',
                            descriptionColor: 'var(--text-gray)',
                            descriptionSize: '0.95rem',
                            backgroundColor: 'var(--bg-card)',
                            borderColor: 'var(--border-color)'
                        });
                    }
                    
                    // Mettre √† jour le tableau des features
                    this.selectedWidget.data.features = features;
                    
                    // Mettre √† jour l'onglet Elements pour refl√©ter les changements
                    this.updateElementsTab();
                }
                
                // Sauvegarder la valeur
                this.selectedWidget.data[propertyName] = value;
                
                /* 
                # R√¥le      : Log sp√©cifique pour espacement largeur apr√®s sauvegarde
                # Type      : console.log conditionnel
                # Unit√©     : pixels
                # Formule   : si propri√©t√© = containerPaddingX, alors log √©tat complet
                # Exemple   : "ESPACEMENT X SAUV√â: valeur dans data + √©tat complet widget"
                */
                if (propertyName === 'containerPaddingX' || propertyName === 'containerPaddingY') {
                    console.log(`üíæ ESPACEMENT ${propertyName === 'containerPaddingX' ? 'LARGEUR (X)' : 'HAUTEUR (Y)'} SAUV√â: ${value}`);
                    console.log(`üì¶ √âtat des espacements:`, {
                        containerPaddingX: this.selectedWidget.data.containerPaddingX,
                        containerPaddingY: this.selectedWidget.data.containerPaddingY,
                        containerPadding: this.selectedWidget.data.containerPadding
                    });
                }
                
                // Mettre √† jour l'affichage de la valeur pour les ranges
                const valueDisplay = document.getElementById(`prop-${propertyName}-value`);
                if (valueDisplay) {
                    const unit = propertyName.includes('Size') || propertyName.includes('width') || propertyName.includes('height') || propertyName.includes('Width') || propertyName.includes('Height') ? 'px' : '';
                    valueDisplay.textContent = value + unit;
                }
                
                // Mise √† jour temps r√©el sp√©cifique par type de widget et propri√©t√©
                const container = document.querySelector(`[data-widget-id="${this.selectedWidget.id}"]`);
                
                
                if (container) {
                    this.updateWidgetRealTime(container, propertyName, value);
                }
                
                // Mettre √† jour aussi le viewer
                this.updatePreview();
                
                // Sauvegarde automatique apr√®s mise √† jour de propri√©t√©
                this.autoSave();
                
                // Pas de setStatus pour √©viter le spam lors de l'input continu
            }
            
            // Mise √† jour temps r√©el sp√©cifique selon le type de widget
            updateWidgetRealTime(container, propertyName, value) {
                /* 
                # R√¥le      : Mise √† jour hybride : directe imm√©diate + re-rendu complet
                # Type      : function
                # Unit√©     : sans unit√©
                # Formule   : mise_√†_jour_directe(propri√©t√©_critique) + nouveau_HTML = widget.render(donn√©es_actuelles)
                # Exemple   : imagePath mise √† jour directe en CSS + re-rendu complet pour coh√©rence
                */
                
                // ‚úÖ SOLUTION HYBRIDE : Mise √† jour directe imm√©diate pour les propri√©t√©s critiques
                this.updateCriticalPropertiesDirectly(container, propertyName, value);
                
                // Puis re-rendu complet pour maintenir la coh√©rence
                this.rerenderWidget(container);
            }
            
            // R√¥le      : Mise √† jour directe imm√©diate des propri√©t√©s critiques pour temps r√©el
            // Type      : function  
            // Unit√©     : sans unit√©
            // Formule   : Si propri√©t√© critique, modifier directement le DOM sans re-rendu
            // Exemple   : imagePath ‚Üí backgroundImage du logo mis √† jour instantan√©ment
            updateCriticalPropertiesDirectly(container, propertyName, value) {
                if (!this.selectedWidget) return;
                
                /* 
                # R√¥le      : Traitement sp√©cialis√© par type de widget et propri√©t√©
                # Type      : switch statement
                # Unit√©     : sans unit√©  
                # Formule   : Si (type_widget === 'logo' && propri√©t√© === 'imagePath') alors mise_√†_jour_directe_CSS
                # Exemple   : Widget logo + imagePath ‚Üí backgroundImage actualis√© imm√©diatement
                */
                switch (this.selectedWidget.type) {
                    case 'logo':
                        if (propertyName === 'imagePath') {
                            const logoElement = container.querySelector('.nav-logo');
                            if (logoElement) {
                                logoElement.style.backgroundImage = `url('${value}')`;
                                console.log(`üöÄ Mise √† jour directe imagePath: ${value}`);
                            }
                        }
                        break;
                        
                    case 'hero-title':
                        if (propertyName === 'text') {
                            const titleElement = container.querySelector('.hero-title, h1');
                            if (titleElement) {
                                titleElement.textContent = value;
                                console.log(`üöÄ Mise √† jour directe text: ${value}`);
                            }
                        }
                        break;
                        
                    case 'comparison':
                        // Mise √† jour directe du titre principal
                        if (propertyName === 'title') {
                            const titleElement = container.querySelector('.comparison-title');
                            if (titleElement) {
                                titleElement.textContent = value;
                                console.log(`üöÄ Mise √† jour directe titre: ${value}`);
                            }
                        }
                        // Mise √† jour directe des titres de colonnes
                        else if (propertyName === 'obsoleteTitle') {
                            const obsoleteTitleElement = container.querySelector('.obsolete-column h3');
                            if (obsoleteTitleElement) {
                                obsoleteTitleElement.textContent = value;
                                console.log(`üöÄ Mise √† jour directe titre obsol√®te: ${value}`);
                            }
                        }
                        else if (propertyName === 'modernTitle') {
                            const modernTitleElement = container.querySelector('.modern-column h3');
                            if (modernTitleElement) {
                                modernTitleElement.textContent = value;
                                console.log(`üöÄ Mise √† jour directe titre moderne: ${value}`);
                            }
                        }
                        break;
                        
                    // Ajouter d'autres cas au besoin pour d'autres types de widgets
                    default:
                        // Pas de mise √† jour directe pour ce type/propri√©t√©
                        break;
                }
            }
            
            // R√¥le      : Re-rendu complet d'un widget avec ses donn√©es actuelles
            // Type      : function
            // Unit√©     : sans unit√©
            // Formule   : nouveau_HTML = widget_instance.render(widget_data)
            // Exemple   : Le widget se re-rend avec les nouvelles donn√©es
            rerenderWidget(container) {
                if (!this.selectedWidget || !this.selectedWidget.instance) return;
                
                try {
                    // R√¥le      : Mise √† jour seulement du contenu du widget, pas des contr√¥les
                    // Type      : function
                    // Unit√©     : sans unit√©
                    // Formule   : widget_content.innerHTML = nouveau_rendu
                    // Exemple   : Seul le contenu .widget-content est mis √† jour, les contr√¥les restent
                    
                    // Chercher le div de contenu sp√©cifiquement
                    const contentDiv = container.querySelector('.widget-content');
                    if (contentDiv) {
                        // G√©n√©rer le nouveau HTML avec les donn√©es actuelles
                        const newHTML = this.selectedWidget.instance.render(this.selectedWidget.data);
                        
                        // Remplacer SEULEMENT le contenu, pas les contr√¥les
                        contentDiv.innerHTML = newHTML;
                    }
                    
                } catch (error) {
                    console.error('‚ùå Erreur lors du re-rendu du widget:', error);
                }
            }
            
            // Mise √† jour temps r√©el pour le hero title
            updateHeroTitleRealTime(container, propertyName, value) {
                const title = container.querySelector('.hero-title, h1');
                const subtitle = container.querySelector('.hero-subtitle');
                const text = container.querySelector('.hero-text');
                const section = container.querySelector('.hero-section');
                
                switch (propertyName) {
                    case 'title':
                        if (title) {
                            title.textContent = value;
                        }
                        break;
                    case 'subtitle':
                        if (subtitle) {
                            subtitle.innerHTML = value;
                        }
                        break;
                    case 'text':
                        if (text) {
                            text.innerHTML = value;
                        }
                        break;
                    case 'titleSize':
                        if (title) {
                            title.style.fontSize = `${value}px`;
                        }
                        break;
                    case 'subtitleSize':
                        if (subtitle) {
                            subtitle.style.fontSize = `${value}px`;
                        }
                        break;
                    case 'textSize':
                        if (text) {
                            text.style.fontSize = `${value}px`;
                        }
                        break;
                    case 'alignment':
                        if (section) {
                            section.style.textAlign = value;
                        }
                        break;
                    case 'backgroundColor':
                        if (section) {
                            if (value === 'transparent' || value === '') {
                                section.style.backgroundColor = 'transparent';
                            } else {
                                section.style.backgroundColor = value;
                            }
                        }
                        break;
                    case 'borderRadius':
                        if (section) {
                            if (parseInt(value) > 0) {
                                section.style.borderRadius = `${value}px`;
                                section.style.overflow = 'hidden';
                            } else {
                                section.style.borderRadius = '0px';
                                section.style.overflow = 'visible';
                            }
                        }
                        break;
                    case 'gradient':
                        if (title) {
                            if (value) {
                                title.style.background = 'linear-gradient(135deg, #10b981, #0d9488)';
                                title.style.webkitBackgroundClip = 'text';
                                title.style.webkitTextFillColor = 'transparent';
                                title.style.backgroundClip = 'text';
                            } else {
                                title.style.background = 'none';
                                title.style.webkitBackgroundClip = 'initial';
                                title.style.webkitTextFillColor = 'initial';
                                title.style.backgroundClip = 'initial';
                                title.style.color = '#10b981';
                            }
                        }
                        break;
                }
            }
            
            // Mise √† jour temps r√©el pour pricing card
            updatePricingCardRealTime(container, propertyName, value) {
                const planName = container.querySelector('h3.pricing-plan-name');
                const price = container.querySelector('.pricing-amount, [style*="font-size: 3.5rem"]');
                const currency = container.querySelector('[style*="font-size: 2rem"]');
                const ctaButton = container.querySelector('a[style*="width: 100%"]');
                const card = container.querySelector('.pricing-card');
                const badge = container.querySelector('.pricing-badge');
                const featuresList = container.querySelector('ul');
                
                switch (propertyName) {
                    case 'planName':
                        if (planName) {
                            planName.textContent = value;
                        }
                        break;
                    case 'price':
                        if (price) {
                            price.textContent = value;
                        }
                        break;
                    case 'currency':
                        if (currency) {
                            currency.textContent = value;
                        }
                        break;
                    case 'ctaText':
                        if (ctaButton) {
                            ctaButton.textContent = value;
                        }
                        break;
                    case 'ctaLink':
                        if (ctaButton) {
                            ctaButton.href = value;
                        }
                        break;
                    case 'accentColor':
                        if (currency) {
                            currency.style.color = value;
                        }
                        if (ctaButton) {
                            ctaButton.style.background = value;
                        }
                        if (badge) {
                            badge.style.background = value;
                        }
                        if (card) {
                            const isFeatured = this.selectedWidget.data.featured;
                            if (isFeatured) {
                                card.style.borderColor = value;
                            }
                        }
                        // Mettre √† jour les checkmarks des fonctionnalit√©s
                        if (featuresList) {
                            const checkmarks = featuresList.querySelectorAll('span[style*="color"]');
                            checkmarks.forEach(check => {
                                check.style.color = value;
                            });
                        }
                        break;
                    case 'backgroundColor':
                        if (card) {
                            card.style.background = value;
                        }
                        break;
                    case 'textColor':
                        if (card) {
                            card.style.color = value;
                        }
                        if (planName) {
                            planName.style.color = value;
                        }
                        if (featuresList) {
                            const textElements = featuresList.querySelectorAll('span:not([style*="color: #10b981"])');
                            textElements.forEach(el => {
                                if (!el.textContent.includes('‚úì')) {
                                    el.style.color = value;
                                }
                            });
                        }
                        break;
                    case 'badge':
                        // Re-render complet pour le badge car il peut √™tre ajout√©/supprim√©
                        this.renderSelectedWidget();
                        break;
                    case 'featured':
                        if (card) {
                            const accentColor = this.selectedWidget.data.accentColor || '#10b981';
                            card.style.borderColor = value ? accentColor : '#374151';
                            if (value) {
                                card.classList.add('featured');
                            } else {
                                card.classList.remove('featured');
                            }
                        }
                        break;
                    
                    // Propri√©t√©s de style du titre du plan
                    case 'planNameSize':
                        if (planName) planName.style.fontSize = `${value}px`;
                        break;
                    case 'planNameColor':
                        if (planName) planName.style.color = value;
                        break;
                    case 'planNameAlignment':
                        if (planName) planName.style.textAlign = value;
                        break;
                    case 'planNameIsBold':
                        if (planName) planName.style.fontWeight = value ? 'bold' : 'normal';
                        break;
                    case 'planNameIsItalic':
                        if (planName) planName.style.fontStyle = value ? 'italic' : 'normal';
                        break;
                    
                    // Arri√®re-plan du titre du plan
                    case 'planNameHasBackground':
                        if (planName) {
                            if (value) {
                                const data = this.selectedWidget.data;
                                const opacity = (data.planNameBackgroundOpacity || 20) / 100;
                                const bgColor = data.planNameBackgroundColor || '#10b981';
                                const hex = bgColor.replace('#', '');
                                const r = parseInt(hex.substr(0, 2), 16);
                                const g = parseInt(hex.substr(2, 2), 16);
                                const b = parseInt(hex.substr(4, 2), 16);
                                planName.style.backgroundColor = `rgba(${r}, ${g}, ${b}, ${opacity})`;
                            } else {
                                planName.style.backgroundColor = 'transparent';
                            }
                        }
                        break;
                    case 'planNameBackgroundColor':
                        if (planName && this.selectedWidget.data.planNameHasBackground) {
                            const opacity = (this.selectedWidget.data.planNameBackgroundOpacity || 20) / 100;
                            const hex = value.replace('#', '');
                            const r = parseInt(hex.substr(0, 2), 16);
                            const g = parseInt(hex.substr(2, 2), 16);
                            const b = parseInt(hex.substr(4, 2), 16);
                            planName.style.backgroundColor = `rgba(${r}, ${g}, ${b}, ${opacity})`;
                        }
                        break;
                    case 'planNameBackgroundOpacity':
                        if (planName && this.selectedWidget.data.planNameHasBackground) {
                            const opacity = value / 100;
                            const bgColor = this.selectedWidget.data.planNameBackgroundColor || '#10b981';
                            const hex = bgColor.replace('#', '');
                            const r = parseInt(hex.substr(0, 2), 16);
                            const g = parseInt(hex.substr(2, 2), 16);
                            const b = parseInt(hex.substr(4, 2), 16);
                            planName.style.backgroundColor = `rgba(${r}, ${g}, ${b}, ${opacity})`;
                        }
                        break;
                    
                    // Contour du titre du plan
                    case 'planNameHasBorder':
                        if (planName) {
                            if (value) {
                                const data = this.selectedWidget.data;
                                const borderWidth = data.planNameBorderWidth || 2;
                                const borderStyle = data.planNameBorderStyle || 'solid';
                                const borderColor = data.planNameBorderColor || '#10b981';
                                planName.style.border = `${borderWidth}px ${borderStyle} ${borderColor}`;
                            } else {
                                planName.style.border = 'none';
                            }
                        }
                        break;
                    case 'planNameBorderColor':
                        if (planName && this.selectedWidget.data.planNameHasBorder) {
                            const borderWidth = this.selectedWidget.data.planNameBorderWidth || 2;
                            const borderStyle = this.selectedWidget.data.planNameBorderStyle || 'solid';
                            planName.style.border = `${borderWidth}px ${borderStyle} ${value}`;
                        }
                        break;
                    case 'planNameBorderWidth':
                        if (planName && this.selectedWidget.data.planNameHasBorder) {
                            const borderStyle = this.selectedWidget.data.planNameBorderStyle || 'solid';
                            const borderColor = this.selectedWidget.data.planNameBorderColor || '#10b981';
                            planName.style.border = `${value}px ${borderStyle} ${borderColor}`;
                        }
                        break;
                    case 'planNameBorderStyle':
                        if (planName && this.selectedWidget.data.planNameHasBorder) {
                            const borderWidth = this.selectedWidget.data.planNameBorderWidth || 2;
                            const borderColor = this.selectedWidget.data.planNameBorderColor || '#10b981';
                            planName.style.border = `${borderWidth}px ${value} ${borderColor}`;
                        }
                        break;
                    
                    // Coins arrondis du titre du plan
                    case 'planNameHasRoundedCorners':
                        if (planName) {
                            if (value) {
                                const borderRadius = this.selectedWidget.data.planNameBorderRadius || 8;
                                planName.style.borderRadius = `${borderRadius}px`;
                            } else {
                                planName.style.borderRadius = '0px';
                            }
                        }
                        break;
                    case 'planNameBorderRadius':
                        if (planName && this.selectedWidget.data.planNameHasRoundedCorners) {
                            planName.style.borderRadius = `${value}px`;
                        }
                        break;
                    
                    // Espacement du titre du plan - mise √† jour compl√®te via generatePlanNameStyles
                    case 'planNamePaddingTop':
                    case 'planNamePaddingBottom':
                    case 'planNamePaddingLeft':
                    case 'planNamePaddingRight':
                    case 'planNameMarginBottom':
                        if (planName) {
                            // R√©g√©n√©rer tous les styles pour l'espacement
                            const instance = this.selectedWidget.instance;
                            const newStyles = instance.generatePlanNameStyles(this.selectedWidget.data);
                            planName.setAttribute('style', newStyles);
                        }
                        break;
                }
            }
            
            // Mise √† jour temps r√©el pour CTA
            updateCTARealTime(container, propertyName, value) {
                const title = container.querySelector('h2');
                const description = container.querySelector('p');
                const primaryBtn = container.querySelector('a[style*="background: white"]');
                const secondaryBtn = container.querySelector('a[style*="background: transparent"]');
                const section = container.querySelector('.cta-section');
                
                switch (propertyName) {
                    case 'title':
                        if (title) title.textContent = value;
                        break;
                    case 'description':
                        if (description) description.textContent = value;
                        break;
                    case 'primaryButtonText':
                        if (primaryBtn) primaryBtn.textContent = value;
                        break;
                    case 'primaryButtonLink':
                        if (primaryBtn) primaryBtn.href = value;
                        break;
                    case 'secondaryButtonText':
                        if (secondaryBtn) secondaryBtn.textContent = value;
                        break;
                    case 'secondaryButtonLink':
                        if (secondaryBtn) secondaryBtn.href = value;
                        break;
                    case 'backgroundColor':
                        if (section) section.style.background = value;
                        break;
                }
            }
            
            // Mise √† jour temps r√©el pour feature grid
            updateFeatureGridRealTime(container, propertyName, value) {
                const title = container.querySelector('h2.features-main-title');
                const grid = container.querySelector('.features-grid');
                
                switch (propertyName) {
                    // Contenu du titre
                    case 'title':
                        if (title) title.textContent = value;
                        break;
                    
                    // Propri√©t√©s de style du titre
                    case 'titleSize':
                        if (title) title.style.fontSize = `${value}px`;
                        break;
                    case 'titleColor':
                        if (title) title.style.color = value;
                        break;
                    case 'titleAlignment':
                        if (title) title.style.textAlign = value;
                        break;
                    case 'titleIsBold':
                        if (title) title.style.fontWeight = value ? 'bold' : 'normal';
                        break;
                    case 'titleIsItalic':
                        if (title) title.style.fontStyle = value ? 'italic' : 'normal';
                        break;
                    
                    // Arri√®re-plan du titre
                    case 'titleHasBackground':
                        if (title) {
                            if (value) {
                                const data = this.selectedWidget.data;
                                const opacity = (data.titleBackgroundOpacity || 20) / 100;
                                const bgColor = data.titleBackgroundColor || '#10b981';
                                const hex = bgColor.replace('#', '');
                                const r = parseInt(hex.substr(0, 2), 16);
                                const g = parseInt(hex.substr(2, 2), 16);
                                const b = parseInt(hex.substr(4, 2), 16);
                                title.style.backgroundColor = `rgba(${r}, ${g}, ${b}, ${opacity})`;
                            } else {
                                title.style.backgroundColor = 'transparent';
                            }
                        }
                        break;
                    case 'titleBackgroundColor':
                        if (title && this.selectedWidget.data.titleHasBackground) {
                            const opacity = (this.selectedWidget.data.titleBackgroundOpacity || 20) / 100;
                            const hex = value.replace('#', '');
                            const r = parseInt(hex.substr(0, 2), 16);
                            const g = parseInt(hex.substr(2, 2), 16);
                            const b = parseInt(hex.substr(4, 2), 16);
                            title.style.backgroundColor = `rgba(${r}, ${g}, ${b}, ${opacity})`;
                        }
                        break;
                    case 'titleBackgroundOpacity':
                        if (title && this.selectedWidget.data.titleHasBackground) {
                            const opacity = value / 100;
                            const bgColor = this.selectedWidget.data.titleBackgroundColor || '#10b981';
                            const hex = bgColor.replace('#', '');
                            const r = parseInt(hex.substr(0, 2), 16);
                            const g = parseInt(hex.substr(2, 2), 16);
                            const b = parseInt(hex.substr(4, 2), 16);
                            title.style.backgroundColor = `rgba(${r}, ${g}, ${b}, ${opacity})`;
                        }
                        break;
                    
                    // Contour du titre
                    case 'titleHasBorder':
                        if (title) {
                            if (value) {
                                const data = this.selectedWidget.data;
                                const borderWidth = data.titleBorderWidth || 2;
                                const borderStyle = data.titleBorderStyle || 'solid';
                                const borderColor = data.titleBorderColor || '#10b981';
                                title.style.border = `${borderWidth}px ${borderStyle} ${borderColor}`;
                            } else {
                                title.style.border = 'none';
                            }
                        }
                        break;
                    case 'titleBorderColor':
                        if (title && this.selectedWidget.data.titleHasBorder) {
                            const borderWidth = this.selectedWidget.data.titleBorderWidth || 2;
                            const borderStyle = this.selectedWidget.data.titleBorderStyle || 'solid';
                            title.style.border = `${borderWidth}px ${borderStyle} ${value}`;
                        }
                        break;
                    case 'titleBorderWidth':
                        if (title && this.selectedWidget.data.titleHasBorder) {
                            const borderStyle = this.selectedWidget.data.titleBorderStyle || 'solid';
                            const borderColor = this.selectedWidget.data.titleBorderColor || '#10b981';
                            title.style.border = `${value}px ${borderStyle} ${borderColor}`;
                        }
                        break;
                    case 'titleBorderStyle':
                        if (title && this.selectedWidget.data.titleHasBorder) {
                            const borderWidth = this.selectedWidget.data.titleBorderWidth || 2;
                            const borderColor = this.selectedWidget.data.titleBorderColor || '#10b981';
                            title.style.border = `${borderWidth}px ${value} ${borderColor}`;
                        }
                        break;
                    
                    // Coins arrondis du titre
                    case 'titleHasRoundedCorners':
                        if (title) {
                            if (value) {
                                const borderRadius = this.selectedWidget.data.titleBorderRadius || 8;
                                title.style.borderRadius = `${borderRadius}px`;
                            } else {
                                title.style.borderRadius = '0px';
                            }
                        }
                        break;
                    case 'titleBorderRadius':
                        if (title && this.selectedWidget.data.titleHasRoundedCorners) {
                            title.style.borderRadius = `${value}px`;
                        }
                        break;
                    
                    // Espacement du titre - mise √† jour compl√®te via generateTitleStyles
                    case 'titlePaddingTop':
                    case 'titlePaddingBottom':
                    case 'titlePaddingLeft':
                    case 'titlePaddingRight':
                    case 'titleMarginBottom':
                        if (title) {
                            // R√©g√©n√©rer tous les styles pour l'espacement
                            const instance = this.selectedWidget.instance;
                            const newStyles = instance.generateTitleStyles(this.selectedWidget.data);
                            title.setAttribute('style', newStyles);
                        }
                        break;
                    
                    // Configuration de la grille
                    case 'columns':
                        if (grid) {
                            grid.style.gridTemplateColumns = `repeat(${value}, 1fr)`;
                        }
                        break;
                    case 'featuresCount':
                        // Pour le nombre de fonctionnalit√©s, il faut refaire un rendu complet
                        this.renderCanvas();
                        break;
                }
                
                // Gestion des propri√©t√©s avanc√©es du titre Hero
                if (this.selectedWidget && this.selectedWidget.type === 'hero-title') {
                    this.updateHeroTitleAdvancedRealTime(container, propertyName, value);
                }
                
                // Gestion des propri√©t√©s avanc√©es du titre CTA
                if (this.selectedWidget && this.selectedWidget.type === 'call-to-action') {
                    this.updateCallToActionRealTime(container, propertyName, value);
                }
                
                // Gestion des propri√©t√©s avanc√©es du widget Image Anim√©e
                if (this.selectedWidget && this.selectedWidget.type === 'image-animated') {
                    this.updateImageAnimatedRealTime(container, propertyName, value);
                }
                
                // Gestion des propri√©t√©s avanc√©es du widget Comparison
                if (this.selectedWidget && this.selectedWidget.type === 'comparison') {
                    this.updateComparisonAdvancedRealTime(container, propertyName, value);
                }
            }
            
            // Extension de la mise √† jour temps r√©el pour Hero Title - propri√©t√©s avanc√©es du titre
            updateHeroTitleAdvancedRealTime(container, propertyName, value) {
                const title = container.querySelector('.hero-title, h1');
                
                if (!title) return;
                
                switch (propertyName) {
                    // Propri√©t√©s de style du titre
                    case 'titleSize':
                        title.style.fontSize = `${value}px`;
                        break;
                    case 'titleColor':
                        if (!this.selectedWidget.data.gradient) {
                            title.style.color = value;
                        }
                        break;
                    case 'titleAlignment':
                        title.style.textAlign = value;
                        break;
                    case 'titleIsBold':
                        title.style.fontWeight = value ? '900' : 'normal';
                        break;
                    case 'titleIsItalic':
                        title.style.fontStyle = value ? 'italic' : 'normal';
                        break;
                    case 'gradient':
                        // R√©g√©n√©rer tous les styles du titre pour g√©rer gradient/couleur
                        const instance = this.selectedWidget.instance;
                        const newStyles = instance.generateTitleStyles(this.selectedWidget.data);
                        title.setAttribute('style', newStyles);
                        break;
                    
                    // Arri√®re-plan du titre
                    case 'titleHasBackground':
                        if (value) {
                            const data = this.selectedWidget.data;
                            const opacity = (data.titleBackgroundOpacity || 20) / 100;
                            const bgColor = data.titleBackgroundColor || '#10b981';
                            const hex = bgColor.replace('#', '');
                            const r = parseInt(hex.substr(0, 2), 16);
                            const g = parseInt(hex.substr(2, 2), 16);
                            const b = parseInt(hex.substr(4, 2), 16);
                            
                            if (data.gradient) {
                                title.style.background = `linear-gradient(135deg, #10b981, #0d9488), rgba(${r}, ${g}, ${b}, ${opacity})`;
                                title.style.backgroundBlendMode = 'overlay';
                            } else {
                                title.style.backgroundColor = `rgba(${r}, ${g}, ${b}, ${opacity})`;
                            }
                        } else {
                            if (this.selectedWidget.data.gradient) {
                                title.style.background = 'linear-gradient(135deg, #10b981, #0d9488)';
                                title.style.backgroundBlendMode = 'normal';
                            } else {
                                title.style.backgroundColor = 'transparent';
                            }
                        }
                        break;
                    case 'titleBackgroundColor':
                    case 'titleBackgroundOpacity':
                        if (this.selectedWidget.data.titleHasBackground) {
                            const data = this.selectedWidget.data;
                            const opacity = (data.titleBackgroundOpacity || 20) / 100;
                            const bgColor = data.titleBackgroundColor || '#10b981';
                            const hex = bgColor.replace('#', '');
                            const r = parseInt(hex.substr(0, 2), 16);
                            const g = parseInt(hex.substr(2, 2), 16);
                            const b = parseInt(hex.substr(4, 2), 16);
                            
                            if (data.gradient) {
                                title.style.background = `linear-gradient(135deg, #10b981, #0d9488), rgba(${r}, ${g}, ${b}, ${opacity})`;
                            } else {
                                title.style.backgroundColor = `rgba(${r}, ${g}, ${b}, ${opacity})`;
                            }
                        }
                        break;
                    
                    // Contour du titre
                    case 'titleHasBorder':
                        if (value) {
                            const data = this.selectedWidget.data;
                            const borderWidth = data.titleBorderWidth || 2;
                            const borderStyle = data.titleBorderStyle || 'solid';
                            const borderColor = data.titleBorderColor || '#10b981';
                            title.style.border = `${borderWidth}px ${borderStyle} ${borderColor}`;
                        } else {
                            title.style.border = 'none';
                        }
                        break;
                    case 'titleBorderColor':
                        if (this.selectedWidget.data.titleHasBorder) {
                            const borderWidth = this.selectedWidget.data.titleBorderWidth || 2;
                            const borderStyle = this.selectedWidget.data.titleBorderStyle || 'solid';
                            title.style.border = `${borderWidth}px ${borderStyle} ${value}`;
                        }
                        break;
                    case 'titleBorderWidth':
                        if (this.selectedWidget.data.titleHasBorder) {
                            const borderStyle = this.selectedWidget.data.titleBorderStyle || 'solid';
                            const borderColor = this.selectedWidget.data.titleBorderColor || '#10b981';
                            title.style.border = `${value}px ${borderStyle} ${borderColor}`;
                        }
                        break;
                    case 'titleBorderStyle':
                        if (this.selectedWidget.data.titleHasBorder) {
                            const borderWidth = this.selectedWidget.data.titleBorderWidth || 2;
                            const borderColor = this.selectedWidget.data.titleBorderColor || '#10b981';
                            title.style.border = `${borderWidth}px ${value} ${borderColor}`;
                        }
                        break;
                    
                    // Coins arrondis du titre
                    case 'titleHasRoundedCorners':
                        if (value) {
                            const borderRadius = this.selectedWidget.data.titleBorderRadius || 8;
                            title.style.borderRadius = `${borderRadius}px`;
                        } else {
                            title.style.borderRadius = '0px';
                        }
                        break;
                    case 'titleBorderRadius':
                        if (this.selectedWidget.data.titleHasRoundedCorners) {
                            title.style.borderRadius = `${value}px`;
                        }
                        break;
                    
                    // Espacement du titre - mise √† jour compl√®te via generateTitleStyles
                    case 'titlePaddingTop':
                    case 'titlePaddingBottom':
                    case 'titlePaddingLeft':
                    case 'titlePaddingRight':
                    case 'titleMarginBottom':
                        // R√©g√©n√©rer tous les styles pour l'espacement
                        const instanceForSpacing = this.selectedWidget.instance;
                        const newStylesForSpacing = instanceForSpacing.generateTitleStyles(this.selectedWidget.data);
                        title.setAttribute('style', newStylesForSpacing);
                        break;
                }
            }
            
            // Extension de la mise √† jour temps r√©el pour CTA - propri√©t√©s avanc√©es du titre
            updateCTAAdvancedRealTime(container, propertyName, value) {
                const title = container.querySelector('.cta-title, h2');
                
                if (!title) return;
                
                switch (propertyName) {
                    // Propri√©t√©s de style du titre
                    case 'titleSize':
                        title.style.fontSize = `${value}px`;
                        break;
                    case 'titleColor':
                        title.style.color = value;
                        break;
                    case 'titleAlignment':
                        title.style.textAlign = value;
                        break;
                    case 'titleIsBold':
                        title.style.fontWeight = value ? 'bold' : 'normal';
                        break;
                    case 'titleIsItalic':
                        title.style.fontStyle = value ? 'italic' : 'normal';
                        break;
                    
                    // Arri√®re-plan du titre
                    case 'titleHasBackground':
                        if (value) {
                            const data = this.selectedWidget.data;
                            const opacity = (data.titleBackgroundOpacity || 20) / 100;
                            const bgColor = data.titleBackgroundColor || '#10b981';
                            const hex = bgColor.replace('#', '');
                            const r = parseInt(hex.substr(0, 2), 16);
                            const g = parseInt(hex.substr(2, 2), 16);
                            const b = parseInt(hex.substr(4, 2), 16);
                            title.style.backgroundColor = `rgba(${r}, ${g}, ${b}, ${opacity})`;
                        } else {
                            title.style.backgroundColor = 'transparent';
                        }
                        break;
                    case 'titleBackgroundColor':
                    case 'titleBackgroundOpacity':
                        if (this.selectedWidget.data.titleHasBackground) {
                            const data = this.selectedWidget.data;
                            const opacity = (data.titleBackgroundOpacity || 20) / 100;
                            const bgColor = data.titleBackgroundColor || '#10b981';
                            const hex = bgColor.replace('#', '');
                            const r = parseInt(hex.substr(0, 2), 16);
                            const g = parseInt(hex.substr(2, 2), 16);
                            const b = parseInt(hex.substr(4, 2), 16);
                            title.style.backgroundColor = `rgba(${r}, ${g}, ${b}, ${opacity})`;
                        }
                        break;
                    
                    // Contour du titre
                    case 'titleHasBorder':
                        if (value) {
                            const data = this.selectedWidget.data;
                            const borderWidth = data.titleBorderWidth || 2;
                            const borderStyle = data.titleBorderStyle || 'solid';
                            const borderColor = data.titleBorderColor || '#10b981';
                            title.style.border = `${borderWidth}px ${borderStyle} ${borderColor}`;
                        } else {
                            title.style.border = 'none';
                        }
                        break;
                    case 'titleBorderColor':
                        if (this.selectedWidget.data.titleHasBorder) {
                            const borderWidth = this.selectedWidget.data.titleBorderWidth || 2;
                            const borderStyle = this.selectedWidget.data.titleBorderStyle || 'solid';
                            title.style.border = `${borderWidth}px ${borderStyle} ${value}`;
                        }
                        break;
                    case 'titleBorderWidth':
                        if (this.selectedWidget.data.titleHasBorder) {
                            const borderStyle = this.selectedWidget.data.titleBorderStyle || 'solid';
                            const borderColor = this.selectedWidget.data.titleBorderColor || '#10b981';
                            title.style.border = `${value}px ${borderStyle} ${borderColor}`;
                        }
                        break;
                    case 'titleBorderStyle':
                        if (this.selectedWidget.data.titleHasBorder) {
                            const borderWidth = this.selectedWidget.data.titleBorderWidth || 2;
                            const borderColor = this.selectedWidget.data.titleBorderColor || '#10b981';
                            title.style.border = `${borderWidth}px ${value} ${borderColor}`;
                        }
                        break;
                    
                    // Coins arrondis du titre
                    case 'titleHasRoundedCorners':
                        if (value) {
                            const borderRadius = this.selectedWidget.data.titleBorderRadius || 8;
                            title.style.borderRadius = `${borderRadius}px`;
                        } else {
                            title.style.borderRadius = '0px';
                        }
                        break;
                    case 'titleBorderRadius':
                        if (this.selectedWidget.data.titleHasRoundedCorners) {
                            title.style.borderRadius = `${value}px`;
                        }
                        break;
                    
                    // Espacement du titre - mise √† jour compl√®te via generateTitleStyles
                    case 'titlePaddingTop':
                    case 'titlePaddingBottom':
                    case 'titlePaddingLeft':
                    case 'titlePaddingRight':
                    case 'titleMarginBottom':
                        // R√©g√©n√©rer tous les styles pour l'espacement
                        const instanceForSpacing = this.selectedWidget.instance;
                        const newStylesForSpacing = instanceForSpacing.generateTitleStyles(this.selectedWidget.data);
                        title.setAttribute('style', newStylesForSpacing);
                        break;
                }
            }
            
            // Extension de la mise √† jour temps r√©el pour Comparison - propri√©t√©s avanc√©es du titre
            updateComparisonAdvancedRealTime(container, propertyName, value) {
                const title = container.querySelector('.comparison-title');
                
                if (!title) return;
                
                switch (propertyName) {
                    // Propri√©t√©s de style du titre principal
                    case 'titleSize':
                        title.style.fontSize = `${value}px`;
                        break;
                    case 'titleColor':
                        title.style.color = value;
                        break;
                    case 'titleAlignment':
                        title.style.textAlign = value;
                        break;
                    case 'titleIsBold':
                        title.style.fontWeight = value ? 'bold' : 'normal';
                        break;
                    case 'titleIsItalic':
                        title.style.fontStyle = value ? 'italic' : 'normal';
                        break;
                    
                    // Arri√®re-plan du titre
                    case 'titleHasBackground':
                        if (value) {
                            const data = this.selectedWidget.data;
                            const opacity = (data.titleBackgroundOpacity || 20) / 100;
                            const bgColor = data.titleBackgroundColor || '#10b981';
                            const hex = bgColor.replace('#', '');
                            const r = parseInt(hex.substr(0, 2), 16);
                            const g = parseInt(hex.substr(2, 2), 16);
                            const b = parseInt(hex.substr(4, 2), 16);
                            title.style.backgroundColor = `rgba(${r}, ${g}, ${b}, ${opacity})`;
                        } else {
                            title.style.backgroundColor = 'transparent';
                        }
                        break;
                    case 'titleBackgroundColor':
                    case 'titleBackgroundOpacity':
                        if (this.selectedWidget.data.titleHasBackground) {
                            const data = this.selectedWidget.data;
                            const opacity = (data.titleBackgroundOpacity || 20) / 100;
                            const bgColor = data.titleBackgroundColor || '#10b981';
                            const hex = bgColor.replace('#', '');
                            const r = parseInt(hex.substr(0, 2), 16);
                            const g = parseInt(hex.substr(2, 2), 16);
                            const b = parseInt(hex.substr(4, 2), 16);
                            title.style.backgroundColor = `rgba(${r}, ${g}, ${b}, ${opacity})`;
                        }
                        break;
                    
                    // Contour du titre
                    case 'titleHasBorder':
                        if (value) {
                            const data = this.selectedWidget.data;
                            const borderWidth = data.titleBorderWidth || 2;
                            const borderStyle = data.titleBorderStyle || 'solid';
                            const borderColor = data.titleBorderColor || '#10b981';
                            title.style.border = `${borderWidth}px ${borderStyle} ${borderColor}`;
                        } else {
                            title.style.border = 'none';
                        }
                        break;
                    case 'titleBorderColor':
                        if (this.selectedWidget.data.titleHasBorder) {
                            const borderWidth = this.selectedWidget.data.titleBorderWidth || 2;
                            const borderStyle = this.selectedWidget.data.titleBorderStyle || 'solid';
                            title.style.border = `${borderWidth}px ${borderStyle} ${value}`;
                        }
                        break;
                    case 'titleBorderWidth':
                        if (this.selectedWidget.data.titleHasBorder) {
                            const borderStyle = this.selectedWidget.data.titleBorderStyle || 'solid';
                            const borderColor = this.selectedWidget.data.titleBorderColor || '#10b981';
                            title.style.border = `${value}px ${borderStyle} ${borderColor}`;
                        }
                        break;
                    case 'titleBorderStyle':
                        if (this.selectedWidget.data.titleHasBorder) {
                            const borderWidth = this.selectedWidget.data.titleBorderWidth || 2;
                            const borderColor = this.selectedWidget.data.titleBorderColor || '#10b981';
                            title.style.border = `${borderWidth}px ${value} ${borderColor}`;
                        }
                        break;
                    
                    // Coins arrondis du titre
                    case 'titleHasRoundedCorners':
                        if (value) {
                            const borderRadius = this.selectedWidget.data.titleBorderRadius || 8;
                            title.style.borderRadius = `${borderRadius}px`;
                        } else {
                            title.style.borderRadius = '0px';
                        }
                        break;
                    case 'titleBorderRadius':
                        if (this.selectedWidget.data.titleHasRoundedCorners) {
                            title.style.borderRadius = `${value}px`;
                        }
                        break;
                    
                    // Propri√©t√©s sp√©cifiques aux colonnes
                    case 'obsoleteTitleColor':
                        const obsoleteTitle = container.querySelector('.obsolete-column h3');
                        if (obsoleteTitle) {
                            obsoleteTitle.style.color = value;
                        }
                        break;
                    case 'modernTitleColor':
                        const modernTitle = container.querySelector('.modern-column h3');
                        if (modernTitle) {
                            modernTitle.style.color = value;
                        }
                        break;
                    case 'obsoleteBackgroundColor':
                        const obsoleteColumn = container.querySelector('.obsolete-column');
                        if (obsoleteColumn) {
                            obsoleteColumn.style.background = value;
                        }
                        break;
                    case 'modernBackgroundColor':
                        const modernColumn = container.querySelector('.modern-column');
                        if (modernColumn) {
                            modernColumn.style.background = value;
                        }
                        break;
                    case 'obsoleteBorderColor':
                        const obsoleteColumnBorder = container.querySelector('.obsolete-column');
                        if (obsoleteColumnBorder) {
                            obsoleteColumnBorder.style.borderColor = value;
                        }
                        break;
                    case 'modernBorderColor':
                        const modernColumnBorder = container.querySelector('.modern-column');
                        if (modernColumnBorder) {
                            modernColumnBorder.style.borderColor = value;
                        }
                        break;
                    
                    // NOUVELLES PROPRI√âT√âS VS (SECTION VS)
                    case 'vsText':
                    case 'vsSize':
                    case 'vsColor':
                    case 'vsAlignment':
                    case 'vsIsBold':
                    case 'vsIsItalic':
                    case 'vsHasBackground':
                    case 'vsBackgroundColor':
                    case 'vsBackgroundOpacity':
                    case 'vsBackgroundGradient':
                    case 'vsGradientStart':
                    case 'vsGradientEnd':
                    case 'vsGradientDirection':
                    case 'vsHasBorder':
                    case 'vsBorderColor':
                    case 'vsBorderWidth':
                    case 'vsBorderStyle':
                    case 'vsHasRoundedCorners':
                    case 'vsBorderRadius':
                    case 'vsPaddingTop':
                    case 'vsPaddingBottom':
                    case 'vsPaddingLeft':
                    case 'vsPaddingRight':
                    case 'vsHasShadow':
                    case 'vsShadowColor':
                    case 'vsShadowOpacity':
                    case 'vsShadowOffsetX':
                    case 'vsShadowOffsetY':
                    case 'vsShadowBlur':
                        // Pour toutes les propri√©t√©s VS, r√©g√©n√©rer compl√®tement les styles
                        const vsSection = container.querySelector('.vs-section');
                        if (vsSection) {
                            const instanceForVS = this.selectedWidget.instance;
                            const newVSStyles = instanceForVS.generateVSStyles(this.selectedWidget.data);
                            vsSection.setAttribute('style', newVSStyles);
                            
                            // Mettre √† jour le texte si c'est vsText
                            if (propertyName === 'vsText') {
                                vsSection.textContent = value;
                            }
                        }
                        break;
                    
                    // Espacement du titre - mise √† jour compl√®te via generateTitleStyles
                    case 'titlePaddingTop':
                    case 'titlePaddingBottom':
                    case 'titlePaddingLeft':
                    case 'titlePaddingRight':
                    case 'titleMarginBottom':
                        // R√©g√©n√©rer tous les styles pour l'espacement
                        const instanceForSpacing = this.selectedWidget.instance;
                        const newStylesForSpacing = instanceForSpacing.generateTitleStyles(this.selectedWidget.data);
                        title.setAttribute('style', newStylesForSpacing);
                        break;
                }
            }

            switchPropertiesTab(tabName) {
                // Mettre √† jour les boutons
                document.querySelectorAll('.properties-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                
                // Mettre √† jour le contenu
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabName + 'Tab').classList.add('active');
            }


            duplicateWidget(widgetId = null) {
                const id = widgetId || (this.selectedWidget ? this.selectedWidget.id : null);
                if (!id) return;
                
                const originalWidget = this.widgets.find(w => w.id === id);
                if (!originalWidget) return;
                
                const duplicatedWidget = {
                    id: `widget-${Date.now()}`,
                    type: originalWidget.type,
                    instance: originalWidget.instance,
                    data: { ...originalWidget.data }
                };
                
                // Ins√©rer apr√®s l'original
                const index = this.widgets.findIndex(w => w.id === id);
                this.widgets.splice(index + 1, 0, duplicatedWidget);
                
                // Historique supprim√©
                this.renderCanvas();
                this.selectWidget(duplicatedWidget.id);
                this.updatePreview();
                
                document.getElementById('widgetCount').textContent = this.widgets.length;
                this.setStatus('Widget dupliqu√©', 'success');
            }

            deleteWidget(widgetId = null) {
                const id = widgetId || (this.selectedWidget ? this.selectedWidget.id : null);
                if (!id) return;
                
                if (!confirm('√ätes-vous s√ªr de vouloir supprimer ce widget ?')) return;
                
                // Supprimer le widget
                this.widgets = this.widgets.filter(w => w.id !== id);
                
                // R√©initialiser la s√©lection
                this.selectedWidget = null;
                
                // Historique supprim√©
                
                // Mettre √† jour l'interface
                this.renderCanvas();
                this.updatePropertiesPanel();
                this.updatePreview();
                
                // Mettre √† jour le compteur
                document.getElementById('widgetCount').textContent = this.widgets.length;
                
                // Afficher l'√©tat vide si n√©cessaire
                const emptyState = document.getElementById('emptyState');
                if (this.widgets.length === 0 && emptyState) {
                    emptyState.classList.remove('hidden');
                    emptyState.style.display = 'flex';
                }
                
                this.setStatus('Widget supprim√©', 'success');
                
                // Sauvegarde automatique apr√®s suppression du widget
                this.autoSave();
            }

            updatePreview() {
                const preview = document.getElementById('presentationPreview');
                
                // G√©n√©rer le header de pr√©visualisation
                const headerHtml = this.generatePreviewHeader();
                
                if (this.widgets.length === 0) {
                    preview.innerHTML = `
                        ${headerHtml}
                        <div style="grid-column: 1 / -1; grid-row: 1 / -1; display: flex; 
                                    flex-direction: column; align-items: center; justify-content: center; 
                                    text-align: center; color: #6b7280; margin-top: 60px;">
                            <i class="fas fa-eye" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                            <div>L'aper√ßu temps r√©el appara√Ætra ici</div>
                        </div>
                    `;
                    return;
                }
                
                let previewHtml = '';
                this.widgets.forEach(widget => {
                    const pos = widget.position || { col: 1, row: 1 };
                    const size = widget.size || { width: 3, height: 2 };
                    
                    previewHtml += `
                        <div class="preview-widget" 
                             style="grid-column: ${pos.col} / ${pos.col + size.width}; 
                                    grid-row: ${pos.row} / ${pos.row + size.height};">
                            ${widget.instance.render(widget.data)}
                        </div>
                    `;
                });
                
                preview.innerHTML = headerHtml + previewHtml;
                
                // Mettre √† jour aussi la pr√©visualisation plein √©cran si elle est ouverte
                this.updateFullscreenPreviewIfOpen();
            }

            // G√©n√©rer le header pour la pr√©visualisation
            generatePreviewHeader() {
                if (!this.viewerConfig) {
                    return ''; // Pas de header si la config n'est pas initialis√©e
                }

                const config = this.viewerConfig;
                const presentationDate = config.presentationDate ? 
                    new Date(config.presentationDate).toLocaleDateString('fr-FR', { 
                        year: 'numeric', month: 'long', day: 'numeric' 
                    }) : 
                    new Date().toLocaleDateString('fr-FR', { 
                        year: 'numeric', month: 'long', day: 'numeric' 
                    });

                // Construire le titre complet
                let fullTitle = config.title;
                if (config.clientName) {
                    fullTitle += ` - ${config.clientName}`;
                }
                if (config.projectName) {
                    fullTitle += ` (${config.projectName})`;
                }

                return `
                    <div class="preview-header-overlay" 
                         style="position: absolute; top: 0; left: 0; right: 0; z-index: 10;
                                background: linear-gradient(135deg, var(--bg-secondary), var(--bg-primary));
                                border-bottom: 2px solid ${config.accentColor};
                                padding: 12px 16px; display: flex; justify-content: space-between;
                                align-items: center; font-size: 0.875rem; color: var(--text-white);">
                        <div style="display: flex; align-items: center; gap: 8px; font-weight: 600;">
                            ${config.customLogo ? 
                                `<img src="${config.customLogo}" style="width: 20px; height: 20px; border-radius: 4px;" onerror="this.style.display='none'; this.nextSibling.style.display='inline';">` : 
                                ''
                            }
                            <i class="fas fa-presentation" style="color: ${config.accentColor}; ${config.customLogo ? 'display: none;' : ''}"></i>
                            <span>${fullTitle}</span>
                        </div>
                        <div style="text-align: right; font-size: 0.75rem; color: var(--text-gray);">
                            <div style="font-weight: 600; color: var(--text-white); margin-bottom: 2px;">${presentationDate}</div>
                            <div>${config.subtitle}</div>
                        </div>
                    </div>
                    <div style="height: 60px;"></div>
                `;
            }

            // Gestion de la recherche dynamique
            handleSearch(term) {
                this.searchTerm = term.toLowerCase().trim();
                const library = document.getElementById('widgetLibrary');
                
                if (this.searchTerm === '') {
                    // Retour √† l'affichage normal
                    library.classList.remove('search-active');
                    this.renderCurrentFolder();
                    return;
                }
                
                // Mode recherche actif
                library.classList.add('search-active');
                this.renderSearchResults();
            }
            
            // Rendu des r√©sultats de recherche
            renderSearchResults() {
                const searchResults = document.getElementById('searchResults');
                if (!searchResults) return;
                
                const results = [];
                
                // Rechercher dans tous les widgets
                this.availableWidgets.forEach(widget => {
                    const name = widget.name.toLowerCase();
                    const description = (widget.description || '').toLowerCase();
                    const category = (widget.category || '').toLowerCase();
                    
                    if (name.includes(this.searchTerm) || 
                        description.includes(this.searchTerm) ||
                        category.includes(this.searchTerm)) {
                        results.push(widget);
                    }
                });
                
                // Rechercher dans les noms de dossiers
                const folderResults = [];
                Object.entries(this.folders).forEach(([id, folder]) => {
                    if (folder.name.toLowerCase().includes(this.searchTerm)) {
                        folderResults.push({ id, ...folder });
                    }
                });
                
                // Afficher les r√©sultats
                searchResults.innerHTML = '';
                
                if (folderResults.length > 0) {
                    const foldersSection = document.createElement('div');
                    foldersSection.innerHTML = `
                        <div style="font-weight: bold; color: var(--text-white); margin-bottom: 8px; padding: 4px 8px;">
                            <i class="fas fa-folder"></i> Dossiers (${folderResults.length})
                        </div>
                    `;
                    
                    folderResults.forEach(folder => {
                        const folderItem = document.createElement('div');
                        folderItem.className = 'folder-item';
                        folderItem.dataset.folder = folder.id;
                        folderItem.innerHTML = `
                            <i class="fas fa-folder folder-icon"></i>
                            <span class="folder-name">${folder.name}</span>
                            <span class="folder-count">${folder.widgets.length}</span>
                        `;
                        foldersSection.appendChild(folderItem);
                    });
                    
                    searchResults.appendChild(foldersSection);
                }
                
                if (results.length > 0) {
                    const widgetsSection = document.createElement('div');
                    widgetsSection.innerHTML = `
                        <div style="font-weight: bold; color: var(--text-white); margin-bottom: 8px; padding: 4px 8px; margin-top: 16px;">
                            <i class="fas fa-puzzle-piece"></i> Widgets (${results.length})
                        </div>
                    `;
                    
                    results.forEach(widget => {
                        const widgetItem = this.createWidgetItem(widget);
                        widgetsSection.appendChild(widgetItem);
                    });
                    
                    searchResults.appendChild(widgetsSection);
                }
                
                if (results.length === 0 && folderResults.length === 0) {
                    searchResults.innerHTML = `
                        <div style="padding: 2rem; text-align: center; color: var(--text-muted);">
                            <i class="fas fa-search" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                            <div>Aucun r√©sultat pour "${this.searchTerm}"</div>
                        </div>
                    `;
                }
            }

            // Syst√®me d'historique supprim√© pour simplifier le code

            // Fonction saveProject() supprim√©e - Focus uniquement sur les widgets individuels
            
            // Calculer les statistiques des widgets par type
            getWidgetStats() {
                const stats = {};
                this.widgets.forEach(widget => {
                    const type = widget.type;
                    stats[type] = (stats[type] || 0) + 1;
                });
                return stats;
            }
            
            // Calculer l'utilisation de la grille
            calculateGridUsage() {
                let usedCells = 0;
                const totalCells = 12 * 8; // 96 cellules totales
                
                this.widgets.forEach(widget => {
                    const pos = widget.position || { col: 1, row: 1 };
                    const size = widget.size || { width: 3, height: 2 };
                    usedCells += size.width * size.height;
                });
                
                return {
                    used: usedCells,
                    total: totalCells,
                    percentage: Math.round((usedCells / totalCells) * 100)
                };
            }
            
            // M√©thodes dossiers et recherche
            
            // S√©lection d'un dossier
            selectFolder(folderId) {
                // Mettre √† jour l'UI
                document.querySelectorAll('.folder-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector(`[data-folder="${folderId}"]`)?.classList.add('active');
                
                this.currentFolder = folderId;
                this.renderCurrentFolder();
                this.setStatus(`Dossier "${this.folders[folderId]?.name || folderId}" s√©lectionn√©`, 'info');
            }
            
            // Gestion des favoris
            toggleFavorite(widgetId) {
                if (this.favoriteWidgets.has(widgetId)) {
                    this.favoriteWidgets.delete(widgetId);
                } else {
                    this.favoriteWidgets.add(widgetId);
                }
                
                this.saveLocalData();
                this.updateFolderStructure();
                
                // Re-rendre si on est dans les favoris
                if (this.currentFolder === 'favorites') {
                    this.renderCurrentFolder();
                }
                
                // Rafra√Æchir les r√©sultats de recherche si actifs
                if (this.searchTerm) {
                    this.renderSearchResults();
                } else {
                    this.renderCurrentFolder();
                }
            }
            
            // Ajouter aux r√©cents
            addToRecent(widgetId) {
                this.recentWidgets.delete(widgetId); // Supprimer s'il existe d√©j√†
                this.recentWidgets.add(widgetId); // Ajouter en premier
                
                // Garder seulement les 10 plus r√©cents
                if (this.recentWidgets.size > 10) {
                    const items = Array.from(this.recentWidgets);
                    this.recentWidgets = new Set(items.slice(-10));
                }
                
                this.saveLocalData();
                this.updateFolderStructure();
            }
            
            // Cr√©er un nouveau dossier
            createNewFolder() {
                const name = prompt('Nom du nouveau dossier :');
                if (!name || name.trim() === '') return;
                
                const folderId = 'custom_' + Date.now();
                this.folders[folderId] = {
                    name: name.trim(),
                    widgets: [],
                    type: 'custom'
                };
                
                this.saveLocalData();
                this.renderCustomFolders();
                this.selectFolder(folderId);
                
                this.setStatus(`Dossier "${name}" cr√©√©`, 'success');
            }
            
            // Rendu des dossiers personnalis√©s
            renderCustomFolders() {
                const container = document.getElementById('customFolders');
                const customFolders = Object.entries(this.folders).filter(([id, folder]) => folder.type === 'custom');
                
                container.innerHTML = '';
                
                customFolders.forEach(([id, folder]) => {
                    const folderItem = document.createElement('div');
                    folderItem.className = 'folder-item';
                    folderItem.dataset.folder = id;
                    folderItem.innerHTML = `
                        <i class="fas fa-folder folder-icon"></i>
                        <span class="folder-name">${folder.name}</span>
                        <span class="folder-count">${folder.widgets.length}</span>
                        <div class="folder-controls">
                            <button class="folder-control-btn" onclick="widgetEditor.renameFol

Folder('${id}')" title="Renommer">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="folder-control-btn" onclick="widgetEditor.deleteFolder('${id}')" title="Supprimer">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    container.appendChild(folderItem);
                });
            }
            
            // Renommer un dossier
            renameFolder(folderId) {
                const folder = this.folders[folderId];
                if (!folder || folder.type !== 'custom') return;
                
                const newName = prompt('Nouveau nom :', folder.name);
                if (!newName || newName.trim() === '' || newName.trim() === folder.name) return;
                
                folder.name = newName.trim();
                this.saveLocalData();
                this.renderCustomFolders();
                
                this.setStatus(`Dossier renomm√© en "${newName}"`, 'success');
            }
            
            // Supprimer un dossier
            deleteFolder(folderId) {
                const folder = this.folders[folderId];
                if (!folder || folder.type !== 'custom') return;
                
                if (!confirm(`Supprimer le dossier "${folder.name}" ?\nLes widgets ne seront pas supprim√©s.`)) return;
                
                delete this.folders[folderId];
                this.saveLocalData();
                this.renderCustomFolders();
                
                // Retourner √† "Tous les widgets" si on √©tait dans ce dossier
                if (this.currentFolder === folderId) {
                    this.selectFolder('root');
                }
                
                this.setStatus(`Dossier "${folder.name}" supprim√©`, 'success');
            }
            
            // Fonction loadSavedProjects() supprim√©e - Focus uniquement sur les widgets
            
            // Charger les donn√©es locales
            loadLocalData() {
                const data = JSON.parse(localStorage.getItem('widgetEditor_userData') || '{}');
                this.favoriteWidgets = new Set(data.favorites || []);
                this.recentWidgets = new Set(data.recent || []);
                this.folders = { ...this.folders, ...(data.customFolders || {}) };
                
                this.renderCustomFolders();
            }
            
            // Sauvegarder les donn√©es locales
            saveLocalData() {
                const data = {
                    favorites: Array.from(this.favoriteWidgets),
                    recent: Array.from(this.recentWidgets),
                    customFolders: Object.fromEntries(
                        Object.entries(this.folders).filter(([id, folder]) => folder.type === 'custom')
                    )
                };
                localStorage.setItem('widgetEditor_userData', JSON.stringify(data));
            }
            
            // Fonction loadProject() supprim√©e - Focus uniquement sur les widgets individuels
            
            // M√©thodes pr√©visualisation plein √©cran
            
            // Ouvrir la popup de pr√©visualisation plein √©cran
            openFullscreenPreview() {
                const popup = document.getElementById('previewPopup');
                popup.classList.add('active');
                
                // Emp√™cher le scroll sur le body
                document.body.style.overflow = 'hidden';
                
                // Rendre la pr√©visualisation
                this.renderFullscreenPreview();
                
                this.setStatus('Pr√©visualisation plein √©cran ouverte', 'info');
            }
            
            // Fermer la popup de pr√©visualisation
            closeFullscreenPreview() {
                const popup = document.getElementById('previewPopup');
                popup.classList.remove('active');
                
                // R√©activer le scroll sur le body
                document.body.style.overflow = 'auto';
                
                this.setStatus('Pr√©visualisation ferm√©e', 'info');
            }
            
            // Rendre la pr√©visualisation finale - copie exacte de updatePreview()
            renderFullscreenPreview() {
                const previewGrid = document.getElementById('previewGrid');
                
                if (this.widgets.length === 0) {
                    previewGrid.innerHTML = `
                        <div style="grid-column: 1 / -1; grid-row: 1 / -1; display: flex; 
                                    flex-direction: column; align-items: center; justify-content: center; 
                                    text-align: center; color: #6b7280;">
                            <i class="fas fa-eye" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.3;"></i>
                            <div>L'aper√ßu temps r√©el appara√Ætra ici</div>
                        </div>
                    `;
                    return;
                }
                
                let previewHtml = '';
                this.widgets.forEach(widget => {
                    const pos = widget.position || { col: 1, row: 1 };
                    const size = widget.size || { width: 3, height: 2 };
                    
                    previewHtml += `
                        <div class="preview-widget" 
                             style="grid-column: ${pos.col} / ${pos.col + size.width}; 
                                    grid-row: ${pos.row} / ${pos.row + size.height};">
                            ${widget.instance.render(widget.data)}
                        </div>
                    `;
                });
                
                previewGrid.innerHTML = previewHtml;
            }
            
            // Mettre √† jour la pr√©visualisation si elle est ouverte
            updateFullscreenPreviewIfOpen() {
                const popup = document.getElementById('previewPopup');
                if (popup && popup.classList.contains('active')) {
                    this.renderFullscreenPreview();
                }
            }

            // Fonction exportProject() supprim√©e - Focus uniquement sur les widgets individuels


            // Trouver une position libre sur la grille (placement intelligent centre-vers-ext√©rieur)
            findFreeGridPosition(width = 3, height = 2) {
                // Positions prioritaires : centre vers l'ext√©rieur
                const centerCol = Math.floor(12 / 2) - Math.floor(width / 2) + 1;
                const centerRow = Math.floor(8 / 2) - Math.floor(height / 2) + 1;
                
                // Positions candidates par priorit√© (centre vers ext√©rieur)
                const candidates = [];
                
                // Ajouter le centre en premier
                candidates.push({ col: centerCol, row: centerRow });
                
                // Puis ajouter les positions en spirale depuis le centre
                for (let radius = 1; radius <= 6; radius++) {
                    for (let row = Math.max(1, centerRow - radius); row <= Math.min(8, centerRow + radius); row++) {
                        for (let col = Math.max(1, centerCol - radius); col <= Math.min(12, centerCol + radius); col++) {
                            // √âviter les positions d√©j√† ajout√©es
                            if (!candidates.some(c => c.col === col && c.row === row)) {
                                candidates.push({ col, row });
                            }
                        }
                    }
                }
                
                // Tester chaque position candidate
                for (const pos of candidates) {
                    if (this.isPositionFree(pos.col, pos.row, width, height)) {
                        return pos;
                    }
                }
                
                // Fallback : premi√®re position disponible
                for (let row = 1; row <= 8; row++) {
                    for (let col = 1; col <= 12; col++) {
                        if (this.isPositionFree(col, row, width, height)) {
                            return { col, row };
                        }
                    }
                }
                
                // Si vraiment pas de place, placer au centre avec chevauchement
                return { col: centerCol, row: centerRow };
            }
            
            // V√©rifier si une position est libre
            isPositionFree(col, row, width, height) {
                // V√©rifier les limites de grille
                if (col + width - 1 > 12 || row + height - 1 > 8) {
                    return false;
                }
                
                // V√©rifier les collisions avec d'autres widgets
                for (const widget of this.widgets) {
                    const pos = widget.position || { col: 1, row: 1 };
                    const size = widget.size || { width: 3, height: 2 };
                    
                    // V√©rifier si les rectangles se chevauchent
                    if (!(col >= pos.col + size.width || 
                          col + width <= pos.col || 
                          row >= pos.row + size.height || 
                          row + height <= pos.row)) {
                        return false;
                    }
                }
                
                return true;
            }
            
            // Configuration du drag & drop
            // Fonction de drag & drop fonctionnelle avec sauvegarde de position
            setupDragDrop(container, widget) {
                let isDragging = false;
                let startX, startY;
                let originalPosition = { ...widget.position } || { col: 1, row: 1 };
                
                const onMouseDown = (e) => {
                    // Ignorer les clics sur les boutons
                    if (e.target.tagName === 'BUTTON' || e.target.closest('button') || e.target.closest('.widget-container-header')) {
                        return;
                    }
                    
                    isDragging = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    originalPosition = { ...widget.position } || { col: 1, row: 1 };
                    
                    container.classList.add('dragging');
                    container.style.opacity = '0.8';
                    container.style.zIndex = '1000';
                    
                    e.preventDefault();
                    e.stopPropagation();
                    
                    document.addEventListener('mousemove', onMouseMove);
                    document.addEventListener('mouseup', onMouseUp);
                };
                
                const onMouseMove = (e) => {
                    if (!isDragging) return;
                    
                    const workspace = document.getElementById('canvasWorkspace');
                    if (!workspace) return;
                    
                    const rect = workspace.getBoundingClientRect();
                    const padding = 32; // Padding de la grille
                    
                    // Dimensions r√©elles de la grille utilisable
                    const gridWidth = rect.width - (padding * 2);
                    const gridHeight = rect.height - (padding * 2);
                    
                    // Taille d'une cellule (en tenant compte du gap de 8px)
                    const cellWidth = (gridWidth - (11 * 8)) / 12; // 11 gaps entre 12 colonnes
                    const cellHeight = (gridHeight - (7 * 8)) / 8;   // 7 gaps entre 8 rang√©es
                    
                    // Calcul du d√©placement
                    const deltaX = e.clientX - startX;
                    const deltaY = e.clientY - startY;
                    
                    // Conversion en d√©placement de grille
                    const deltaCol = Math.round(deltaX / (cellWidth + 8)); // +8 pour le gap
                    const deltaRow = Math.round(deltaY / (cellHeight + 8)); // +8 pour le gap
                    
                    // Nouvelle position avec contraintes
                    const size = widget.size || { width: 3, height: 2 };
                    let newCol = Math.max(1, Math.min(12 - size.width + 1, originalPosition.col + deltaCol));
                    let newRow = Math.max(1, Math.min(8 - size.height + 1, originalPosition.row + deltaRow));
                    
                    // Mise √† jour visuelle temporaire
                    container.style.gridColumnStart = newCol;
                    container.style.gridColumnEnd = newCol + size.width;
                    container.style.gridRowStart = newRow;
                    container.style.gridRowEnd = newRow + size.height;
                };
                
                const onMouseUp = (e) => {
                    if (!isDragging) return;
                    
                    isDragging = false;
                    container.classList.remove('dragging');
                    container.style.opacity = '';
                    container.style.zIndex = '10';
                    
                    // Calculer la position finale d√©finitive
                    const workspace = document.getElementById('canvasWorkspace');
                    if (!workspace) return;
                    
                    const rect = workspace.getBoundingClientRect();
                    const padding = 32;
                    const gridWidth = rect.width - (padding * 2);
                    const gridHeight = rect.height - (padding * 2);
                    const cellWidth = (gridWidth - (11 * 8)) / 12;
                    const cellHeight = (gridHeight - (7 * 8)) / 8;
                    
                    const deltaX = e.clientX - startX;
                    const deltaY = e.clientY - startY;
                    const deltaCol = Math.round(deltaX / (cellWidth + 8));
                    const deltaRow = Math.round(deltaY / (cellHeight + 8));
                    
                    const size = widget.size || { width: 3, height: 2 };
                    let newCol = Math.max(1, Math.min(12 - size.width + 1, originalPosition.col + deltaCol));
                    let newRow = Math.max(1, Math.min(8 - size.height + 1, originalPosition.row + deltaRow));
                    
                    // CRUCIAL: Sauvegarder d√©finitivement la nouvelle position
                    widget.position = { col: newCol, row: newRow };
                    
                    // Appliquer la position finale CSS
                    container.style.gridColumnStart = newCol;
                    container.style.gridColumnEnd = newCol + size.width;
                    container.style.gridRowStart = newRow;
                    container.style.gridRowEnd = newRow + size.height;
                    
                    // Synchroniser avec le widget s√©lectionn√© si c'est le cas
                    if (this.selectedWidget && this.selectedWidget.id === widget.id) {
                        this.selectedWidget.position = { col: newCol, row: newRow };
                        
                        // Mettre √† jour les sliders de position dans l'onglet Organisation
                        const colSlider = document.getElementById('positionColSlider');
                        const rowSlider = document.getElementById('positionRowSlider');
                        if (colSlider) colSlider.value = newCol;
                        if (rowSlider) rowSlider.value = newRow;
                        
                    }
                    
                    // Mettre √† jour l'aper√ßu
                    this.updatePreview();
                    
                    // Mettre √† jour le conteneur arri√®re-plan si activ√©
                    this.updateBackgroundContainer();
                    
                    // Message de confirmation
                    this.setStatus(`Widget repositionn√©: colonne ${newCol}, rang√©e ${newRow}`, 'success');
                    
                    // Nettoyer les √©v√©nements
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                };
                
                // Attacher l'√©v√©nement mousedown
                container.addEventListener('mousedown', onMouseDown);
            }
            
            // Configuration du redimensionnement
            setupResize(container, widget) {
                const handles = container.querySelectorAll('.resize-handle');
                
                handles.forEach(handle => {
                    handle.addEventListener('mousedown', (e) => {
                        e.stopPropagation();
                        this.startResize(e, handle, container, widget);
                    });
                });
            }
            
            // D√©marrer le redimensionnement
            startResize(e, handle, container, widget) {
                const direction = handle.dataset.direction;
                const startX = e.clientX;
                const startY = e.clientY;
                const startSize = { ...widget.size } || { width: 3, height: 2 };
                const startPos = { ...widget.position } || { col: 1, row: 1 };
                
                const handleMouseMove = (e) => {
                    const deltaX = e.clientX - startX;
                    const deltaY = e.clientY - startY;
                    
                    // Calculer la nouvelle taille selon la direction
                    let newSize = { ...startSize };
                    let newPos = { ...startPos };
                    
                    if (direction.includes('e')) {
                        newSize.width = Math.max(1, startSize.width + Math.round(deltaX / 60));
                    }
                    if (direction.includes('w')) {
                        const deltaWidth = Math.round(deltaX / -60);
                        newSize.width = Math.max(1, startSize.width + deltaWidth);
                        newPos.col = Math.max(1, startPos.col - deltaWidth);
                    }
                    if (direction.includes('s')) {
                        newSize.height = Math.max(1, startSize.height + Math.round(deltaY / 60));
                    }
                    if (direction.includes('n')) {
                        const deltaHeight = Math.round(deltaY / -60);
                        newSize.height = Math.max(1, startSize.height + deltaHeight);
                        newPos.row = Math.max(1, startPos.row - deltaHeight);
                    }
                    
                    // V√©rifier les limites
                    if (newPos.col + newSize.width - 1 <= 12 && newPos.row + newSize.height - 1 <= 8) {
                        widget.size = newSize;
                        widget.position = newPos;
                        
                        // Mettre √† jour le style du conteneur
                        container.style.gridColumnStart = newPos.col;
                        container.style.gridColumnEnd = newPos.col + newSize.width;
                        container.style.gridRowStart = newPos.row;
                        container.style.gridRowEnd = newPos.row + newSize.height;
                    }
                };
                
                const handleMouseUp = () => {
                    document.removeEventListener('mousemove', handleMouseMove);
                    document.removeEventListener('mouseup', handleMouseUp);
                    
                    this.updatePreview();
                    this.setStatus('Widget redimensionn√©', 'success');
                };
                
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseUp);
            }
            
            // Cr√©er le bouton d'export vers viewer
            createExportButton() {
                const viewerControls = document.querySelector('.viewer-controls');
                if (viewerControls && !document.getElementById('exportViewerBtn')) {
                    const exportBtn = document.createElement('button');
                    exportBtn.id = 'exportViewerBtn';
                    exportBtn.className = 'btn btn-sm';
                    exportBtn.innerHTML = '<i class="fas fa-download"></i> Exporter Viewer';
                    exportBtn.title = 'Exporter vers le dossier viewers pour pr√©sentation client';
                    exportBtn.addEventListener('click', () => this.exportToStaticViewer());
                    viewerControls.appendChild(exportBtn);
                }
            }

            // Exporter vers le viewer statique
            exportToStaticViewer() {
                try {
                    // Pr√©parer les donn√©es des widgets
                    const widgetsData = this.widgets.map(widget => ({
                        type: widget.type,
                        position: widget.position || { col: 1, row: 1 },
                        size: widget.size || { width: 3, height: 2 },
                        content: widget.instance.render(widget.data)
                    }));

                    // G√©n√©rer le nom de fichier avec timestamp
                    const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
                    const filename = `presentation-client-${timestamp}.html`;

                    // Cr√©er le contenu du viewer
                    const viewerHtml = this.generateViewerHtml(widgetsData);

                    // T√©l√©charger le fichier
                    this.downloadFile(viewerHtml, filename);

                    this.setStatus('Viewer export√© avec succ√®s !', 'success');

                } catch (error) {
                    console.error('Erreur lors de l\'export:', error);
                    this.setStatus('Erreur lors de l\'export du viewer', 'error');
                }
            }

            // G√©n√©rer le HTML du viewer client avec configuration personnalis√©e
            generateViewerHtml(widgetsData) {
                const config = this.viewerConfig || {
                    title: 'Eds Qu√©bec - Pr√©sentation Marketing',
                    subtitle: 'Version Client - Confidentiel',
                    clientName: '',
                    projectName: '',
                    presentationDate: new Date().toISOString().split('T')[0],
                    accentColor: '#10b981',
                    customLogo: '',
                    copyrightText: '¬© 2024 Eds Qu√©bec - Pr√©sentation Marketing',
                    legalText: 'Document confidentiel - Ne pas diffuser'
                };

                const widgetsHtml = widgetsData.map(widget => `
                    <div class="widget-item" 
                         style="grid-column: ${widget.position.col} / ${widget.position.col + widget.size.width}; 
                                grid-row: ${widget.position.row} / ${widget.position.row + widget.size.height};"
                         data-widget-type="${widget.type}">
                        ${widget.content}
                    </div>
                `).join('');

                // Utiliser la date configur√©e ou la date actuelle
                const presentationDate = config.presentationDate ? 
                    new Date(config.presentationDate) : new Date();
                const dateStr = presentationDate.toLocaleDateString('fr-FR', { 
                    year: 'numeric', month: 'long', day: 'numeric' 
                });
                const now = new Date();
                const timeStr = now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });

                // Construire le titre complet
                let fullTitle = config.title;
                if (config.clientName) {
                    fullTitle += ` - ${config.clientName}`;
                }
                if (config.projectName) {
                    fullTitle += ` (${config.projectName})`;
                }

                return `<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${fullTitle} - Viewer Marketing</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    ${this.getViewerStyles(config.accentColor)}
</head>
<body>
    <div class="viewer-container">
        <div class="viewer-header">
            <div class="viewer-header-content">
                <div class="viewer-logo">
                    ${config.customLogo ? 
                        `<img src="${config.customLogo}" style="width: 32px; height: 32px; border-radius: var(--border-radius);" onerror="this.style.display='none'; this.nextSibling.style.display='inline';">` : 
                        ''
                    }
                    <i class="fas fa-presentation" style="${config.customLogo ? 'display: none;' : ''}"></i>
                    <span>${fullTitle}</span>
                </div>
                <div class="viewer-info">
                    <div class="viewer-date">${dateStr}</div>
                    <div>${config.subtitle}</div>
                </div>
            </div>
        </div>
        
        <div class="viewer-content">
            <div class="presentation-grid">
                ${widgetsHtml || '<div class="presentation-empty"><i class="fas fa-presentation"></i><h3>Aucun contenu</h3><p>Cette pr√©sentation ne contient aucun widget</p></div>'}
            </div>
        </div>
        
        <div class="viewer-footer">
            <div class="footer-content">
                <span>${config.copyrightText}</span>
                <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 4px;">
                    <span>G√©n√©r√© le ${now.toLocaleDateString('fr-FR')} √† ${timeStr}</span>
                    <span style="font-size: 0.75em;">${config.legalText}</span>
                </div>
            </div>
        </div>
    </div>
</body>
</html>`;
            }

            // Obtenir les styles CSS pour le viewer avec couleur d'accent personnalis√©e
            getViewerStyles(accentColor = '#10b981') {
                return `<style>
                    /* Variables CSS pour le viewer */
                    :root {
                        --bg-primary: #0f172a;
                        --bg-secondary: #1e293b;
                        --bg-card: #334155;
                        --text-white: #ffffff;
                        --text-gray: #94a3b8;
                        --text-muted: #64748b;
                        --accent-green: ${accentColor};
                        --border-color: #334155;
                        --spacing-md: 1rem;
                        --spacing-lg: 1.5rem;
                        --spacing-xl: 2rem;
                        --border-radius: 0.5rem;
                        --border-radius-lg: 0.75rem;
                        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
                        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
                        --font-primary: 'Inter', system-ui, sans-serif;
                        --font-semibold: 600;
                        --font-bold: 700;
                        --text-sm: 0.875rem;
                        --text-lg: 1.125rem;
                        --text-xl: 1.25rem;
                        --text-2xl: 1.5rem;
                        --transition-normal: 0.3s ease;
                    }

                    * { margin: 0; padding: 0; box-sizing: border-box; }

                    body {
                        font-family: var(--font-primary);
                        background: var(--bg-primary);
                        color: var(--text-white);
                        min-height: 100vh;
                        line-height: 1.6;
                    }

                    .viewer-container {
                        width: 100%;
                        min-height: 100vh;
                        display: flex;
                        flex-direction: column;
                    }

                    .viewer-header {
                        background: linear-gradient(135deg, var(--bg-secondary), var(--bg-primary));
                        border-bottom: 2px solid var(--accent-green);
                        padding: var(--spacing-lg) var(--spacing-xl);
                        position: sticky;
                        top: 0;
                        z-index: 1000;
                        backdrop-filter: blur(10px);
                        box-shadow: var(--shadow-lg);
                    }

                    .viewer-header-content {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        max-width: 1400px;
                        margin: 0 auto;
                    }

                    .viewer-logo {
                        display: flex;
                        align-items: center;
                        gap: var(--spacing-md);
                        font-size: var(--text-xl);
                        font-weight: var(--font-bold);
                        color: var(--text-white);
                    }

                    .viewer-logo i {
                        font-size: var(--text-2xl);
                        color: var(--accent-green);
                        background: rgba(16, 185, 129, 0.1);
                        padding: var(--spacing-md);
                        border-radius: var(--border-radius);
                    }

                    .viewer-info {
                        text-align: right;
                        color: var(--text-gray);
                        font-size: var(--text-sm);
                    }

                    .viewer-date {
                        font-weight: var(--font-semibold);
                        color: var(--text-white);
                        margin-bottom: 0.25rem;
                    }

                    .viewer-content {
                        flex: 1;
                        padding: var(--spacing-xl);
                        overflow: auto;
                        background: linear-gradient(180deg, var(--bg-primary) 0%, rgba(15, 23, 42, 0.95) 100%);
                    }

                    .presentation-grid {
                        width: 100%;
                        max-width: 1400px;
                        margin: 0 auto;
                        background: var(--bg-secondary);
                        border-radius: var(--border-radius-lg);
                        box-shadow: var(--shadow-xl);
                        overflow: hidden;
                        display: grid;
                        grid-template-columns: repeat(12, 1fr);
                        grid-template-rows: repeat(8, minmax(100px, 1fr));
                        gap: 8px;
                        padding: var(--spacing-lg);
                        min-height: 700px;
                        border: 1px solid var(--border-color);
                    }

                    .widget-item {
                        border-radius: var(--border-radius);
                        overflow: hidden;
                        display: flex;
                        flex-direction: column;
                        background: rgba(248, 250, 252, 0.02);
                        transition: var(--transition-normal);
                        position: relative;
                    }

                    .widget-item:hover {
                        transform: translateY(-2px);
                        box-shadow: var(--shadow-lg);
                        background: rgba(248, 250, 252, 0.05);
                    }

                    .presentation-empty {
                        grid-column: 1 / -1;
                        grid-row: 1 / -1;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        text-align: center;
                        color: var(--text-muted);
                        font-size: var(--text-lg);
                        padding: var(--spacing-xl);
                    }

                    .presentation-empty i {
                        font-size: 4rem;
                        margin-bottom: var(--spacing-lg);
                        opacity: 0.3;
                        color: var(--accent-green);
                    }

                    .presentation-empty h3 {
                        font-size: var(--text-xl);
                        font-weight: var(--font-semibold);
                        margin-bottom: 0.5rem;
                        color: var(--text-white);
                    }

                    .viewer-footer {
                        background: var(--bg-secondary);
                        border-top: 1px solid var(--border-color);
                        padding: var(--spacing-lg) var(--spacing-xl);
                        margin-top: auto;
                    }

                    .footer-content {
                        max-width: 1400px;
                        margin: 0 auto;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        font-size: var(--text-sm);
                        color: var(--text-muted);
                    }

                    .footer-content span:first-child {
                        font-weight: var(--font-semibold);
                        color: var(--text-white);
                    }

                    @keyframes fadeInUp {
                        from { opacity: 0; transform: translateY(30px); }
                        to { opacity: 1; transform: translateY(0); }
                    }

                    .widget-item { animation: fadeInUp 0.6s ease-out; }
                    .widget-item:nth-child(2) { animation-delay: 0.1s; }
                    .widget-item:nth-child(3) { animation-delay: 0.2s; }
                    .widget-item:nth-child(4) { animation-delay: 0.3s; }
                    .widget-item:nth-child(5) { animation-delay: 0.4s; }

                    @media (max-width: 768px) {
                        .viewer-header { padding: var(--spacing-md); }
                        .viewer-header-content { flex-direction: column; gap: 0.5rem; text-align: center; }
                        .viewer-content { padding: var(--spacing-md); }
                        .presentation-grid {
                            grid-template-columns: repeat(6, 1fr);
                            grid-template-rows: repeat(12, minmax(80px, 1fr));
                            padding: var(--spacing-md);
                        }
                        .footer-content { flex-direction: column; gap: 0.25rem; text-align: center; }
                    }

                    @media print {
                        body { background: white; color: black; }
                        .viewer-header, .viewer-footer { background: white; color: black; border-color: #ccc; }
                        .presentation-grid { background: white; box-shadow: none; border: 1px solid #ccc; }
                        .widget-item { background: white; border: 1px solid #eee; }
                    }
                </style>`;
            }

            // Fonction pour t√©l√©charger un fichier
            downloadFile(content, filename) {
                const blob = new Blob([content], { type: 'text/html;charset=utf-8' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }

            // Configuration du viewer
            initializeViewerConfig() {
                // Configuration par d√©faut du viewer
                this.viewerConfig = {
                    title: 'Eds Qu√©bec - Pr√©sentation Marketing',
                    subtitle: 'Version Client - Confidentiel',
                    clientName: '',
                    projectName: '',
                    presentationDate: new Date().toISOString().split('T')[0],
                    accentColor: '#10b981',
                    customLogo: '',
                    copyrightText: '¬© 2024 Eds Qu√©bec - Pr√©sentation Marketing',
                    legalText: 'Document confidentiel - Ne pas diffuser'
                };

                // Event listeners pour l'onglet viewer
                this.setupViewerEventListeners();

                // G√©n√©rer l'aper√ßu initial
                this.updateHeaderPreview();
            }

            // Configurer les event listeners pour l'onglet viewer
            setupViewerEventListeners() {
                const inputs = [
                    'viewerTitle', 'viewerSubtitle', 'clientName', 'projectName', 
                    'presentationDate', 'accentColor', 'customLogo', 
                    'copyrightText', 'legalText'
                ];

                inputs.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.addEventListener('input', () => this.updateViewerConfig(id, element.value));
                        element.addEventListener('change', () => this.updateViewerConfig(id, element.value));
                    }
                });

                // Boutons d'action
                const updateBtn = document.getElementById('updateHeaderPreviewBtn');
                if (updateBtn) {
                    updateBtn.addEventListener('click', () => this.updateHeaderPreview());
                }

                const resetBtn = document.getElementById('resetViewerConfigBtn');
                if (resetBtn) {
                    resetBtn.addEventListener('click', () => this.resetViewerConfig());
                }

                const testLogoBtn = document.getElementById('testLogoBtn');
                if (testLogoBtn) {
                    testLogoBtn.addEventListener('click', () => this.testCustomLogo());
                }
            }

            // Mettre √† jour la configuration du viewer
            updateViewerConfig(field, value) {
                // Mapper les IDs des √©l√©ments aux propri√©t√©s de configuration
                const fieldMapping = {
                    'viewerTitle': 'title',
                    'viewerSubtitle': 'subtitle',
                    'clientName': 'clientName',
                    'projectName': 'projectName',
                    'presentationDate': 'presentationDate',
                    'accentColor': 'accentColor',
                    'customLogo': 'customLogo',
                    'copyrightText': 'copyrightText',
                    'legalText': 'legalText'
                };

                const configField = fieldMapping[field];
                if (configField) {
                    this.viewerConfig[configField] = value;
                    this.updateHeaderPreview();
                    this.setStatus(`Configuration viewer mise √† jour : ${configField}`, 'info');
                }
            }

            // Mettre √† jour l'aper√ßu du header
            updateHeaderPreview() {
                const previewContainer = document.getElementById('headerPreview');
                if (!previewContainer) return;

                const config = this.viewerConfig;
                const presentationDate = config.presentationDate ? 
                    new Date(config.presentationDate).toLocaleDateString('fr-FR', { 
                        year: 'numeric', month: 'long', day: 'numeric' 
                    }) : 
                    new Date().toLocaleDateString('fr-FR', { 
                        year: 'numeric', month: 'long', day: 'numeric' 
                    });

                // Construire le titre complet
                let fullTitle = config.title;
                if (config.clientName) {
                    fullTitle += ` - ${config.clientName}`;
                }
                if (config.projectName) {
                    fullTitle += ` (${config.projectName})`;
                }

                // Construire le sous-titre
                let fullSubtitle = config.subtitle;

                previewContainer.innerHTML = `
                    <div class="header-preview" style="border-bottom-color: ${config.accentColor};">
                        <div class="header-preview-logo">
                            ${config.customLogo ? 
                                `<img src="${config.customLogo}" style="width: 24px; height: 24px; border-radius: 4px;" onerror="this.style.display='none'; this.nextSibling.style.display='inline';">` : 
                                ''
                            }
                            <i class="fas fa-presentation" style="color: ${config.accentColor}; ${config.customLogo ? 'display: none;' : ''}"></i>
                            <span>${fullTitle}</span>
                        </div>
                        <div class="header-preview-info">
                            <div class="header-preview-date">${presentationDate}</div>
                            <div>${fullSubtitle}</div>
                        </div>
                    </div>
                    <div class="config-preview-note">
                        <i class="fas fa-info-circle"></i>
                        Aper√ßu du header qui appara√Ætra dans le viewer export√©
                    </div>
                `;
            }

            // Tester le logo personnalis√©
            testCustomLogo() {
                const logoUrl = document.getElementById('customLogo').value;
                if (!logoUrl) {
                    this.setStatus('Veuillez entrer une URL de logo', 'error');
                    return;
                }

                const img = new Image();
                img.onload = () => {
                    this.setStatus('Logo test√© avec succ√®s !', 'success');
                    this.updateHeaderPreview();
                };
                img.onerror = () => {
                    this.setStatus('Erreur : Impossible de charger le logo', 'error');
                };
                img.src = logoUrl;
            }

            // R√©initialiser la configuration du viewer
            resetViewerConfig() {
                // R√©initialiser les valeurs par d√©faut
                const defaults = {
                    viewerTitle: 'Eds Qu√©bec - Pr√©sentation Marketing',
                    viewerSubtitle: 'Version Client - Confidentiel',
                    clientName: '',
                    projectName: '',
                    presentationDate: new Date().toISOString().split('T')[0],
                    accentColor: '#10b981',
                    customLogo: '',
                    copyrightText: '¬© 2024 Eds Qu√©bec - Pr√©sentation Marketing',
                    legalText: 'Document confidentiel - Ne pas diffuser'
                };

                Object.keys(defaults).forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.value = defaults[id];
                        this.updateViewerConfig(id, defaults[id]);
                    }
                });

                this.updateHeaderPreview();
                this.setStatus('Configuration viewer r√©initialis√©e', 'success');
            }

            setStatus(message, type = 'info') {
                const statusText = document.getElementById('statusText');
                const statusIndicator = document.getElementById('statusIndicator');
                
                if (statusText) statusText.textContent = message;
                if (statusIndicator) statusIndicator.className = `status-indicator ${type}`;
                
                if (type === 'success' || type === 'info') {
                    setTimeout(() => {
                        if (statusText && statusText.textContent === message) {
                            this.setStatus('Pr√™t', 'success');
                        }
                    }, 3000);
                }
                
                // Log supprim√© pour le nettoyage
            }
            
            // Gestion dynamique des fonctionnalit√©s pour Pricing Card
            addFeatureToSelected() {
                if (!this.selectedWidget || this.selectedWidget.type !== 'pricing-card') return;
                
                const input = document.getElementById('newFeatureInput');
                if (!input || !input.value.trim()) return;
                
                const newFeature = input.value.trim();
                this.selectedWidget.data.features.push(newFeature);
                
                // Vider l'input
                input.value = '';
                
                // Mettre √† jour l'interface
                this.updateElementsTab();
                this.renderSelectedWidget();
                this.updatePreview();
                
                this.setStatus(`Fonctionnalit√© "${newFeature}" ajout√©e`, 'success');
            }
            
            removeFeatureAtIndex(index) {
                if (!this.selectedWidget || this.selectedWidget.type !== 'pricing-card') return;
                
                const features = this.selectedWidget.data.features;
                if (index < 0 || index >= features.length) return;
                
                const removedFeature = features[index];
                features.splice(index, 1);
                
                // Mettre √† jour l'interface
                this.updateElementsTab();
                this.renderSelectedWidget();
                this.updatePreview();
                
                this.setStatus(`Fonctionnalit√© "${removedFeature}" supprim√©e`, 'success');
            }
            
            updateFeatureAtIndex(index, newValue) {
                if (!this.selectedWidget || this.selectedWidget.type !== 'pricing-card') return;
                
                const features = this.selectedWidget.data.features;
                if (index < 0 || index >= features.length) return;
                
                features[index] = newValue.trim();
                
                // Mise √† jour temps r√©el optimis√©e - seulement la fonctionnalit√© modifi√©e
                const container = document.querySelector(`[data-widget-id="${this.selectedWidget.id}"]`);
                if (container) {
                    const featuresList = container.querySelector('ul');
                    if (featuresList) {
                        const featureItems = featuresList.querySelectorAll('li');
                        if (featureItems[index]) {
                            const textSpan = featureItems[index].querySelector('span:last-child');
                            if (textSpan) {
                                textSpan.textContent = newValue.trim();
                            }
                        }
                    }
                }
                
                // Sauvegarde automatique
                this.autoSave();
            }
            
            // Gestion dynamique des inconv√©nients pour Comparison Widget (colonne obsol√®te)
            addObsoleteDisadvantage() {
                console.log('üöÄ addObsoleteDisadvantage called');
                if (!this.selectedWidget) {
                    console.log('‚ùå No selectedWidget');
                    return;
                }
                if (this.selectedWidget.type !== 'comparison') {
                    console.log('‚ùå Wrong widget type:', this.selectedWidget.type);
                    return;
                }
                
                const input = document.getElementById('newObsoleteInput');
                console.log('üîç Input element:', input);
                if (!input || !input.value.trim()) {
                    console.log('‚ùå No input or empty value');
                    return;
                }
                
                const newDisadvantageText = input.value.trim();
                console.log('üìù New disadvantage text:', newDisadvantageText);
                
                // Cr√©er un nouvel objet avec emoji et couleur par d√©faut
                const newDisadvantageObj = {
                    text: newDisadvantageText,
                    emoji: '‚ùå', // Emoji par d√©faut pour obsol√®te
                    color: '#ffffff' // Couleur par d√©faut
                };
                
                this.selectedWidget.data.obsoleteDisadvantages.push(newDisadvantageObj);
                console.log('üìã New disadvantage object:', newDisadvantageObj);
                console.log('üìã Current disadvantages:', this.selectedWidget.data.obsoleteDisadvantages);
                
                // Vider l'input
                input.value = '';
                
                // Mettre √† jour l'interface
                this.updateElementsTab();
                this.renderSelectedWidget();
                this.updatePreview();
                
                this.setStatus(`Inconv√©nient "${newDisadvantage}" ajout√©`, 'success');
            }
            
            removeObsoleteDisadvantage(index) {
                console.log('üóëÔ∏è removeObsoleteDisadvantage called with index:', index);
                if (!this.selectedWidget || this.selectedWidget.type !== 'comparison') return;
                
                const disadvantages = this.selectedWidget.data.obsoleteDisadvantages;
                if (index < 0 || index >= disadvantages.length) return;
                
                const removedItem = disadvantages[index];
                disadvantages.splice(index, 1);
                console.log('üìã After removal:', disadvantages);
                
                // Mettre √† jour l'interface
                this.updateElementsTab();
                this.renderSelectedWidget();
                this.updatePreview();
                
                this.setStatus(`Inconv√©nient supprim√©`, 'success');
            }
            
            updateObsoleteDisadvantage(index, newValue) {
                console.log('‚úèÔ∏è updateObsoleteDisadvantage called:', index, newValue);
                if (!this.selectedWidget || this.selectedWidget.type !== 'comparison') return;
                
                const disadvantages = this.selectedWidget.data.obsoleteDisadvantages;
                if (index < 0 || index >= disadvantages.length) return;
                
                disadvantages[index] = newValue.trim();
                
                // Mise √† jour temps r√©el optimis√©e - CORRIG√âE POUR LE NOUVEAU RENDU SIMPLIFI√â
                const container = document.querySelector(`[data-widget-id="${this.selectedWidget.id}"]`);
                console.log('üîç Container found:', !!container);
                if (container) {
                    const obsoleteColumn = container.querySelector('.obsolete-column .disadvantages-list');
                    console.log('üîç Obsolete column found:', !!obsoleteColumn);
                    if (obsoleteColumn) {
                        const disadvantageItems = obsoleteColumn.querySelectorAll('.comparison-item.obsolete-item');
                        console.log('üîç Found', disadvantageItems.length, 'disadvantage items, updating index', index);
                        if (disadvantageItems[index]) {
                            // Dans le nouveau rendu simplifi√©, le texte est dans le deuxi√®me div enfant
                            const textElement = disadvantageItems[index].querySelector('div:last-child');
                            console.log('üîç Text element found:', !!textElement);
                            if (textElement) {
                                textElement.textContent = newValue.trim();
                                console.log('‚úÖ Updated text in DOM:', newValue.trim());
                            }
                        }
                    }
                }
                
                // Mettre √† jour le viewer
                this.updatePreview();
                
                // Sauvegarde automatique
                this.autoSave();
            }
            
            // Gestion dynamique des avantages pour Comparison Widget (colonne moderne)
            addModernAdvantage() {
                console.log('üöÄ addModernAdvantage called');
                if (!this.selectedWidget) {
                    console.log('‚ùå No selectedWidget');
                    return;
                }
                if (this.selectedWidget.type !== 'comparison') {
                    console.log('‚ùå Wrong widget type:', this.selectedWidget.type);
                    return;
                }
                
                const input = document.getElementById('newModernInput');
                console.log('üîç Input element:', input);
                if (!input || !input.value.trim()) {
                    console.log('‚ùå No input or empty value');
                    return;
                }
                
                const newAdvantageText = input.value.trim();
                console.log('üìù New advantage text:', newAdvantageText);
                
                // Cr√©er un nouvel objet avec emoji et couleur par d√©faut
                const newAdvantageObj = {
                    text: newAdvantageText,
                    emoji: '‚úÖ', // Emoji par d√©faut pour moderne
                    color: '#ffffff' // Couleur par d√©faut
                };
                
                this.selectedWidget.data.modernAdvantages.push(newAdvantageObj);
                console.log('üìã New advantage object:', newAdvantageObj);
                console.log('üìã Current advantages:', this.selectedWidget.data.modernAdvantages);
                
                // Vider l'input
                input.value = '';
                
                // Mettre √† jour l'interface
                this.updateElementsTab();
                this.renderSelectedWidget();
                this.updatePreview();
                
                this.setStatus(`Avantage "${newAdvantage}" ajout√©`, 'success');
            }
            
            removeModernAdvantage(index) {
                console.log('üóëÔ∏è removeModernAdvantage called with index:', index);
                if (!this.selectedWidget || this.selectedWidget.type !== 'comparison') return;
                
                const advantages = this.selectedWidget.data.modernAdvantages;
                if (index < 0 || index >= advantages.length) return;
                
                const removedItem = advantages[index];
                advantages.splice(index, 1);
                console.log('üìã After removal:', advantages);
                
                // Mettre √† jour l'interface
                this.updateElementsTab();
                this.renderSelectedWidget();
                this.updatePreview();
                
                this.setStatus(`Avantage supprim√©`, 'success');
            }
            
            updateModernAdvantage(index, newValue) {
                console.log('‚úèÔ∏è updateModernAdvantage called:', index, newValue);
                if (!this.selectedWidget || this.selectedWidget.type !== 'comparison') return;
                
                const advantages = this.selectedWidget.data.modernAdvantages;
                if (index < 0 || index >= advantages.length) return;
                
                advantages[index] = newValue.trim();
                
                // Mise √† jour temps r√©el optimis√©e - CORRIG√âE POUR LE NOUVEAU RENDU SIMPLIFI√â
                const container = document.querySelector(`[data-widget-id="${this.selectedWidget.id}"]`);
                console.log('üîç Container found:', !!container);
                if (container) {
                    const modernColumn = container.querySelector('.modern-column .advantages-list');
                    console.log('üîç Modern column found:', !!modernColumn);
                    if (modernColumn) {
                        const advantageItems = modernColumn.querySelectorAll('.comparison-item.modern-item');
                        console.log('üîç Found', advantageItems.length, 'advantage items, updating index', index);
                        if (advantageItems[index]) {
                            // Dans le nouveau rendu simplifi√©, le texte est dans le deuxi√®me div enfant
                            const textElement = advantageItems[index].querySelector('div:last-child');
                            console.log('üîç Text element found:', !!textElement);
                            if (textElement) {
                                textElement.textContent = newValue.trim();
                                console.log('‚úÖ Updated text in DOM:', newValue.trim());
                            }
                        }
                    }
                }
                
                // Mettre √† jour le viewer
                this.updatePreview();
                
                // Sauvegarde automatique
                this.autoSave();
            }
            
            // NOUVELLES FONCTIONS POUR GESTION D√âTAILL√âE DES √âL√âMENTS (EMOJI + COULEUR + TEXTE)
            
            // Fonctions pour les inconv√©nients obsol√®tes
            updateObsoleteDisadvantageText(index, newText) {
                console.log('‚úèÔ∏è updateObsoleteDisadvantageText called:', index, newText);
                if (!this.selectedWidget || this.selectedWidget.type !== 'comparison') return;
                
                const disadvantages = this.selectedWidget.data.obsoleteDisadvantages;
                if (index < 0 || index >= disadvantages.length) return;
                
                // S'assurer que l'√©l√©ment est un objet
                if (typeof disadvantages[index] === 'string') {
                    disadvantages[index] = { text: disadvantages[index], emoji: '‚ùå', color: '#ffffff' };
                }
                
                disadvantages[index].text = newText.trim();
                this.updateComparisonElementInDOM('obsolete', index, disadvantages[index]);
                this.updatePreview();
                this.autoSave();
            }
            
            updateObsoleteDisadvantageEmoji(index, newEmoji) {
                console.log('üé® updateObsoleteDisadvantageEmoji called:', index, newEmoji);
                if (!this.selectedWidget || this.selectedWidget.type !== 'comparison') return;
                
                const disadvantages = this.selectedWidget.data.obsoleteDisadvantages;
                if (index < 0 || index >= disadvantages.length) return;
                
                // S'assurer que l'√©l√©ment est un objet
                if (typeof disadvantages[index] === 'string') {
                    disadvantages[index] = { text: disadvantages[index], emoji: '‚ùå', color: '#ffffff' };
                }
                
                // Mettre √† jour l'emoji
                disadvantages[index].emoji = newEmoji;
                console.log(`üîÑ Emoji mis √† jour dans les donn√©es:`, disadvantages[index]);
                
                // Mettre √† jour le DOM directement
                this.updateComparisonElementInDOM('obsolete', index, disadvantages[index]);
                
                // Force une mise √† jour compl√®te de l'aper√ßu
                this.updatePreview();
                
                // Force aussi un re-render du canvas si n√©cessaire  
                this.renderCanvas();
                
                // FALLBACK : Si les √©l√©ments ne sont pas mis √† jour, forcer un re-render complet
                setTimeout(() => {
                    this.verifyAndFixEmojiDisplay('obsolete', index, disadvantages[index]);
                }, 100);
                
                this.autoSave();
            }
            
            updateObsoleteDisadvantageColor(index, newColor) {
                console.log('üåà updateObsoleteDisadvantageColor called:', index, newColor);
                if (!this.selectedWidget || this.selectedWidget.type !== 'comparison') return;
                
                const disadvantages = this.selectedWidget.data.obsoleteDisadvantages;
                if (index < 0 || index >= disadvantages.length) return;
                
                // S'assurer que l'√©l√©ment est un objet
                if (typeof disadvantages[index] === 'string') {
                    disadvantages[index] = { text: disadvantages[index], emoji: '‚ùå', color: '#ffffff' };
                }
                
                disadvantages[index].color = newColor;
                this.updateComparisonElementInDOM('obsolete', index, disadvantages[index]);
                this.updatePreview();
                this.autoSave();
            }
            
            // Fonctions pour les avantages modernes
            updateModernAdvantageText(index, newText) {
                console.log('‚úèÔ∏è updateModernAdvantageText called:', index, newText);
                if (!this.selectedWidget || this.selectedWidget.type !== 'comparison') return;
                
                const advantages = this.selectedWidget.data.modernAdvantages;
                if (index < 0 || index >= advantages.length) return;
                
                // S'assurer que l'√©l√©ment est un objet
                if (typeof advantages[index] === 'string') {
                    advantages[index] = { text: advantages[index], emoji: '‚úÖ', color: '#ffffff' };
                }
                
                advantages[index].text = newText.trim();
                this.updateComparisonElementInDOM('modern', index, advantages[index]);
                this.updatePreview();
                this.autoSave();
            }
            
            updateModernAdvantageEmoji(index, newEmoji) {
                console.log('üé® updateModernAdvantageEmoji called:', index, newEmoji);
                if (!this.selectedWidget || this.selectedWidget.type !== 'comparison') return;
                
                const advantages = this.selectedWidget.data.modernAdvantages;
                if (index < 0 || index >= advantages.length) return;
                
                // S'assurer que l'√©l√©ment est un objet
                if (typeof advantages[index] === 'string') {
                    advantages[index] = { text: advantages[index], emoji: '‚úÖ', color: '#ffffff' };
                }
                
                // Mettre √† jour l'emoji
                advantages[index].emoji = newEmoji;
                console.log(`üîÑ Emoji mis √† jour dans les donn√©es:`, advantages[index]);
                
                // Mettre √† jour le DOM directement
                this.updateComparisonElementInDOM('modern', index, advantages[index]);
                
                // Force une mise √† jour compl√®te de l'aper√ßu
                this.updatePreview();
                
                // Force aussi un re-render du canvas si n√©cessaire
                this.renderCanvas();
                
                // FALLBACK : Si les √©l√©ments ne sont pas mis √† jour, forcer un re-render complet
                setTimeout(() => {
                    this.verifyAndFixEmojiDisplay('modern', index, advantages[index]);
                }, 100);
                
                this.autoSave();
            }
            
            updateModernAdvantageColor(index, newColor) {
                console.log('üåà updateModernAdvantageColor called:', index, newColor);
                if (!this.selectedWidget || this.selectedWidget.type !== 'comparison') return;
                
                const advantages = this.selectedWidget.data.modernAdvantages;
                if (index < 0 || index >= advantages.length) return;
                
                // S'assurer que l'√©l√©ment est un objet
                if (typeof advantages[index] === 'string') {
                    advantages[index] = { text: advantages[index], emoji: '‚úÖ', color: '#ffffff' };
                }
                
                advantages[index].color = newColor;
                this.updateComparisonElementInDOM('modern', index, advantages[index]);
                this.updatePreview();
                this.autoSave();
            }
            
            // Fonction utilitaire pour mettre √† jour un √©l√©ment dans le DOM - VERSION AM√âLIOR√âE
            updateComparisonElementInDOM(type, index, itemData) {
                console.log(`üîÑ updateComparisonElementInDOM: ${type}, index=${index}`, itemData);
                
                // Mise √† jour dans la fen√™tre d'√©dition (canvas)
                const editorContainer = document.querySelector(`[data-widget-id="${this.selectedWidget.id}"]`);
                if (editorContainer) {
                    const columnSelector = type === 'obsolete' ? '.obsolete-column .disadvantages-list' : '.modern-column .advantages-list';
                    const column = editorContainer.querySelector(columnSelector);
                    
                    if (column) {
                        const itemSelector = type === 'obsolete' ? '.comparison-item.obsolete-item' : '.comparison-item.modern-item';
                        const items = column.querySelectorAll(itemSelector);
                        
                        if (items[index]) {
                            const item = items[index];
                            const emojiElement = item.querySelector('.item-emoji');
                            const textElement = item.querySelector('.item-text');
                            
                            if (emojiElement) {
                                emojiElement.textContent = itemData.emoji || (type === 'obsolete' ? '‚ùå' : '‚úÖ');
                                console.log(`‚úÖ Emoji mis √† jour dans l'√©diteur:`, emojiElement.textContent);
                            }
                            if (textElement) {
                                textElement.textContent = itemData.text || '';
                                textElement.style.color = itemData.color || '#ffffff';
                                console.log(`‚úÖ Texte mis √† jour dans l'√©diteur:`, textElement.textContent, textElement.style.color);
                            }
                        }
                    }
                }
                
                // Mise √† jour dans l'aper√ßu temps r√©el (preview)
                const previewContainer = document.getElementById('preview');
                if (previewContainer) {
                    const previewColumnSelector = type === 'obsolete' ? '.obsolete-column .disadvantages-list' : '.modern-column .advantages-list';
                    const previewColumn = previewContainer.querySelector(previewColumnSelector);
                    
                    if (previewColumn) {
                        const previewItemSelector = type === 'obsolete' ? '.comparison-item.obsolete-item' : '.comparison-item.modern-item';
                        const previewItems = previewColumn.querySelectorAll(previewItemSelector);
                        
                        if (previewItems[index]) {
                            const previewItem = previewItems[index];
                            const previewEmojiElement = previewItem.querySelector('.item-emoji');
                            const previewTextElement = previewItem.querySelector('.item-text');
                            
                            if (previewEmojiElement) {
                                previewEmojiElement.textContent = itemData.emoji || (type === 'obsolete' ? '‚ùå' : '‚úÖ');
                                console.log(`‚úÖ Emoji mis √† jour dans l'aper√ßu:`, previewEmojiElement.textContent);
                            }
                            if (previewTextElement) {
                                previewTextElement.textContent = itemData.text || '';
                                previewTextElement.style.color = itemData.color || '#ffffff';
                                console.log(`‚úÖ Texte mis √† jour dans l'aper√ßu:`, previewTextElement.textContent, previewTextElement.style.color);
                            }
                        }
                    }
                }
                
                console.log(`üéØ updateComparisonElementInDOM termin√© pour ${type}[${index}]`);
            }
            
            // Fonction de v√©rification et correction des emoji - FALLBACK S√âCURIS√â
            verifyAndFixEmojiDisplay(type, index, expectedData) {
                console.log(`üîç verifyAndFixEmojiDisplay: V√©rification ${type}[${index}]`, expectedData);
                
                let needsRefresh = false;
                
                // V√©rifier la fen√™tre d'√©dition
                const editorContainer = document.querySelector(`[data-widget-id="${this.selectedWidget.id}"]`);
                if (editorContainer) {
                    const columnSelector = type === 'obsolete' ? '.obsolete-column .disadvantages-list' : '.modern-column .advantages-list';
                    const column = editorContainer.querySelector(columnSelector);
                    
                    if (column) {
                        const itemSelector = type === 'obsolete' ? '.comparison-item.obsolete-item' : '.comparison-item.modern-item';
                        const items = column.querySelectorAll(itemSelector);
                        
                        if (items[index]) {
                            const item = items[index];
                            const emojiElement = item.querySelector('.item-emoji');
                            
                            if (emojiElement && emojiElement.textContent !== expectedData.emoji) {
                                console.log(`‚ùå Emoji mismatch dans l'√©diteur - Attendu: "${expectedData.emoji}", Trouv√©: "${emojiElement.textContent}"`);
                                needsRefresh = true;
                            }
                        }
                    }
                }
                
                // V√©rifier l'aper√ßu
                const previewContainer = document.getElementById('preview');
                if (previewContainer) {
                    const previewColumnSelector = type === 'obsolete' ? '.obsolete-column .disadvantages-list' : '.modern-column .advantages-list';
                    const previewColumn = previewContainer.querySelector(previewColumnSelector);
                    
                    if (previewColumn) {
                        const previewItemSelector = type === 'obsolete' ? '.comparison-item.obsolete-item' : '.comparison-item.modern-item';
                        const previewItems = previewColumn.querySelectorAll(previewItemSelector);
                        
                        if (previewItems[index]) {
                            const previewItem = previewItems[index];
                            const previewEmojiElement = previewItem.querySelector('.item-emoji');
                            
                            if (previewEmojiElement && previewEmojiElement.textContent !== expectedData.emoji) {
                                console.log(`‚ùå Emoji mismatch dans l'aper√ßu - Attendu: "${expectedData.emoji}", Trouv√©: "${previewEmojiElement.textContent}"`);
                                needsRefresh = true;
                            }
                        }
                    }
                }
                
                // Si des probl√®mes sont d√©tect√©s, forcer un re-render complet
                if (needsRefresh) {
                    console.log(`üîÑ For√ßage du re-render complet pour corriger les emoji`);
                    this.renderCanvas();
                    this.updatePreview();
                } else {
                    console.log(`‚úÖ Emoji correctement affich√© partout`);
                }
            }
            
            // Fonction pour re-render un widget sp√©cifique
            renderSelectedWidget() {
                if (!this.selectedWidget) return;
                
                const container = document.querySelector(`[data-widget-id="${this.selectedWidget.id}"]`);
                if (!container) return;
                
                const contentDiv = container.querySelector('.widget-content');
                if (contentDiv) {
                    contentDiv.innerHTML = this.selectedWidget.instance.render(this.selectedWidget.data);
                }
            }

            // Gestion taille et position
            
            // Mettre √† jour la taille d'un widget
            updateWidgetSize(dimension, value) {
                if (!this.selectedWidget) return;
                
                const numValue = parseInt(value, 10);
                if (isNaN(numValue)) return;
                
                // Initialiser size si n√©cessaire
                if (!this.selectedWidget.size) {
                    this.selectedWidget.size = { width: 3, height: 2 };
                }
                
                // Mettre √† jour la dimension
                this.selectedWidget.size[dimension] = numValue;
                
                // Synchroniser les contr√¥les
                this.syncSizeControls(dimension, numValue);
                
                // V√©rifier que le widget reste dans les limites de la grille
                this.constrainWidgetToGrid();
                
                // Mettre √† jour l'affichage
                this.renderCanvas();
                this.updatePreview();
                
                this.setStatus(`${dimension === 'width' ? 'Largeur' : 'Hauteur'} mise √† jour: ${numValue}`, 'info');
            }
            
            // Mettre √† jour la position d'un widget
            updateWidgetPosition(dimension, value) {
                if (!this.selectedWidget) return;
                
                const numValue = parseInt(value, 10);
                if (isNaN(numValue)) return;
                
                // Initialiser position si n√©cessaire
                if (!this.selectedWidget.position) {
                    this.selectedWidget.position = { col: 1, row: 1 };
                }
                
                // Mettre √† jour la dimension
                this.selectedWidget.position[dimension] = numValue;
                
                // V√©rifier que le widget reste dans les limites de la grille
                this.constrainWidgetToGrid();
                
                // Mettre √† jour l'affichage
                this.renderCanvas();
                this.updatePreview();
                
                this.setStatus(`Position ${dimension === 'col' ? 'colonne' : 'rang√©e'} mise √† jour: ${numValue}`, 'info');
            }
            
            // Synchroniser les contr√¥les de taille
            syncSizeControls(changedDimension, value) {
                if (changedDimension === 'width') {
                    const widthSlider = document.getElementById('widthSlider');
                    const widthInput = document.getElementById('widthInput');
                    if (widthSlider && widthSlider.value != value) widthSlider.value = value;
                    if (widthInput && widthInput.value != value) widthInput.value = value;
                } else if (changedDimension === 'height') {
                    const heightSlider = document.getElementById('heightSlider');
                    const heightInput = document.getElementById('heightInput');
                    if (heightSlider && heightSlider.value != value) heightSlider.value = value;
                    if (heightInput && heightInput.value != value) heightInput.value = value;
                }
            }
            
            // Contraindre le widget aux limites de la grille
            constrainWidgetToGrid() {
                if (!this.selectedWidget) return;
                
                const size = this.selectedWidget.size || { width: 3, height: 2 };
                const position = this.selectedWidget.position || { col: 1, row: 1 };
                
                // Limiter la taille maximale
                size.width = Math.max(1, Math.min(12, size.width));
                size.height = Math.max(1, Math.min(8, size.height));
                
                // Ajuster la position si le widget d√©passe
                position.col = Math.max(1, Math.min(12 - size.width + 1, position.col));
                position.row = Math.max(1, Math.min(8 - size.height + 1, position.row));
                
                // Mettre √† jour l'objet
                this.selectedWidget.size = size;
                this.selectedWidget.position = position;
                
                // Mettre √† jour les contr√¥les
            }
            
            // D√©finir un widget en plein √©cran
            setFullScreen() {
                if (!this.selectedWidget) return;
                
                this.selectedWidget.size = { width: 12, height: 8 };
                this.selectedWidget.position = { col: 1, row: 1 };
                
                this.renderCanvas();
                this.updatePreview();
                
                this.setStatus('Widget mis en plein √©cran', 'success');
            }
            
            // Remplir le conteneur parent (version simplifi√©e - toute la largeur, hauteur adaptative)
            fillParent() {
                if (!this.selectedWidget) return;
                
                // Pour cette version, "remplir parent" = largeur maximale avec hauteur de 4 rang√©es
                this.selectedWidget.size = { width: 12, height: 4 };
                
                // Garder la position actuelle en colonne, mais v√©rifier les limites
                const currentPosition = this.selectedWidget.position || { col: 1, row: 1 };
                this.selectedWidget.position = { col: 1, row: currentPosition.row };
                
                this.constrainWidgetToGrid();
                this.renderCanvas();
                this.updatePreview();
                
                this.setStatus('Widget configur√© pour remplir le conteneur parent', 'success');
            }

            // R√¥le      : Sauvegarder un widget comme widget personnalis√© r√©utilisable
            // Type      : function
            // Unit√©     : sans unit√©
            // Formule   : nouveau_widget_template = {name, data, type, isCustom: true}
            // Exemple   : Widget logo sauv√© comme "Mon Logo Corporate" dans localStorage
            saveCustomWidget() {
                if (!this.selectedWidget) return;
                
                const nameInput = document.getElementById('customWidgetName');
                const customName = nameInput ? nameInput.value.trim() : '';
                
                if (!customName) {
                    alert('Veuillez saisir un nom pour votre widget personnalis√©.');
                    return;
                }
                
                /* 
                # R√¥le      : Cr√©ation du template de widget personnalis√© complet
                # Type      : object creation
                # Unit√©     : sans unit√©
                # Formule   : template = {id, name, data_copi√©e, type, size, position, elements, timestamp, isCustom}
                # Exemple   : {id: "custom_123", name: "Mon Logo", data: {...}, type: "logo", size: {width: 6, height: 4}, position: {col: 2, row: 1}, isCustom: true}
                */
                const customTemplate = {
                    id: `custom_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    name: customName,
                    type: this.selectedWidget.type,
                    
                    // R√¥le      : Copie profonde de toutes les propri√©t√©s √©ditables du widget
                    // Type      : object (deep copy)
                    // Unit√©     : sans unit√©
                    // Exemple   : {imagePath: "./logo.png", width: 500, borderColor: "#10b981"}
                    data: JSON.parse(JSON.stringify(this.selectedWidget.data)),
                    
                    // R√¥le      : Dimensions du widget dans la grille (onglet Organisation)
                    // Type      : object {width: number, height: number}
                    // Unit√©     : colonnes/rang√©es de grille
                    // Exemple   : {width: 6, height: 4}
                    size: JSON.parse(JSON.stringify(this.selectedWidget.size || { width: 3, height: 2 })),
                    
                    // R√¥le      : Position du widget dans la grille (onglet Organisation)
                    // Type      : object {col: number, row: number}
                    // Unit√©     : coordonn√©es de grille (col: 1-12, row: 1-8)
                    // Exemple   : {col: 2, row: 1}
                    position: JSON.parse(JSON.stringify(this.selectedWidget.position || { col: 1, row: 1 })),
                    
                    // R√¥le      : √âl√©ments personnalis√©s du widget si disponibles (onglet √âl√©ments)
                    // Type      : object ou null
                    // Unit√©     : sans unit√©
                    // Exemple   : {customElements: [...], elementConfig: {...}}
                    elements: this.selectedWidget.elements ? JSON.parse(JSON.stringify(this.selectedWidget.elements)) : null,
                    
                    // R√¥le      : Propri√©t√©s d'organisation avanc√©es si pr√©sentes
                    // Type      : object ou null
                    // Unit√©     : sans unit√©
                    // Exemple   : {zIndex: 10, opacity: 0.9, visible: true}
                    organization: this.selectedWidget.organization ? JSON.parse(JSON.stringify(this.selectedWidget.organization)) : null,
                    
                    isCustom: true,
                    createdAt: new Date().toISOString(),
                    originalType: this.selectedWidget.type
                };
                
                // Sauvegarder dans localStorage
                let customWidgets = JSON.parse(localStorage.getItem('customWidgets') || '[]');
                
                // V√©rifier si un widget avec ce nom existe d√©j√†
                const existingIndex = customWidgets.findIndex(w => w.name === customName);
                if (existingIndex >= 0) {
                    if (!confirm(`Un widget nomm√© "${customName}" existe d√©j√†. Voulez-vous le remplacer ?`)) {
                        return;
                    }
                    customWidgets[existingIndex] = customTemplate;
                } else {
                    customWidgets.push(customTemplate);
                }
                
                localStorage.setItem('customWidgets', JSON.stringify(customWidgets));
                
                // Marquer le widget actuel comme personnalis√©
                this.selectedWidget.isCustom = true;
                this.selectedWidget.customName = customName;
                this.selectedWidget.customId = customTemplate.id;
                
                // Actualiser la biblioth√®que de widgets
                this.renderWidgetLibrary();
                
                // Mettre √† jour l'interface
                this.updateOrganizationControls();
                
                console.log(`üíæ Widget personnalis√© sauv√©: ${customName}`, customTemplate);
                this.setStatus(`Widget "${customName}" sauvegard√© avec succ√®s`, 'success');
            }
            
            // R√¥le      : Mettre √† jour un widget personnalis√© existant
            // Type      : function
            // Unit√©     : sans unit√©
            // Formule   : widget_existant.data = nouvelles_donn√©es_actuelles
            // Exemple   : "Mon Logo Corporate" mis √† jour avec nouvelles couleurs
            updateCustomWidget() {
                if (!this.selectedWidget || !this.selectedWidget.isCustom) return;
                
                const customName = this.selectedWidget.customName;
                if (!customName) return;
                
                if (!confirm(`Voulez-vous vraiment mettre √† jour le widget "${customName}" avec la configuration actuelle ?`)) {
                    return;
                }
                
                let customWidgets = JSON.parse(localStorage.getItem('customWidgets') || '[]');
                const index = customWidgets.findIndex(w => w.name === customName);
                
                if (index >= 0) {
                    // R√¥le      : Mise √† jour compl√®te de toutes les propri√©t√©s du widget personnalis√©
                    // Type      : object property updates
                    // Unit√©     : sans unit√©
                    // Exemple   : data, size, position, elements, organization mis √† jour
                    
                    // Mettre √† jour toutes les propri√©t√©s √©ditables
                    customWidgets[index].data = JSON.parse(JSON.stringify(this.selectedWidget.data));
                    customWidgets[index].size = JSON.parse(JSON.stringify(this.selectedWidget.size || { width: 3, height: 2 }));
                    customWidgets[index].position = JSON.parse(JSON.stringify(this.selectedWidget.position || { col: 1, row: 1 }));
                    customWidgets[index].elements = this.selectedWidget.elements ? JSON.parse(JSON.stringify(this.selectedWidget.elements)) : null;
                    customWidgets[index].organization = this.selectedWidget.organization ? JSON.parse(JSON.stringify(this.selectedWidget.organization)) : null;
                    customWidgets[index].updatedAt = new Date().toISOString();
                    
                    localStorage.setItem('customWidgets', JSON.stringify(customWidgets));
                    
                    // Actualiser la biblioth√®que
                    this.renderWidgetLibrary();
                    
                    console.log(`üîÑ Widget personnalis√© mis √† jour: ${customName}`);
                    this.setStatus(`Widget "${customName}" mis √† jour avec succ√®s`, 'success');
                } else {
                    this.setStatus(`Erreur: Widget "${customName}" non trouv√©`, 'error');
                }
            }
            
            // R√¥le      : Supprimer un widget personnalis√© de la biblioth√®que
            // Type      : function
            // Unit√©     : sans unit√©
            // Formule   : customWidgets = customWidgets.filter(w => w.id !== id_√†_supprimer)
            // Exemple   : Widget "Mon Logo Corporate" supprim√© de localStorage
            deleteCustomWidget(customId) {
                let customWidgets = JSON.parse(localStorage.getItem('customWidgets') || '[]');
                const widget = customWidgets.find(w => w.id === customId);
                
                if (!widget) {
                    this.setStatus('Widget personnalis√© non trouv√©', 'error');
                    return;
                }
                
                if (!confirm(`√ätes-vous s√ªr de vouloir supprimer d√©finitivement le widget "${widget.name}" ?`)) {
                    return;
                }
                
                // Filtrer le widget √† supprimer
                customWidgets = customWidgets.filter(w => w.id !== customId);
                localStorage.setItem('customWidgets', JSON.stringify(customWidgets));
                
                // Actualiser la biblioth√®que
                this.renderWidgetLibrary();
                
                console.log(`üóëÔ∏è Widget personnalis√© supprim√©: ${widget.name}`);
                this.setStatus(`Widget "${widget.name}" supprim√© avec succ√®s`, 'success');
            }

            // Gestion des fonctionnalit√©s de la grille
            
            // Ajouter une nouvelle fonctionnalit√© √† la grille
            addFeatureToGrid() {
                if (!this.selectedWidget || this.selectedWidget.type !== 'feature-grid') return;
                
                if (!this.selectedWidget.data.features) {
                    this.selectedWidget.data.features = [];
                }
                
                this.selectedWidget.data.features.push({
                    icon: '‚≠ê',
                    title: 'Nouvelle fonctionnalit√©',
                    description: 'Description de la nouvelle fonctionnalit√©',
                    iconSize: '3rem',
                    titleColor: 'white',
                    titleSize: '1.5rem',
                    descriptionColor: 'var(--text-gray)',
                    descriptionSize: '0.95rem',
                    backgroundColor: 'var(--bg-card)',
                    borderColor: 'var(--border-color)'
                });
                
                // Mettre √† jour l'interface
                this.updateElementsTab();
                this.renderCanvas();
                this.updatePreview();
                
                this.setStatus('Nouvelle fonctionnalit√© ajout√©e', 'success');
            }
            
            // Supprimer une fonctionnalit√© de la grille
            removeGridFeature(index) {
                if (!this.selectedWidget || this.selectedWidget.type !== 'feature-grid') return;
                
                const features = this.selectedWidget.data.features;
                if (!features || index < 0 || index >= features.length) return;
                
                if (confirm(`Supprimer la fonctionnalit√© "${features[index].title}" ?`)) {
                    features.splice(index, 1);
                    
                    // Ajuster le nombre de fonctionnalit√©s actives si n√©cessaire
                    if (this.selectedWidget.data.featuresCount > features.length) {
                        this.selectedWidget.data.featuresCount = features.length;
                    }
                    
                    // Mettre √† jour l'interface
                    this.updateElementsTab();
                    this.renderCanvas();
                    this.updatePreview();
                    
                    this.setStatus('Fonctionnalit√© supprim√©e', 'success');
                }
            }
            
            // Mettre √† jour une fonctionnalit√© de la grille
            updateGridFeature(index, field, value) {
                if (!this.selectedWidget || this.selectedWidget.type !== 'feature-grid') return;
                
                const features = this.selectedWidget.data.features;
                if (!features || index < 0 || index >= features.length) return;
                
                features[index][field] = value;
                
                // Mise √† jour temps r√©el optimis√©e - seulement l'√©l√©ment modifi√©
                const container = document.querySelector(`[data-widget-id="${this.selectedWidget.id}"]`);
                if (container) {
                    const featureCards = container.querySelectorAll('.feature-card');
                    if (featureCards[index]) {
                        const card = featureCards[index];
                        
                        switch (field) {
                            case 'icon':
                                const iconDiv = card.querySelector('div:first-child');
                                if (iconDiv) iconDiv.textContent = value;
                                break;
                            case 'iconSize':
                                const iconElement = card.querySelector('div:first-child');
                                if (iconElement) iconElement.style.fontSize = value;
                                break;
                            case 'title':
                                const titleElement = card.querySelector('h3');
                                if (titleElement) titleElement.textContent = value;
                                break;
                            case 'titleColor':
                                const titleColorElement = card.querySelector('h3');
                                if (titleColorElement) titleColorElement.style.color = value;
                                break;
                            case 'titleSize':
                                const titleSizeElement = card.querySelector('h3');
                                if (titleSizeElement) titleSizeElement.style.fontSize = value;
                                break;
                            case 'description':
                                const descElement = card.querySelector('p');
                                if (descElement) descElement.textContent = value;
                                break;
                            case 'descriptionColor':
                                const descColorElement = card.querySelector('p');
                                if (descColorElement) descColorElement.style.color = value;
                                break;
                            case 'descriptionSize':
                                const descSizeElement = card.querySelector('p');
                                if (descSizeElement) descSizeElement.style.fontSize = value;
                                break;
                            case 'backgroundColor':
                                card.style.background = value;
                                break;
                            case 'borderColor':
                                card.style.borderColor = value;
                                break;
                        }
                    }
                }
                
                // Sauvegarde automatique
                this.autoSave();
                
                // Message de statut discret uniquement pour les changements importants
                if (field === 'title') {
                    this.setStatus(`Titre mis √† jour: ${value}`, 'info');
                }
            }

            // Fonction toggle conteneur arri√®re-plan global adaptatif
            toggleBackground() {
                const workspace = document.getElementById('canvasWorkspace');
                const backgroundButton = document.getElementById('backgroundToggleBtn');
                
                if (!workspace) return;
                
                let container = workspace.querySelector('.global-background-container');
                const isActive = container !== null;
                
                if (isActive) {
                    // D√©sactiver le conteneur
                    if (container) {
                        container.remove();
                    }
                    
                    if (backgroundButton) {
                        backgroundButton.classList.remove('btn-primary');
                        backgroundButton.innerHTML = '<i class="fas fa-square"></i> Conteneur';
                        backgroundButton.style.background = '';
                        backgroundButton.style.borderColor = '';
                    }
                    
                    this.setStatus('Conteneur arri√®re-plan d√©sactiv√©', 'info');
                } else {
                    // Activer le conteneur
                    container = document.createElement('div');
                    container.className = 'global-background-container active';
                    workspace.appendChild(container);
                    
                    if (backgroundButton) {
                        backgroundButton.classList.add('btn-primary');
                        backgroundButton.innerHTML = '<i class="fas fa-square"></i> Masquer Conteneur';
                        backgroundButton.style.background = 'var(--accent-green)';
                        backgroundButton.style.borderColor = 'var(--accent-green)';
                    }
                    
                    // Calculer et appliquer les dimensions
                    this.updateBackgroundContainer();
                    
                    this.setStatus('Conteneur arri√®re-plan adaptatif activ√©', 'success');
                }
            }
            
            // Mettre √† jour le conteneur arri√®re-plan pour qu'il englobe tous les widgets
            updateBackgroundContainer() {
                const workspace = document.getElementById('canvasWorkspace');
                const container = workspace?.querySelector('.global-background-container');
                
                if (!container || this.widgets.length === 0) return;
                
                // Calculer les dimensions englobantes de tous les widgets
                let minCol = 12, maxCol = 1, minRow = 8, maxRow = 1;
                
                this.widgets.forEach(widget => {
                    const pos = widget.position || { col: 1, row: 1 };
                    const size = widget.size || { width: 3, height: 2 };
                    
                    minCol = Math.min(minCol, pos.col);
                    maxCol = Math.max(maxCol, pos.col + size.width - 1);
                    minRow = Math.min(minRow, pos.row);
                    maxRow = Math.max(maxRow, pos.row + size.height - 1);
                });
                
                // Ajouter une marge de padding autour des widgets
                const padding = 1;
                minCol = Math.max(1, minCol - padding);
                maxCol = Math.min(12, maxCol + padding);
                minRow = Math.max(1, minRow - padding);
                maxRow = Math.min(8, maxRow + padding);
                
                // Appliquer les dimensions CSS Grid au conteneur
                container.style.gridColumnStart = minCol;
                container.style.gridColumnEnd = maxCol + 1;
                container.style.gridRowStart = minRow;
                container.style.gridRowEnd = maxRow + 1;
                
                // Ajouter du contenu visuel au conteneur
                container.innerHTML = `
                    <div style="position: absolute; top: 8px; left: 12px; 
                                background: rgba(16, 185, 129, 0.8); color: white; 
                                padding: 4px 8px; border-radius: 4px; font-size: 10px; 
                                font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
                        Conteneur Global (${maxCol - minCol + 1}√ó${maxRow - minRow + 1})
                    </div>
                `;
            }

            // Fonction toggle grille avec indicateur visuel
            toggleGrid() {
                const workspace = document.getElementById('canvasWorkspace');
                const gridButton = document.getElementById('gridToggleBtn');
                
                if (workspace) {
                    const isGridVisible = workspace.classList.toggle('show-grid');
                    
                    // Mettre √† jour l'apparence du bouton
                    if (gridButton) {
                        if (isGridVisible) {
                            gridButton.classList.add('btn-primary');
                            gridButton.innerHTML = '<i class="fas fa-th"></i> Masquer Grille';
                            gridButton.style.background = 'var(--accent-green)';
                            gridButton.style.borderColor = 'var(--accent-green)';
                        } else {
                            gridButton.classList.remove('btn-primary');
                            gridButton.innerHTML = '<i class="fas fa-th"></i> Grille';
                            gridButton.style.background = '';
                            gridButton.style.borderColor = '';
                        }
                    }
                    
                    // Message de statut informatif
                    const statusMessage = isGridVisible ? 
                        'Grille 12√ó8 affich√©e - Positionnement visuel activ√©' : 
                        'Grille masqu√©e - Mode √©dition normal';
                    
                    this.setStatus(statusMessage, 'info');
                }
            }
            
            // R√¥le      : Configuration du syst√®me de redimensionnement du panneau propri√©t√©s
            // Type      : m√©thode (sans param√®tres)
            // Unit√©     : sans unit√©
            // Domaine   : m√©thode d'initialisation
            // Formule   : configuration des event listeners pour le handle de redimensionnement
            // Exemple   : setupPropertiesResize() - active le redimensionnement par glisser-d√©poser
            setupPropertiesResize() {
                // R√¥le      : Handle de redimensionnement du panneau
                // Type      : HTMLElement
                // Unit√©     : sans unit√©  
                // Domaine   : √©l√©ment DOM existant ou null
                // Formule   : s√©lecteur CSS .resize-handle
                // Exemple   : <div class="resize-handle"></div>
                const resizeHandle = document.querySelector('.resize-handle');
                if (!resizeHandle) return;
                
                // R√¥le      : Indicateur de redimensionnement actif
                // Type      : boolean
                // Unit√©     : sans unit√©
                // Domaine   : true/false
                // Formule   : √©tat = mousedown && mousemove
                // Exemple   : true pendant le glisser-d√©poser
                let isResizing = false;
                
                // R√¥le      : Position initiale de la souris
                // Type      : number
                // Unit√©     : pixels (px)
                // Domaine   : coordonn√©es √©cran >= 0
                // Formule   : position = event.clientX
                // Exemple   : 1200 (pixels depuis le bord gauche de l'√©cran)
                let startX = 0;
                
                // R√¥le      : Largeur initiale du panneau
                // Type      : number  
                // Unit√©     : pixels (px)
                // Domaine   : largeur >= 250px et <= 600px
                // Formule   : largeur = getComputedStyle(panel).width
                // Exemple   : 350 (largeur par d√©faut)
                let startWidth = 0;
                
                // Gestionnaire de d√©but de redimensionnement
                resizeHandle.addEventListener('mousedown', (e) => {
                    // R√¥le      : Activation du mode redimensionnement
                    // Type      : op√©ration (changement d'√©tat)
                    // Unit√©     : sans unit√©
                    // Domaine   : isResizing = false -> true
                    // Formule   : √©tat = true + capture position/taille initiales
                    // Exemple   : mousedown -> isResizing=true, startX=1200, startWidth=350
                    isResizing = true;
                    startX = e.clientX;
                    
                    const propertiesPanel = document.querySelector('.properties-panel');
                    if (propertiesPanel) {
                        // R√¥le      : R√©cup√©ration largeur actuelle
                        // Type      : number (conversion string->number)
                        // Unit√©     : pixels (px)
                        // Domaine   : largeur >= 0
                        // Formule   : parseInt(getComputedStyle().width)
                        // Exemple   : "350px" -> 350
                        startWidth = parseInt(getComputedStyle(propertiesPanel).width);
                    }
                    
                    // Ajout des classes visuelles
                    resizeHandle.classList.add('resizing');
                    document.body.style.cursor = 'ew-resize';
                    document.body.style.userSelect = 'none';
                    
                    e.preventDefault();
                });
                
                // Gestionnaire de mouvement de redimensionnement
                document.addEventListener('mousemove', (e) => {
                    if (!isResizing) return;
                    
                    // R√¥le      : Calcul du d√©placement de la souris
                    // Type      : number (diff√©rence)
                    // Unit√©     : pixels (px)
                    // Domaine   : delta peut √™tre n√©gatif ou positif
                    // Formule   : delta = position_actuelle - position_initiale
                    // Exemple   : 1150 - 1200 = -50 (souris vers la gauche)
                    const deltaX = e.clientX - startX;
                    
                    // R√¥le      : Nouvelle largeur calcul√©e
                    // Type      : number (soustraction car handle √† gauche)
                    // Unit√©     : pixels (px)  
                    // Domaine   : 250 <= newWidth <= 600
                    // Formule   : nouvelle_largeur = largeur_initiale - d√©placement
                    // Exemple   : 350 - (-50) = 400 (panneau plus large)
                    const newWidth = startWidth - deltaX;
                    
                    // R√¥le      : Largeur contrainte dans les limites
                    // Type      : number (application des bornes min/max)
                    // Unit√©     : pixels (px)
                    // Domaine   : 250 <= constrainedWidth <= 600
                    // Formule   : width = Math.max(min_width, Math.min(max_width, calculated_width))
                    // Exemple   : Math.max(250, Math.min(600, 400)) = 400
                    const constrainedWidth = Math.max(250, Math.min(600, newWidth));
                    
                    const propertiesPanel = document.querySelector('.properties-panel');
                    const widgetEditor = document.querySelector('.widget-editor');
                    if (propertiesPanel && widgetEditor) {
                        // Application de la nouvelle largeur
                        const rootStyle = document.documentElement.style;
                        rootStyle.setProperty('--properties-width', `${constrainedWidth}px`);
                        propertiesPanel.style.width = `${constrainedWidth}px`;
                        
                        // Mise √† jour du grid-template-columns
                        widgetEditor.style.gridTemplateColumns = `280px 1fr ${constrainedWidth}px`;
                        
                        // Mise √† jour de l'indicateur de largeur
                        const widthIndicator = document.querySelector('.properties-width-indicator');
                        if (widthIndicator) {
                            widthIndicator.textContent = `${constrainedWidth}px`;
                        }
                    }
                });
                
                // Gestionnaire de fin de redimensionnement
                document.addEventListener('mouseup', () => {
                    if (!isResizing) return;
                    
                    // R√¥le      : D√©sactivation du mode redimensionnement
                    // Type      : op√©ration (remise √† l'√©tat initial)
                    // Unit√©     : sans unit√©
                    // Domaine   : isResizing = true -> false
                    // Formule   : √©tat = false + suppression classes/styles temporaires
                    // Exemple   : mouseup -> isResizing=false, cursor=default
                    isResizing = false;
                    resizeHandle.classList.remove('resizing');
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                    
                    // Sauvegarde automatique apr√®s redimensionnement
                    if (window.widgetEditor) {
                        window.widgetEditor.autoSave();
                    }
                });
            }
            
            // R√¥le      : Basculement de l'√©tat collapsed/expanded du panneau propri√©t√©s  
            // Type      : m√©thode (sans param√®tres)
            // Unit√©     : sans unit√©
            // Domaine   : m√©thode de toggle UI
            // Formule   : √©tat = !√©tat_actuel
            // Exemple   : togglePropertiesPanel() - panneau ouvert -> ferm√© ou ferm√© -> ouvert
            togglePropertiesPanel() {
                // R√¥le      : Panneau de propri√©t√©s √† basculer
                // Type      : HTMLElement
                // Unit√©     : sans unit√©
                // Domaine   : √©l√©ment DOM existant ou null
                // Formule   : s√©lecteur CSS .properties-panel
                // Exemple   : <div class="properties-panel">...</div>
                const propertiesPanel = document.querySelector('.properties-panel');
                if (!propertiesPanel) return;
                
                // R√¥le      : √âtat collapsed actuel du panneau
                // Type      : boolean
                // Unit√©     : sans unit√©
                // Domaine   : true/false
                // Formule   : isCollapsed = panel.classList.contains('collapsed')
                // Exemple   : false (panneau ouvert)
                const isCollapsed = propertiesPanel.classList.contains('collapsed');
                
                if (isCollapsed) {
                    // R√¥le      : Expansion du panneau (ouverture)
                    // Type      : op√©ration (changement de classe CSS)
                    // Unit√©     : sans unit√©
                    // Domaine   : suppression classe 'collapsed'
                    // Formule   : panel.classList.remove('collapsed')
                    // Exemple   : panneau ferm√© -> panneau ouvert (largeur normale)
                    propertiesPanel.classList.remove('collapsed');
                    // Restaurer la largeur sauvegard√©e ou utiliser la largeur actuelle
                    const currentWidth = this.getCurrentPropertiesWidth();
                    propertiesPanel.style.width = currentWidth;
                } else {
                    // R√¥le      : Collapse du panneau (fermeture)
                    // Type      : op√©ration (ajout de classe CSS)
                    // Unit√©     : sans unit√©
                    // Domaine   : ajout classe 'collapsed'
                    // Formule   : panel.classList.add('collapsed')
                    // Exemple   : panneau ouvert -> panneau ferm√© (largeur minimale 40px)
                    propertiesPanel.classList.add('collapsed');
                    propertiesPanel.style.width = '40px';
                }
                
                // R√¥le      : Ic√¥ne du bouton de collapse
                // Type      : HTMLElement
                // Unit√©     : sans unit√©
                // Domaine   : √©l√©ment DOM existant ou null
                // Formule   : s√©lecteur CSS du bouton collapse
                // Exemple   : <i class="fas fa-chevron-right"></i>
                const collapseIcon = document.querySelector('.properties-collapse-btn i');
                if (collapseIcon) {
                    // R√¥le      : Rotation de l'ic√¥ne selon l'√©tat
                    // Type      : string (classe CSS)
                    // Unit√©     : sans unit√©
                    // Domaine   : 'fa-chevron-right' ou 'fa-chevron-left'
                    // Formule   : classe = isCollapsed ? 'fa-chevron-left' : 'fa-chevron-right'
                    // Exemple   : panneau ferm√© -> 'fa-chevron-left' (fl√®che vers la gauche pour ouvrir)
                    collapseIcon.className = isCollapsed ? 'fas fa-chevron-left' : 'fas fa-chevron-right';
                }
            }

            // ====== FONCTIONS POUR TARIF LOCATION WIDGET ======

            // Gestion dynamique des fonctionnalit√©s Plan 1 (ESSAI)
            addPlan1Feature() {
                console.log('üöÄ addPlan1Feature called');
                if (!this.selectedWidget) return;
                if (this.selectedWidget.type !== 'tarif-location') return;
                
                const input = document.getElementById('newPlan1Input');
                if (!input || !input.value.trim()) return;
                
                const newFeature = input.value.trim();
                this.selectedWidget.data.plan1Features.push({ text: newFeature, emoji: '‚úÖ', color: '#ffffff' });
                input.value = '';
                
                this.updateElementsTab();
                this.renderSelectedWidget();
                this.updatePreview();
                this.setStatus(`Fonctionnalit√© Plan 1 "${newFeature}" ajout√©e`, 'success');
            }
            
            removePlan1Feature(index) {
                console.log('üóëÔ∏è removePlan1Feature called with index:', index);
                if (!this.selectedWidget || this.selectedWidget.type !== 'tarif-location') return;
                
                const features = this.selectedWidget.data.plan1Features;
                if (index < 0 || index >= features.length) return;
                
                features.splice(index, 1);
                this.updateElementsTab();
                this.renderSelectedWidget();
                this.updatePreview();
                this.setStatus('Fonctionnalit√© Plan 1 supprim√©e', 'success');
            }

            // Fonctions de mise √† jour d√©taill√©e Plan 1
            updatePlan1FeatureText(index, newText) {
                console.log('‚úèÔ∏è updatePlan1FeatureText called:', index, newText);
                if (!this.selectedWidget || this.selectedWidget.type !== 'tarif-location') return;
                
                const features = this.selectedWidget.data.plan1Features;
                if (index < 0 || index >= features.length) return;
                
                if (typeof features[index] === 'string') {
                    features[index] = { text: features[index], emoji: '‚úÖ', color: '#ffffff' };
                }
                
                features[index].text = newText.trim();
                this.updateTarifFeatureInDOM('plan1', index, features[index]);
                this.updatePreview();
                this.autoSave();
            }
            
            updatePlan1FeatureEmoji(index, newEmoji) {
                console.log('üé® updatePlan1FeatureEmoji called:', index, newEmoji);
                if (!this.selectedWidget || this.selectedWidget.type !== 'tarif-location') return;
                
                const features = this.selectedWidget.data.plan1Features;
                if (index < 0 || index >= features.length) return;
                
                if (typeof features[index] === 'string') {
                    features[index] = { text: features[index], emoji: '‚úÖ', color: '#ffffff' };
                }
                
                features[index].emoji = newEmoji;
                this.updateTarifFeatureInDOM('plan1', index, features[index]);
                this.updatePreview();
                this.renderCanvas();
                setTimeout(() => {
                    this.verifyAndFixTarifEmojiDisplay('plan1', index, features[index]);
                }, 100);
                this.autoSave();
            }
            
            updatePlan1FeatureColor(index, newColor) {
                console.log('üåà updatePlan1FeatureColor called:', index, newColor);
                if (!this.selectedWidget || this.selectedWidget.type !== 'tarif-location') return;
                
                const features = this.selectedWidget.data.plan1Features;
                if (index < 0 || index >= features.length) return;
                
                if (typeof features[index] === 'string') {
                    features[index] = { text: features[index], emoji: '‚úÖ', color: '#ffffff' };
                }
                
                features[index].color = newColor;
                this.updateTarifFeatureInDOM('plan1', index, features[index]);
                this.updatePreview();
                this.autoSave();
            }

            // Gestion dynamique des fonctionnalit√©s Plan 2 (STANDARD)
            addPlan2Feature() {
                console.log('üöÄ addPlan2Feature called');
                if (!this.selectedWidget) return;
                if (this.selectedWidget.type !== 'tarif-location') return;
                
                const input = document.getElementById('newPlan2Input');
                if (!input || !input.value.trim()) return;
                
                const newFeature = input.value.trim();
                this.selectedWidget.data.plan2Features.push({ text: newFeature, emoji: '‚úÖ', color: '#ffffff' });
                input.value = '';
                
                this.updateElementsTab();
                this.renderSelectedWidget();
                this.updatePreview();
                this.setStatus(`Fonctionnalit√© Plan 2 "${newFeature}" ajout√©e`, 'success');
            }
            
            removePlan2Feature(index) {
                console.log('üóëÔ∏è removePlan2Feature called with index:', index);
                if (!this.selectedWidget || this.selectedWidget.type !== 'tarif-location') return;
                
                const features = this.selectedWidget.data.plan2Features;
                if (index < 0 || index >= features.length) return;
                
                features.splice(index, 1);
                this.updateElementsTab();
                this.renderSelectedWidget();
                this.updatePreview();
                this.setStatus('Fonctionnalit√© Plan 2 supprim√©e', 'success');
            }

            // Fonctions de mise √† jour d√©taill√©e Plan 2
            updatePlan2FeatureText(index, newText) {
                console.log('‚úèÔ∏è updatePlan2FeatureText called:', index, newText);
                if (!this.selectedWidget || this.selectedWidget.type !== 'tarif-location') return;
                
                const features = this.selectedWidget.data.plan2Features;
                if (index < 0 || index >= features.length) return;
                
                if (typeof features[index] === 'string') {
                    features[index] = { text: features[index], emoji: '‚úÖ', color: '#ffffff' };
                }
                
                features[index].text = newText.trim();
                this.updateTarifFeatureInDOM('plan2', index, features[index]);
                this.updatePreview();
                this.autoSave();
            }
            
            updatePlan2FeatureEmoji(index, newEmoji) {
                console.log('üé® updatePlan2FeatureEmoji called:', index, newEmoji);
                if (!this.selectedWidget || this.selectedWidget.type !== 'tarif-location') return;
                
                const features = this.selectedWidget.data.plan2Features;
                if (index < 0 || index >= features.length) return;
                
                if (typeof features[index] === 'string') {
                    features[index] = { text: features[index], emoji: '‚úÖ', color: '#ffffff' };
                }
                
                features[index].emoji = newEmoji;
                this.updateTarifFeatureInDOM('plan2', index, features[index]);
                this.updatePreview();
                this.renderCanvas();
                setTimeout(() => {
                    this.verifyAndFixTarifEmojiDisplay('plan2', index, features[index]);
                }, 100);
                this.autoSave();
            }
            
            updatePlan2FeatureColor(index, newColor) {
                console.log('üåà updatePlan2FeatureColor called:', index, newColor);
                if (!this.selectedWidget || this.selectedWidget.type !== 'tarif-location') return;
                
                const features = this.selectedWidget.data.plan2Features;
                if (index < 0 || index >= features.length) return;
                
                if (typeof features[index] === 'string') {
                    features[index] = { text: features[index], emoji: '‚úÖ', color: '#ffffff' };
                }
                
                features[index].color = newColor;
                this.updateTarifFeatureInDOM('plan2', index, features[index]);
                this.updatePreview();
                this.autoSave();
            }

            // Gestion dynamique des fonctionnalit√©s Plan 3 (PREMIUM)
            addPlan3Feature() {
                console.log('üöÄ addPlan3Feature called');
                if (!this.selectedWidget) return;
                if (this.selectedWidget.type !== 'tarif-location') return;
                
                const input = document.getElementById('newPlan3Input');
                if (!input || !input.value.trim()) return;
                
                const newFeature = input.value.trim();
                this.selectedWidget.data.plan3Features.push({ text: newFeature, emoji: '‚úÖ', color: '#ffffff' });
                input.value = '';
                
                this.updateElementsTab();
                this.renderSelectedWidget();
                this.updatePreview();
                this.setStatus(`Fonctionnalit√© Plan 3 "${newFeature}" ajout√©e`, 'success');
            }
            
            removePlan3Feature(index) {
                console.log('üóëÔ∏è removePlan3Feature called with index:', index);
                if (!this.selectedWidget || this.selectedWidget.type !== 'tarif-location') return;
                
                const features = this.selectedWidget.data.plan3Features;
                if (index < 0 || index >= features.length) return;
                
                features.splice(index, 1);
                this.updateElementsTab();
                this.renderSelectedWidget();
                this.updatePreview();
                this.setStatus('Fonctionnalit√© Plan 3 supprim√©e', 'success');
            }

            // Fonctions de mise √† jour d√©taill√©e Plan 3
            updatePlan3FeatureText(index, newText) {
                console.log('‚úèÔ∏è updatePlan3FeatureText called:', index, newText);
                if (!this.selectedWidget || this.selectedWidget.type !== 'tarif-location') return;
                
                const features = this.selectedWidget.data.plan3Features;
                if (index < 0 || index >= features.length) return;
                
                if (typeof features[index] === 'string') {
                    features[index] = { text: features[index], emoji: '‚úÖ', color: '#ffffff' };
                }
                
                features[index].text = newText.trim();
                this.updateTarifFeatureInDOM('plan3', index, features[index]);
                this.updatePreview();
                this.autoSave();
            }
            
            updatePlan3FeatureEmoji(index, newEmoji) {
                console.log('üé® updatePlan3FeatureEmoji called:', index, newEmoji);
                if (!this.selectedWidget || this.selectedWidget.type !== 'tarif-location') return;
                
                const features = this.selectedWidget.data.plan3Features;
                if (index < 0 || index >= features.length) return;
                
                if (typeof features[index] === 'string') {
                    features[index] = { text: features[index], emoji: '‚úÖ', color: '#ffffff' };
                }
                
                features[index].emoji = newEmoji;
                this.updateTarifFeatureInDOM('plan3', index, features[index]);
                this.updatePreview();
                this.renderCanvas();
                setTimeout(() => {
                    this.verifyAndFixTarifEmojiDisplay('plan3', index, features[index]);
                }, 100);
                this.autoSave();
            }
            
            updatePlan3FeatureColor(index, newColor) {
                console.log('üåà updatePlan3FeatureColor called:', index, newColor);
                if (!this.selectedWidget || this.selectedWidget.type !== 'tarif-location') return;
                
                const features = this.selectedWidget.data.plan3Features;
                if (index < 0 || index >= features.length) return;
                
                if (typeof features[index] === 'string') {
                    features[index] = { text: features[index], emoji: '‚úÖ', color: '#ffffff' };
                }
                
                features[index].color = newColor;
                this.updateTarifFeatureInDOM('plan3', index, features[index]);
                this.updatePreview();
                this.autoSave();
            }

            // Fonctions utilitaires pour TarifLocationWidget - avec syst√®me de fallback
            updateTarifFeatureInDOM(planType, index, itemData) {
                console.log(`üîÑ updateTarifFeatureInDOM: ${planType}, index=${index}`, itemData);
                
                // Mise √† jour dans la fen√™tre d'√©dition (canvas)
                const editorContainer = document.querySelector(`[data-widget-id="${this.selectedWidget.id}"]`);
                if (editorContainer) {
                    const planSelector = `.${planType}-features`;
                    const planColumn = editorContainer.querySelector(planSelector);
                    
                    if (planColumn) {
                        const featureItems = planColumn.querySelectorAll(`.${planType}-feature`);
                        
                        if (featureItems[index]) {
                            const featureItem = featureItems[index];
                            const emojiElement = featureItem.querySelector('.feature-emoji');
                            const textElement = featureItem.querySelector('.feature-text');
                            
                            if (emojiElement) {
                                emojiElement.textContent = itemData.emoji || '‚úÖ';
                                console.log(`‚úÖ Emoji mis √† jour dans l'√©diteur:`, emojiElement.textContent);
                            }
                            if (textElement) {
                                textElement.textContent = itemData.text || '';
                                textElement.style.color = itemData.color || '#ffffff';
                                console.log(`‚úÖ Texte mis √† jour dans l'√©diteur:`, textElement.textContent, textElement.style.color);
                            }
                        }
                    }
                }
                
                // Mise √† jour dans l'aper√ßu temps r√©el (preview)
                const previewContainer = document.getElementById('preview');
                if (previewContainer) {
                    const previewPlanSelector = `.${planType}-features`;
                    const previewPlanColumn = previewContainer.querySelector(previewPlanSelector);
                    
                    if (previewPlanColumn) {
                        const previewFeatureItems = previewPlanColumn.querySelectorAll(`.${planType}-feature`);
                        
                        if (previewFeatureItems[index]) {
                            const previewFeatureItem = previewFeatureItems[index];
                            const previewEmojiElement = previewFeatureItem.querySelector('.feature-emoji');
                            const previewTextElement = previewFeatureItem.querySelector('.feature-text');
                            
                            if (previewEmojiElement) {
                                previewEmojiElement.textContent = itemData.emoji || '‚úÖ';
                                console.log(`‚úÖ Emoji mis √† jour dans l'aper√ßu:`, previewEmojiElement.textContent);
                            }
                            if (previewTextElement) {
                                previewTextElement.textContent = itemData.text || '';
                                previewTextElement.style.color = itemData.color || '#ffffff';
                                console.log(`‚úÖ Texte mis √† jour dans l'aper√ßu:`, previewTextElement.textContent, previewTextElement.style.color);
                            }
                        }
                    }
                }
                
                console.log(`üéØ updateTarifFeatureInDOM termin√© pour ${planType}[${index}]`);
            }
            
            // Fonction de v√©rification et correction des emoji - FALLBACK S√âCURIS√â pour TarifLocation
            verifyAndFixTarifEmojiDisplay(planType, index, expectedData) {
                console.log(`üîç verifyAndFixTarifEmojiDisplay: V√©rification ${planType}[${index}]`, expectedData);
                
                let needsRefresh = false;
                
                // V√©rifier la fen√™tre d'√©dition
                const editorContainer = document.querySelector(`[data-widget-id="${this.selectedWidget.id}"]`);
                if (editorContainer) {
                    const planSelector = `.${planType}-features`;
                    const planColumn = editorContainer.querySelector(planSelector);
                    
                    if (planColumn) {
                        const featureItems = planColumn.querySelectorAll(`.${planType}-feature`);
                        
                        if (featureItems[index]) {
                            const featureItem = featureItems[index];
                            const emojiElement = featureItem.querySelector('.feature-emoji');
                            
                            if (emojiElement && emojiElement.textContent !== expectedData.emoji) {
                                console.log(`‚ùå Emoji mismatch dans l'√©diteur - Attendu: "${expectedData.emoji}", Trouv√©: "${emojiElement.textContent}"`);
                                needsRefresh = true;
                            }
                        }
                    }
                }
                
                // V√©rifier l'aper√ßu
                const previewContainer = document.getElementById('preview');
                if (previewContainer) {
                    const previewPlanSelector = `.${planType}-features`;
                    const previewPlanColumn = previewContainer.querySelector(previewPlanSelector);
                    
                    if (previewPlanColumn) {
                        const previewFeatureItems = previewPlanColumn.querySelectorAll(`.${planType}-feature`);
                        
                        if (previewFeatureItems[index]) {
                            const previewFeatureItem = previewFeatureItems[index];
                            const previewEmojiElement = previewFeatureItem.querySelector('.feature-emoji');
                            
                            if (previewEmojiElement && previewEmojiElement.textContent !== expectedData.emoji) {
                                console.log(`‚ùå Emoji mismatch dans l'aper√ßu - Attendu: "${expectedData.emoji}", Trouv√©: "${previewEmojiElement.textContent}"`);
                                needsRefresh = true;
                            }
                        }
                    }
                }
                
                // Si des probl√®mes sont d√©tect√©s, forcer un re-render complet
                if (needsRefresh) {
                    console.log(`üîÑ For√ßage du re-render complet pour corriger les emoji`);
                    this.renderCanvas();
                    this.updatePreview();
                } else {
                    console.log(`‚úÖ Emoji correctement affich√© partout`);
                }
            }
            
            // ===== FONCTIONS POUR CALL TO ACTION WIDGET - GESTION DES AVANTAGES =====
            
            addCallToActionAdvantage() {
                console.log('üöÄ addCallToActionAdvantage called');
                if (!this.selectedWidget) return;
                if (this.selectedWidget.type !== 'call-to-action') return;
                
                const input = document.getElementById('newAdvantageInput');
                if (!input || !input.value.trim()) return;
                
                const newAdvantage = input.value.trim();
                this.selectedWidget.data.advantages.push({ text: newAdvantage, emoji: '‚úÖ', color: '#10b981' });
                input.value = '';
                
                this.updateElementsTab();
                this.updatePreview();
                this.autoSave();
                console.log('‚úÖ Advantage added to CallToAction widget');
            }
            
            removeCallToActionAdvantage(index) {
                console.log('üóëÔ∏è removeCallToActionAdvantage called with index:', index);
                if (!this.selectedWidget || this.selectedWidget.type !== 'call-to-action') return;
                if (index < 0 || index >= this.selectedWidget.data.advantages.length) return;
                
                this.selectedWidget.data.advantages.splice(index, 1);
                this.updateElementsTab();
                this.updatePreview();
                this.autoSave();
                console.log('‚úÖ Advantage removed from CallToAction widget');
            }
            
            updateCallToActionAdvantageText(index, newText) {
                console.log('üìù updateCallToActionAdvantageText called:', index, newText);
                if (!this.selectedWidget || this.selectedWidget.type !== 'call-to-action') return;
                
                const advantages = this.selectedWidget.data.advantages;
                if (index < 0 || index >= advantages.length) return;
                
                advantages[index].text = newText;
                this.updateCallToActionAdvantageInDOM(index, advantages[index]);
                this.updatePreview();
                this.autoSave();
            }
            
            updateCallToActionAdvantageEmoji(index, newEmoji) {
                console.log('üòä updateCallToActionAdvantageEmoji called:', index, newEmoji);
                if (!this.selectedWidget || this.selectedWidget.type !== 'call-to-action') return;
                
                const advantages = this.selectedWidget.data.advantages;
                if (index < 0 || index >= advantages.length) return;
                
                advantages[index].emoji = newEmoji;
                this.updateCallToActionAdvantageInDOM(index, advantages[index]);
                this.updatePreview();
                setTimeout(() => {
                    this.verifyAndFixCallToActionEmojiDisplay(index, advantages[index]);
                }, 100);
                this.autoSave();
            }
            
            updateCallToActionAdvantageColor(index, newColor) {
                console.log('üåà updateCallToActionAdvantageColor called:', index, newColor);
                if (!this.selectedWidget || this.selectedWidget.type !== 'call-to-action') return;
                
                const advantages = this.selectedWidget.data.advantages;
                if (index < 0 || index >= advantages.length) return;
                
                advantages[index].color = newColor;
                this.updateCallToActionAdvantageInDOM(index, advantages[index]);
                this.updatePreview();
                this.autoSave();
            }
            
            updateCallToActionAdvantageInDOM(index, advantageData) {
                console.log(`üîÑ updateCallToActionAdvantageInDOM: Mise √† jour avantage[${index}]`, advantageData);
                
                // 1. Mettre √† jour dans l'onglet Elements (√©diteur)
                const advantageItem = document.querySelector(`[data-advantage-index="${index}"]`);
                if (advantageItem) {
                    const textInput = advantageItem.querySelector('.advantage-text');
                    const emojiInput = advantageItem.querySelector('.advantage-emoji');
                    const colorInput = advantageItem.querySelector('.advantage-color');
                    
                    if (textInput) textInput.value = advantageData.text;
                    if (emojiInput) emojiInput.value = advantageData.emoji;
                    if (colorInput) colorInput.value = advantageData.color;
                    
                    console.log(`‚úÖ DOM √©diteur mis √† jour pour l'avantage[${index}]`);
                }
                
                // 2. Mettre √† jour dans le widget canvas
                const widget = document.querySelector(`[data-widget-id="${this.selectedWidget.id}"]`);
                if (widget) {
                    const canvasAdvantages = widget.querySelectorAll('.advantage-item');
                    if (canvasAdvantages[index]) {
                        const emojiSpan = canvasAdvantages[index].querySelector('.advantage-emoji');
                        const textSpan = canvasAdvantages[index].querySelector('.advantage-text');
                        
                        if (emojiSpan) emojiSpan.textContent = advantageData.emoji;
                        if (textSpan) {
                            textSpan.textContent = advantageData.text;
                            textSpan.style.color = advantageData.color;
                        }
                        console.log(`‚úÖ Canvas mis √† jour pour l'avantage[${index}]`);
                    }
                }
                
                // 3. Mettre √† jour dans la preview
                const preview = document.getElementById('preview');
                if (preview) {
                    const previewAdvantages = preview.querySelectorAll('.cta-location-section .advantage-item');
                    if (previewAdvantages[index]) {
                        const emojiSpan = previewAdvantages[index].querySelector('.advantage-emoji');
                        const textSpan = previewAdvantages[index].querySelector('.advantage-text');
                        
                        if (emojiSpan) emojiSpan.textContent = advantageData.emoji;
                        if (textSpan) {
                            textSpan.textContent = advantageData.text;
                            textSpan.style.color = advantageData.color;
                        }
                        console.log(`‚úÖ Preview mis √† jour pour l'avantage[${index}]`);
                    }
                }
                
                console.log(`‚úÖ updateCallToActionAdvantageInDOM complet pour l'avantage[${index}]`);
            }
            
            verifyAndFixCallToActionEmojiDisplay(index, expectedData) {
                console.log(`üîç verifyAndFixCallToActionEmojiDisplay: V√©rification avantage[${index}]`, expectedData);
                
                let needsRefresh = false;
                
                // V√©rifier la fen√™tre d'√©dition
                const advantageItem = document.querySelector(`[data-advantage-index="${index}"]`);
                if (advantageItem) {
                    const emojiInput = advantageItem.querySelector('.advantage-emoji');
                    
                    if (emojiInput && emojiInput.value !== expectedData.emoji) {
                        console.log(`‚ùå Emoji mismatch dans l'√©diteur - Attendu: "${expectedData.emoji}", Trouv√©: "${emojiInput.value}"`);
                        needsRefresh = true;
                    }
                }
                
                // V√©rifier la pr√©visualisation
                const preview = document.getElementById('preview');
                if (preview) {
                    const advantageElements = preview.querySelectorAll('.cta-location-section .advantage-item');
                    
                    if (advantageElements[index]) {
                        const emojiSpan = advantageElements[index].querySelector('.advantage-emoji');
                        
                        if (emojiSpan && emojiSpan.textContent !== expectedData.emoji) {
                            console.log(`‚ùå Emoji mismatch dans la preview - Attendu: "${expectedData.emoji}", Trouv√©: "${emojiSpan.textContent}"`);
                            needsRefresh = true;
                        }
                    }
                }
                
                // Si des probl√®mes sont d√©tect√©s, forcer un re-render complet
                if (needsRefresh) {
                    console.log(`üîÑ For√ßage du re-render complet pour corriger les emoji des avantages`);
                    this.renderCanvas();
                    this.updatePreview();
                } else {
                    console.log(`‚úÖ Emoji correctement affich√© partout pour l'avantage[${index}]`);
                }
            }
            
            // Nouvelle fonction de mise √† jour temps r√©el sp√©cialement pour le CallToActionWidget
            updateCallToActionRealTime(container, propertyName, value) {
                console.log(`üîÑ updateCallToActionRealTime: ${propertyName} = ${value}`);
                
                // Propri√©t√©s du titre principal (mainTitle)
                if (propertyName.startsWith('mainTitle')) {
                    const mainTitle = container.querySelector('h1, .cta-location-section h1');
                    if (mainTitle) {
                        switch (propertyName) {
                            case 'mainTitle':
                                mainTitle.textContent = value;
                                break;
                            case 'mainTitleSize':
                                mainTitle.style.fontSize = `${value}px`;
                                break;
                            case 'mainTitleColor':
                                mainTitle.style.color = value;
                                break;
                            case 'mainTitleAlignment':
                                mainTitle.style.textAlign = value;
                                break;
                            case 'mainTitleIsBold':
                                mainTitle.style.fontWeight = value ? 'bold' : 'normal';
                                break;
                            case 'mainTitleIsItalic':
                                mainTitle.style.fontStyle = value ? 'italic' : 'normal';
                                break;
                        }
                        console.log(`‚úÖ Titre principal mis √† jour: ${propertyName}`);
                    }
                }
                
                // Propri√©t√©s du sous-titre
                else if (propertyName.startsWith('subtitle')) {
                    const subtitle = container.querySelector('.cta-location-section > p:first-of-type');
                    if (subtitle) {
                        switch (propertyName) {
                            case 'subtitle':
                                subtitle.textContent = value;
                                break;
                            case 'subtitleSize':
                                subtitle.style.fontSize = `${value}px`;
                                break;
                            case 'subtitleColor':
                                subtitle.style.color = value;
                                break;
                            case 'subtitleAlignment':
                                subtitle.style.textAlign = value;
                                break;
                            case 'subtitleIsBold':
                                subtitle.style.fontWeight = value ? 'bold' : 'normal';
                                break;
                            case 'subtitleIsItalic':
                                subtitle.style.fontStyle = value ? 'italic' : 'normal';
                                break;
                        }
                        console.log(`‚úÖ Sous-titre mis √† jour: ${propertyName}`);
                    }
                }
                
                // Propri√©t√©s de colonnes des avantages
                else if (propertyName === 'advantagesColumns') {
                    const advantagesContainer = container.querySelector('.advantages-container');
                    if (advantagesContainer) {
                        const columnsCount = Math.min(Math.max(parseInt(value), 1), 4);
                        advantagesContainer.style.gridTemplateColumns = `repeat(${columnsCount}, 1fr)`;
                        console.log(`‚úÖ Colonnes des avantages mises √† jour: ${columnsCount}`);
                    }
                    
                    // Aussi mettre √† jour dans la preview
                    const preview = document.getElementById('preview');
                    if (preview) {
                        const previewContainer = preview.querySelector('.advantages-container');
                        if (previewContainer) {
                            const columnsCount = Math.min(Math.max(parseInt(value), 1), 4);
                            previewContainer.style.gridTemplateColumns = `repeat(${columnsCount}, 1fr)`;
                        }
                    }
                }
                
                // Propri√©t√©s de style g√©n√©ral
                else if (propertyName === 'backgroundColor') {
                    const ctaSection = container.querySelector('.cta-location-section');
                    if (ctaSection) {
                        ctaSection.style.background = value;
                        console.log(`‚úÖ Couleur de fond mise √† jour: ${value}`);
                    }
                }
                else if (propertyName === 'containerPadding') {
                    const ctaSection = container.querySelector('.cta-location-section');
                    if (ctaSection) {
                        ctaSection.style.padding = `${value}px`;
                        console.log(`‚úÖ Padding conteneur mis √† jour: ${value}px`);
                    }
                }
                else if (propertyName === 'borderRadius') {
                    const ctaSection = container.querySelector('.cta-location-section');
                    if (ctaSection) {
                        ctaSection.style.borderRadius = `${value}px`;
                        console.log(`‚úÖ Border radius mis √† jour: ${value}px`);
                    }
                }
                
                // Pour les propri√©t√©s complexes (sections de contact, boutons), forcer un re-render complet
                else if (propertyName.includes('phone') || propertyName.includes('email') || propertyName.includes('delivery') || propertyName.includes('Button')) {
                    console.log(`üîÑ Propri√©t√© complexe d√©tect√©e (${propertyName}), re-render complet...`);
                    this.updatePreview();
                }
                
                // Anciennes propri√©t√©s pour r√©trocompatibilit√©
                else if (['title', 'titleSize', 'titleColor', 'titleAlignment', 'titleIsBold', 'titleIsItalic'].includes(propertyName)) {
                    const title = container.querySelector('.cta-title, h2, h1');
                    if (title) {
                        switch (propertyName) {
                            case 'title':
                                title.textContent = value;
                                break;
                            case 'titleSize':
                                title.style.fontSize = `${value}px`;
                                break;
                            case 'titleColor':
                                title.style.color = value;
                                break;
                            case 'titleAlignment':
                                title.style.textAlign = value;
                                break;
                            case 'titleIsBold':
                                title.style.fontWeight = value ? 'bold' : 'normal';
                                break;
                            case 'titleIsItalic':
                                title.style.fontStyle = value ? 'italic' : 'normal';
                                break;
                        }
                        console.log(`‚úÖ Propri√©t√© de r√©trocompatibilit√© mise √† jour: ${propertyName}`);
                    }
                }
                
                console.log(`‚úÖ updateCallToActionRealTime termin√© pour ${propertyName}`);
            }

            // Fonction de mise √† jour temps r√©el sp√©cialement pour le ImageAnimatedWidget
            updateImageAnimatedRealTime(container, propertyName, value) {
                console.log(`üîÑ updateImageAnimatedRealTime: ${propertyName} = ${value}`);
                
                // R√¥le      : S√©lecteur de l'image principale du widget
                // Type      : HTMLElement
                // Unit√©     : sans unit√© (√©l√©ment DOM)
                // Exemple   : <img> ou √©l√©ment avec background-image
                const imageElement = container.querySelector('.animated-image, img');
                
                // R√¥le      : Conteneur principal du widget image anim√©e
                // Type      : HTMLElement  
                // Unit√©     : sans unit√© (√©l√©ment DOM)
                // Exemple   : <div class="image-animated-container">
                const imageContainer = container.querySelector('.image-animated-container, .image-animated-widget');
                
                // Propri√©t√©s de l'image
                if (propertyName === 'imagePath') {
                    if (imageElement) {
                        if (imageElement.tagName === 'IMG') {
                            imageElement.src = value;
                        } else {
                            imageElement.style.backgroundImage = `url('${value}')`;
                        }
                        console.log(`‚úÖ Chemin d'image mis √† jour: ${value}`);
                    }
                }
                else if (propertyName === 'altText') {
                    if (imageElement && imageElement.tagName === 'IMG') {
                        imageElement.alt = value;
                        console.log(`‚úÖ Texte alternatif mis √† jour: ${value}`);
                    }
                }
                
                // Propri√©t√©s de dimensions
                else if (propertyName === 'width') {
                    if (imageContainer) {
                        imageContainer.style.width = `${value}px`;
                        console.log(`‚úÖ Largeur mise √† jour: ${value}px`);
                    }
                }
                else if (propertyName === 'height') {
                    if (imageContainer) {
                        imageContainer.style.height = `${value}px`;
                        console.log(`‚úÖ Hauteur mise √† jour: ${value}px`);
                    }
                }
                
                // Propri√©t√©s d'animations
                else if (propertyName === 'floatAnimation') {
                    if (imageContainer) {
                        if (value) {
                            imageContainer.style.animation = 'float 6s ease-in-out infinite';
                        } else {
                            imageContainer.style.animation = 'none';
                        }
                        console.log(`‚úÖ Animation flottante ${value ? 'activ√©e' : 'd√©sactiv√©e'}`);
                    }
                }
                else if (propertyName === 'floatDuration') {
                    if (imageContainer && imageContainer.style.animation.includes('float')) {
                        imageContainer.style.animation = `float ${value}s ease-in-out infinite`;
                        console.log(`‚úÖ Dur√©e animation flottante: ${value}s`);
                    }
                }
                
                // Propri√©t√©s de bordure
                else if (propertyName === 'borderRadius') {
                    if (imageContainer) {
                        imageContainer.style.borderRadius = `${value}px`;
                        console.log(`‚úÖ Bordure arrondie mise √† jour: ${value}px`);
                    }
                }
                else if (propertyName === 'borderWidth') {
                    if (imageContainer) {
                        const currentBorder = imageContainer.style.border || '';
                        const borderParts = currentBorder.split(' ');
                        borderParts[0] = `${value}px`;
                        imageContainer.style.borderWidth = `${value}px`;
                        console.log(`‚úÖ √âpaisseur bordure mise √† jour: ${value}px`);
                    }
                }
                else if (propertyName === 'borderColor' || propertyName === 'borderOpacity') {
                    if (imageContainer) {
                        // R√©cup√©rer les valeurs actuelles depuis les donn√©es du widget
                        const widget = this.selectedWidget;
                        if (widget) {
                            const borderColor = widget.data.borderColor || '#10b981';
                            const borderOpacity = (widget.data.borderOpacity || 30) / 100;
                            const borderWidth = widget.data.borderWidth || 3;
                            
                            // Convertir hex en rgba
                            const hex = borderColor.replace('#', '');
                            const r = parseInt(hex.substr(0, 2), 16);
                            const g = parseInt(hex.substr(2, 2), 16);
                            const b = parseInt(hex.substr(4, 2), 16);
                            
                            if (widget.data.border) {
                                imageContainer.style.border = `${borderWidth}px solid rgba(${r}, ${g}, ${b}, ${borderOpacity})`;
                            }
                            console.log(`‚úÖ Couleur/opacit√© bordure mise √† jour`);
                        }
                    }
                }
                
                // Pour les propri√©t√©s complexes (arri√®re-plan, ombre), forcer un re-render complet
                else if (propertyName.includes('background') || propertyName.includes('shadow') || propertyName.includes('shine')) {
                    console.log(`üîÑ Propri√©t√© complexe d√©tect√©e (${propertyName}), re-render complet...`);
                    this.updatePreview();
                }
                
                console.log(`‚úÖ updateImageAnimatedRealTime termin√© pour ${propertyName}`);
            }
        }

        // Initialisation et exposition globale une fois le DOM charg√©
        document.addEventListener('DOMContentLoaded', function() {
            // R√¥le      : Cr√©er l'instance globale widgetEditor
            // Type      : WidgetEditorComplete
            // Unit√©     : sans unit√©
            // Exemple   : window.widgetEditor devient accessible globalement
            window.widgetEditor = new WidgetEditorComplete();
        });
        
        // CSS pour les animations
        const style = document.createElement('style');
        style.textContent = `
            .slide-up {
                opacity: 0;
                transform: translateY(30px);
                animation: slideUp 0.6s ease-out forwards;
            }
            
            @keyframes slideUp {
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            .hover-effect:hover {
                transform: scale(1.1) !important;
                box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3) !important;
            }
        `;
        document.head.appendChild(style);
        
    </script>
    
    <!-- Popup de pr√©visualisation plein √©cran -->
    <div class="preview-popup" id="previewPopup">
        <!-- Header avec contr√¥les -->
        <div class="preview-header">
            <div class="preview-title">
                <i class="fas fa-eye"></i>
                Pr√©visualisation temps r√©el
            </div>
            <div class="preview-controls">
                <div style="color: var(--text-muted); font-size: 0.9rem; margin-right: 1rem;">
                    <i class="fas fa-info-circle"></i>
                    Rendu final tel qu'il appara√Ætra dans la pr√©sentation export√©e
                </div>
                <button class="preview-close" id="closePreviewBtn">
                    <i class="fas fa-times"></i>
                    Fermer
                </button>
            </div>
        </div>
        
        <!-- Contenu de pr√©visualisation -->
        <div class="preview-content">
            <div class="preview-grid" id="previewGrid">
                <!-- Widgets g√©n√©r√©s dynamiquement -->
            </div>
        </div>
    </div>
    
</body>
</html>