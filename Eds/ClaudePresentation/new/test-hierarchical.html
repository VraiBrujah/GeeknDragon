<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test SystÃ¨me HiÃ©rarchique - GeekDragon PrÃ©sentation</title>
    <style>
        /* RÃ´le : Styles de test pour dÃ©monstration du dark mode */
        /* Type : CSS (styles d'interface de test) */
        /* UnitÃ© : Sans unitÃ© */
        /* Domaine : Styles de test spÃ©cifiques */
        /* Formule : Adaptation du thÃ¨me dark principal */
        /* Exemple : background sombre, texte clair, contrastes Ã©levÃ©s */
        
        :root {
            --primary-dark: #10B981;
            --secondary-dark: #1E293B;
            --surface-dark: #0F172A;
            --surface-light: #334155;
            --text-primary: #F1F5F9;
            --text-secondary: #94A3B8;
        }

        body {
            background: var(--surface-dark);
            color: var(--text-primary);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--secondary-dark);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .test-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .test-header h1 {
            color: var(--primary-dark);
            margin: 0 0 8px 0;
        }

        .test-section {
            background: var(--surface-light);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .test-button {
            background: var(--primary-dark);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .test-button:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .test-result {
            background: var(--surface-dark);
            border: 1px solid var(--surface-light);
            border-radius: 4px;
            padding: 16px;
            margin-top: 16px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            min-height: 60px;
        }

        .success { color: #10B981; }
        .error { color: #EF4444; }
        .info { color: var(--text-secondary); }
    </style>
</head>
<body>
    <!-- RÃ´le : Page de test pour validation du systÃ¨me hiÃ©rarchique complet -->
    <!-- Type : Interface de test interactive -->
    <!-- UnitÃ© : Sans unitÃ© -->
    <!-- Domaine : Interface de validation fonctionnelle -->
    <!-- Formule : Tests manuels + automatiques pour validation -->
    <!-- Exemple : Boutons de test pour chaque fonctionnalitÃ© -->

    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ§ª Test SystÃ¨me HiÃ©rarchique</h1>
            <p class="info">Validation du systÃ¨me de crÃ©ation hiÃ©rarchique GeekDragon</p>
        </div>

        <div class="test-section">
            <h2>ğŸ¯ Test 1: Initialisation du Moteur</h2>
            <button class="test-button" onclick="testEngineInit()">Initialiser le Moteur</button>
            <div id="engine-result" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ“‹ Test 2: CrÃ©ation de PrÃ©sentation HiÃ©rarchique</h2>
            <button class="test-button" onclick="testCreatePresentation()">CrÃ©er PrÃ©sentation</button>
            <div id="presentation-result" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ—ï¸ Test 3: Ajout d'Ã‰lÃ©ments HiÃ©rarchiques</h2>
            <button class="test-button" onclick="testAddMetaSection()">Ajouter MÃ©ta-Section</button>
            <button class="test-button" onclick="testAddSection()">Ajouter Section</button>
            <button class="test-button" onclick="testAddWidget()">Ajouter Widget</button>
            <div id="hierarchy-result" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ¨ Test 4: Application de Templates</h2>
            <button class="test-button" onclick="testApplyTemplate()">Appliquer Template</button>
            <div id="template-result" class="test-result"></div>
        </div>

        <div class="test-section">
            <h2>ğŸ” Test 5: Ã‰tat du SystÃ¨me</h2>
            <button class="test-button" onclick="testSystemState()">VÃ©rifier Ã‰tat</button>
            <div id="state-result" class="test-result"></div>
        </div>
    </div>

    <!-- Scripts core du systÃ¨me -->
    <script src="src/core/HistoryManager.js"></script>
    <script src="src/core/SyncManager.js"></script>
    <script src="src/core/WidgetManager.js"></script>
    <script src="src/core/SectionManager.js"></script>
    <script src="src/core/HierarchyManager.js"></script>
    <script src="src/core/PresentationEngine.js"></script>

    <script>
        // RÃ´le : Variable globale pour instance du moteur de prÃ©sentation
        // Type : PresentationEngine (instance singleton)
        // UnitÃ© : Sans unitÃ©
        // Domaine : Instance unique du moteur ou null
        // Formule : new PresentationEngine() â†’ instance singleton
        // Exemple : Moteur principal pour tous les tests
        let presentationEngine = null;

        /**
         * Test d'initialisation du moteur de prÃ©sentation
         * 
         * RÃ´le : Validation de l'initialisation complÃ¨te du systÃ¨me
         * Type : Fonction de test d'initialisation
         * Effet de bord : CrÃ©e l'instance globale du moteur
         */
        async function testEngineInit() {
            const resultDiv = document.getElementById('engine-result');
            resultDiv.innerHTML = 'â³ Initialisation du moteur...';
            
            try {
                presentationEngine = new PresentationEngine();
                await new Promise(resolve => setTimeout(resolve, 1000)); // Attendre l'initialisation
                
                resultDiv.innerHTML = `<span class="success">âœ… Moteur initialisÃ© avec succÃ¨s</span>
ğŸ“Š Ã‰tat: ${presentationEngine ? 'OpÃ©rationnel' : 'Erreur'}
ğŸ”§ HierarchyManager: ${presentationEngine?.hierarchyManager ? 'ChargÃ©' : 'Non chargÃ©'}
ğŸ“š WidgetManager: ${presentationEngine?.widgetManager ? 'ChargÃ©' : 'Non chargÃ©'}`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ Erreur d'initialisation: ${error.message}</span>`;
            }
        }

        /**
         * Test de crÃ©ation de prÃ©sentation hiÃ©rarchique
         * 
         * RÃ´le : Validation de la crÃ©ation de prÃ©sentation avec support hiÃ©rarchique
         * Type : Fonction de test de crÃ©ation
         * Effet de bord : CrÃ©e une prÃ©sentation de test
         */
        async function testCreatePresentation() {
            const resultDiv = document.getElementById('presentation-result');
            
            if (!presentationEngine) {
                resultDiv.innerHTML = '<span class="error">âŒ Moteur non initialisÃ© - lancer le Test 1 d\'abord</span>';
                return;
            }

            resultDiv.innerHTML = 'â³ CrÃ©ation de prÃ©sentation hiÃ©rarchique...';

            try {
                const config = {
                    titre: 'Test PrÃ©sentation HiÃ©rarchique',
                    templateHierarchique: 'meta-header'
                };

                const presentation = await presentationEngine.createHierarchicalPresentation(config);
                
                resultDiv.innerHTML = `<span class="success">âœ… PrÃ©sentation crÃ©Ã©e avec succÃ¨s</span>
ğŸ“‹ ID: ${presentation.id}
ğŸ“ Titre: ${presentation.titre}
ğŸ—ï¸ Ã‰lÃ©ments hiÃ©rarchiques: ${presentation.hierarchicalElements?.length || 0}
ğŸ“… CrÃ©Ã©e: ${new Date(presentation.dateCreation).toLocaleString()}`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ Erreur crÃ©ation: ${error.message}</span>`;
            }
        }

        /**
         * Test d'ajout de mÃ©ta-section
         * 
         * RÃ´le : Validation de l'ajout d'Ã©lÃ©ments de niveau mÃ©ta-section
         * Type : Fonction de test d'ajout hiÃ©rarchique
         * Effet de bord : Ajoute une mÃ©ta-section Ã  la prÃ©sentation courante
         */
        function testAddMetaSection() {
            const resultDiv = document.getElementById('hierarchy-result');
            
            if (!presentationEngine?.currentPresentation) {
                resultDiv.innerHTML = '<span class="error">âŒ Aucune prÃ©sentation active - lancer le Test 2 d\'abord</span>';
                return;
            }

            try {
                const elementConfig = {
                    title: 'En-tÃªte Principal',
                    description: 'MÃ©ta-section de test'
                };

                const element = presentationEngine.addHierarchicalElement('meta-section', elementConfig);
                
                resultDiv.innerHTML = `<span class="success">âœ… MÃ©ta-section ajoutÃ©e</span>
ğŸ†” ID: ${element.id}
ğŸ“‹ Type: ${element.type}
ğŸ“ Titre: ${element.title}
ğŸ‘¥ Enfants possibles: ${JSON.stringify(element.canContain || [])}`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ Erreur ajout mÃ©ta-section: ${error.message}</span>`;
            }
        }

        /**
         * Test d'ajout de section
         * 
         * RÃ´le : Validation de l'ajout d'Ã©lÃ©ments de niveau section
         * Type : Fonction de test d'ajout avec parent
         * Effet de bord : Ajoute une section Ã  un parent existant
         */
        function testAddSection() {
            const resultDiv = document.getElementById('hierarchy-result');
            
            if (!presentationEngine?.currentPresentation?.hierarchicalElements?.length) {
                resultDiv.innerHTML = '<span class="error">âŒ Aucune mÃ©ta-section parent - lancer d\'abord "Ajouter MÃ©ta-Section"</span>';
                return;
            }

            try {
                // RÃ´le : ID du premier Ã©lÃ©ment parent disponible
                // Type : String (identifiant d'Ã©lÃ©ment hiÃ©rarchique)
                // UnitÃ© : Sans unitÃ©
                // Domaine : ID valide d'Ã©lÃ©ment existant
                // Formule : hierarchicalElements[0].id
                // Exemple : 'meta-001', 'meta-section-12345'
                const parentId = presentationEngine.currentPresentation.hierarchicalElements[0].id;
                
                const elementConfig = {
                    title: 'Section Hero',
                    description: 'Section d\'accueil'
                };

                const element = presentationEngine.addHierarchicalElement('section', elementConfig, parentId);
                
                resultDiv.innerHTML = `<span class="success">âœ… Section ajoutÃ©e</span>
ğŸ†” ID: ${element.id}
ğŸ“‹ Type: ${element.type}
ğŸ“ Titre: ${element.title}
ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Parent: ${parentId}`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ Erreur ajout section: ${error.message}</span>`;
            }
        }

        /**
         * Test d'ajout de widget
         * 
         * RÃ´le : Validation de l'ajout de widgets dans la hiÃ©rarchie
         * Type : Fonction de test d'ajout de widget
         * Effet de bord : Ajoute un widget Ã  un Ã©lÃ©ment parent
         */
        function testAddWidget() {
            const resultDiv = document.getElementById('hierarchy-result');
            
            // Recherche du premier Ã©lÃ©ment pouvant contenir des widgets
            let parentElement = null;
            if (presentationEngine?.currentPresentation?.hierarchicalElements) {
                const findWidgetParent = (elements) => {
                    for (const element of elements) {
                        if (element.canContain?.includes('widget')) {
                            return element;
                        }
                        if (element.children) {
                            const found = findWidgetParent(element.children);
                            if (found) return found;
                        }
                    }
                    return null;
                };
                
                parentElement = findWidgetParent(presentationEngine.currentPresentation.hierarchicalElements);
            }

            if (!parentElement) {
                resultDiv.innerHTML = '<span class="error">âŒ Aucun parent disponible pour widget - ajouter d\'abord des sections</span>';
                return;
            }

            try {
                const elementConfig = {
                    title: 'Widget Titre',
                    widgetType: 'text',
                    content: 'Bienvenue dans le systÃ¨me hiÃ©rarchique !'
                };

                const element = presentationEngine.addHierarchicalElement('widget', elementConfig, parentElement.id);
                
                resultDiv.innerHTML = `<span class="success">âœ… Widget ajoutÃ©</span>
ğŸ†” ID: ${element.id}
ğŸ“‹ Type: ${element.type}
ğŸ¨ Type Widget: ${element.widgetType}
ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Parent: ${parentElement.id}`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ Erreur ajout widget: ${error.message}</span>`;
            }
        }

        /**
         * Test d'application de template hiÃ©rarchique
         * 
         * RÃ´le : Validation du systÃ¨me de templates hiÃ©rarchiques
         * Type : Fonction de test de template
         * Effet de bord : Applique un template Ã  la prÃ©sentation
         */
        function testApplyTemplate() {
            const resultDiv = document.getElementById('template-result');
            
            if (!presentationEngine?.currentPresentation) {
                resultDiv.innerHTML = '<span class="error">âŒ Aucune prÃ©sentation active</span>';
                return;
            }

            try {
                const deployedTemplate = presentationEngine.applyHierarchicalTemplate('hero-section');
                
                resultDiv.innerHTML = `<span class="success">âœ… Template appliquÃ© avec succÃ¨s</span>
ğŸ†” ID Template: ${deployedTemplate.id}
ğŸ“‹ Type: ${deployedTemplate.type}
ğŸ—ï¸ Structure dÃ©ployÃ©e avec Ã©lÃ©ments intÃ©grÃ©s`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ Erreur application template: ${error.message}</span>`;
            }
        }

        /**
         * Test de vÃ©rification de l'Ã©tat du systÃ¨me
         * 
         * RÃ´le : Validation de l'Ã©tat complet du systÃ¨me
         * Type : Fonction de diagnostic systÃ¨me
         * Effet de bord : Affiche l'Ã©tat dÃ©taillÃ© du systÃ¨me
         */
        function testSystemState() {
            const resultDiv = document.getElementById('state-result');
            
            if (!presentationEngine) {
                resultDiv.innerHTML = '<span class="error">âŒ Moteur non initialisÃ©</span>';
                return;
            }

            try {
                const state = presentationEngine.getState();
                const currentPres = state.currentPresentation;
                
                // RÃ´le : Comptage des Ã©lÃ©ments hiÃ©rarchiques par type
                // Type : Object (compteurs par type d'Ã©lÃ©ment)
                // UnitÃ© : Sans unitÃ© (nombre d'Ã©lÃ©ments)
                // Domaine : Object avec propriÃ©tÃ©s numÃ©riques
                // Formule : Parcours rÃ©cursif + comptage par type
                // Exemple : {'meta-section': 1, 'section': 2, 'widget': 3}
                const hierarchyCount = {};
                const countElements = (elements) => {
                    if (!elements) return;
                    for (const element of elements) {
                        hierarchyCount[element.type] = (hierarchyCount[element.type] || 0) + 1;
                        if (element.children) {
                            countElements(element.children);
                        }
                    }
                };
                countElements(currentPres?.hierarchicalElements);

                resultDiv.innerHTML = `<span class="success">âœ… Ã‰tat du systÃ¨me</span>
ğŸ“‹ PrÃ©sentation: ${currentPres ? currentPres.titre : 'Aucune'}
ğŸ—ï¸ Ã‰lÃ©ments hiÃ©rarchiques: ${JSON.stringify(hierarchyCount, null, 2)}
ğŸ“š Widgets disponibles: ${Object.keys(state.availableWidgets || {}).length}
ğŸ§© Sections disponibles: ${Object.keys(state.availableSections || {}).length}
ğŸ¨ Templates hiÃ©rarchiques: ${Object.keys(state.hierarchyTemplates || {}).length}
ğŸ“ Historique: ${state.history?.length || 0} entrÃ©es`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ Erreur vÃ©rification Ã©tat: ${error.message}</span>`;
            }
        }

        // RÃ´le : Initialisation automatique au chargement de la page
        // Type : Event listener de chargement DOM
        // UnitÃ© : Sans unitÃ©
        // Domaine : Event de chargement de page
        // Formule : DOMContentLoaded â†’ initialisation automatique
        // Exemple : Chargement automatique du moteur au dÃ©marrage
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ§ª Page de test du systÃ¨me hiÃ©rarchique chargÃ©e');
            console.log('ğŸ‘† Cliquez sur "Initialiser le Moteur" pour commencer les tests');
        });
    </script>
</body>
</html>