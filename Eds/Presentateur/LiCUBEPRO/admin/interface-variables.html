<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéõÔ∏è Interface Variables Centralis√©es - Li-CUBE PRO‚Ñ¢ | EDS Qu√©bec</title>
    
    <!-- S√©curit√© et SEO -->
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
    <meta name="cache-control" content="no-cache, no-store, must-revalidate">
    <meta name="description" content="Interface de gestion centralis√©e des variables Li-CUBE PRO - EDS Qu√©bec">
    
    <link rel="icon" href="../image/EdsQuebec/logo edsquebec.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /**
         * =================================================================
         * STYLES INTERFACE VARIABLES CENTRALIS√âES
         * =================================================================
         * 
         * Interface moderne et intuitive pour la gestion de toutes les 
         * variables du syst√®me Li-CUBE PRO‚Ñ¢
         */
        
        :root {
            --primary: #1B365D;
            --secondary: #2E86AB; 
            --accent: #F18F01;
            --success: #28A745;
            --warning: #FFC107;
            --danger: #DC3545;
            --info: #17A2B8;
            --light: #F8F9FA;
            --dark: #212529;
            
            --bg-main: #0F1419;
            --bg-panel: #1A1F2E;
            --bg-card: #252B3B;
            --bg-input: #2F3849;
            --text-primary: #FFFFFF;
            --text-secondary: #B8C5D6;
            --text-muted: #8A95A6;
            --border: #3A4556;
            --border-focus: #F18F01;
            
            --radius: 8px;
            --radius-lg: 12px;
            --shadow: 0 4px 12px rgba(0,0,0,0.3);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.4);
            --transition: all 0.2s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-main) 0%, var(--primary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* =================================================================
         * LAYOUT PRINCIPAL
         * ================================================================= */
        
        .admin-layout {
            display: grid;
            grid-template-columns: 320px 1fr;
            grid-template-rows: auto 1fr;
            grid-template-areas: 
                "header header"
                "sidebar main";
            min-height: 100vh;
        }
        
        /* Header */
        .admin-header {
            grid-area: header;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .brand-logo {
            width: 40px;
            height: 40px;
            background: var(--accent);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
        }
        
        .brand-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .brand-subtitle {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 2px;
        }
        
        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .btn-secondary {
            background: var(--bg-input);
            color: var(--text-secondary);
        }
        
        .btn-success { background: var(--success); }
        .btn-danger { background: var(--danger); }
        .btn-sm { padding: 0.4rem 0.8rem; font-size: 0.8rem; }

        /* Sidebar */
        .admin-sidebar {
            grid-area: sidebar;
            background: var(--bg-panel);
            border-right: 1px solid var(--border);
            padding: 1.5rem;
            overflow-y: auto;
            height: calc(100vh - 80px);
        }
        
        .sidebar-section {
            margin-bottom: 2rem;
        }
        
        .sidebar-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .search-box {
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 0.75rem;
            width: 100%;
            color: var(--text-primary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .search-box:focus {
            outline: none;
            border-color: var(--border-focus);
            background: rgba(241, 143, 1, 0.1);
        }
        
        .filter-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .filter-tab {
            background: var(--bg-input);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 0.4rem 0.8rem;
            border-radius: var(--radius);
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .filter-tab.active,
        .filter-tab:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        
        .variables-tree {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .tree-node {
            margin-bottom: 0.5rem;
        }
        
        .tree-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: var(--bg-input);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }
        
        .tree-label:hover {
            background: rgba(241, 143, 1, 0.2);
        }
        
        .tree-label.active {
            background: var(--accent);
            color: white;
        }
        
        .tree-icon {
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        .tree-children {
            margin-left: 1rem;
            margin-top: 0.5rem;
        }
        
        .variable-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.8rem;
            margin-bottom: 0.25rem;
        }
        
        .variable-item:hover {
            background: rgba(241, 143, 1, 0.2);
        }
        
        .variable-item.selected {
            background: var(--accent);
            color: white;
        }
        
        .variable-type {
            background: var(--info);
            color: white;
            padding: 0.1rem 0.4rem;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .variable-type.texte { background: var(--info); }
        .variable-type.nombre { background: var(--success); }
        .variable-type.prix { background: var(--warning); }
        .variable-type.image { background: var(--secondary); }
        .variable-type.html { background: var(--danger); }

        /* Main Content */
        .admin-main {
            grid-area: main;
            padding: 2rem;
            overflow-y: auto;
            height: calc(100vh - 80px);
        }
        
        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .main-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .main-stats {
            display: flex;
            gap: 2rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* =================================================================
         * √âDITEUR DE VARIABLES
         * ================================================================= */
        
        .editor-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 0;
            box-shadow: var(--shadow);
            min-height: 600px;
            display: flex;
            flex-direction: column;
        }
        
        .editor-header {
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border);
            padding: 1.5rem;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }
        
        .editor-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .editor-path {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: var(--accent);
            background: rgba(241, 143, 1, 0.1);
            padding: 0.3rem 0.8rem;
            border-radius: var(--radius);
            display: inline-block;
        }
        
        .editor-content {
            flex: 1;
            padding: 2rem;
        }
        
        .editor-form {
            display: grid;
            gap: 1.5rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .form-label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
        }
        
        .form-input,
        .form-textarea,
        .form-select {
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 0.75rem;
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: var(--transition);
        }
        
        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--border-focus);
            background: rgba(241, 143, 1, 0.1);
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }
        
        .form-help {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .form-row-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        /* Preview en temps r√©el */
        .preview-section {
            background: rgba(40, 167, 69, 0.1);
            border: 1px solid var(--success);
            border-radius: var(--radius);
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .preview-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--success);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .preview-content {
            background: var(--bg-main);
            border-radius: var(--radius);
            padding: 1rem;
            color: var(--text-primary);
            min-height: 60px;
            border: 1px solid rgba(40, 167, 69, 0.2);
        }
        
        .preview-content[data-type="html"] {
            font-family: inherit;
        }
        
        .preview-content[data-type="prix"]::after {
            content: " CAD";
            color: var(--text-muted);
        }
        
        /* M√©tadonn√©es et utilisation */
        .metadata-section {
            background: rgba(23, 162, 184, 0.1);
            border: 1px solid var(--info);
            border-radius: var(--radius);
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .metadata-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--info);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .usage-pages {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .usage-page {
            background: var(--info);
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        /* Actions et boutons */
        .editor-actions {
            background: var(--bg-panel);
            border-top: 1px solid var(--border);
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
        }
        
        .action-group {
            display: flex;
            gap: 1rem;
        }
        
        .save-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .save-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-muted);
        }
        
        .save-indicator.saving {
            background: var(--warning);
            animation: pulse 1s infinite;
        }
        
        .save-indicator.saved {
            background: var(--success);
        }
        
        .save-indicator.error {
            background: var(--danger);
        }

        /* =================================================================
         * √âTATS VIDES ET MESSAGES
         * ================================================================= */
        
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }
        
        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: var(--text-muted);
        }
        
        .empty-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }
        
        .empty-message {
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* =================================================================
         * NOTIFICATIONS ET ALERTES
         * ================================================================= */
        
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            max-width: 400px;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transform: translateX(120%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .notification-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
        }
        
        .notification-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .notification-message {
            color: var(--text-secondary);
            font-size: 0.8rem;
            line-height: 1.4;
        }
        
        .notification.success {
            border-left: 4px solid var(--success);
        }
        
        .notification.error {
            border-left: 4px solid var(--danger);
        }
        
        .notification.warning {
            border-left: 4px solid var(--warning);
        }

        /* =================================================================
         * ANIMATIONS ET TRANSITIONS
         * ================================================================= */
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .fade-in {
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }

        /* =================================================================
         * RESPONSIVE
         * ================================================================= */
        
        @media (max-width: 1200px) {
            .admin-layout {
                grid-template-columns: 280px 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .admin-layout {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "header"
                    "main";
            }
            
            .admin-sidebar {
                display: none;
            }
            
            .header-actions {
                gap: 0.5rem;
            }
            
            .btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .form-row,
            .form-row-3 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="admin-layout">
        <!-- Header -->
        <header class="admin-header">
            <div class="header-brand">
                <div class="brand-logo">
                    <i class="fas fa-cogs"></i>
                </div>
                <div>
                    <div class="brand-title">Variables Centralis√©es</div>
                    <div class="brand-subtitle">Li-CUBE PRO‚Ñ¢ - EDS Qu√©bec</div>
                </div>
            </div>
            
            <div class="header-actions">
                <div class="save-status">
                    <div class="save-indicator" id="saveIndicator"></div>
                    <span id="saveStatus">Pr√™t</span>
                </div>
                <button class="btn btn-success btn-sm" id="saveAllBtn">
                    <i class="fas fa-save"></i>
                    Sauvegarder
                </button>
                <button class="btn btn-secondary btn-sm" id="exportBtn">
                    <i class="fas fa-download"></i>
                    Export
                </button>
                <a href="./index.html" class="btn btn-secondary btn-sm">
                    <i class="fas fa-arrow-left"></i>
                    Retour
                </a>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="sidebar-section">
                <h3 class="sidebar-title">Recherche</h3>
                <input type="text" class="search-box" id="searchBox" placeholder="Rechercher une variable...">
                
                <div class="filter-tabs">
                    <div class="filter-tab active" data-filter="all">Tout</div>
                    <div class="filter-tab" data-filter="texte">Textes</div>
                    <div class="filter-tab" data-filter="prix">Prix</div>
                    <div class="filter-tab" data-filter="image">Images</div>
                    <div class="filter-tab" data-filter="nombre">Nombres</div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <h3 class="sidebar-title">Arborescence</h3>
                <div class="variables-tree" id="variablesTree">
                    <!-- G√©n√©r√© dynamiquement -->
                </div>
            </div>
            
            <div class="sidebar-section">
                <h3 class="sidebar-title">Statistiques</h3>
                <div class="main-stats" id="sidebarStats">
                    <div class="stat-item">
                        <i class="fas fa-list-ul"></i>
                        <span id="totalVariables">0</span> variables
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <div class="main-header">
                <h1 class="main-title">√âditeur de Variables</h1>
                <div class="main-stats">
                    <div class="stat-item">
                        <i class="fas fa-database"></i>
                        <span id="loadedVariables">0</span> variables charg√©es
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-eye"></i>
                        <span id="pagesCount">0</span> pages surveill√©es
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-clock"></i>
                        <span id="lastUpdate">Jamais</span>
                    </div>
                </div>
            </div>

            <div class="editor-container" id="editorContainer">
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-mouse-pointer"></i>
                    </div>
                    <h3 class="empty-title">S√©lectionnez une variable</h3>
                    <p class="empty-message">
                        Choisissez une variable dans l'arborescence de gauche pour commencer l'√©dition.<br>
                        Vous pouvez aussi utiliser la recherche pour trouver rapidement une variable sp√©cifique.
                    </p>
                </div>
            </div>
        </main>
    </div>

    <!-- Template pour l'√©diteur -->
    <template id="editorTemplate">
        <div class="editor-header">
            <h2 class="editor-title" data-field="title">Nom de la variable</h2>
            <div class="editor-path" data-field="path">chemin.de.la.variable</div>
        </div>
        
        <div class="editor-content">
            <form class="editor-form" id="variableForm">
                <div class="form-group">
                    <label class="form-label">Valeur</label>
                    <textarea class="form-textarea" name="valeur" id="valeurField" placeholder="Saisissez la valeur..."></textarea>
                    <div class="form-help">Cette valeur sera utilis√©e partout o√π la variable est r√©f√©renc√©e.</div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Type</label>
                        <select class="form-select" name="type" id="typeField">
                            <option value="texte">Texte</option>
                            <option value="html">HTML</option>
                            <option value="nombre">Nombre</option>
                            <option value="prix">Prix</option>
                            <option value="image">Image</option>
                            <option value="email">Email</option>
                            <option value="telephone">T√©l√©phone</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Unit√© (optionnel)</label>
                        <input type="text" class="form-input" name="unite" id="uniteField" placeholder="CAD, kg, Wh...">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" name="description" id="descriptionField" placeholder="Description de la variable et de son utilisation..."></textarea>
                    <div class="form-help">Description visible dans l'interface d'administration.</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Pages utilisatrices</label>
                    <input type="text" class="form-input" name="utiliseePar" id="utiliseParField" placeholder="hero, contact, tco... (s√©par√©es par des virgules)">
                    <div class="form-help">Liste des pages ou sections qui utilisent cette variable.</div>
                </div>
            </form>
            
            <!-- Preview en temps r√©el -->
            <div class="preview-section">
                <h3 class="preview-title">
                    <i class="fas fa-eye"></i>
                    Aper√ßu en temps r√©el
                </h3>
                <div class="preview-content" id="previewContent" data-type="texte">
                    <!-- Preview g√©n√©r√© ici -->
                </div>
            </div>
            
            <!-- M√©tadonn√©es et usage -->
            <div class="metadata-section">
                <h3 class="metadata-title">
                    <i class="fas fa-info-circle"></i>
                    Utilisation et m√©tadonn√©es
                </h3>
                <div id="metadataContent">
                    <p><strong>Type:</strong> <span id="currentType">texte</span></p>
                    <p><strong>Utilis√©e par:</strong></p>
                    <div class="usage-pages" id="usagePages">
                        <!-- Pages g√©n√©r√©es ici -->
                    </div>
                </div>
            </div>
        </div>
        
        <div class="editor-actions">
            <div class="action-group">
                <button type="button" class="btn btn-danger btn-sm" id="resetBtn">
                    <i class="fas fa-undo"></i>
                    R√©initialiser
                </button>
            </div>
            
            <div class="action-group">
                <button type="button" class="btn btn-secondary btn-sm" id="duplicateBtn">
                    <i class="fas fa-copy"></i>
                    Dupliquer
                </button>
                <button type="button" class="btn btn-success" id="saveVariableBtn">
                    <i class="fas fa-save"></i>
                    Sauvegarder variable
                </button>
            </div>
        </div>
    </template>

    <!-- Scripts -->
    <script src="../js/variables-centrales.js"></script>
    <script src="../js/pricing-manager.js"></script>
    
    <script>
        /**
         * =================================================================
         * INTERFACE VARIABLES CENTRALIS√âES - SCRIPT PRINCIPAL
         * =================================================================
         * 
         * Interface d'administration moderne pour la gestion centralis√©e
         * de toutes les variables du syst√®me Li-CUBE PRO‚Ñ¢
         */

        class InterfaceVariablesCentrales {
            constructor() {
                // √âtat de l'interface
                this.variableSelectionnee = null;
                this.filtreActuel = 'all';
                this.rechercheActuelle = '';
                this.sauvegardeAuto = true;
                this.modifiee = false;
                
                // Cache des √©l√©ments DOM
                this.elements = {};
                
                // Instance des variables centrales
                this.variablesCentrales = null;
                
                this.initialiser();
            }

            /**
             * Initialise l'interface
             */
            initialiser() {
                console.log('üéõÔ∏è Initialisation de l\'interface variables centralis√©es...');
                
                // Attendre que les variables centrales soient pr√™tes
                if (window.variablesCentrales && window.variablesCentrales.estInitialise) {
                    this.configurerInterface();
                } else {
                    window.addEventListener('variablesCentralesReady', () => {
                        this.configurerInterface();
                    });
                }
            }

            /**
             * Configure l'interface une fois les variables centrales pr√™tes
             */
            configurerInterface() {
                this.variablesCentrales = window.variablesCentrales;
                console.log('‚úÖ Variables centrales connect√©es');
                
                // Cache des √©l√©ments DOM
                this.cacherElements();
                
                // Configurer les √©v√©nements
                this.configurerEvenements();
                
                // Charger l'arborescence
                this.chargerArborescence();
                
                // Mettre √† jour les statistiques
                this.mettreAJourStatistiques();
                
                console.log('üéØ Interface variables centralis√©es pr√™te');
            }

            /**
             * Met en cache les √©l√©ments DOM fr√©quemment utilis√©s
             */
            cacherElements() {
                this.elements = {
                    searchBox: document.getElementById('searchBox'),
                    variablesTree: document.getElementById('variablesTree'),
                    editorContainer: document.getElementById('editorContainer'),
                    saveIndicator: document.getElementById('saveIndicator'),
                    saveStatus: document.getElementById('saveStatus'),
                    filterTabs: document.querySelectorAll('.filter-tab'),
                    totalVariables: document.getElementById('totalVariables'),
                    loadedVariables: document.getElementById('loadedVariables'),
                    pagesCount: document.getElementById('pagesCount'),
                    lastUpdate: document.getElementById('lastUpdate')
                };
            }

            /**
             * Configure tous les √©v√©nements de l'interface
             */
            configurerEvenements() {
                // Recherche
                this.elements.searchBox.addEventListener('input', (e) => {
                    this.rechercheActuelle = e.target.value;
                    this.filtrerArborescence();
                });
                
                // Filtres par type
                this.elements.filterTabs.forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        this.elements.filterTabs.forEach(t => t.classList.remove('active'));
                        e.target.classList.add('active');
                        this.filtreActuel = e.target.dataset.filter;
                        this.filtrerArborescence();
                    });
                });
                
                // Boutons du header
                document.getElementById('saveAllBtn').addEventListener('click', () => {
                    this.sauvegarderTout();
                });
                
                document.getElementById('exportBtn').addEventListener('click', () => {
                    this.exporterConfiguration();
                });
                
                // √âcouter les modifications de variables
                window.addEventListener('variableModifiee', (e) => {
                    this.surModificationVariable(e.detail);
                });
                
                // Sauvegarde automatique avant fermeture
                window.addEventListener('beforeunload', (e) => {
                    if (this.modifiee) {
                        e.preventDefault();
                        e.returnValue = 'Des modifications non sauvegard√©es seront perdues.';
                    }
                });
            }

            /**
             * Charge et affiche l'arborescence des variables
             */
            chargerArborescence() {
                const arborescence = this.construireArborescence(this.variablesCentrales.variables);
                this.elements.variablesTree.innerHTML = '';
                this.afficherNoeudArborescence(arborescence, this.elements.variablesTree);
            }

            /**
             * Construit la structure arborescente des variables
             * @param {Object} variables - Variables √† traiter
             * @param {string} prefixe - Pr√©fixe du chemin
             * @returns {Object} - Arborescence structur√©e
             */
            construireArborescence(variables, prefixe = '') {
                const noeuds = {};
                
                for (const [cle, valeur] of Object.entries(variables)) {
                    const cheminComplet = prefixe ? `${prefixe}.${cle}` : cle;
                    
                    if (valeur && typeof valeur === 'object') {
                        if (valeur.valeur !== undefined) {
                            // C'est une variable finale
                            noeuds[cle] = {
                                type: 'variable',
                                chemin: cheminComplet,
                                valeur: valeur.valeur,
                                description: valeur.description,
                                typeVariable: valeur.type || 'texte',
                                utiliseePar: valeur.utiliseePar || []
                            };
                        } else {
                            // C'est un dossier
                            noeuds[cle] = {
                                type: 'dossier',
                                chemin: cheminComplet,
                                enfants: this.construireArborescence(valeur, cheminComplet)
                            };
                        }
                    }
                }
                
                return noeuds;
            }

            /**
             * Affiche un n≈ìud de l'arborescence dans le DOM
             * @param {Object} noeuds - N≈ìuds √† afficher
             * @param {Element} conteneur - Conteneur DOM
             * @param {number} niveau - Niveau d'indentation
             */
            afficherNoeudArborescence(noeuds, conteneur, niveau = 0) {
                for (const [nom, noeud] of Object.entries(noeuds)) {
                    if (!this.noeudPasseFiltres(noeud)) continue;
                    
                    const elementNoeud = document.createElement('div');
                    elementNoeud.className = 'tree-node';
                    
                    if (noeud.type === 'dossier') {
                        // Dossier
                        const labelDossier = document.createElement('div');
                        labelDossier.className = 'tree-label';
                        labelDossier.innerHTML = `
                            <i class="tree-icon fas fa-folder"></i>
                            <span>${this.formaterNomVariable(nom)}</span>
                            <small style="margin-left: auto; color: var(--text-muted);">
                                ${Object.keys(noeud.enfants).length}
                            </small>
                        `;
                        
                        const enfants = document.createElement('div');
                        enfants.className = 'tree-children';
                        enfants.style.display = 'block'; // Toujours ouvert pour simplifier
                        
                        elementNoeud.appendChild(labelDossier);
                        elementNoeud.appendChild(enfants);
                        
                        this.afficherNoeudArborescence(noeud.enfants, enfants, niveau + 1);
                    } else {
                        // Variable
                        const itemVariable = document.createElement('div');
                        itemVariable.className = 'variable-item';
                        itemVariable.dataset.chemin = noeud.chemin;
                        
                        itemVariable.innerHTML = `
                            <i class="fas fa-${this.obtenirIconeType(noeud.typeVariable)}"></i>
                            <span>${this.formaterNomVariable(nom)}</span>
                            <div class="variable-type ${noeud.typeVariable}">${noeud.typeVariable}</div>
                            ${noeud.utiliseePar.length > 0 ? `<small style="margin-left: auto; color: var(--text-muted);">${noeud.utiliseePar.length} pages</small>` : ''}
                        `;
                        
                        // √âv√©nement de s√©lection
                        itemVariable.addEventListener('click', () => {
                            this.selectionnerVariable(noeud.chemin);
                        });
                        
                        elementNoeud.appendChild(itemVariable);
                    }
                    
                    conteneur.appendChild(elementNoeud);
                }
            }

            /**
             * V√©rifie si un n≈ìud passe les filtres actuels
             * @param {Object} noeud - N≈ìud √† v√©rifier
             * @returns {boolean} - True si le n≈ìud passe les filtres
             */
            noeudPasseFiltres(noeud) {
                // Filtre par type
                if (this.filtreActuel !== 'all' && noeud.type === 'variable') {
                    if (noeud.typeVariable !== this.filtreActuel) {
                        return false;
                    }
                }
                
                // Filtre par recherche textuelle
                if (this.rechercheActuelle) {
                    const texteRecherche = this.rechercheActuelle.toLowerCase();
                    const texteNoeud = `${noeud.chemin} ${noeud.description || ''} ${noeud.valeur || ''}`.toLowerCase();
                    
                    if (!texteNoeud.includes(texteRecherche)) {
                        return false;
                    }
                }
                
                return true;
            }

            /**
             * Filtre et recharge l'arborescence
             */
            filtrerArborescence() {
                this.chargerArborescence();
            }

            /**
             * S√©lectionne une variable pour l'√©dition
             * @param {string} cheminVariable - Chemin de la variable
             */
            selectionnerVariable(cheminVariable) {
                // D√©s√©lectionner la pr√©c√©dente
                document.querySelectorAll('.variable-item.selected').forEach(item => {
                    item.classList.remove('selected');
                });
                
                // S√©lectionner la nouvelle
                const itemVariable = document.querySelector(`[data-chemin="${cheminVariable}"]`);
                if (itemVariable) {
                    itemVariable.classList.add('selected');
                }
                
                this.variableSelectionnee = cheminVariable;
                this.chargerEditeurVariable(cheminVariable);
                
                console.log(`üìù Variable s√©lectionn√©e: ${cheminVariable}`);
            }

            /**
             * Charge l'√©diteur pour une variable donn√©e
             * @param {string} cheminVariable - Chemin de la variable
             */
            chargerEditeurVariable(cheminVariable) {
                const template = document.getElementById('editorTemplate');
                const contenuEditeur = template.content.cloneNode(true);
                
                // R√©cup√©rer les donn√©es de la variable
                const valeur = this.variablesCentrales.obtenirVariable(cheminVariable);
                const metadata = this.variablesCentrales.obtenirMetadonnees(cheminVariable);
                
                if (!metadata) {
                    console.error('‚ùå M√©tadonn√©es introuvables pour:', cheminVariable);
                    return;
                }
                
                // Remplir les champs du header
                contenuEditeur.querySelector('[data-field="title"]').textContent = 
                    this.formaterNomVariable(cheminVariable.split('.').pop());
                contenuEditeur.querySelector('[data-field="path"]').textContent = cheminVariable;
                
                // Remplir les champs du formulaire
                const valeurField = contenuEditeur.getElementById('valeurField');
                const typeField = contenuEditeur.getElementById('typeField');
                const uniteField = contenuEditeur.getElementById('uniteField');
                const descriptionField = contenuEditeur.getElementById('descriptionField');
                const utiliseParField = contenuEditeur.getElementById('utiliseParField');
                
                valeurField.value = valeur || '';
                typeField.value = metadata.type || 'texte';
                uniteField.value = metadata.unite || '';
                descriptionField.value = metadata.description || '';
                utiliseParField.value = (metadata.utiliseePar || []).join(', ');
                
                // Mettre √† jour les m√©tadonn√©es affich√©es
                this.mettreAJourMetadonnees(contenuEditeur, metadata);
                
                // Configurer les √©v√©nements du formulaire
                this.configurerEditeurEvenements(contenuEditeur, cheminVariable);
                
                // Remplacer le contenu de l'√©diteur
                this.elements.editorContainer.innerHTML = '';
                this.elements.editorContainer.appendChild(contenuEditeur);
                
                // Mise √† jour initiale du preview
                this.mettreAJourPreview();
            }

            /**
             * Configure les √©v√©nements de l'√©diteur
             * @param {Element} editeur - √âl√©ment √©diteur
             * @param {string} cheminVariable - Chemin de la variable
             */
            configurerEditeurEvenements(editeur, cheminVariable) {
                const formulaire = editeur.getElementById('variableForm');
                
                // Mise √† jour en temps r√©el du preview
                const champs = ['valeurField', 'typeField'];
                champs.forEach(champId => {
                    const champ = editeur.getElementById(champId);
                    if (champ) {
                        champ.addEventListener('input', () => {
                            this.mettreAJourPreview();
                            this.marquerCommeModifiee();
                        });
                        champ.addEventListener('change', () => {
                            this.mettreAJourPreview();
                            this.marquerCommeModifiee();
                        });
                    }
                });
                
                // Bouton de sauvegarde
                const btnSauvegarder = editeur.getElementById('saveVariableBtn');
                btnSauvegarder.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.sauvegarderVariable(cheminVariable);
                });
                
                // Bouton de r√©initialisation
                const btnReinitialiser = editeur.getElementById('resetBtn');
                btnReinitialiser.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.reinitialiserVariable(cheminVariable);
                });
                
                // Bouton de duplication
                const btnDupliquer = editeur.getElementById('duplicateBtn');
                btnDupliquer.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.dupliquerVariable(cheminVariable);
                });
                
                // Sauvegarde automatique
                if (this.sauvegardeAuto) {
                    let timeoutSauvegarde;
                    formulaire.addEventListener('input', () => {
                        clearTimeout(timeoutSauvegarde);
                        timeoutSauvegarde = setTimeout(() => {
                            this.sauvegarderVariable(cheminVariable, true);
                        }, 2000); // 2 secondes apr√®s la derni√®re modification
                    });
                }
            }

            /**
             * Met √† jour l'aper√ßu en temps r√©el
             */
            mettreAJourPreview() {
                const valeurField = document.getElementById('valeurField');
                const typeField = document.getElementById('typeField');
                const previewContent = document.getElementById('previewContent');
                
                if (!valeurField || !typeField || !previewContent) return;
                
                const valeur = valeurField.value;
                const type = typeField.value;
                
                // Mettre √† jour le type de donn√©es du preview
                previewContent.dataset.type = type;
                
                // Afficher la valeur selon le type
                switch (type) {
                    case 'html':
                        previewContent.innerHTML = valeur;
                        break;
                    case 'prix':
                        previewContent.textContent = valeur ? `${valeur} CAD` : '';
                        break;
                    case 'nombre':
                        previewContent.textContent = valeur;
                        break;
                    default:
                        previewContent.textContent = valeur;
                }
                
                // Mettre √† jour le type affich√©
                const currentType = document.getElementById('currentType');
                if (currentType) {
                    currentType.textContent = type;
                }
            }

            /**
             * Met √† jour l'affichage des m√©tadonn√©es
             * @param {Element} editeur - √âl√©ment √©diteur
             * @param {Object} metadata - M√©tadonn√©es de la variable
             */
            mettreAJourMetadonnees(editeur, metadata) {
                const usagePages = editeur.getElementById('usagePages');
                
                // Afficher les pages utilisatrices
                if (usagePages && metadata.utiliseePar) {
                    usagePages.innerHTML = '';
                    metadata.utiliseePar.forEach(page => {
                        const badgePage = document.createElement('div');
                        badgePage.className = 'usage-page';
                        badgePage.textContent = page;
                        usagePages.appendChild(badgePage);
                    });
                }
            }

            /**
             * Sauvegarde une variable modifi√©e
             * @param {string} cheminVariable - Chemin de la variable
             * @param {boolean} auto - Si c'est une sauvegarde automatique
             */
            sauvegarderVariable(cheminVariable, auto = false) {
                const valeurField = document.getElementById('valeurField');
                const typeField = document.getElementById('typeField');
                const uniteField = document.getElementById('uniteField');
                const descriptionField = document.getElementById('descriptionField');
                const utiliseParField = document.getElementById('utiliseParField');
                
                if (!valeurField) return;
                
                // Indication de sauvegarde en cours
                this.indiquerSauvegarde('saving');
                
                try {
                    // Sauvegarder la valeur
                    this.variablesCentrales.definirVariable(
                        cheminVariable + '.valeur',
                        valeurField.value,
                        auto ? 'auto-save' : 'manuel'
                    );
                    
                    // Sauvegarder les m√©tadonn√©es
                    if (typeField) {
                        this.variablesCentrales.definirVariable(
                            cheminVariable + '.type',
                            typeField.value,
                            auto ? 'auto-save' : 'manuel'
                        );
                    }
                    
                    if (uniteField && uniteField.value) {
                        this.variablesCentrales.definirVariable(
                            cheminVariable + '.unite',
                            uniteField.value,
                            auto ? 'auto-save' : 'manuel'
                        );
                    }
                    
                    if (descriptionField) {
                        this.variablesCentrales.definirVariable(
                            cheminVariable + '.description',
                            descriptionField.value,
                            auto ? 'auto-save' : 'manuel'
                        );
                    }
                    
                    if (utiliseParField) {
                        const pages = utiliseParField.value
                            .split(',')
                            .map(p => p.trim())
                            .filter(p => p);
                        
                        this.variablesCentrales.definirVariable(
                            cheminVariable + '.utiliseePar',
                            pages,
                            auto ? 'auto-save' : 'manuel'
                        );
                    }
                    
                    this.indiquerSauvegarde('saved');
                    this.modifiee = false;
                    
                    if (!auto) {
                        this.afficherNotification('Variable sauvegard√©e avec succ√®s!', 'success');
                    }
                    
                    // Recharger l'arborescence pour refl√©ter les changements
                    setTimeout(() => {
                        this.chargerArborescence();
                    }, 500);
                    
                } catch (error) {
                    console.error('‚ùå Erreur de sauvegarde:', error);
                    this.indiquerSauvegarde('error');
                    this.afficherNotification('Erreur lors de la sauvegarde: ' + error.message, 'error');
                }
            }

            /**
             * R√©initialise une variable √† sa valeur par d√©faut
             * @param {string} cheminVariable - Chemin de la variable
             */
            reinitialiserVariable(cheminVariable) {
                if (!confirm('√ätes-vous s√ªr de vouloir r√©initialiser cette variable?')) {
                    return;
                }
                
                // Recharger la variable depuis sa valeur par d√©faut
                this.chargerEditeurVariable(cheminVariable);
                this.afficherNotification('Variable r√©initialis√©e', 'success');
            }

            /**
             * Duplique une variable
             * @param {string} cheminVariable - Chemin de la variable
             */
            dupliquerVariable(cheminVariable) {
                const nouveauNom = prompt('Nom de la nouvelle variable:');
                if (!nouveauNom) return;
                
                // TODO: Impl√©menter la duplication
                this.afficherNotification('Fonction de duplication √† venir', 'warning');
            }

            /**
             * Sauvegarde toutes les modifications
             */
            sauvegarderTout() {
                this.indiquerSauvegarde('saving');
                
                try {
                    this.variablesCentrales.sauvegarderConfiguration();
                    this.indiquerSauvegarde('saved');
                    this.modifiee = false;
                    this.afficherNotification('Toutes les variables sauvegard√©es!', 'success');
                } catch (error) {
                    console.error('‚ùå Erreur de sauvegarde globale:', error);
                    this.indiquerSauvegarde('error');
                    this.afficherNotification('Erreur lors de la sauvegarde globale', 'error');
                }
            }

            /**
             * Exporte la configuration compl√®te
             */
            exporterConfiguration() {
                try {
                    const config = this.variablesCentrales.exporterConfiguration();
                    
                    const blob = new Blob([JSON.stringify(config, null, 2)], {
                        type: 'application/json'
                    });
                    
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `variables-licubepro-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.afficherNotification('Configuration export√©e avec succ√®s!', 'success');
                    
                } catch (error) {
                    console.error('‚ùå Erreur d\'export:', error);
                    this.afficherNotification('Erreur lors de l\'export', 'error');
                }
            }

            /**
             * Marque l'interface comme modifi√©e
             */
            marquerCommeModifiee() {
                this.modifiee = true;
                this.indiquerSauvegarde('unsaved');
            }

            /**
             * Indique l'√©tat de sauvegarde
             * @param {string} etat - √âtat ('saving', 'saved', 'error', 'unsaved')
             */
            indiquerSauvegarde(etat) {
                const indicateur = this.elements.saveIndicator;
                const status = this.elements.saveStatus;
                
                // Supprimer les classes d'√©tat pr√©c√©dentes
                indicateur.className = 'save-indicator';
                
                switch (etat) {
                    case 'saving':
                        indicateur.classList.add('saving');
                        status.textContent = 'Sauvegarde...';
                        break;
                    case 'saved':
                        indicateur.classList.add('saved');
                        status.textContent = 'Sauvegard√©';
                        break;
                    case 'error':
                        indicateur.classList.add('error');
                        status.textContent = 'Erreur';
                        break;
                    case 'unsaved':
                        status.textContent = 'Non sauvegard√©';
                        break;
                    default:
                        status.textContent = 'Pr√™t';
                }
                
                // Remettre √† "Pr√™t" apr√®s 3 secondes
                if (etat === 'saved' || etat === 'error') {
                    setTimeout(() => {
                        indicateur.className = 'save-indicator';
                        status.textContent = 'Pr√™t';
                    }, 3000);
                }
            }

            /**
             * Met √† jour les statistiques affich√©es
             */
            mettreAJourStatistiques() {
                const stats = this.variablesCentrales.obtenirStatistiques();
                
                this.elements.totalVariables.textContent = stats.nombreVariables;
                this.elements.loadedVariables.textContent = stats.nombreVariables;
                this.elements.pagesCount.textContent = stats.nombreObservateurs;
                this.elements.lastUpdate.textContent = this.formaterDate(stats.derniereMiseAJour);
                
                // Sidebar
                const sidebarTotal = document.getElementById('totalVariables');
                if (sidebarTotal) {
                    sidebarTotal.textContent = stats.nombreVariables;
                }
            }

            /**
             * G√®re les modifications de variables
             * @param {Object} detail - D√©tails de la modification
             */
            surModificationVariable(detail) {
                console.log('üîÑ Variable modifi√©e:', detail);
                
                // Mettre √† jour les statistiques
                this.mettreAJourStatistiques();
                
                // Si c'est la variable actuellement √©dit√©e, ne pas recharger
                // pour √©viter de perdre les modifications en cours
            }

            /**
             * Affiche une notification
             * @param {string} message - Message √† afficher
             * @param {string} type - Type de notification ('success', 'error', 'warning', 'info')
             * @param {number} duree - Dur√©e d'affichage en ms
             */
            afficherNotification(message, type = 'info', duree = 4000) {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                
                notification.innerHTML = `
                    <div class="notification-header">
                        <div class="notification-title">
                            <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-triangle' : type === 'warning' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                            ${type === 'success' ? 'Succ√®s' : type === 'error' ? 'Erreur' : type === 'warning' ? 'Attention' : 'Information'}
                        </div>
                        <button class="notification-close">&times;</button>
                    </div>
                    <div class="notification-message">${message}</div>
                `;
                
                // Bouton de fermeture
                notification.querySelector('.notification-close').addEventListener('click', () => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                });
                
                document.body.appendChild(notification);
                
                // Animer l'apparition
                setTimeout(() => notification.classList.add('show'), 100);
                
                // Disparition automatique
                if (duree > 0) {
                    setTimeout(() => {
                        notification.classList.remove('show');
                        setTimeout(() => notification.remove(), 300);
                    }, duree);
                }
            }

            // =================================================================
            // M√âTHODES UTILITAIRES
            // =================================================================

            /**
             * Formate le nom d'une variable pour l'affichage
             * @param {string} nom - Nom brut de la variable
             * @returns {string} - Nom format√©
             */
            formaterNomVariable(nom) {
                return nom.replace(/([A-Z])/g, ' $1')
                         .replace(/^./, str => str.toUpperCase())
                         .trim();
            }

            /**
             * Retourne l'ic√¥ne FontAwesome pour un type de variable
             * @param {string} type - Type de variable
             * @returns {string} - Nom de l'ic√¥ne
             */
            obtenirIconeType(type) {
                const icones = {
                    'texte': 'font',
                    'html': 'code',
                    'nombre': 'hashtag',
                    'prix': 'dollar-sign',
                    'image': 'image',
                    'email': 'envelope',
                    'telephone': 'phone'
                };
                
                return icones[type] || 'file-alt';
            }

            /**
             * Formate une date pour l'affichage
             * @param {string} dateStr - Date ISO
             * @returns {string} - Date format√©e
             */
            formaterDate(dateStr) {
                if (!dateStr) return 'Jamais';
                
                const date = new Date(dateStr);
                const maintenant = new Date();
                const diffJours = Math.floor((maintenant - date) / (1000 * 60 * 60 * 24));
                
                if (diffJours === 0) return 'Aujourd\'hui';
                if (diffJours === 1) return 'Hier';
                if (diffJours < 7) return `Il y a ${diffJours} jours`;
                
                return date.toLocaleDateString('fr-CA');
            }
        }

        // =================================================================
        // INITIALISATION DE L'INTERFACE
        // =================================================================

        // Cr√©er l'instance de l'interface quand le DOM est pr√™t
        document.addEventListener('DOMContentLoaded', () => {
            window.interfaceVariables = new InterfaceVariablesCentrales();
        });

        console.log('üéõÔ∏è Interface Variables Centralis√©es - Script charg√©');
    </script>
    
    <!-- Script syst√®me de notes testeur alpha -->
    <script src="../module_notes/notes-module.js"></script>
</body>
</html>