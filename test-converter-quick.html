<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Rapide - Convertisseur Corrigé</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">🧪 Test Rapide - Convertisseur v2.1.0</h1>
        
        <div id="currency-converter-premium" class="bg-gray-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">💰 Test des Monnaies Sources</h2>
            
            <!-- Inputs sources simplifiés -->
            <div class="grid grid-cols-5 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium mb-2">🪙 Cuivre</label>
                    <input type="number" data-currency="copper" value="0" class="w-full p-2 bg-gray-700 rounded">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">🥈 Argent</label>
                    <input type="number" data-currency="silver" value="0" class="w-full p-2 bg-gray-700 rounded">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">⚡ Électrum</label>
                    <input type="number" data-currency="electrum" value="0" class="w-full p-2 bg-gray-700 rounded">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">🥇 Or</label>
                    <input type="number" data-currency="gold" value="0" class="w-full p-2 bg-gray-700 rounded">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">💎 Platine</label>
                    <input type="number" data-currency="platinum" value="0" class="w-full p-2 bg-gray-700 rounded">
                </div>
            </div>

            <!-- Tableau multiplicateur simplifié -->
            <h3 class="text-lg font-bold mb-4">⚖️ Tableau Multiplicateur</h3>
            <table class="w-full mb-6 bg-gray-700 rounded">
                <thead>
                    <tr class="border-b border-gray-600">
                        <th class="p-2 text-left">Monnaie</th>
                        <th class="p-2">×1</th>
                        <th class="p-2">×10</th>
                        <th class="p-2">×100</th>
                    </tr>
                </thead>
                <tbody>
                    <tr data-currency="platinum">
                        <td class="p-2">💎 Platine</td>
                        <td class="p-2"><input type="number" class="multiplier-input w-full p-1 bg-gray-600 rounded text-center" data-multiplier="1" value=""></td>
                        <td class="p-2"><input type="number" class="multiplier-input w-full p-1 bg-gray-600 rounded text-center" data-multiplier="10" value=""></td>
                        <td class="p-2"><input type="number" class="multiplier-input w-full p-1 bg-gray-600 rounded text-center" data-multiplier="100" value=""></td>
                    </tr>
                    <tr data-currency="gold">
                        <td class="p-2">🥇 Or</td>
                        <td class="p-2"><input type="number" class="multiplier-input w-full p-1 bg-gray-600 rounded text-center" data-multiplier="1" value=""></td>
                        <td class="p-2"><input type="number" class="multiplier-input w-full p-1 bg-gray-600 rounded text-center" data-multiplier="10" value=""></td>
                        <td class="p-2"><input type="number" class="multiplier-input w-full p-1 bg-gray-600 rounded text-center" data-multiplier="100" value=""></td>
                    </tr>
                </tbody>
            </table>

            <!-- Zone d'affichage des résultats -->
            <div id="currency-best" class="bg-gray-700 rounded p-4 mb-4">
                <p class="text-gray-400">Entrez des montants pour voir les recommandations optimales</p>
            </div>

            <!-- Cartes métaux -->
            <div class="grid grid-cols-2 gap-4">
                <div id="copper-card"></div>
                <div id="silver-card"></div>
                <div id="electrum-card"></div>
                <div id="gold-card"></div>
                <div id="platinum-card"></div>
            </div>
        </div>

        <!-- Zone de test manuel -->
        <div class="bg-gray-800 rounded-lg p-6">
            <h2 class="text-xl font-bold mb-4">🧪 Test Manuel de l'API</h2>
            <button onclick="testAPI()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">Tester l'API v2.1.0</button>
            <div id="test-results" class="mt-4 p-4 bg-gray-700 rounded"></div>
        </div>
    </div>

    <!-- Chargement du convertisseur -->
    <script src="js/currency-converter.js"></script>

    <script>
        // Test de l'API
        function testAPI() {
            const results = document.getElementById('test-results');
            
            try {
                // Vérifier que la classe existe
                if (typeof CurrencyConverterPremium === 'undefined') {
                    throw new Error('CurrencyConverterPremium n\'est pas défini - erreur de chargement');
                }
                
                // Créer une instance
                const converter = new CurrencyConverterPremium();
                
                // Vérifier les propriétés standardisées
                const props = ['tauxChange', 'multiplicateursDisponibles', 'donneesMetaux', 'callbacksChangement'];
                const propsStatus = props.map(prop => ({
                    name: prop,
                    exists: converter[prop] !== undefined,
                    type: typeof converter[prop]
                }));
                
                // Test de conversion
                let conversionResult = 'Erreur de conversion';
                try {
                    const testResult = converter.convertirMontant(1661);
                    conversionResult = testResult.length + ' pièces différentes';
                } catch (e) {
                    conversionResult = 'Erreur: ' + e.message;
                }
                
                results.innerHTML = `
                    <h3 class="font-bold text-green-400 mb-2">✅ Test réussi !</h3>
                    <ul class="space-y-1 text-sm">
                        <li>• CurrencyConverterPremium créé avec succès</li>
                        ${propsStatus.map(p => `<li>• ${p.name}: ${p.exists ? '✅' : '❌'} (${p.type})</li>`).join('')}
                        <li>• Méthodes API v2.1.0 disponibles</li>
                    </ul>
                    <div class="mt-4 p-2 bg-gray-600 rounded">
                        <strong>Test conversion 1661 cuivres :</strong><br>
                        <span class="text-blue-300">${conversionResult}</span>
                    </div>
                `;
            } catch (error) {
                results.innerHTML = `
                    <h3 class="font-bold text-red-400 mb-2">❌ Erreur détectée</h3>
                    <p class="text-red-300"><strong>Message:</strong> ${error.message}</p>
                    <div class="mt-2 p-2 bg-red-900/20 rounded">
                        <details>
                            <summary class="cursor-pointer text-sm">Stack trace</summary>
                            <pre class="text-xs text-gray-400 mt-2 overflow-auto">${error.stack}</pre>
                        </details>
                    </div>
                `;
            }
        }

        // Test automatique au chargement
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                const status = document.createElement('div');
                status.className = 'fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded shadow-lg';
                status.textContent = '✅ Convertisseur chargé !';
                document.body.appendChild(status);
                
                setTimeout(() => status.remove(), 3000);
            }, 1000);
        });
    </script>
</body>
</html>