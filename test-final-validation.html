<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úÖ Test Final - CurrencyConverter v2.1.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .test-success { color: #10b981; }
        .test-error { color: #ef4444; }
        .test-warning { color: #f59e0b; }
    </style>
</head>
<body class="bg-gray-900 text-white p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-4xl font-bold mb-8 text-center">
            ‚úÖ Test Final - CurrencyConverter v2.1.0
        </h1>
        
        <div class="grid lg:grid-cols-2 gap-8">
            <!-- Interface de test -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-2xl font-bold mb-4">üß™ Interface de Test</h2>
                
                <div id="currency-converter-premium" class="mb-6">
                    <!-- Sources simplifi√©es -->
                    <div class="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">ü™ô Cuivre</label>
                            <input type="number" data-currency="copper" value="1661" class="w-full p-2 bg-gray-700 rounded">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">ü•á Or</label>
                            <input type="number" data-currency="gold" value="0" class="w-full p-2 bg-gray-700 rounded">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">üíé Platine</label>
                            <input type="number" data-currency="platinum" value="0" class="w-full p-2 bg-gray-700 rounded">
                        </div>
                    </div>

                    <!-- Tableau multiplicateur simplifi√© -->
                    <table class="w-full mb-4 bg-gray-700 rounded">
                        <thead>
                            <tr class="border-b border-gray-600">
                                <th class="p-2 text-left">Monnaie</th>
                                <th class="p-2">√ó1</th>
                                <th class="p-2">√ó10</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr data-currency="platinum">
                                <td class="p-2">üíé Platine</td>
                                <td class="p-2"><input type="number" class="multiplier-input w-full p-1 bg-gray-600 rounded text-center" data-multiplier="1" value=""></td>
                                <td class="p-2"><input type="number" class="multiplier-input w-full p-1 bg-gray-600 rounded text-center" data-multiplier="10" value=""></td>
                            </tr>
                            <tr data-currency="gold">
                                <td class="p-2">ü•á Or</td>
                                <td class="p-2"><input type="number" class="multiplier-input w-full p-1 bg-gray-600 rounded text-center" data-multiplier="1" value=""></td>
                                <td class="p-2"><input type="number" class="multiplier-input w-full p-1 bg-gray-600 rounded text-center" data-multiplier="10" value=""></td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Zone d'affichage -->
                    <div id="currency-best" class="bg-gray-700 rounded p-4 mb-4">
                        <p class="text-gray-400">Test en cours...</p>
                    </div>

                    <!-- Cartes m√©taux -->
                    <div class="grid grid-cols-2 gap-2">
                        <div id="copper-card"></div>
                        <div id="gold-card"></div>
                        <div id="platinum-card"></div>
                    </div>
                </div>

                <button onclick="runInteractiveTest()" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded font-medium">
                    üîÑ Lancer Test Interactif
                </button>
            </div>

            <!-- R√©sultats des tests -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-2xl font-bold mb-4">üìä R√©sultats des Tests</h2>
                
                <div id="test-status" class="mb-4 p-4 bg-gray-700 rounded">
                    <p class="text-gray-400">Initialisation...</p>
                </div>
                
                <div id="test-details" class="space-y-4">
                    <!-- Les d√©tails des tests appara√Ætront ici -->
                </div>
            </div>
        </div>
        
        <!-- Logs d√©taill√©s -->
        <div class="mt-8 bg-gray-800 rounded-lg p-6">
            <h2 class="text-2xl font-bold mb-4">üìù Logs D√©taill√©s</h2>
            <div id="test-logs" class="bg-black rounded p-4 text-green-400 font-mono text-sm h-64 overflow-y-auto">
                <p>En attente du chargement...</p>
            </div>
        </div>
    </div>

    <!-- Chargement du convertisseur -->
    <script src="js/currency-converter.js"></script>

    <script>
        let converter = null;
        const logs = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            logs.push(logEntry);
            
            const logsDiv = document.getElementById('test-logs');
            if (logsDiv) {
                logsDiv.innerHTML = logs.join('\\n');
                logsDiv.scrollTop = logsDiv.scrollHeight;
            }
        }
        
        function updateStatus(message, isSuccess = true) {
            const statusDiv = document.getElementById('test-status');
            statusDiv.innerHTML = `
                <div class="flex items-center">
                    <span class="text-2xl mr-3">${isSuccess ? '‚úÖ' : '‚ùå'}</span>
                    <span class="${isSuccess ? 'test-success' : 'test-error'}">${message}</span>
                </div>
            `;
        }
        
        function addTestDetail(name, result, details = '') {
            const detailsDiv = document.getElementById('test-details');
            const success = result !== false;
            
            const detailHtml = `
                <div class="p-3 bg-gray-700 rounded">
                    <div class="flex items-center justify-between">
                        <span class="font-medium">${name}</span>
                        <span class="${success ? 'test-success' : 'test-error'}">${success ? '‚úÖ OK' : '‚ùå √âCHEC'}</span>
                    </div>
                    ${details ? `<p class="text-sm text-gray-400 mt-1">${details}</p>` : ''}
                </div>
            `;
            
            detailsDiv.innerHTML += detailHtml;
        }
        
        function runComprehensiveTests() {
            log('=== D√âBUT DES TESTS COMPLETS ===');
            
            try {
                // Test 1: Chargement de la classe
                log('Test 1: V√©rification du chargement de CurrencyConverterPremium');
                if (typeof CurrencyConverterPremium === 'undefined') {
                    throw new Error('CurrencyConverterPremium non d√©fini');
                }
                addTestDetail('Chargement classe', true, 'CurrencyConverterPremium disponible');
                log('‚úÖ Classe charg√©e avec succ√®s');
                
                // Test 2: Cr√©ation d'instance
                log('Test 2: Cr√©ation d\\'instance');
                converter = new CurrencyConverterPremium();
                addTestDetail('Cr√©ation instance', true, 'Instance cr√©√©e sans erreur');
                log('‚úÖ Instance cr√©√©e avec succ√®s');
                
                // Test 3: Propri√©t√©s standardis√©es
                log('Test 3: V√©rification des propri√©t√©s standardis√©es');
                const requiredProps = ['tauxChange', 'multiplicateursDisponibles', 'donneesMetaux', 'callbacksChangement'];
                let propsOK = true;
                
                requiredProps.forEach(prop => {
                    if (converter[prop] === undefined) {
                        log(`‚ùå Propri√©t√© manquante: ${prop}`, 'error');
                        propsOK = false;
                    } else {
                        log(`‚úÖ Propri√©t√© OK: ${prop} (${typeof converter[prop]})`);
                    }
                });
                
                addTestDetail('Propri√©t√©s standardis√©es', propsOK, `${requiredProps.length} propri√©t√©s v√©rifi√©es`);
                
                // Test 4: API v2.1.0
                log('Test 4: Test de l\\'API v2.1.0');
                const testResult = converter.convertirMontant(1661);
                const isValidResult = Array.isArray(testResult) && testResult.length > 0;
                
                if (isValidResult) {
                    log(`‚úÖ convertirMontant(1661) retourne ${testResult.length} pi√®ces`);
                    addTestDetail('API convertirMontant', true, `${testResult.length} pi√®ces calcul√©es`);
                } else {
                    log('‚ùå convertirMontant retourne un r√©sultat invalide', 'error');
                    addTestDetail('API convertirMontant', false, 'R√©sultat invalide');
                }
                
                // Test 5: M√©thodes utilitaires
                log('Test 5: Test des m√©thodes utilitaires');
                const totalPieces = converter.calculerTotalPieces(testResult);
                const valeurTotale = converter.calculerValeurTotale(testResult);
                const texteFormate = converter.formaterPourAffichage(testResult);
                
                log(`‚úÖ calculerTotalPieces: ${totalPieces}`);
                log(`‚úÖ calculerValeurTotale: ${valeurTotale}`);
                log(`‚úÖ formaterPourAffichage: "${texteFormate}"`);
                
                addTestDetail('M√©thodes utilitaires', true, 'Toutes les m√©thodes fonctionnent');
                
                // Test 6: Statistiques
                log('Test 6: V√©rification des statistiques');
                const stats = converter.obtenirStatistiques();
                log(`‚úÖ Statistiques: ${JSON.stringify(stats)}`);
                addTestDetail('Statistiques', true, `Taux cache: ${stats.tauxCacheHit}`);
                
                updateStatus('Tous les tests r√©ussis ! CurrencyConverter v2.1.0 op√©rationnel', true);
                log('=== TESTS TERMIN√âS AVEC SUCC√àS ===');
                
            } catch (error) {
                log(`‚ùå ERREUR CRITIQUE: ${error.message}`, 'error');
                log(`Stack: ${error.stack}`, 'error');
                updateStatus('Erreur d√©tect√©e ! Voir les logs pour plus de d√©tails', false);
                addTestDetail('Test global', false, error.message);
            }
        }
        
        function runInteractiveTest() {
            log('Test interactif lanc√© par l\\'utilisateur');
            if (converter) {
                log('D√©clenchement de mises √† jour...');
                // Simuler une saisie dans les sources
                const copperInput = document.querySelector('[data-currency="copper"]');
                if (copperInput) {
                    copperInput.dispatchEvent(new Event('input', { bubbles: true }));
                    log('‚úÖ √âv√©nement input d√©clench√© sur le champ cuivre');
                }
            }
        }
        
        // Lancement automatique des tests
        document.addEventListener('DOMContentLoaded', () => {
            log('DOM charg√©, d√©marrage des tests...');
            setTimeout(() => {
                runComprehensiveTests();
            }, 1000);
        });
    </script>
</body>
</html>