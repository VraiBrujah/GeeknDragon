<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Panier GeeknDragon</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-product { border: 1px solid #ccc; padding: 20px; margin: 20px 0; }
        .btn { padding: 10px 20px; background: #007cba; color: white; border: none; cursor: pointer; }
        #test-log { background: #f0f0f0; padding: 10px; margin: 20px 0; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>Test du Système de Panier Custom</h1>
    
    <div class="test-product">
        <h3>L'Offrande du Voyageur (Test)</h3>
        <p>Prix: 60.00 CAD</p>
        
        <!-- Bouton simulant exactement celui généré par PHP -->
        <button class="gd-add-to-cart btn"
            data-id="lot10"
            data-name="L'Offrande du Voyageur"
            data-name-fr="L'Offrande du Voyageur"
            data-name-en="The Traveler's Offering"
            data-price="60.00"
            data-url="http://localhost:8000/product.php?id=lot10"
            data-quantity="1"
            data-custom1-name="Multiplicateur"
            data-custom1-options="‎ — x1|‎ — x10|‎ — x100|‎ — x1 000|‎ — x10 000"
            data-custom1-value="‎ — x1"
        >
            Ajouter au panier
        </button>
    </div>
    
    <div class="test-product">
        <h3>Test sans variations</h3>
        <p>Prix: 25.00 CAD</p>
        
        <button class="gd-add-to-cart btn"
            data-id="test-simple"
            data-name="Produit Simple"
            data-price="25.00"
            data-quantity="1"
        >
            Ajouter au panier (sans variations)
        </button>
    </div>
    
    <div id="test-log"></div>
    
    <!-- Chargement du système e-commerce -->
    <script src="js/gd-ecommerce-native.js"></script>
    
    <script>
        // Surcharge du logger pour afficher dans la page
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        const logElement = document.getElementById('test-log');
        
        function addToLog(level, message, data) {
            const timestamp = new Date().toLocaleTimeString();
            const logLine = `[${timestamp}] [${level}] ${message} ${data ? JSON.stringify(data, null, 2) : ''}`;
            logElement.textContent += logLine + '\n';
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        console.log = function(message, data) {
            addToLog('INFO', message, data);
            originalLog.apply(console, arguments);
        };
        
        console.warn = function(message, data) {
            addToLog('WARN', message, data);
            originalWarn.apply(console, arguments);
        };
        
        console.error = function(message, data) {
            addToLog('ERROR', message, data);
            originalError.apply(console, arguments);
        };
        
        // Test du panier au chargement
        window.addEventListener('load', function() {
            console.log('=== DÉBUT DES TESTS DU PANIER ===');
            
            // Vérifier que l'API est disponible
            if (window.GDEcommerce) {
                console.log('✅ API GDEcommerce disponible');
                console.log('Méthodes disponibles:', Object.keys(window.GDEcommerce));
            } else {
                console.error('❌ API GDEcommerce non disponible');
            }
            
            // Test d'extraction des variantes
            const boutonAvecVariations = document.querySelector('[data-id="lot10"]');
            if (boutonAvecVariations) {
                console.log('=== TEST EXTRACTION VARIANTES ===');
                console.log('Bouton trouvé:', boutonAvecVariations);
                console.log('Dataset complet:', boutonAvecVariations.dataset);
                
                // Simulation de l'extraction
                const variants = {};
                for (let i = 1; i <= 3; i++) {
                    const name = boutonAvecVariations.dataset[`custom${i}Name`];
                    const value = boutonAvecVariations.dataset[`custom${i}Value`];
                    const options = boutonAvecVariations.dataset[`custom${i}Options`];
                    
                    console.log(`Custom${i}: name=${name}, value=${value}, options=${options}`);
                    
                    if (name && value) {
                        variants[name] = value;
                    }
                }
                console.log('Variantes extraites:', variants);
            }
        });
    </script>
</body>
</html>