<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test des traductions - Geek & Dragon</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            background: #333;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .lang-switch {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        .flag-btn {
            background: none;
            border: 2px solid #ccc;
            padding: 5px;
            margin: 0 5px;
            cursor: pointer;
            border-radius: 4px;
        }
        .flag-btn[aria-current="true"] {
            border-color: #007bff;
            background: rgba(0, 123, 255, 0.2);
        }
        .snipcart-add-item {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 0;
        }
        .test-result {
            background: #2d5a2d;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #4caf50;
        }
        .test-error {
            background: #5a2d2d;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #f44336;
        }
    </style>
</head>
<body>
    <div class="lang-switch">
        <button class="flag-btn" data-lang="fr" aria-current="true">🇫🇷 FR</button>
        <button class="flag-btn" data-lang="en" aria-current="false">🇬🇧 EN</button>
    </div>

    <h1 data-i18n="hero.title">L'immersion au cœur du jeu</h1>

    <div class="test-section">
        <h2>Test des traductions de base</h2>
        <p><strong data-i18n="nav.shop">Boutique</strong></p>
        <p><strong data-i18n="nav.contact">Contact</strong></p>
        <p><strong data-i18n="product.add">Ajouter</strong></p>
        <p><strong data-i18n="product.quantity">Quantité</strong></p>
        <div id="translation-status" class="test-result">En attente du chargement des traductions...</div>
    </div>

    <div class="test-section">
        <h2>Test des traductions Snipcart</h2>
        <div id="snipcart-test">
            <p>Test produit avec champs personnalisés :</p>
            <button 
                class="snipcart-add-item"
                data-item-id="test-product"
                data-item-name="Produit de test"
                data-item-price="10.00"
                data-item-url="/test"
                data-item-custom1-name="multiplier"
                data-item-custom1-options="x1|x10|x25"
                data-item-custom1-value="x1"
                data-item-custom2-name="language"
                data-item-custom2-options="Français|English"
                data-item-custom2-value="Français">
                <span data-i18n="product.add">Ajouter au panier</span>
            </button>
        </div>
        <div id="snipcart-status" class="test-result">Snipcart pas encore chargé</div>
    </div>

    <div class="test-section">
        <h2>Test du changement de langue</h2>
        <p>Cliquez sur les drapeaux en haut à droite pour tester le changement de langue.</p>
        <div id="language-test-status" class="test-result">Langue actuelle : <span id="current-lang">fr</span></div>
    </div>

    <!-- Snipcart -->
    <div hidden id="snipcart" data-api-key="test-key"></div>
    
    <!-- Scripts Snipcart (simulation) -->
    <script>
        // Simulation basique de Snipcart pour les tests
        window.Snipcart = {
            events: {
                on: (event, callback) => {
                    console.log(`[Test] Snipcart event listener: ${event}`);
                }
            },
            api: {
                session: {
                    setLanguage: (lang) => {
                        console.log(`[Test] Snipcart langue changée: ${lang}`);
                    }
                }
            }
        };
    </script>
    
    <script>
        // Simulation des utilitaires GD
        window.GD = {
            getLang: () => localStorage.getItem('lang') || 'fr',
            setLang: (lang) => {
                localStorage.setItem('lang', lang);
                localStorage.setItem('snipcartLanguage', lang);
                document.documentElement.lang = lang;
                return lang;
            }
        };

        // Fonction de test des traductions
        function testTranslations() {
            const currentLang = window.GD.getLang();
            const statusEl = document.getElementById('translation-status');
            const langStatusEl = document.getElementById('current-lang');
            
            langStatusEl.textContent = currentLang;
            
            fetch(`/translations/${currentLang}.json`)
                .then(res => res.ok ? res.json() : null)
                .then(data => {
                    if (data) {
                        window.i18n = data;
                        statusEl.className = 'test-result';
                        statusEl.textContent = `✅ Traductions ${currentLang.toUpperCase()} chargées avec succès`;
                        
                        // Appliquer les traductions
                        document.querySelectorAll('[data-i18n]').forEach(el => {
                            const keys = el.dataset.i18n.split('.');
                            let text = data;
                            keys.forEach(k => { if (text) text = text[k]; });
                            if (text != null) el.textContent = text;
                        });
                        
                        // Test des traductions Snipcart
                        if (data.snipcart) {
                            document.getElementById('snipcart-status').className = 'test-result';
                            document.getElementById('snipcart-status').textContent = `✅ Traductions Snipcart disponibles pour ${currentLang.toUpperCase()}`;
                        } else {
                            document.getElementById('snipcart-status').className = 'test-error';
                            document.getElementById('snipcart-status').textContent = `❌ Traductions Snipcart manquantes pour ${currentLang.toUpperCase()}`;
                        }
                    } else {
                        statusEl.className = 'test-error';
                        statusEl.textContent = `❌ Impossible de charger les traductions ${currentLang.toUpperCase()}`;
                    }
                })
                .catch(error => {
                    statusEl.className = 'test-error';
                    statusEl.textContent = `❌ Erreur: ${error.message}`;
                });
        }

        // Gestion du changement de langue
        document.querySelectorAll('.flag-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const lang = btn.dataset.lang;
                window.GD.setLang(lang);
                
                // Mettre à jour l'interface
                document.querySelectorAll('.flag-btn').forEach(b => {
                    b.setAttribute('aria-current', b.dataset.lang === lang ? 'true' : 'false');
                });
                
                // Recharger les traductions
                testTranslations();
            });
        });

        // Test initial
        document.addEventListener('DOMContentLoaded', () => {
            const currentLang = window.GD.getLang();
            document.querySelectorAll('.flag-btn').forEach(btn => {
                btn.setAttribute('aria-current', btn.dataset.lang === currentLang ? 'true' : 'false');
            });
            testTranslations();
        });
    </script>
</body>
</html>