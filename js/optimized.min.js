/* Source: ab-testing.js */
(function() { 'use strict'; class ABTestingClient { constructor() { this.activeTests={}; this.conversionEvents=[]; this.init(); } init() { this.loadTestVariations(); this.attachConversionTracking(); this.setupAutomaticReporting(); } loadTestVariations() { const testData=document.querySelector('meta[name="ab-tests"]'); if (testData) { try { this.activeTests=JSON.parse(testData.content); } catch (e) { } } const body=document.body; Object.keys(body.dataset).forEach(key => { if (key.startsWith('abTest')) { const testName=key.replace('abTest', '').toLowerCase(); this.activeTests[testName]=body.dataset[key]; } }); } recordConversion(testName, conversionType='interaction', value=0) { const conversion={ test_name: testName, variation: this.activeTests[testName] || 'control', conversion_type: conversionType, value: value, timestamp: Date.now(), page_url: window.location.pathname, referrer: document.referrer }; this.conversionEvents.push(conversion); if (['purchase', 'add_to_cart', 'signup'].includes(conversionType)) { this.sendConversion(conversion); } if (window.GeeknDragonAnalytics) { window.GeeknDragonAnalytics.trackEvent('ab_test_conversion', conversion); } } async sendConversion(conversion) { try { await fetch('/api/ab-test/conversion', { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest' }, body: JSON.stringify(conversion) }); } catch (e) { } } attachConversionTracking() { document.addEventListener('click', (e) => { const target=e.target.closest('[data-ab-track]'); if (target) { const trackType=target.dataset.abTrack; const testName=target.dataset.abTest || 'cta_button'; this.recordConversion(testName, trackType); } if (e.target.closest('.gd-add-to-cart')) { this.recordConversion('cta_button', 'add_to_cart_click'); } if (e.target.closest('.trust-badge, [data-quebec]')) { this.recordConversion('trust_signals', 'trust_signal_click'); } }); let hoverTimeout; document.addEventListener('mouseenter', (e) => { if (e.target.closest('.product-card')) { hoverTimeout=setTimeout(() => { this.recordConversion('product_description', 'product_engagement'); }, 3000); } }, true); document.addEventListener('mouseleave', (e) => { if (e.target.closest('.product-card')) { clearTimeout(hoverTimeout); } }, true); this.trackHeadlineEngagement(); } trackHeadlineEngagement() { const hero=document.querySelector('.hero-text, .hero-title'); if (!hero) return; const observer=new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) { this.recordConversion('hero_headline', 'headline_view'); setTimeout(() => { if (entry.isIntersecting) { this.recordConversion('hero_headline', 'headline_engagement'); } }, 5000); observer.unobserve(entry.target); } }); }, { threshold: 0.7 }); observer.observe(hero); } applyDynamicStyles() { const trustVariation=this.activeTests.trust_signals || 'control'; this.applyTrustSignalsStyles(trustVariation); const pricingVariation=this.activeTests.pricing_display || 'control'; this.applyPricingStyles(pricingVariation); } applyTrustSignalsStyles(variation) { const styles={ 'flim_prominent': { '.trust-badge[data-type="flim"]': 'transform: scale(1.1); border: 2px solid #fbbf24;', '.trust-badge[data-type="quebec"]': 'opacity: 0.8; transform: scale(0.95);' }, 'balanced': { '.trust-badge': 'transform: scale(1.05);' }, 'quebec_prominent': { '.trust-badge[data-type="quebec"]': 'transform: scale(1.1); border: 2px solid #3b82f6;', '.trust-badge[data-type="flim"]': 'opacity: 0.8; transform: scale(0.95);' } }; const variationStyles=styles[variation]; if (variationStyles) { this.injectDynamicCSS('trust-signals', variationStyles); } } applyPricingStyles(variation) { const styles={ 'cad_emphasis': { '.product-price': 'font-weight: 700; color: #059669;' }, 'value_emphasis': { '.product-price': 'position: relative;', '.product-price::after': 'content: " (vs 300$ figurines)"; font-size: 0.8em; opacity: 0.7;' } }; const variationStyles=styles[variation]; if (variationStyles) { this.injectDynamicCSS('pricing', variationStyles); } } injectDynamicCSS(testName, rules) { const existingStyle=document.getElementById(`ab-test-${testName}`); if (existingStyle) { existingStyle.remove(); } const style=document.createElement('style'); style.id=`ab-test-${testName}`; let css=''; Object.entries(rules).forEach(([selector, rule]) => { css += `${selector} { ${rule} }\n`; }); style.textContent=css; document.head.appendChild(style); } setupAutomaticReporting() { setInterval(() => { if (this.conversionEvents.length > 0) { this.sendBatchConversions(); } }, 30000); window.addEventListener('beforeunload', () => { if (this.conversionEvents.length > 0) { navigator.sendBeacon('/api/ab-test/batch-conversions', JSON.stringify(this.conversionEvents)); } }); } async sendBatchConversions() { if (this.conversionEvents.length===0) return; try { await fetch('/api/ab-test/batch-conversions', { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest' }, body: JSON.stringify(this.conversionEvents) }); this.conversionEvents=[]; } catch (e) { } } getDebugInfo() { return { activeTests: this.activeTests, conversionEvents: this.conversionEvents, totalConversions: this.conversionEvents.length }; } forceVariation(testName, variation) { this.activeTests[testName]=variation; this.applyDynamicStyles(); } } document.addEventListener('DOMContentLoaded', () => { window.GeeknDragonABTesting=new ABTestingClient(); if (window.location.hostname==='localhost') { window._debugAB=window.GeeknDragonABTesting; } }); window.recordABConversion=function(testName, conversionType, value) { if (window.GeeknDragonABTesting) { window.GeeknDragonABTesting.recordConversion(testName, conversionType, value); } }; })();
/* Source: advanced-seo-accessibility.js */
(function() { 'use strict'; class AdvancedSEOAccessibility { constructor() { this.config={ enableStructuredData: true, enableBreadcrumbs: true, enableSkipLinks: true, enableAriaEnhancements: true, enableFocusManagement: true, enableScreenReaderOptimizations: true, enableKeyboardNavigation: true, enableLanguageManagement: true, enableSocialSharing: true, autoGenerateAltText: true }; this.structuredData={ '@context': 'https: '@type': 'Organization', 'name': 'Geek & Dragon', 'url': 'https: 'logo': 'https: 'description': 'Aides de jeu physiques pour D&D : pi√®ces m√©talliques, cartes d\'√©quipement et triptyques de personnage. Fabriqu√© au Qu√©bec.', 'foundingDate': '2024', 'foundingLocation': { '@type': 'Place', 'name': 'Qu√©bec, Canada' }, 'contactPoint': { '@type': 'ContactPoint', 'telephone': '+1-438-764-2612', 'contactType': 'Customer Service', 'email': 'contact@geekndragon.com', 'availableLanguage': ['French', 'English'] }, 'sameAs': [ 'https: ], 'hasOfferCatalog': { '@type': 'OfferCatalog', 'name': 'Aides de jeu D&D', 'itemListElement': [] } }; this.breadcrumbPath=[]; this.focusHistory=[]; this.currentLanguage='fr'; this.init(); } async init() { this.detectCurrentLanguage(); this.generateStructuredData(); this.enhanceMetadata(); this.generateBreadcrumbs(); this.addSkipLinks(); this.enhanceARIA(); this.setupFocusManagement(); this.setupScreenReaderOptimizations(); this.enhanceImages(); this.setupSocialSharing(); this.startSEOMonitoring(); } detectCurrentLanguage() { this.currentLanguage=document.documentElement.lang || (window.location.pathname.includes('/en/') ? 'en' : 'fr'); } generateStructuredData() { if (!this.config.enableStructuredData) return; this.addStructuredData('organization', this.structuredData); const path=window.location.pathname; if (path==='/' || path==='/index.php') { this.addWebsiteSchema(); } else if (path.includes('boutique')) { this.addShopSchema(); } else if (path.includes('product') || this.isProductPage()) { this.addProductSchema(); } this.addFAQSchema(); this.addBreadcrumbSchema(); } addStructuredData(type, data) { const script=document.createElement('script'); script.type='application/ld+json'; script.textContent=JSON.stringify(data, null, 2); document.head.appendChild(script); } addWebsiteSchema() { const websiteSchema={ '@context': 'https: '@type': 'WebSite', 'name': 'Geek & Dragon', 'url': 'https: 'description': 'Aides de jeu physiques pour D&D fabriqu√©es au Qu√©bec', 'inLanguage': ['fr-CA', 'en-CA'], 'potentialAction': [ { '@type': 'SearchAction', 'target': { '@type': 'EntryPoint', 'urlTemplate': 'https: }, 'query-input': 'required name=search_term_string' } ], 'publisher': this.structuredData }; this.addStructuredData('website', websiteSchema); } addShopSchema() { const products=this.extractProductsFromPage(); const catalogSchema={ '@context': 'https: '@type': 'CollectionPage', 'name': this.currentLanguage==='fr' ? 'Boutique-Aides de jeu D&D' : 'Shop-D&D Game Aids', 'description': this.currentLanguage==='fr' ? 'D√©couvrez notre collection de pi√®ces m√©talliques, cartes d\'√©quipement et triptyques pour vos parties de D&D' : 'Discover our collection of metal coins, equipment cards and triptychs for your D&D games', 'url': window.location.href, 'mainEntity': { '@type': 'ItemList', 'itemListElement': products.map((product, index) => ({ '@type': 'ListItem', 'position': index+1, 'item': product })) } }; this.addStructuredData('catalog', catalogSchema); } addProductSchema() { const productData=this.extractCurrentProductData(); if (!productData) return; const productSchema={ '@context': 'https: '@type': 'Product', 'name': productData.name, 'description': productData.description, 'image': productData.images, 'sku': productData.id, 'brand': { '@type': 'Brand', 'name': 'Geek & Dragon' }, 'manufacturer': { '@type': 'Organization', 'name': 'Geek & Dragon', 'address': { '@type': 'PostalAddress', 'addressCountry': 'CA', 'addressRegion': 'QC' } }, 'offers': { '@type': 'Offer', 'price': productData.price, 'priceCurrency': 'CAD', 'availability': productData.availability, 'seller': this.structuredData, 'priceValidUntil': new Date(Date.now()+365*24*60*60*1000).toISOString().split('T')[0] }, 'category': 'Tabletop Gaming Accessories', 'audience': { '@type': 'Audience', 'name': 'Tabletop RPG Players' }, 'additionalProperty': [ { '@type': 'PropertyValue', 'name': 'Made In', 'value': 'Quebec, Canada' }, { '@type': 'PropertyValue', 'name': 'Game System', 'value': 'Dungeons & Dragons' } ] }; if (productData.variations && productData.variations.length > 0) { productSchema.model=productData.variations.map(variation => ({ '@type': 'ProductModel', 'name': `${productData.name}-${variation.name}`, 'offers': { '@type': 'Offer', 'price': productData.price+(variation.priceModifier || 0), 'priceCurrency': 'CAD', 'availability': productData.availability } })); } this.addStructuredData('product', productSchema); } addFAQSchema() { const faqs=[ { question: this.currentLanguage==='fr' ? 'Qu\'est-ce que les multiplicateurs sur les pi√®ces ?' : 'What are the multipliers on the coins?', answer: this.currentLanguage==='fr' ? 'Les multiplicateurs (x10, x100, x1000, x10000) sont grav√©s sur les pi√®ces pour faciliter les calculs mon√©taires en jeu, tout en gardant l\'immersion physique.' : 'Multipliers (x10, x100, x1000, x10000) are engraved on coins to facilitate monetary calculations in-game while maintaining physical immersion.' }, { question: this.currentLanguage==='fr' ? 'Les produits sont-ils vraiment fabriqu√©s au Qu√©bec ?' : 'Are the products really made in Quebec?', answer: this.currentLanguage==='fr' ? 'Oui, tous nos produits sont con√ßus et fabriqu√©s au Qu√©bec avec des mat√©riaux de qualit√© premium.' : 'Yes, all our products are designed and manufactured in Quebec with premium quality materials.' }, { question: this.currentLanguage==='fr' ? 'Combien de temps prend la livraison ?' : 'How long does shipping take?', answer: this.currentLanguage==='fr' ? 'Nous exp√©dions sous 48h partout au Canada avec suivi en temps r√©el.' : 'We ship within 48h across Canada with real-time tracking.' } ]; const faqSchema={ '@context': 'https: '@type': 'FAQPage', 'mainEntity': faqs.map(faq => ({ '@type': 'Question', 'name': faq.question, 'acceptedAnswer': { '@type': 'Answer', 'text': faq.answer } })) }; this.addStructuredData('faq', faqSchema); } addBreadcrumbSchema() { if (this.breadcrumbPath.length===0) return; const breadcrumbSchema={ '@context': 'https: '@type': 'BreadcrumbList', 'itemListElement': this.breadcrumbPath.map((item, index) => ({ '@type': 'ListItem', 'position': index+1, 'name': item.name, 'item': item.url })) }; this.addStructuredData('breadcrumb', breadcrumbSchema); } enhanceMetadata() { this.optimizeMetaTags(); this.addMissingMetaTags(); this.optimizeOpenGraph(); this.optimizeTwitterCards(); } optimizeMetaTags() { const metaDescription=document.querySelector('meta[name="description"]'); if (metaDescription && !metaDescription.content) { metaDescription.content=this.generatePageDescription(); } let canonical=document.querySelector('link[rel="canonical"]'); if (!canonical) { canonical=document.createElement('link'); canonical.rel='canonical'; canonical.href=this.getCanonicalURL(); document.head.appendChild(canonical); } } addMissingMetaTags() { const metaTags=[ { name: 'robots', content: 'index, follow, max-snippet:-1, max-image-preview:large' }, { name: 'author', content: 'Geek & Dragon' }, { name: 'theme-color', content: '#8b5cf6' }, { name: 'msapplication-TileColor', content: '#8b5cf6' }, { 'http-equiv': 'X-UA-Compatible', content: 'IE=edge' } ]; metaTags.forEach(tag => { const selector=tag.name ? `meta[name="${tag.name}"]` : `meta[http-equiv="${tag['http-equiv']}"]`; if (!document.querySelector(selector)) { const meta=document.createElement('meta'); if (tag.name) meta.name=tag.name; if (tag['http-equiv']) meta.setAttribute('http-equiv', tag['http-equiv']); meta.content=tag.content; document.head.appendChild(meta); } }); } optimizeOpenGraph() { const ogTags={ 'og:site_name': 'Geek & Dragon', 'og:locale': this.currentLanguage==='fr' ? 'fr_CA' : 'en_CA', 'og:type': this.isProductPage() ? 'product' : 'website' }; if (this.isProductPage()) { const productData=this.extractCurrentProductData(); if (productData) { ogTags['product:brand']='Geek & Dragon'; ogTags['product:availability']='in stock'; ogTags['product:condition']='new'; ogTags['product:price:amount']=productData.price; ogTags['product:price:currency']='CAD'; } } Object.entries(ogTags).forEach(([property, content]) => { let meta=document.querySelector(`meta[property="${property}"]`); if (!meta) { meta=document.createElement('meta'); meta.setAttribute('property', property); meta.content=content; document.head.appendChild(meta); } else if (!meta.content) { meta.content=content; } }); } optimizeTwitterCards() { const twitterTags={ 'twitter:site': '@GeekAndDragon', 'twitter:creator': '@GeekAndDragon', 'twitter:domain': 'geekndragon.com' }; Object.entries(twitterTags).forEach(([name, content]) => { let meta=document.querySelector(`meta[name="${name}"]`); if (!meta) { meta=document.createElement('meta'); meta.name=name; meta.content=content; document.head.appendChild(meta); } }); } generateBreadcrumbs() { if (!this.config.enableBreadcrumbs) return; const path=window.location.pathname; this.breadcrumbPath=[ { name: this.currentLanguage==='fr' ? 'Accueil' : 'Home', url: '/' } ]; if (path.includes('boutique')) { this.breadcrumbPath.push({ name: this.currentLanguage==='fr' ? 'Boutique' : 'Shop', url: '/boutique.php' }); } if (this.isProductPage()) { const productData=this.extractCurrentProductData(); if (productData) { this.breadcrumbPath.push({ name: productData.name, url: window.location.pathname }); } } this.renderBreadcrumbs(); } renderBreadcrumbs() { if (this.breadcrumbPath.length <= 1) return; const breadcrumbContainer=document.createElement('nav'); breadcrumbContainer.setAttribute('aria-label', this.currentLanguage==='fr' ? 'Fil d\'Ariane' : 'Breadcrumb'); breadcrumbContainer.className='breadcrumb-navigation'; const breadcrumbList=document.createElement('ol'); breadcrumbList.className='breadcrumb-list'; this.breadcrumbPath.forEach((item, index) => { const listItem=document.createElement('li'); listItem.className='breadcrumb-item'; if (index===this.breadcrumbPath.length-1) { listItem.innerHTML=`<span aria-current="page">${item.name}</span>`; } else { listItem.innerHTML=`<a href="${item.url}">${item.name}</a>`; if (index < this.breadcrumbPath.length-1) { listItem.innerHTML += `<span class="breadcrumb-separator" aria-hidden="true">/</span>`; } } breadcrumbList.appendChild(listItem); }); breadcrumbContainer.appendChild(breadcrumbList); const main=document.querySelector('main'); if (main) { main.insertBefore(breadcrumbContainer, main.firstChild); } } addSkipLinks() { if (!this.config.enableSkipLinks) return; const skipLinks=[ { href: '#main', text: this.currentLanguage==='fr' ? 'Aller au contenu principal' : 'Skip to main content' }, { href: '#navigation', text: this.currentLanguage==='fr' ? 'Aller √† la navigation' : 'Skip to navigation' }, { href: '#footer', text: this.currentLanguage==='fr' ? 'Aller au pied de page' : 'Skip to footer' } ]; const skipContainer=document.createElement('div'); skipContainer.className='skip-links'; skipContainer.setAttribute('aria-label', this.currentLanguage==='fr' ? 'Liens de navigation rapide' : 'Skip navigation links'); skipLinks.forEach(link => { const skipLink=document.createElement('a'); skipLink.href=link.href; skipLink.className='skip-link'; skipLink.textContent=link.text; skipContainer.appendChild(skipLink); }); document.body.insertBefore(skipContainer, document.body.firstChild); } enhanceARIA() { if (!this.config.enableAriaEnhancements) return; this.enhanceLandmarks(); this.enhanceForms(); this.enhanceInteractiveElements(); this.enhanceNavigation(); this.setupDynamicARIA(); } enhanceLandmarks() { const landmarks={ 'header': this.currentLanguage==='fr' ? 'En-t√™te principal' : 'Main header', 'nav': this.currentLanguage==='fr' ? 'Navigation principale' : 'Main navigation', 'main': this.currentLanguage==='fr' ? 'Contenu principal' : 'Main content', 'footer': this.currentLanguage==='fr' ? 'Pied de page' : 'Footer', 'aside': this.currentLanguage==='fr' ? 'Contenu compl√©mentaire' : 'Complementary content' }; Object.entries(landmarks).forEach(([tag, label]) => { const elements=document.querySelectorAll(tag); elements.forEach((element, index) => { if (!element.getAttribute('aria-label') && !element.getAttribute('aria-labelledby')) { element.setAttribute('aria-label', elements.length > 1 ? `${label} ${index+1}` : label); } }); }); } enhanceForms() { const forms=document.querySelectorAll('form'); forms.forEach(form => { const inputs=form.querySelectorAll('input, select, textarea'); inputs.forEach(input => { if (!input.getAttribute('aria-label') && !input.getAttribute('aria-labelledby') && !form.querySelector(`label[for="${input.id}"]`)) { const placeholder=input.getAttribute('placeholder'); if (placeholder) { input.setAttribute('aria-label', placeholder); } } if (input.hasAttribute('required') && !input.getAttribute('aria-describedby')) { const errorId=`${input.id || 'input'}-error`; input.setAttribute('aria-describedby', errorId); if (!document.getElementById(errorId)) { const errorDiv=document.createElement('div'); errorDiv.id=errorId; errorDiv.className='sr-only error-message'; errorDiv.setAttribute('aria-live', 'polite'); input.parentNode.appendChild(errorDiv); } } }); }); } enhanceInteractiveElements() { const buttons=document.querySelectorAll('button, [role="button"]'); buttons.forEach(button => { if (!button.textContent.trim() && !button.getAttribute('aria-label') && !button.getAttribute('aria-labelledby')) { const icon=button.querySelector('svg, .icon'); if (icon) { const action=button.classList.contains('close') ? (this.currentLanguage==='fr' ? 'Fermer' : 'Close') : button.classList.contains('menu') ? (this.currentLanguage==='fr' ? 'Menu' : 'Menu') : (this.currentLanguage==='fr' ? 'Bouton' : 'Button'); button.setAttribute('aria-label', action); } } }); const links=document.querySelectorAll('a:empty, a:not([aria-label]):not([aria-labelledby])'); links.forEach(link => { if (!link.textContent.trim()) { const img=link.querySelector('img'); if (img && img.alt) { link.setAttribute('aria-label', img.alt); } } }); } enhanceNavigation() { const currentPath=window.location.pathname; const navLinks=document.querySelectorAll('nav a'); navLinks.forEach(link => { if (link.pathname===currentPath) { link.setAttribute('aria-current', 'page'); } }); const dropdownTriggers=document.querySelectorAll('[data-dropdown], .dropdown-trigger'); dropdownTriggers.forEach(trigger => { if (!trigger.getAttribute('aria-haspopup')) { trigger.setAttribute('aria-haspopup', 'menu'); } if (!trigger.getAttribute('aria-expanded')) { trigger.setAttribute('aria-expanded', 'false'); } }); } setupDynamicARIA() { const observer=new MutationObserver(mutations => { mutations.forEach(mutation => { if (mutation.type==='attributes') { this.updateARIAStates(mutation.target); } }); }); observer.observe(document.body, { attributes: true, subtree: true, attributeFilter: ['class', 'style', 'hidden'] }); } updateARIAStates(element) { if (element.classList.contains('open') || element.classList.contains('active')) { if (element.hasAttribute('aria-expanded')) { element.setAttribute('aria-expanded', 'true'); } } else if (element.hasAttribute('aria-expanded')) { element.setAttribute('aria-expanded', 'false'); } if (element.style.display==='none' || element.hidden) { element.setAttribute('aria-hidden', 'true'); } else if (element.hasAttribute('aria-hidden')) { element.removeAttribute('aria-hidden'); } } setupFocusManagement() { if (!this.config.enableFocusManagement) return; this.setupModalFocusTraps(); this.setupKeyboardNavigation(); this.setupFocusIndicators(); this.trackFocusHistory(); } setupModalFocusTraps() { document.addEventListener('keydown', (e) => { if (e.key==='Tab') { const modal=document.querySelector('.gd-product-customizer.active, .modal.active'); if (modal) { this.trapFocus(e, modal); } } }); } trapFocus(event, container) { const focusableElements=container.querySelectorAll( 'a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])' ); const firstElement=focusableElements[0]; const lastElement=focusableElements[focusableElements.length-1]; if (event.shiftKey) { if (document.activeElement===firstElement) { event.preventDefault(); lastElement.focus(); } } else { if (document.activeElement===lastElement) { event.preventDefault(); firstElement.focus(); } } } setupKeyboardNavigation() { document.addEventListener('keydown', (e) => { if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) { const productGrid=e.target.closest('.products-grid, .multiplier-grid'); if (productGrid) { this.handleGridNavigation(e, productGrid); } } if (e.altKey) { switch (e.key) { case 's': e.preventDefault(); window.location.href='/boutique.php'; break; case 'h': e.preventDefault(); window.location.href='/'; break; } } }); } handleGridNavigation(event, grid) { const items=Array.from(grid.querySelectorAll('a, button, [tabindex]:not([tabindex="-1"])')); const currentIndex=items.indexOf(document.activeElement); if (currentIndex===-1) return; const columns=this.getGridColumns(grid); let newIndex; switch (event.key) { case 'ArrowLeft': newIndex=currentIndex > 0 ? currentIndex-1 : items.length-1; break; case 'ArrowRight': newIndex=currentIndex < items.length-1 ? currentIndex+1 : 0; break; case 'ArrowUp': newIndex=currentIndex-columns; if (newIndex < 0) newIndex=currentIndex; break; case 'ArrowDown': newIndex=currentIndex+columns; if (newIndex >= items.length) newIndex=currentIndex; break; } if (newIndex!==undefined && items[newIndex]) { event.preventDefault(); items[newIndex].focus(); } } setupFocusIndicators() { const focusStyles=` <style> .enhanced-focus-indicators { --focus-color: #8b5cf6; --focus-width: 2px; --focus-offset: 2px; } .enhanced-focus-indicators *:focus { outline: var(--focus-width) solid var(--focus-color); outline-offset: var(--focus-offset); position: relative; z-index: 1; } .enhanced-focus-indicators button:focus, .enhanced-focus-indicators .btn:focus { outline: none; box-shadow: 0 0 0 var(--focus-width) var(--focus-color), 0 0 0 calc(var(--focus-width)+2px) rgba(139, 92, 246, 0.2); } .enhanced-focus-indicators .product-card:focus-within { transform: translateY(-4px); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3), 0 0 0 2px var(--focus-color); } .skip-link { position: absolute; top: -100px; left: 8px; background: var(--focus-color); color: white; padding: 8px 12px; text-decoration: none; border-radius: 4px; font-weight: 500; z-index: 9999; transition: top 0.2s ease; } .skip-link:focus { top: 8px; } .breadcrumb-navigation { padding: 1rem 0; font-size: 0.9rem; color: #64748b; } .breadcrumb-list { display: flex; list-style: none; margin: 0; padding: 0; flex-wrap: wrap; gap: 0.5rem; } .breadcrumb-item { display: flex; align-items: center; } .breadcrumb-item a { color: #8b5cf6; text-decoration: none; transition: color 0.2s ease; } .breadcrumb-item a:hover, .breadcrumb-item a:focus { color: #7c3aed; text-decoration: underline; } .breadcrumb-separator { margin: 0 0.25rem; color: #94a3b8; } .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; } .sr-only:focus { position: static; width: auto; height: auto; padding: 0.5rem 1rem; margin: 0; overflow: visible; clip: auto; white-space: normal; background: var(--focus-color); color: white; border-radius: 4px; z-index: 9999; } </style> `; document.head.insertAdjacentHTML('beforeend', focusStyles); document.body.classList.add('enhanced-focus-indicators'); } trackFocusHistory() { let lastFocusedElement=null; document.addEventListener('focusin', (e) => { if (lastFocusedElement && !e.target.closest('.modal, .gd-product-customizer')) { this.focusHistory.push(lastFocusedElement); if (this.focusHistory.length > 10) { this.focusHistory=this.focusHistory.slice(-10); } } lastFocusedElement=e.target; }); document.addEventListener('modal-closed', () => { const lastElement=this.focusHistory.pop(); if (lastElement && document.contains(lastElement)) { setTimeout(() => lastElement.focus(), 100); } }); } setupScreenReaderOptimizations() { if (!this.config.enableScreenReaderOptimizations) return; this.createLiveRegions(); this.enhanceImageDescriptions(); this.addContextualTexts(); this.optimizeDataStructures(); } createLiveRegions() { const politeRegion=document.createElement('div'); politeRegion.id='live-region-polite'; politeRegion.setAttribute('aria-live', 'polite'); politeRegion.setAttribute('aria-atomic', 'true'); politeRegion.className='sr-only'; document.body.appendChild(politeRegion); const assertiveRegion=document.createElement('div'); assertiveRegion.id='live-region-assertive'; assertiveRegion.setAttribute('aria-live', 'assertive'); assertiveRegion.setAttribute('aria-atomic', 'true'); assertiveRegion.className='sr-only'; document.body.appendChild(assertiveRegion); window.announceToScreenReader=(message, assertive=false) => { const region=assertive ? assertiveRegion : politeRegion; region.textContent=''; setTimeout(() => { region.textContent=message; }, 100); }; } enhanceImageDescriptions() { const images=document.querySelectorAll('img'); images.forEach(img => { if (!img.alt) { const filename=img.src.split('/').pop().split('.')[0]; const altText=filename.replace(/[-_]/g, ' ') .replace(/([a-z])([A-Z])/g, '$1 $2') .toLowerCase(); img.alt=altText; } if (img.closest('.product-card') && !img.getAttribute('aria-describedby')) { const description=img.closest('.product-card').querySelector('.product-description'); if (description && description.id) { img.setAttribute('aria-describedby', description.id); } } }); } addContextualTexts() { const addToCartButtons=document.querySelectorAll('.gd-add-to-cart, .add-to-cart-btn'); addToCartButtons.forEach(button => { const productCard=button.closest('.product-card'); if (productCard) { const productName=productCard.querySelector('.product-title, .product-name')?.textContent?.trim(); if (productName && !button.getAttribute('aria-label')) { button.setAttribute('aria-label', `${this.currentLanguage==='fr' ? 'Ajouter' : 'Add'} ${productName} ${this.currentLanguage==='fr' ? 'au panier' : 'to cart'}` ); } } }); const quantityButtons=document.querySelectorAll('.quantity-btn'); quantityButtons.forEach(button => { const action=button.classList.contains('plus') ? (this.currentLanguage==='fr' ? 'Augmenter' : 'Increase') : (this.currentLanguage==='fr' ? 'Diminuer' : 'Decrease'); if (!button.getAttribute('aria-label')) { button.setAttribute('aria-label', `${action} ${this.currentLanguage==='fr' ? 'la quantit√©' : 'quantity'}` ); } }); } optimizeDataStructures() { const productGrids=document.querySelectorAll('.products-grid'); productGrids.forEach(grid => { if (!grid.getAttribute('role')) { grid.setAttribute('role', 'grid'); grid.setAttribute('aria-label', this.currentLanguage==='fr' ? 'Grille de produits' : 'Products grid' ); } const products=grid.querySelectorAll('.product-card'); products.forEach((product, index) => { product.setAttribute('role', 'gridcell'); product.setAttribute('aria-posinset', String(index+1)); product.setAttribute('aria-setsize', String(products.length)); }); }); const tables=document.querySelectorAll('table'); tables.forEach(table => { if (!table.querySelector('caption') && !table.getAttribute('aria-label')) { const heading=table.previousElementSibling; if (heading && heading.matches('h1, h2, h3, h4, h5, h6')) { table.setAttribute('aria-labelledby', heading.id || this.generateId('table-heading')); if (!heading.id) { heading.id=table.getAttribute('aria-labelledby'); } } } }); } enhanceImages() { if (!this.config.autoGenerateAltText) return; const images=document.querySelectorAll('img:not([alt]), img[alt=""]'); images.forEach(async (img) => { const altText=this.generateIntelligentAltText(img); if (altText) { img.alt=altText; } }); } generateIntelligentAltText(img) { const src=img.src; const context=img.closest('.product-card, .hero-section, .feature-card'); let altText=''; if (src.includes('coin') || src.includes('piece')) { altText=this.currentLanguage==='fr' ? 'Pi√®ce m√©tallique pour jeu de r√¥le' : 'Metal coin for tabletop RPG'; } else if (src.includes('card') || src.includes('carte')) { altText=this.currentLanguage==='fr' ? 'Carte d\'√©quipement illustr√©e' : 'Illustrated equipment card'; } else if (src.includes('triptyque') || src.includes('triptych')) { altText=this.currentLanguage==='fr' ? 'Fiche de personnage triptyque' : 'Triptych character sheet'; } else if (context?.querySelector('.product-title')) { const productName=context.querySelector('.product-title').textContent.trim(); altText=this.currentLanguage==='fr' ? `Image du produit ${productName}` : `Product image of ${productName}`; } if (src.includes('x10')) altText += ' (multiplicateur x10)'; if (src.includes('x100')) altText += ' (multiplicateur x100)'; if (src.includes('copper')) altText += this.currentLanguage==='fr' ? ' en cuivre' : ' copper'; if (src.includes('gold')) altText += this.currentLanguage==='fr' ? ' en or' : ' gold'; if (src.includes('silver')) altText += this.currentLanguage==='fr' ? ' en argent' : ' silver'; return altText; } setupSocialSharing() { if (!this.config.enableSocialSharing) return; this.addSocialShareButtons(); this.optimizeSocialMetaTags(); } addSocialShareButtons() { const shareContainer=document.createElement('div'); shareContainer.className='social-share-container'; shareContainer.innerHTML=` <h3>${this.currentLanguage==='fr' ? 'Partager cette page' : 'Share this page'}</h3> <div class="social-share-buttons"> <button class="share-btn facebook" data-platform="facebook" aria-label="${this.currentLanguage==='fr' ? 'Partager sur Facebook' : 'Share on Facebook'}"> <svg viewBox="0 0 24 24" fill="currentColor"> <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/> </svg> </button> <button class="share-btn twitter" data-platform="twitter" aria-label="${this.currentLanguage==='fr' ? 'Partager sur Twitter' : 'Share on Twitter'}"> <svg viewBox="0 0 24 24" fill="currentColor"> <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/> </svg> </button> <button class="share-btn linkedin" data-platform="linkedin" aria-label="${this.currentLanguage==='fr' ? 'Partager sur LinkedIn' : 'Share on LinkedIn'}"> <svg viewBox="0 0 24 24" fill="currentColor"> <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/> </svg> </button> <button class="share-btn native" data-platform="native" aria-label="${this.currentLanguage==='fr' ? 'Partager via...' : 'Share via...'}"> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"> <circle cx="18" cy="5" r="3"/> <circle cx="6" cy="12" r="3"/> <circle cx="18" cy="19" r="3"/> <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/> <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/> </svg> </button> </div> `; const shareStyles=` <style> .social-share-container { margin: 2rem 0; padding: 1.5rem; background: rgba(139, 92, 246, 0.05); border-radius: 12px; border: 1px solid rgba(139, 92, 246, 0.2); } .social-share-container h3 { margin: 0 0 1rem 0; font-size: 1.1rem; color: #f1f5f9; } .social-share-buttons { display: flex; gap: 0.5rem; flex-wrap: wrap; } .share-btn { background: none; border: 2px solid rgba(139, 92, 246, 0.3); border-radius: 50%; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s ease; color: #94a3b8; } .share-btn svg { width: 20px; height: 20px; } .share-btn:hover { border-color: #8b5cf6; background: rgba(139, 92, 246, 0.1); color: #8b5cf6; transform: translateY(-1px); } .share-btn.facebook:hover { color: #1877f2; border-color: #1877f2; background: rgba(24, 119, 242, 0.1); } .share-btn.twitter:hover { color: #1da1f2; border-color: #1da1f2; background: rgba(29, 161, 242, 0.1); } .share-btn.linkedin:hover { color: #0077b5; border-color: #0077b5; background: rgba(0, 119, 181, 0.1); } @media (max-width: 768px) { .social-share-buttons { justify-content: center; } } </style> `; document.head.insertAdjacentHTML('beforeend', shareStyles); shareContainer.addEventListener('click', (e) => { const button=e.target.closest('.share-btn'); if (button) { this.handleSocialShare(button.dataset.platform); } }); const main=document.querySelector('main'); if (main) { main.appendChild(shareContainer); } } handleSocialShare(platform) { const url=encodeURIComponent(window.location.href); const title=encodeURIComponent(document.title); const description=encodeURIComponent( document.querySelector('meta[name="description"]')?.content || '' ); let shareUrl; switch (platform) { case 'facebook': shareUrl=`https: break; case 'twitter': shareUrl=`https: break; case 'linkedin': shareUrl=`https: break; case 'native': if (navigator.share) { navigator.share({ title: document.title, text: description, url: window.location.href }); return; } else { navigator.clipboard.writeText(window.location.href).then(() => { window.announceToScreenReader?.( this.currentLanguage==='fr' ? 'Lien copi√© dans le presse-papiers' : 'Link copied to clipboard' ); }); return; } } if (shareUrl) { window.open(shareUrl, 'share', 'width=600,height=400,scrollbars=yes,resizable=yes'); } } optimizeSocialMetaTags() { const ogImage=document.querySelector('meta[property="og:image"]'); if (ogImage && !ogImage.content.startsWith('https: ogImage.content=`https: } if (ogImage && !document.querySelector('meta[property="og:image:width"]')) { const imageMeta=[ { property: 'og:image:width', content: '1200' }, { property: 'og:image:height', content: '630' }, { property: 'og:image:type', content: 'image/webp' } ]; imageMeta.forEach(meta => { const element=document.createElement('meta'); element.setAttribute('property', meta.property); element.content=meta.content; document.head.appendChild(element); }); } } startSEOMonitoring() { this.seoMetrics={ pageLoadTime: 0, firstContentfulPaint: 0, largestContentfulPaint: 0, cumulativeLayoutShift: 0, interactionToNextPaint: 0, socialShares: 0, accessibilityScore: 0 }; this.trackSEOMetrics(); if (window.location.hostname==='localhost') { setTimeout(() => { this.generateSEOReport(); }, 5000); } } trackSEOMetrics() { if (window.performance) { window.addEventListener('load', () => { const navigation=performance.getEntriesByType('navigation')[0]; this.seoMetrics.pageLoadTime=navigation.loadEventEnd-navigation.loadEventStart; }); } if (window.GeeknDragonPerformanceMonitor) { const performanceMonitor=window.GeeknDragonPerformanceMonitor; setInterval(() => { const metrics=performanceMonitor.getMetrics(); if (metrics.webVitals) { this.seoMetrics.firstContentfulPaint=metrics.webVitals.FCP?.value || 0; this.seoMetrics.largestContentfulPaint=metrics.webVitals.LCP?.value || 0; this.seoMetrics.cumulativeLayoutShift=metrics.webVitals.CLS?.value || 0; } }, 10000); } this.seoMetrics.accessibilityScore=this.calculateBasicAccessibilityScore(); } calculateBasicAccessibilityScore() { let score=100; const checks=[ { test: () => document.querySelectorAll('img:not([alt])').length===0, weight: 15 }, { test: () => document.querySelectorAll('a:empty').length===0, weight: 10 }, { test: () => document.querySelectorAll('button:empty').length===0, weight: 10 }, { test: () => document.querySelector('h1')!==null, weight: 10 }, { test: () => document.querySelector('[lang]')!==null, weight: 5 }, { test: () => document.querySelector('main')!==null, weight: 10 }, { test: () => document.querySelectorAll('input:not([aria-label]):not([aria-labelledby])').length===0, weight: 15 }, { test: () => document.querySelector('.skip-link')!==null, weight: 10 }, { test: () => document.querySelectorAll('[aria-live]').length > 0, weight: 5 }, { test: () => document.querySelector('nav[aria-label]')!==null, weight: 10 } ]; checks.forEach(check => { if (!check.test()) { score -= check.weight; } }); return Math.max(0, score); } generateSEOReport() { const report={ url: window.location.href, title: document.title, description: document.querySelector('meta[name="description"]')?.content || '', h1Count: document.querySelectorAll('h1').length, h2Count: document.querySelectorAll('h2').length, imageCount: document.querySelectorAll('img').length, imagesWithoutAlt: document.querySelectorAll('img:not([alt])').length, linksCount: document.querySelectorAll('a').length, emptyLinks: document.querySelectorAll('a:empty').length, structuredData: document.querySelectorAll('script[type="application/ld+json"]').length, canonicalUrl: document.querySelector('link[rel="canonical"]')?.href || '', openGraphTags: document.querySelectorAll('meta[property^="og:"]').length, twitterCardTags: document.querySelectorAll('meta[name^="twitter:"]').length, accessibilityScore: this.seoMetrics.accessibilityScore, metrics: this.seoMetrics, recommendations: this.generateSEORecommendations() }; console.group('üìä SEO Report'); console.table(report); console.groupEnd(); return report; } generateSEORecommendations() { const recommendations=[]; if (this.seoMetrics.accessibilityScore < 80) { recommendations.push('Am√©liorer le score d\'accessibilit√©'); } if (document.querySelectorAll('img:not([alt])').length > 0) { recommendations.push('Ajouter des attributs alt aux images'); } if (document.querySelectorAll('h1').length!==1) { recommendations.push('Utiliser exactement un H1 par page'); } if (!document.querySelector('meta[name="description"]')?.content) { recommendations.push('Ajouter une meta description'); } if (this.seoMetrics.largestContentfulPaint > 2500) { recommendations.push('Optimiser le temps de chargement (LCP > 2.5s)'); } return recommendations; } extractProductsFromPage() { const products=[]; document.querySelectorAll('.product-card').forEach(card => { const product=this.extractProductFromCard(card); if (product) products.push(product); }); return products; } extractProductFromCard(card) { const name=card.querySelector('.product-title, .product-name')?.textContent?.trim(); const price=card.querySelector('.product-price')?.textContent?.replace(/[^\d.]/g, ''); const image=card.querySelector('img')?.src; const description=card.querySelector('.product-description')?.textContent?.trim(); if (!name || !price) return null; return { '@type': 'Product', 'name': name, 'price': parseFloat(price), 'image': image, 'description': description || '', 'priceCurrency': 'CAD' }; } extractCurrentProductData() { const productCard=document.querySelector('.product-card'); if (productCard) { return this.extractProductFromCard(productCard); } return { name: document.title, price: 0, description: document.querySelector('meta[name="description"]')?.content || '', images: [document.querySelector('meta[property="og:image"]')?.content || ''], id: window.location.pathname.split('/').pop().replace('.php', ''), availability: 'https: variations: [] }; } generatePageDescription() { const path=window.location.pathname; if (path==='/' || path==='/index.php') { return this.currentLanguage==='fr' ? 'Transformez vos parties D&D avec nos aides de jeu physiques : pi√®ces m√©talliques, cartes d\'√©quipement et triptyques. Fabriqu√© au Qu√©bec.' : 'Transform your D&D games with our physical game aids: metal coins, equipment cards and triptychs. Made in Quebec.'; } if (path.includes('boutique')) { return this.currentLanguage==='fr' ? 'D√©couvrez notre boutique d\'aides de jeu D&D : pi√®ces m√©talliques avec multiplicateurs, cartes d\'√©quipement illustr√©es et triptyques de personnage.' : 'Discover our D&D game aids shop: metal coins with multipliers, illustrated equipment cards and character triptychs.'; } return document.querySelector('meta[name="description"]')?.content || ''; } getCanonicalURL() { const base='https: const path=window.location.pathname; return base+path; } isProductPage() { const path=window.location.pathname; return path.includes('product') || path.includes('lot') || path.includes('pack') || path.includes('triptyque'); } getGridColumns(grid) { const style=window.getComputedStyle(grid); const columns=style.gridTemplateColumns; return columns ? columns.split(' ').length : 1; } generateId(prefix='generated') { return `${prefix}-${Math.random().toString(36).substr(2, 9)}`; } getSEOMetrics() { return this.seoMetrics; } generateReport() { return this.generateSEOReport(); } updateLanguage(lang) { this.currentLanguage=lang; document.documentElement.lang=lang; } } document.addEventListener('DOMContentLoaded', () => { window.GeeknDragonSEO=new AdvancedSEOAccessibility(); if (window.location.hostname==='localhost') { window._debugSEO=window.GeeknDragonSEO; '); } }); })();
/* Source: analytics-ecommerce.js */
(function() { 'use strict'; const GA_MEASUREMENT_ID='G-XXXXXXXXX'; const DEBUG_MODE=window.location.hostname==='localhost'; const EcommerceEvents={ VIEW_ITEM: 'view_item', ADD_TO_CART: 'add_to_cart', REMOVE_FROM_CART: 'remove_from_cart', VIEW_CART: 'view_cart', BEGIN_CHECKOUT: 'begin_checkout', PURCHASE: 'purchase', PRODUCT_HOVER: 'product_hover', QUANTITY_CHANGE: 'quantity_change', MULTIPLIER_SELECT: 'multiplier_select', LANGUAGE_SWITCH: 'language_switch', VIDEO_PLAY: 'video_play', TRUST_SIGNAL_CLICK: 'trust_signal_click' }; const ProductMapper={ mapProduct(productData) { return { item_id: productData.id || 'unknown', item_name: productData.name || 'Unknown Product', category: this.getCategory(productData.id), price: parseFloat(productData.price) || 0, currency: 'CAD', item_brand: 'Geek&Dragon', item_category2: this.getSubCategory(productData.id), item_variant: productData.variant || 'default', quantity: parseInt(productData.quantity) || 1 }; }, getCategory(productId) { if (productId.startsWith('lot')) return 'Pi√®ces M√©talliques'; if (productId.startsWith('pack')) return 'Cartes √âquipement'; if (productId.startsWith('triptyque')) return 'Triptyques'; return 'Autres'; }, getSubCategory(productId) { const mapping={ 'lot10': 'Starter Pack', 'lot25': 'Collection Compl√®te', 'lot50-essence': 'Premium Double', 'lot50-tresorerie': 'Premium Uniforme', 'pack-182-arsenal-aventurier': '√âquipement Base', 'pack-182-butins-ingenieries': 'Contenu Avanc√©', 'pack-182-routes-services': 'Voyage & Services', 'triptyque-aleatoire': 'H√©ros Myst√®re' }; return mapping[productId] || 'Standard'; } }; class AnalyticsManager { constructor() { this.isInitialized=false; this.eventQueue=[]; this.userProperties={}; this.sessionData={ session_start: Date.now(), page_views: 0, interactions: 0 }; this.init(); } async init() { await this.loadGoogleAnalytics(); gtag('config', GA_MEASUREMENT_ID, { debug_mode: DEBUG_MODE, send_page_view: false, enhanced_ecommerce: true, custom_map: { custom_parameter_1: 'product_category_jdr', custom_parameter_2: 'user_language_pref', custom_parameter_3: 'quebec_customer' } }); this.setUserProperties(); this.processEventQueue(); this.attachEventListeners(); this.isInitialized=true; if (DEBUG_MODE) { } } async loadGoogleAnalytics() { return new Promise((resolve) => { if (window.gtag) { resolve(); return; } const script=document.createElement('script'); script.async=true; script.src=`https: script.onload=() => { window.dataLayer=window.dataLayer || []; window.gtag=function(){dataLayer.push(arguments);}; gtag('js', new Date()); resolve(); }; document.head.appendChild(script); }); } setUserProperties() { const language=document.documentElement.lang || 'fr'; const isQuebecCustomer=this.detectQuebecUser(); this.userProperties={ language_preference: language, quebec_customer: isQuebecCustomer, device_type: this.getDeviceType(), user_engagement: 'new_visitor' }; gtag('set', 'user_properties', this.userProperties); } detectQuebecUser() { const timezone=Intl.DateTimeFormat().resolvedOptions().timeZone; const language=navigator.language; return timezone.includes('Montreal') || timezone.includes('Toronto') || language.startsWith('fr-CA'); } getDeviceType() { const width=window.innerWidth; if (width < 768) return 'mobile'; if (width < 1024) return 'tablet'; return 'desktop'; } trackPageView(pageName, pageTitle) { this.sessionData.page_views++; const eventData={ page_title: pageTitle || document.title, page_location: window.location.href, page_name: pageName, session_page_views: this.sessionData.page_views, language: document.documentElement.lang }; this.trackEvent('page_view', eventData); } trackProductView(productData) { const item=ProductMapper.mapProduct(productData); this.trackEvent(EcommerceEvents.VIEW_ITEM, { currency: 'CAD', value: item.price, items: [item] }); } trackAddToCart(productData) { const item=ProductMapper.mapProduct(productData); this.trackEvent(EcommerceEvents.ADD_TO_CART, { currency: 'CAD', value: item.price*item.quantity, items: [item] }); this.trackEvent('treasure_acquired', { product_id: item.item_id, product_category: item.category, value: item.price }); } trackRemoveFromCart(productData) { const item=ProductMapper.mapProduct(productData); this.trackEvent(EcommerceEvents.REMOVE_FROM_CART, { currency: 'CAD', value: item.price*item.quantity, items: [item] }); } trackPurchase(orderData) { const items=orderData.items.map(item => ProductMapper.mapProduct(item)); this.trackEvent(EcommerceEvents.PURCHASE, { transaction_id: orderData.transaction_id, value: orderData.total, currency: 'CAD', shipping: orderData.shipping || 0, tax: orderData.tax || 0, items: items }); this.trackEvent('quebec_artisan_purchase', { order_value: orderData.total, product_count: items.length, shipping_province: orderData.shipping_province || 'unknown' }); } trackProductHover(productId) { this.trackEvent(EcommerceEvents.PRODUCT_HOVER, { product_id: productId, hover_timestamp: Date.now() }); } trackQuantityChange(productId, oldQty, newQty) { this.trackEvent(EcommerceEvents.QUANTITY_CHANGE, { product_id: productId, old_quantity: oldQty, new_quantity: newQty, change_type: newQty > oldQty ? 'increase' : 'decrease' }); } trackMultiplierSelect(productId, multiplier) { this.trackEvent(EcommerceEvents.MULTIPLIER_SELECT, { product_id: productId, multiplier_selected: multiplier, multiplier_type: multiplier==='x1' ? 'standard' : 'engraved' }); } trackVideoInteraction(videoId, action, progress=0) { this.trackEvent(EcommerceEvents.VIDEO_PLAY, { video_id: videoId, video_action: action, video_progress: progress, video_type: 'product_demo' }); } trackTrustSignalClick(signalType) { this.trackEvent(EcommerceEvents.TRUST_SIGNAL_CLICK, { trust_signal_type: signalType, click_timestamp: Date.now() }); } trackLanguageSwitch(fromLang, toLang) { this.trackEvent(EcommerceEvents.LANGUAGE_SWITCH, { from_language: fromLang, to_language: toLang, switch_method: 'manual' }); } trackEvent(eventName, eventParams={}) { if (!this.isInitialized) { this.eventQueue.push({eventName, eventParams}); return; } this.sessionData.interactions++; const enhancedParams={ ...eventParams, session_interactions: this.sessionData.interactions, time_on_site: Date.now()-this.sessionData.session_start, device_type: this.userProperties.device_type }; gtag('event', eventName, enhancedParams); if (DEBUG_MODE) { } } processEventQueue() { while (this.eventQueue.length > 0) { const {eventName, eventParams}=this.eventQueue.shift(); this.trackEvent(eventName, eventParams); } } attachEventListeners() { document.addEventListener('mouseenter', (e) => { const productCard=e.target.closest('.product-card'); if (productCard) { const productId=this.extractProductId(productCard); if (productId) { this.trackProductHover(productId); } } }, true); document.addEventListener('click', (e) => { const trustElement=e.target.closest('[data-quebec], .trust-badge'); if (trustElement) { const signalType=trustElement.dataset.trustType || 'quebec_made'; this.trackTrustSignalClick(signalType); } }); document.addEventListener('play', (e) => { if (e.target.tagName==='VIDEO') { const videoId=e.target.id || 'unnamed_video'; this.trackVideoInteraction(videoId, 'play'); } }, true); this.trackScrollDepth(); } trackScrollDepth() { let maxScroll=0; const milestones=[25, 50, 75, 90]; const triggered=new Set(); window.addEventListener('scroll', () => { const scrollPercent=Math.round( (window.scrollY/(document.body.scrollHeight-window.innerHeight))*100 ); maxScroll=Math.max(maxScroll, scrollPercent); milestones.forEach(milestone => { if (scrollPercent >= milestone && !triggered.has(milestone)) { triggered.add(milestone); this.trackEvent('scroll_depth', { scroll_percentage: milestone, page_url: window.location.pathname }); } }); }); } extractProductId(element) { return element.dataset.productId || element.querySelector('[data-product-id]')?.dataset.productId || element.id?.replace('product-', ''); } getStats() { return { session_duration: Date.now()-this.sessionData.session_start, page_views: this.sessionData.page_views, interactions: this.sessionData.interactions, user_properties: this.userProperties }; } } window.GeeknDragonAnalytics=new AnalyticsManager(); document.addEventListener('DOMContentLoaded', () => { const pageName=document.body.dataset.page || 'unknown'; window.GeeknDragonAnalytics.trackPageView(pageName); }); if (DEBUG_MODE) { window._debugAnalytics=window.GeeknDragonAnalytics; } })();
/* Source: boutique-premium.js */
(() => { const ANIMATION_CONFIG={ observerOptions: { threshold: [0.1, 0.25, 0.5, 0.75], rootMargin: '0px 0px -50px 0px', }, delays: { card: 100, feature: 150, stagger: 50, }, }; class ScrollAnimations { constructor() { this.observer=null; this.animatedElements=new Set(); this.init(); } init() { this.setupIntersectionObserver(); this.observeElements(); this.setupParallaxEffects(); } setupIntersectionObserver() { this.observer=new IntersectionObserver( this.handleIntersection.bind(this), ANIMATION_CONFIG.observerOptions, ); } handleIntersection(entries) { entries.forEach((entry) => { if (entry.isIntersecting && !this.animatedElements.has(entry.target)) { this.animateElement(entry.target); this.animatedElements.add(entry.target); } }); } animateElement(element) { const animationType=element.dataset.animation || 'fadeInUp'; const delay=parseInt(element.dataset.delay || '0', 10); setTimeout(() => { element.classList.add(`animate-${animationType}`); element.style.opacity='1'; element.style.transform='translateY(0)'; }, delay); if (element.classList.contains('product-card')) { this.addSparkleEffect(element); } } addSparkleEffect(element) { const sparkles=document.createElement('div'); sparkles.className='sparkle-container'; sparkles.innerHTML=` <div class="sparkle" style="--delay: 0s; --duration: 2s;"></div> <div class="sparkle" style="--delay: 0.5s; --duration: 2.5s;"></div> <div class="sparkle" style="--delay: 1s; --duration: 2s;"></div> `; element.style.position='relative'; element.appendChild(sparkles); setTimeout(() => sparkles.remove(), 3000); } observeElements() { document.querySelectorAll('.product-card').forEach((card, index) => { card.dataset.animation='fadeInUp'; card.dataset.delay=(index*ANIMATION_CONFIG.delays.stagger).toString(); card.style.opacity='0'; card.style.transform='translateY(30px)'; this.observer.observe(card); }); document.querySelectorAll('.feature-card').forEach((card, index) => { card.dataset.animation='scaleIn'; card.dataset.delay=(index*ANIMATION_CONFIG.delays.feature).toString(); card.style.opacity='0'; card.style.transform='scale(0.9)'; this.observer.observe(card); }); document.querySelectorAll('.shop-section-title').forEach((title) => { title.dataset.animation='slideInFromLeft'; title.style.opacity='0'; title.style.transform='translateX(-50px)'; this.observer.observe(title); }); } setupParallaxEffects() { window.addEventListener('scroll', this.handleScroll.bind(this), { passive: true }); } handleScroll() { const { scrollY }=window; const speed=0.5; const heroContent=document.querySelector('.hero-content'); if (heroContent) { heroContent.style.transform=`translateY(${scrollY*speed}px)`; } document.querySelectorAll('.feature-icon').forEach((icon, index) => { const offset=Math.sin(scrollY*0.01+index)*3; icon.style.transform=`translateY(${offset}px)`; }); } } class ParticleEffects { constructor() { this.particles=[]; this.canvas=null; this.ctx=null; this.init(); } init() { this.createCanvas(); this.bindEvents(); this.animate(); } createCanvas() { this.canvas=document.createElement('canvas'); this.canvas.style.cssText=` position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; opacity: 0.6; `; this.ctx=this.canvas.getContext('2d'); this.updateCanvasSize(); const heroSection=document.querySelector('.hero-boutique'); if (heroSection) { heroSection.appendChild(this.canvas); } } updateCanvasSize() { const dpr=window.devicePixelRatio || 1; this.canvas.width=window.innerWidth*dpr; this.canvas.height=window.innerHeight*dpr; this.ctx.scale(dpr, dpr); this.canvas.style.width=`${window.innerWidth}px`; this.canvas.style.height=`${window.innerHeight}px`; } bindEvents() { window.addEventListener('resize', () => this.updateCanvasSize()); document.addEventListener('mouseenter', (e) => { if (e.target.closest('.product-card')) { this.createBurstEffect(e.pageX, e.pageY); } }, true); } createBurstEffect(x, y) { for (let i=0; i < 6; i += 1) { this.particles.push({ x, y, vx: (Math.random()-0.5)*4, vy: (Math.random()-0.5)*4, life: 1, decay: 0.02, size: Math.random()*3+1, color: `hsl(${Math.random()*60+270}, 70%, 60%)`, }); } } animate() { this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height); this.particles=this.particles.filter((particle) => { particle.x += particle.vx; particle.y += particle.vy; particle.life -= particle.decay; particle.vy += 0.1; if (particle.life > 0) { this.ctx.save(); this.ctx.globalAlpha=particle.life; this.ctx.fillStyle=particle.color; this.ctx.beginPath(); this.ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI*2); this.ctx.fill(); this.ctx.restore(); return true; } return false; }); requestAnimationFrame(() => this.animate()); } } class InteractiveEnhancements { constructor() { this.init(); } init() { this.enhanceButtons(); this.addHoverEffects(); this.setupQuantityControls(); this.addSoundEffects(); this.setupLoadingStates(); } enhanceButtons() { document.addEventListener('click', (e) => { const button=e.target.closest('.hero-cta, .add-to-cart-btn'); if (!button) return; const ripple=document.createElement('div'); ripple.className='ripple-effect'; const rect=button.getBoundingClientRect(); const size=Math.max(rect.width, rect.height); const x=e.clientX-rect.left-size/2; const y=e.clientY-rect.top-size/2; ripple.style.cssText=` position: absolute; width: ${size}px; height: ${size}px; left: ${x}px; top: ${y}px; background: rgba(255, 255, 255, 0.3); border-radius: 50%; transform: scale(0); animation: ripple 0.6s ease-out; pointer-events: none; `; button.style.position='relative'; button.style.overflow='hidden'; button.appendChild(ripple); setTimeout(() => ripple.remove(), 600); }); this.addRippleStyles(); } addRippleStyles() { if (document.getElementById('ripple-styles')) return; const style=document.createElement('style'); style.id='ripple-styles'; style.textContent=` @keyframes ripple { to { transform: scale(2); opacity: 0; } } @keyframes sparkle { 0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); } 50% { opacity: 1; transform: scale(1) rotate(180deg); } } .sparkle-container { position: absolute; top: 10px; right: 10px; width: 20px; height: 20px; pointer-events: none; } .sparkle { position: absolute; width: 4px; height: 4px; background: #8b5cf6; border-radius: 50%; animation: sparkle var(--duration, 2s) ease-in-out infinite; animation-delay: var(--delay, 0s); } `; document.head.appendChild(style); } addHoverEffects() { document.querySelectorAll('.product-card').forEach((card) => { card.addEventListener('mouseenter', () => { card.style.filter='drop-shadow(0 0 20px rgba(139, 92, 246, 0.4))'; }); card.addEventListener('mouseleave', () => { card.style.filter=''; }); }); document.querySelectorAll('.product-media').forEach((media) => { media.addEventListener('mousemove', (e) => { const rect=media.getBoundingClientRect(); const x=(e.clientX-rect.left)/rect.width; const y=(e.clientY-rect.top)/rect.height; const rotateX=(y-0.5)*10; const rotateY=(0.5-x)*10; media.style.transform=`perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`; }); media.addEventListener('mouseleave', () => { media.style.transform=''; }); }); } setupQuantityControls() { document.addEventListener('click', (e) => { if (e.target.classList.contains('quantity-btn')) { e.target.style.transform='scale(0.9)'; setTimeout(() => { e.target.style.transform=''; }, 100); if (e.target.classList.contains('plus')) { this.createConfettiEffect(e.target); } } }); } createConfettiEffect(element) { const colors=['#8b5cf6', '#10b981', '#f59e0b', '#ef4444']; const rect=element.getBoundingClientRect(); for (let i=0; i < 5; i += 1) { const confetti=document.createElement('div'); confetti.style.cssText=` position: fixed; width: 4px; height: 4px; background: ${colors[Math.floor(Math.random()*colors.length)]}; left: ${rect.left+rect.width/2}px; top: ${rect.top+rect.height/2}px; border-radius: 50%; pointer-events: none; z-index: 1000; animation: confetti 1s ease-out forwards; `; confetti.style.setProperty('--x', `${(Math.random()-0.5)*100}px`); confetti.style.setProperty('--y', `${(Math.random()-0.5)*100}px`); document.body.appendChild(confetti); setTimeout(() => confetti.remove(), 1000); } } addSoundEffects() { const audioCtx=window.AudioContext ? new AudioContext() : null; const playSound=(frequency, duration=100) => { if (!audioCtx) return; const oscillator=audioCtx.createOscillator(); const gainNode=audioCtx.createGain(); oscillator.connect(gainNode); gainNode.connect(audioCtx.destination); oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime); gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime+duration/1000); oscillator.start(); oscillator.stop(audioCtx.currentTime+duration/1000); }; document.addEventListener('click', (e) => { if (e.target.closest('.quantity-btn.plus')) { playSound(800, 150); } else if (e.target.closest('.quantity-btn.minus')) { playSound(400, 150); } else if (e.target.closest('.add-to-cart-btn')) { playSound(600, 200); } }); } setupLoadingStates() { document.addEventListener('click', (e) => { const button=e.target.closest('.add-to-cart-btn'); if (!button || button.disabled) return; button.classList.add('loading'); button.disabled=true; setTimeout(() => { button.classList.remove('loading'); button.disabled=false; button.style.background='linear-gradient(135deg, #10b981, #059669)'; button.innerHTML=` <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"> <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/> </svg> <span>Ajout√© !</span> `; setTimeout(() => { button.style.background=''; button.innerHTML=` <svg class="cart-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"> <path d="M3 3h2l.4 2m0 0L8 17h8l3-8H5.4z"/> <circle cx="9" cy="20" r="1"/> <circle cx="20" cy="20" r="1"/> </svg> <span>Ajouter au panier</span> `; }, 2000); }, 1000); }); } } class PerformanceOptimizer { constructor() { this.init(); } init() { this.lazyLoadImages(); this.prefetchResources(); this.optimizeAnimations(); } lazyLoadImages() { if ('IntersectionObserver' in window) { const imageObserver=new IntersectionObserver((entries) => { entries.forEach((entry) => { if (entry.isIntersecting) { const img=entry.target; if (img.dataset.src) { img.src=img.dataset.src; img.removeAttribute('data-src'); imageObserver.unobserve(img); } } }); }); document.querySelectorAll('img[data-src]').forEach((img) => { imageObserver.observe(img); }); } } prefetchResources() { const productImages=document.querySelectorAll('.product-media'); productImages.forEach((img, index) => { if (index < 3) { const link=document.createElement('link'); link.rel='prefetch'; link.href=img.src; document.head.appendChild(link); } }); } optimizeAnimations() { if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) { document.documentElement.style.setProperty('--boutique-transition', 'none'); document.documentElement.style.setProperty('--boutique-transition-fast', 'none'); } } } function initializeBoutiquePremium() { if (!document.querySelector('.hero-boutique')) return; new ScrollAnimations(); new ParticleEffects(); new InteractiveEnhancements(); new PerformanceOptimizer(); const animationStyles=document.createElement('style'); animationStyles.textContent=` @keyframes confetti { to { transform: translate(var(--x), var(--y)) rotate(360deg); opacity: 0; } } @keyframes slideInFromLeft { from { opacity: 0; transform: translateX(-50px); } to { opacity: 1; transform: translateX(0); } } `; document.head.appendChild(animationStyles); } if (document.readyState==='loading') { document.addEventListener('DOMContentLoaded', initializeBoutiquePremium); } else { initializeBoutiquePremium(); } window.BoutiquePremium={ ScrollAnimations, ParticleEffects, InteractiveEnhancements, PerformanceOptimizer, }; })();
/* Source: cart-custom.js */
class GeeknDragonCart { constructor() { this.isOpen=false; this.items=new Map(); this.apiEndpoint='/api/cart'; this.csrfToken=document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || ''; this.init(); } init() { this.cartToggle=document.getElementById('gd-cart-toggle-widget'); this.cartPanel=document.getElementById('gd-cart-panel'); this.cartOverlay=document.getElementById('gd-cart-overlay'); this.cartClose=document.getElementById('gd-cart-close'); this.cartContent=document.getElementById('gd-cart-content'); this.cartCount=document.getElementById('gd-cart-count-widget'); this.cartTotal=document.getElementById('gd-cart-total'); if (!this.cartToggle || !this.cartPanel) { this.showError('GeeknDragon Cart: Elements required not found'); return; } this.setupEventListeners(); this.loadCart(); this.initAddToCartButtons(); } setupEventListeners() { this.cartToggle.addEventListener('click', (e) => { e.preventDefault(); this.toggle(); }); if (this.cartClose) { this.cartClose.addEventListener('click', () => this.close()); } if (this.cartOverlay) { this.cartOverlay.addEventListener('click', () => this.close()); } document.addEventListener('keydown', (e) => { if (e.key==='Escape' && this.isOpen) { this.close(); } }); if (this.cartContent) { this.cartContent.addEventListener('click', (e) => { const target=e.target.closest('button'); if (!target) return; e.preventDefault(); if (target.classList.contains('gd-qty-btn')) { this.handleQuantityChange(target); } else if (target.classList.contains('gd-remove-btn')) { this.handleRemoveItem(target); } }); } const checkoutBtn=document.getElementById('gd-cart-checkout'); const clearBtn=document.getElementById('gd-cart-clear'); if (checkoutBtn) { checkoutBtn.addEventListener('click', () => this.checkout()); } if (clearBtn) { clearBtn.addEventListener('click', () => this.clear()); } } initAddToCartButtons() { const addToCartBtns=document.querySelectorAll('[data-product-id]'); addToCartBtns.forEach((btn) => { btn.addEventListener('click', (e) => { e.preventDefault(); this.addFromButton(btn); }); }); } async addFromButton(button) { const { productId }=button.dataset; const quantity=parseInt(button.dataset.quantity, 10) || 1; const options={}; const form=button.closest('form'); if (form) { const formData=new FormData(form); formData.forEach((value, key) => { if (key!=='_token' && key!=='quantity') { options[key]=value; } }); } let productData; try { const res=await fetch(`/api/products/${encodeURIComponent(productId)}`); if (!res.ok) throw new Error(`HTTP ${res.status}`); const data=await res.json(); if (!data.success) throw new Error(data.message || 'Produit introuvable'); productData=data.product; } catch (err) { this.showError('Produit introuvable'); return; } try { await this.addItem({ id: productData.id, name: productData.name, price: productData.price, image: productData.image || '', quantity, options, }); this.constructor.showAddedFeedback(button); } catch (error) { this.showError('Erreur lors de l\'ajout au panier'); } } async addItem(item) { try { const response=await fetch('/api/cart/add', { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest', 'X-CSRF-Token': this.csrfToken, }, body: JSON.stringify(item), }); if (!response.ok) { throw new Error(`HTTP ${response.status}`); } const result=await response.json(); if (result.success) { this.updateCartDisplay(result.cart); this.open(); } else { this.showError(`${result.message || 'Erreur lors de l\'ajout au panier'}. Veuillez r√©essayer plus tard.`); } } catch (error) { this.showError('Mode hors ligne, gestion locale du panier'); this.addItemLocally(item); } } addItemLocally(item) { const itemKey=this.constructor.generateItemKey(item.id, item.options || {}); if (this.items.has(itemKey)) { const existingItem=this.items.get(itemKey); existingItem.quantity += item.quantity; } else { this.items.set(itemKey, { ...item }); } this.saveToSession(); this.renderCart(); this.open(); } async handleQuantityChange(button) { const { action }=button.dataset; const { itemKey }=button.dataset; if (!itemKey) return; try { const response=await fetch('/api/cart/update', { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest', 'X-CSRF-Token': this.csrfToken, }, body: JSON.stringify({ itemKey, action, }), }); if (response.ok) { const result=await response.json(); if (result.success) { this.updateCartDisplay(result.cart); } else { this.showError(`${result.message || 'Impossible de mettre √† jour le panier'}. Veuillez r√©essayer plus tard.`); } } } catch (error) { this.updateQuantityLocally(itemKey, action); } } updateQuantityLocally(itemKey, action) { if (!this.items.has(itemKey)) return; const item=this.items.get(itemKey); if (action==='increase') { item.quantity += 1; } else if (action==='decrease') { item.quantity -= 1; if (item.quantity <= 0) { this.items.delete(itemKey); } } this.saveToSession(); this.renderCart(); } async handleRemoveItem(button) { const { itemKey }=button.dataset; if (!itemKey) return; try { const response=await fetch('/api/cart/remove', { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest', 'X-CSRF-Token': this.csrfToken, }, body: JSON.stringify({ itemKey }), }); if (response.ok) { const result=await response.json(); this.updateCartDisplay(result.cart); } } catch (error) { this.items.delete(itemKey); this.saveToSession(); this.renderCart(); } } async clear() { try { const response=await fetch('/api/cart/clear', { method: 'POST', headers: { 'X-Requested-With': 'XMLHttpRequest', 'X-CSRF-Token': this.csrfToken, }, }); if (response.ok) { this.items.clear(); this.renderCart(); } } catch (error) { this.items.clear(); this.saveToSession(); this.renderCart(); } } checkout() { if (this.items.size===0) { this.showError('Votre panier est vide'); return; } window.location.href='/checkout.php'; } open() { this.isOpen=true; this.cartPanel.classList.remove('hidden'); this.cartPanel.setAttribute('aria-hidden', 'false'); this.cartToggle.setAttribute('aria-expanded', 'true'); if (this.cartOverlay) { this.cartOverlay.classList.remove('hidden'); } this.cartClose?.focus(); } close() { this.isOpen=false; this.cartPanel.classList.add('hidden'); this.cartPanel.setAttribute('aria-hidden', 'true'); this.cartToggle.setAttribute('aria-expanded', 'false'); if (this.cartOverlay) { this.cartOverlay.classList.add('hidden'); } this.cartToggle.focus(); } toggle() { if (this.isOpen) { this.close(); } else { this.open(); } } updateCartDisplay(cartData) { if (cartData.items) { this.items.clear(); Object.entries(cartData.items).forEach(([key, item]) => { this.items.set(key, item); }); } this.renderCart(); } renderCart() { this.updateCartCount(); this.updateCartTotal(); this.renderCartItems(); } updateCartCount() { const totalItems=Array.from(this.items.values()) .reduce((sum, item) => sum+item.quantity, 0); if (this.cartCount) { this.cartCount.textContent=totalItems.toString(); } } updateCartTotal() { const total=Array.from(this.items.values()) .reduce((sum, item) => sum+(item.price*item.quantity), 0); if (this.cartTotal) { this.cartTotal.textContent=this.constructor.formatPrice(total); } } renderCartItems() { if (!this.cartContent) return; if (this.items.size===0) { this.cartContent.innerHTML=` <div class="p-6 text-center text-gray-500"> <svg class="w-12 h-12 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.5 6M7 13l-1.5 6m0 0h9m-9 0h9"/> </svg> <p class="text-sm">Votre panier est vide</p> </div> `; } else { this.reloadCartContent(); } } async reloadCartContent() { try { const response=await fetch('/api/cart/render', { headers: { 'X-Requested-With': 'XMLHttpRequest', }, }); if (response.ok) { const html=await response.text(); this.cartContent.innerHTML=html; } } catch (error) { this.showError('Impossible de recharger le contenu du panier'); } } async loadCart() { try { const response=await fetch('/api/cart', { headers: { 'X-Requested-With': 'XMLHttpRequest', }, }); if (response.ok) { const cartData=await response.json(); this.updateCartDisplay(cartData); } } catch (error) { this.loadFromSession(); } } saveToSession() { try { const cartData={ items: Object.fromEntries(this.items), timestamp: Date.now(), }; localStorage.setItem('gd_cart', JSON.stringify(cartData)); } catch (error) { this.showError('Impossible de sauvegarder le panier'); } } loadFromSession() { try { const cartData=localStorage.getItem('gd_cart'); if (cartData) { const parsed=JSON.parse(cartData); if (parsed.items) { this.items.clear(); Object.entries(parsed.items).forEach(([key, item]) => { this.items.set(key, item); }); this.renderCart(); } } } catch (error) { this.showError('Impossible de charger le panier depuis la session'); } } static generateItemKey(productId, options) { const optionsStr=Object.keys(options).sort() .map((key) => `${key}:${options[key]}`) .join('|'); return `${productId}_${btoa(optionsStr)}`; } static formatPrice(price) { return new Intl.NumberFormat('fr-CA', { style: 'currency', currency: 'CAD', }).format(price); } static showAddedFeedback(button) { const btn=button; const originalText=btn.textContent; btn.textContent='‚úì Ajout√©'; btn.disabled=true; setTimeout(() => { btn.textContent=originalText; btn.disabled=false; }, 1500); } showError(message) { this.lastError=message; const container=document.getElementById('gd-cart-error'); if (container) { container.textContent=message; container.classList.remove('hidden'); } } } document.addEventListener('DOMContentLoaded', () => { window.gdCart=new GeeknDragonCart(); }); window.GeeknDragonCart=GeeknDragonCart;
/* Source: currency-converter.js */
(() => { const rates={ copper: 1, silver: 10, electrum: 50, gold: 100, platinum: 1000, }; const sources=document.querySelectorAll('#currency-sources input'); const best=document.getElementById('currency-best'); const equivContainer=document.getElementById('currency-equivalences'); const equivTable=document.getElementById('currency-equivalences-list'); const equivBody=equivTable?.querySelector('tbody'); if (!sources.length || !best || !equivContainer || !equivTable || !equivBody) return; const multipliers=[1, 10, 100, 1000, 10000]; const coins=Object.keys(rates).sort((a, b) => rates[b]-rates[a]); const nf=new Intl.NumberFormat(document.documentElement.lang); const tr=window.i18n?.shop?.converter || {}; const errorPositiveInteger=tr.errorPositiveInteger || 'Please enter a positive integer'; const denominations=multipliers .flatMap((multiplier) => coins.map((coin) => ({ coin, multiplier, value: rates[coin]*multiplier, }))) .sort((a, b) => b.value-a.value); const minimalParts=(value, currencyNames, andText) => { let remaining=value; const items=[]; denominations.forEach(({ coin, multiplier, value: val }) => { if (remaining <= 0) return; const qty=Math.floor(remaining/val); if (qty > 0) { remaining -= qty*val; items.push({ coin, multiplier, qty }); } }); const parts=items.map(({ coin, multiplier, qty }) => { const label=currencyNames[coin].replace(/^pi√®ce/, qty > 1 ? 'pi√®ces' : 'pi√®ce'); return multiplier===1 ? `${nf.format(qty)} ${label}` : `${nf.format(qty)} ${label} x${nf.format(multiplier)}`; }); let text=''; if (parts.length===1) { [text]=parts; } else if (parts.length > 1) { const groups=[]; for (let i=0; i < parts.length; i += 3) { groups.push(parts.slice(i, i+3)); } const lastGroup=groups[groups.length-1]; const lastItem=lastGroup.pop(); const lastGroupText=lastGroup.length ? `${lastGroup.join(', ')} ${andText} ${lastItem}` : `${andText} ${lastItem}`; groups[groups.length-1]=lastGroupText; text=groups .map((g) => (Array.isArray(g) ? g.join(', ') : g)) .join(',<br>'); } return { text, remaining, items }; }; const render=() => { const currencyNames={ copper: tr.copper || 'pi√®ce de cuivre', silver: tr.silver || 'pi√®ce d‚Äôargent', electrum: tr.electrum || 'pi√®ce d‚Äô√©lectrum', gold: tr.gold || 'pi√®ce d‚Äôor', platinum: tr.platinum || 'pi√®ce de platine', }; const andText=tr.and || 'and'; const bestLabel=tr.bestLabel || ''; const totalPiecesLabel=tr.totalPieces || 'Total pieces:'; const baseValue=Array.from(sources).reduce((sum, input) => { const { currency }=input.dataset; const amount=Math.max(0, Math.floor(parseFloat(input.value) || 0)); return sum+amount*rates[currency]; }, 0); const minimal=minimalParts(baseValue, currencyNames, andText); const totalPieces=minimal.items.reduce((sum, { qty }) => sum+qty, 0); best.innerHTML=minimal.text ? `${bestLabel}<br>${minimal.text}<br><span class="total-pieces">${totalPiecesLabel} ${nf.format(totalPieces)}</span>` : ''; best.classList.toggle('hidden', !minimal.text); equivBody.innerHTML=''; let hasEquiv=false; coins.forEach((coin) => { const base=rates[coin]; const units=Math.floor(baseValue/base); if (!units) return; let rest=units; const parts=[]; multipliers.slice().reverse().forEach((mult) => { const qty=Math.floor(rest/mult); if (qty > 0) { const label=currencyNames[coin].replace(/^pi√®ce/, qty > 1 ? 'pi√®ces' : 'pi√®ce'); const text=mult===1 ? `${nf.format(qty)} ${label}` : `${nf.format(qty)} ${label} x${nf.format(mult)}`; parts.push({ qty, text }); rest -= qty*mult; } }); if (!parts.length) return; const summaryParts=parts.map((p) => p.text); const summary=summaryParts.join('<br>'); const remainder=baseValue % base; let remainderItems=[]; if (remainder > 0) { const rem=minimalParts(remainder, currencyNames, andText); remainderItems=rem.items; } const remainderPhrase=remainderItems .map(({ coin: rCoin, multiplier, qty }) => { const label=currencyNames[rCoin].replace(/^pi√®ce/, qty > 1 ? 'pi√®ces' : 'pi√®ce'); return multiplier===1 ? `${nf.format(qty)} ${label}` : `${nf.format(qty)} ${label} x${nf.format(multiplier)}`; }) .join('<br>'); const totalRowPieces=parts.reduce((sum, { qty }) => sum+qty, 0)+remainderItems.reduce((sum, { qty }) => sum+qty, 0); const row=document.createElement('tr'); const coinTitle=currencyNames[coin] .replace(/^pi√®ces?\s+(?:de|d['‚Äô])\s*/i, '') .replace(/^./, (ch) => ch.toUpperCase()); row.innerHTML=`<th>${coinTitle}</th><td>${summary}</td><td>${remainderPhrase}</td><td>${nf.format(totalRowPieces)}</td>`; equivBody.appendChild(row); hasEquiv=true; }); equivContainer.classList.toggle('hidden', !hasEquiv); }; sources.forEach((inputEl) => { const el=inputEl; el.addEventListener('focus', () => { if (el.value==='0') el.value=''; }); el.addEventListener('input', () => { el.value=el.value.replace(/[^0-9.-]/g, ''); const value=parseFloat(el.value); const invalid=Number.isFinite(value) && (value < 0 || !Number.isInteger(value)); el.setCustomValidity(invalid ? errorPositiveInteger : ''); if (invalid) el.reportValidity(); render(); }); }); render(); })();
/* Source: dynamic-trust-widgets.js */
(function() { 'use strict'; class DynamicTrustWidgets { constructor() { this.trustSignals={ flim2025: { name: 'FLIM 2025', icon: 'fas fa-trophy', color: '#f59e0b', priority: 95, testimonials: [ '"Ces pi√®ces ont transform√© nos parties, l\'immersion est totale !"-Marc, MJ depuis 8 ans', '"Qualit√© exceptionnelle, mes joueurs adorent le clinking des pi√®ces"-Sarah, Collectionneuse', '"Fini les calculs fastidieux, tout devient intuitif"-Alex, Nouveau MJ' ], stats: { satisfaction: 98, usage: 87, recommendation: 96 } }, quebecMade: { name: 'Fait au Qu√©bec', icon: 'fas fa-flag', color: '#3b82f6', priority: 90, testimonials: [ '"Fier de soutenir l\'artisanat qu√©b√©cois de qualit√©"-Pierre, Collectionneur', '"Livraison rapide depuis le Qu√©bec, service impeccable"-Marie, MJ', '"Savoir que c\'est fait ici ajoute de la valeur √©motionnelle"-Jean, Joueur' ], stats: { local_pride: 94, quality: 92, support: 89 } }, fastShipping: { name: 'Livraison Rapide', icon: 'fas fa-shipping-fast', color: '#10b981', priority: 85, testimonials: [ '"Command√© lundi, re√ßu mercredi ! Parfait pour ma session du weekend"-Lisa, MJ', '"Emballage soign√©, arriv√© en parfait √©tat"-David, Joueur', '"Service client r√©actif quand j\'ai eu une question"-Sophie, Collectionneuse' ], stats: { delivery_time: 2.3, satisfaction: 96, repeat_rate: 78 } }, securePayment: { name: 'Paiement S√©curis√©', icon: 'fas fa-shield-alt', color: '#8b5cf6', priority: 75, testimonials: [ '"Transaction s√©curis√©e, aucun souci avec mes donn√©es"-Robert, Acheteur', '"Interface de paiement claire et rassurante"-Nathalie, Cliente', '"Plusieurs options de paiement disponibles"-Marc, Utilisateur' ], stats: { security_score: 99, payment_success: 98, fraud_rate: 0.02 } }, customerSupport: { name: 'Support Client 5‚òÖ', icon: 'fas fa-headset', color: '#f97316', priority: 80, testimonials: [ '"R√©ponse rapide √† mes questions sur les produits"-Caroline, Acheteuse', '"Aide pr√©cieuse pour choisir le bon lot"-Thomas, Nouveau joueur', '"Service apr√®s-vente exemplaire"-Michel, Client fid√®le' ], stats: { response_time: '< 2h', satisfaction: 97, resolution_rate: 94 } }, communityTrust: { name: 'Communaut√© JDR', icon: 'fas fa-users', color: '#ec4899', priority: 70, testimonials: [ '"Recommand√© par ma communaut√© de joueurs"-Am√©lie, Joueuse', '"Les forums JDR en parlent positivement"-Vincent, MJ exp√©riment√©', '"Approuv√© par plusieurs tables de jeu"-Isabelle, Organisatrice' ], stats: { community_size: 2847, active_users: 1834, recommendations: 156 } }, qualityGuarantee: { name: 'Garantie Qualit√©', icon: 'fas fa-certificate', color: '#dc2626', priority: 82, testimonials: [ '"Garantie qui me rassure sur la qualit√©"-Philippe, Acheteur prudent', '"Remplacement gratuit suite √† un d√©faut, super service"-Lucie, Cliente', '"Qualit√© constante sur toutes mes commandes"-Bruno, Collectionneur' ], stats: { return_rate: 0.8, replacement_rate: 0.3, satisfaction: 98 } } }; this.displayPatterns={ homepage: ['flim2025', 'quebecMade', 'fastShipping'], product: ['flim2025', 'qualityGuarantee', 'customerSupport', 'securePayment'], boutique: ['quebecMade', 'communityTrust', 'fastShipping'], cart: ['securePayment', 'fastShipping', 'qualityGuarantee'], checkout: ['securePayment', 'qualityGuarantee'] }; this.animations={ fadeIn: 'opacity-0 animate-fadeIn', slideUp: 'translate-y-4 opacity-0 animate-slideUp', pulse: 'animate-pulse', bounce: 'animate-bounce' }; this.userContext={}; this.displayedWidgets=new Set(); this.interactionStats={ views: [], clicks: [], conversions: [] }; this.init(); } async init() { await this.analyzeUserContext(); this.displayPageSpecificWidgets(); this.initializeFloatingWidgets(); this.initializeRealTimeWidgets(); this.initializeSocialProof(); this.setupInteractionTracking(); } async analyzeUserContext() { this.userContext={ page_type: this.detectPageType(), user_segment: this.detectUserSegment(), cart_value: this.getCartValue(), session_duration: this.getSessionDuration(), device_type: this.getDeviceType(), is_returning_visitor: this.isReturningVisitor(), geo_location: await this.getGeoLocation(), time_of_day: this.getTimeOfDay(), referrer_source: this.getReferrerSource(), scroll_depth: 0 }; this.setupContextMonitoring(); } displayPageSpecificWidgets() { const pageType=this.userContext.page_type; const widgetsForPage=this.displayPatterns[pageType] || this.displayPatterns.homepage; this.displayHeaderTrustWidget(); widgetsForPage.forEach((signalKey, index) => { setTimeout(() => { this.displayInlineWidget(signalKey, index); }, index*200); }); this.displayTestimonialsWidget(); } displayHeaderTrustWidget() { const headerContainer=document.querySelector('.trust-signals-header') || this.createTrustContainer('header'); if (!headerContainer) return; const topSignals=this.getTopSignalsForContext(3); headerContainer.innerHTML=` <div class="flex flex-wrap items-center justify-center gap-4 py-3 bg-gradient-to-r from-purple-50 to-blue-50 border-b border-purple-100"> ${topSignals.map(signal => this.renderHeaderSignal(signal)).join('')} </div> `; this.animateWidgets(headerContainer); this.trackWidgetDisplay('header', topSignals); } displayInlineWidget(signalKey, index) { const signal=this.trustSignals[signalKey]; if (!signal) return; const container=this.findOptimalInlinePosition() || this.createInlineContainer(`inline-trust-${index}`); if (!container) return; const widget=document.createElement('div'); widget.className=`trust-widget-inline trust-widget-${signalKey} bg-white rounded-xl shadow-lg p-6 mb-8 border-l-4 border-${this.getColorClass(signal.color)} ${this.animations.slideUp}`; widget.dataset.signalKey=signalKey; widget.innerHTML=` <div class="flex items-start space-x-4"> <div class="flex-shrink-0"> <div class="w-12 h-12 rounded-full bg-gradient-to-r from-${this.getColorClass(signal.color)}-100 to-${this.getColorClass(signal.color)}-200 flex items-center justify-center"> <i class="${signal.icon} text-${this.getColorClass(signal.color)}-600 text-xl"></i> </div> </div> <div class="flex-1"> <h3 class="text-lg font-bold text-gray-800 mb-2">${signal.name}</h3> <p class="text-sm text-gray-600 mb-3">${this.getContextualMessage(signal)}</p> <div class="flex items-center space-x-4"> ${this.renderSignalStats(signal)} </div> <button class="mt-3 text-${this.getColorClass(signal.color)}-600 hover:text-${this.getColorClass(signal.color)}-800 text-sm font-semibold transition-colors toggle-testimonials"> Voir les t√©moignages <i class="fas fa-chevron-down ml-1"></i> </button> <div class="testimonials-container hidden mt-4 p-4 bg-gray-50 rounded-lg"> <div class="space-y-3"> ${signal.testimonials.slice(0, 2).map(testimonial => ` <blockquote class="text-sm italic text-gray-700 border-l-3 border-${this.getColorClass(signal.color)}-300 pl-3"> ${testimonial} </blockquote> `).join('')} </div> </div> </div> </div> `; container.appendChild(widget); widget.querySelector('.toggle-testimonials').addEventListener('click', (e) => { this.toggleTestimonials(widget, signal); }); this.animateWidget(widget); this.displayedWidgets.add(signalKey); } displayTestimonialsWidget() { const container=this.createTrustContainer('testimonials'); if (!container) return; const contextualTestimonials=this.getContextualTestimonials(); container.innerHTML=` <section class="testimonials-widget bg-gradient-to-r from-purple-600 to-blue-600 text-white py-12 rounded-2xl my-8"> <div class="container mx-auto px-4"> <h3 class="text-3xl font-bold text-center mb-8"> <i class="fas fa-quote-left mr-2"></i> Ce que disent nos joueurs </h3> <div class="testimonials-carousel"> <div class="testimonials-track flex transition-transform duration-500" style="transform: translateX(0%)"> ${contextualTestimonials.map((testimonial, index) => this.renderTestimonialCard(testimonial, index)).join('')} </div> </div> <div class="flex justify-center mt-6 space-x-2"> ${contextualTestimonials.map((_, index) => ` <button class="carousel-dot w-3 h-3 rounded-full bg-white bg-opacity-50 hover:bg-opacity-100 transition-all ${index===0 ? 'bg-opacity-100' : ''}" data-slide="${index}"></button> `).join('')} </div> </div> </section> `; this.setupTestimonialCarousel(container); this.trackWidgetDisplay('testimonials', contextualTestimonials); } initializeFloatingWidgets() { this.initializeUrgencyWidget(); this.initializeFreeShippingWidget(); this.initializeGuaranteeWidget(); } initializeUrgencyWidget() { if (this.shouldShowUrgency()) { setTimeout(() => { this.displayFloatingUrgencyWidget(); }, 5000); } } displayFloatingUrgencyWidget() { if (document.querySelector('.urgency-widget')) return; const widget=document.createElement('div'); widget.className='urgency-widget fixed bottom-4 left-4 z-50 bg-red-500 text-white px-4 py-3 rounded-lg shadow-2xl max-w-sm transform -translate-x-full transition-transform duration-500'; widget.innerHTML=` <div class="flex items-center space-x-3"> <div class="flex-shrink-0"> <i class="fas fa-fire text-yellow-300 text-xl animate-bounce"></i> </div> <div class="flex-1"> <p class="text-sm font-semibold">üî• Forte demande d√©tect√©e</p> <p class="text-xs opacity-90">+ de 15 personnes consultent ce produit</p> </div> <button class="close-urgency text-white hover:text-gray-200"> <i class="fas fa-times"></i> </button> </div> `; document.body.appendChild(widget); setTimeout(() => { widget.style.transform='translateX(0)'; }, 100); widget.querySelector('.close-urgency').addEventListener('click', () => { this.hideFloatingWidget(widget); }); setTimeout(() => { if (document.body.contains(widget)) { this.hideFloatingWidget(widget); } }, 8000); this.trackWidgetDisplay('urgency_floating', [{ type: 'stock_urgency' }]); } initializeFreeShippingWidget() { const cartValue=this.getCartValue(); const freeShippingThreshold=150; if (cartValue > 0 && cartValue < freeShippingThreshold) { this.displayFreeShippingProgress(); } } displayFreeShippingProgress() { const container=document.querySelector('.cart-summary') || document.querySelector('.product-price'); if (!container) return; const cartValue=this.getCartValue(); const freeShippingThreshold=150; const remaining=freeShippingThreshold-cartValue; const progress=(cartValue/freeShippingThreshold)*100; const widget=document.createElement('div'); widget.className='free-shipping-widget bg-green-50 border border-green-200 rounded-lg p-4 mt-4'; widget.innerHTML=` <div class="flex items-center space-x-3 mb-3"> <i class="fas fa-truck text-green-600"></i> <div class="flex-1"> <p class="text-sm font-semibold text-green-800"> Plus que <span class="font-bold">${remaining.toFixed(0)}$</span> pour la livraison gratuite ! </p> </div> </div> <div class="w-full bg-gray-200 rounded-full h-2 mb-2"> <div class="bg-gradient-to-r from-green-400 to-green-600 h-2 rounded-full transition-all duration-500" style="width: ${Math.min(100, progress)}%"></div> </div> <p class="text-xs text-green-600 text-center"> <i class="fas fa-leaf mr-1"></i> Livraison √©coresponsable depuis le Qu√©bec </p> `; container.appendChild(widget); this.trackWidgetDisplay('free_shipping_progress', [{ remaining, progress }]); } initializeRealTimeWidgets() { this.displayRealTimeVisitors(); this.displayRecentOrders(); this.displayLiveActivity(); } displayRealTimeVisitors() { const container=this.createTrustContainer('real-time'); if (!container) return; const visitorCount=this.generateRealisticVisitorCount(); const widget=document.createElement('div'); widget.className='real-time-widget bg-white border border-purple-200 rounded-lg p-4 mb-6 shadow-sm'; widget.innerHTML=` <div class="flex items-center space-x-3"> <div class="relative"> <i class="fas fa-eye text-purple-600"></i> <span class="absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full animate-pulse"></span> </div> <div> <p class="text-sm text-gray-600">Actuellement en ligne</p> <p class="text-lg font-bold text-purple-600 visitor-count">${visitorCount}</p> </div> </div> `; container.appendChild(widget); setInterval(() => { this.updateVisitorCount(widget); }, 30000); } displayRecentOrders() { if (!this.shouldShowRecentOrders()) return; setTimeout(() => { this.showRecentOrderNotification(); }, Math.random()*10000+5000); } showRecentOrderNotification() { const notification=document.createElement('div'); notification.className='recent-order-notification fixed top-4 left-4 z-50 bg-white border border-gray-200 rounded-lg shadow-lg p-4 transform -translate-x-full transition-transform duration-500 max-w-sm'; const recentOrder=this.generateRecentOrder(); notification.innerHTML=` <div class="flex items-start space-x-3"> <div class="flex-shrink-0"> <i class="fas fa-shopping-bag text-green-500"></i> </div> <div class="flex-1"> <p class="text-sm font-semibold text-gray-800">Commande r√©cente</p> <p class="text-xs text-gray-600">${recentOrder.customer} vient d'acheter</p> <p class="text-xs font-semibold text-purple-600">${recentOrder.product}</p> <p class="text-xs text-gray-500 mt-1">Il y a ${recentOrder.timeAgo}</p> </div> <button class="close-notification text-gray-400 hover:text-gray-600"> <i class="fas fa-times text-xs"></i> </button> </div> `; document.body.appendChild(notification); setTimeout(() => { notification.style.transform='translateX(0)'; }, 100); notification.querySelector('.close-notification').addEventListener('click', () => { this.hideFloatingWidget(notification); }); setTimeout(() => { if (document.body.contains(notification)) { this.hideFloatingWidget(notification); } }, 6000); this.trackWidgetDisplay('recent_order', [recentOrder]); } initializeSocialProof() { this.displaySocialProofBadges(); this.displayCommunityStats(); this.displayInfluencerEndorsements(); } displaySocialProofBadges() { const container=this.createTrustContainer('social-proof'); if (!container) return; container.innerHTML=` <div class="social-proof-badges flex flex-wrap justify-center gap-4 py-6"> ${this.renderSocialProofBadge('2800+', 'Joueurs satisfaits', 'fas fa-users')} ${this.renderSocialProofBadge('156', 'Recommandations communaut√©', 'fas fa-thumbs-up')} ${this.renderSocialProofBadge('4.9/5', 'Note moyenne', 'fas fa-star')} ${this.renderSocialProofBadge('98%', 'Taux de satisfaction', 'fas fa-heart')} </div> `; this.animateCounters(container); } setupInteractionTracking() { document.addEventListener('click', (e) => { const trustWidget=e.target.closest('[data-signal-key]'); if (trustWidget) { const signalKey=trustWidget.dataset.signalKey; this.trackTrustSignalClick(signalKey, e.target); } }); document.addEventListener('mouseenter', (e) => { const trustWidget=e.target.closest('[data-signal-key]'); if (trustWidget && !trustWidget.dataset.hoverTracked) { trustWidget.dataset.hoverTracked='true'; this.trackTrustSignalHover(trustWidget.dataset.signalKey); } }, true); this.setupScrollTracking(); } setupScrollTracking() { const socialProofElements=document.querySelectorAll('.social-proof-badges, .testimonials-widget'); if (socialProofElements.length===0) return; const observer=new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting && !entry.target.dataset.viewTracked) { entry.target.dataset.viewTracked='true'; this.trackSocialProofView(entry.target); } }); }, { threshold: 0.5 }); socialProofElements.forEach(el => observer.observe(el)); } detectPageType() { const path=window.location.pathname; if (path==='/' || path==='/index.php') return 'homepage'; if (path.includes('boutique')) return 'boutique'; if (path.includes('lot') || path.includes('pack') || path.includes('triptyque')) return 'product'; if (path.includes('cart') || document.querySelector('.snipcart-cart')) return 'cart'; if (path.includes('checkout')) return 'checkout'; return 'general'; } detectUserSegment() { const cartValue=this.getCartValue(); const pageViews=this.getPageViews(); const timeOnSite=this.getSessionDuration(); if (cartValue===0 && pageViews===1) return 'new_visitor'; if (cartValue > 200 || timeOnSite > 300) return 'high_value'; if (this.isReturningVisitor()) return 'returning_customer'; return 'regular_visitor'; } getTopSignalsForContext(limit=3) { const pageType=this.userContext.page_type; const availableSignals=this.displayPatterns[pageType] || this.displayPatterns.homepage; return availableSignals.slice(0, limit).map(key => ({ key, ...this.trustSignals[key] })); } getContextualMessage(signal) { const messages={ flim2025: this.getRandomMessage([ 'Certifi√© par les joueurs les plus exigeants', 'Test√© et approuv√© par la communaut√© JDR', 'Qualit√© reconnue depuis 2025' ]), quebecMade: this.getRandomMessage([ 'Fi√®rement fabriqu√© au Qu√©bec avec passion', 'Artisanat local de qualit√© sup√©rieure', 'Soutenir l\'√©conomie locale n\'a jamais √©t√© aussi ludique' ]), fastShipping: this.getRandomMessage([ 'Livraison rapide partout au Canada', 'Exp√©dition sous 24h, livraison en 2-3 jours', 'Service de livraison fiable et s√©curis√©' ]) }; return messages[signal.name] || 'Signal de confiance authentique'; } getRandomMessage(messages) { return messages[Math.floor(Math.random()*messages.length)]; } renderHeaderSignal(signal) { return ` <div class="header-trust-signal flex items-center space-x-2 px-3 py-1 bg-white rounded-full shadow-sm hover:shadow-md transition-shadow cursor-pointer" data-signal-key="${signal.key}"> <i class="${signal.icon} text-${this.getColorClass(signal.color)}-600"></i> <span class="text-sm font-semibold text-gray-800">${signal.name}</span> <i class="fas fa-check-circle text-green-500 text-xs"></i> </div> `; } renderSignalStats(signal) { const stats=Object.entries(signal.stats).slice(0, 2); return stats.map(([key, value]) => ` <div class="text-center"> <div class="text-lg font-bold text-${this.getColorClass(signal.color)}-600">${value}${typeof value==='number' && value < 10 ? '%' : ''}</div> <div class="text-xs text-gray-500 capitalize">${key.replace('_', ' ')}</div> </div> `).join(''); } renderTestimonialCard(testimonial, index) { return ` <div class="testimonial-card flex-shrink-0 w-80 mx-4"> <blockquote class="text-lg italic mb-4">${testimonial}</blockquote> <div class="flex items-center space-x-3"> <div class="w-12 h-12 rounded-full bg-white bg-opacity-20 flex items-center justify-center"> <i class="fas fa-user text-white"></i> </div> <div> <p class="font-semibold">${this.extractAuthor(testimonial)}</p> <p class="text-sm opacity-75">${this.extractRole(testimonial)}</p> </div> </div> </div> `; } renderSocialProofBadge(value, label, icon) { return ` <div class="social-proof-badge text-center p-4 bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow"> <div class="mb-2"> <i class="${icon} text-3xl text-purple-600"></i> </div> <div class="text-2xl font-bold text-gray-800 counter" data-target="${value}">${value}</div> <div class="text-sm text-gray-600">${label}</div> </div> `; } animateWidgets(container) { const widgets=container.querySelectorAll('.trust-widget-inline, .header-trust-signal'); widgets.forEach((widget, index) => { widget.style.opacity='0'; widget.style.transform='translateY(20px)'; setTimeout(() => { widget.style.transition='opacity 0.5s ease, transform 0.5s ease'; widget.style.opacity='1'; widget.style.transform='translateY(0)'; }, index*100); }); } animateWidget(widget) { widget.style.opacity='0'; widget.style.transform='translateY(20px)'; setTimeout(() => { widget.style.transition='opacity 0.5s ease, transform 0.5s ease'; widget.style.opacity='1'; widget.style.transform='translateY(0)'; }, 100); } animateCounters(container) { const counters=container.querySelectorAll('.counter'); const observer=new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) { this.animateCounter(entry.target); observer.unobserve(entry.target); } }); }); counters.forEach(counter => observer.observe(counter)); } animateCounter(element) { const target=element.dataset.target; const numericTarget=parseInt(target.replace(/[^\d]/g, '')); const suffix=target.replace(/[\d]/g, ''); let current=0; const increment=numericTarget/50; const timer=setInterval(() => { current += increment; if (current >= numericTarget) { element.textContent=target; clearInterval(timer); } else { element.textContent=Math.floor(current)+suffix; } }, 40); } getCartValue() { if (window.Snipcart?.store?.getState) { return window.Snipcart.store.getState().cart.subtotal; } return 0; } getPageViews() { return parseInt(sessionStorage.getItem('gd_page_views') || '1'); } getSessionDuration() { const start=parseInt(sessionStorage.getItem('gd_session_start') || Date.now().toString()); return (Date.now()-start)/1000; } getDeviceType() { const width=window.innerWidth; if (width < 768) return 'mobile'; if (width < 1024) return 'tablet'; return 'desktop'; } isReturningVisitor() { return localStorage.getItem('gd_returning_visitor')==='true'; } async getGeoLocation() { return { country: 'CA', region: 'QC', city: 'Montreal' }; } getTimeOfDay() { const hour=new Date().getHours(); if (hour < 6) return 'night'; if (hour < 12) return 'morning'; if (hour < 18) return 'afternoon'; return 'evening'; } getReferrerSource() { const referrer=document.referrer; if (!referrer) return 'direct'; if (referrer.includes('google')) return 'google'; if (referrer.includes('facebook')) return 'facebook'; if (referrer.includes('reddit')) return 'reddit'; return 'other'; } shouldShowUrgency() { return this.userContext.page_type==='product' && this.userContext.session_duration > 30 && !this.displayedWidgets.has('urgency'); } shouldShowRecentOrders() { return this.userContext.page_type!=='checkout' && Math.random() > 0.7; } generateRealisticVisitorCount() { const baseCount=12; const variance=Math.floor(Math.random()*8)-4; const timeBonus=this.getTimeOfDay()==='evening' ? 5 : 0; return Math.max(1, baseCount+variance+timeBonus); } generateRecentOrder() { const names=['Alexandre', 'Sarah', 'Marc', 'Julie', 'Pierre', 'Marie', 'David', 'Sophie']; const products=[ 'Lot de 10 pi√®ces m√©talliques', 'Lot de 25 pi√®ces m√©talliques', 'Pack Arsenal de l\'Aventurier', 'Triptyque H√©ros Al√©atoire' ]; const timeOptions=['2 min', '5 min', '12 min', '28 min', '45 min']; return { customer: names[Math.floor(Math.random()*names.length)], product: products[Math.floor(Math.random()*products.length)], timeAgo: timeOptions[Math.floor(Math.random()*timeOptions.length)] }; } getContextualTestimonials() { const allTestimonials=Object.values(this.trustSignals) .flatMap(signal => signal.testimonials); return this.shuffleArray(allTestimonials).slice(0, 3); } createTrustContainer(type) { const selectors={ header: '.hero-section, main', inline: '.product-details, .products-grid', testimonials: '.hero-section, main', 'social-proof': '.trust-signals, footer', 'real-time': '.sidebar, .product-sidebar' }; const target=document.querySelector(selectors[type]); if (!target) return null; const container=document.createElement('div'); container.className=`trust-container trust-${type}`; if (type==='header') { target.insertBefore(container, target.firstChild); } else { target.appendChild(container); } return container; } findOptimalInlinePosition() { const candidates=[ '.product-description', '.products-grid > .product-card:nth-child(3n)', '.hero-content', '.page-content section:nth-child(2)' ]; for (const selector of candidates) { const element=document.querySelector(selector); if (element) { const container=document.createElement('div'); container.className='optimal-trust-position'; element.insertAdjacentElement('afterend', container); return container; } } return null; } createInlineContainer(className) { const main=document.querySelector('main, .main-content, .content'); if (!main) return null; const container=document.createElement('div'); container.className=className; main.appendChild(container); return container; } getColorClass(color) { const colorMap={ '#f59e0b': 'yellow', '#3b82f6': 'blue', '#10b981': 'green', '#8b5cf6': 'purple', '#f97316': 'orange', '#ec4899': 'pink', '#dc2626': 'red' }; return colorMap[color] || 'purple'; } extractAuthor(testimonial) { const match=testimonial.match(/- ([^,]+)/); return match ? match[1] : 'Joueur anonyme'; } extractRole(testimonial) { const match=testimonial.match(/, (.+)$/); return match ? match[1] : 'Joueur JDR'; } shuffleArray(array) { const shuffled=[...array]; for (let i=shuffled.length-1; i > 0; i--) { const j=Math.floor(Math.random()*(i+1)); [shuffled[i], shuffled[j]]=[shuffled[j], shuffled[i]]; } return shuffled; } hideFloatingWidget(widget) { widget.style.opacity='0'; widget.style.transform='translateY(20px)'; setTimeout(() => { if (document.body.contains(widget)) { document.body.removeChild(widget); } }, 300); } toggleTestimonials(widget, signal) { const testimonialsContainer=widget.querySelector('.testimonials-container'); const toggleButton=widget.querySelector('.toggle-testimonials'); const chevron=toggleButton.querySelector('.fas'); if (testimonialsContainer.classList.contains('hidden')) { testimonialsContainer.classList.remove('hidden'); chevron.classList.remove('fa-chevron-down'); chevron.classList.add('fa-chevron-up'); toggleButton.innerHTML='Masquer les t√©moignages <i class="fas fa-chevron-up ml-1"></i>'; this.trackTrustSignalClick(signal.name, 'testimonials_expand'); } else { testimonialsContainer.classList.add('hidden'); chevron.classList.remove('fa-chevron-up'); chevron.classList.add('fa-chevron-down'); toggleButton.innerHTML='Voir les t√©moignages <i class="fas fa-chevron-down ml-1"></i>'; } } setupTestimonialCarousel(container) { const track=container.querySelector('.testimonials-track'); const dots=container.querySelectorAll('.carousel-dot'); let currentSlide=0; dots.forEach((dot, index) => { dot.addEventListener('click', () => { currentSlide=index; this.updateCarousel(track, dots, currentSlide); }); }); setInterval(() => { currentSlide=(currentSlide+1) % dots.length; this.updateCarousel(track, dots, currentSlide); }, 8000); } updateCarousel(track, dots, currentSlide) { const translateX=-currentSlide*100; track.style.transform=`translateX(${translateX}%)`; dots.forEach((dot, index) => { dot.classList.toggle('bg-opacity-100', index===currentSlide); dot.classList.toggle('bg-opacity-50', index!==currentSlide); }); } updateVisitorCount(widget) { const countElement=widget.querySelector('.visitor-count'); const newCount=this.generateRealisticVisitorCount(); countElement.style.transition='transform 0.3s ease'; countElement.style.transform='scale(1.1)'; setTimeout(() => { countElement.textContent=newCount; countElement.style.transform='scale(1)'; }, 150); } setupContextMonitoring() { window.addEventListener('scroll', () => { const scrollPercent=(window.scrollY/(document.body.scrollHeight-window.innerHeight))*100; this.userContext.scroll_depth=Math.min(100, Math.max(0, scrollPercent)); }); if (window.Snipcart) { window.Snipcart.events.on('cart.ready', () => { this.userContext.cart_value=this.getCartValue(); }); } } trackWidgetDisplay(widgetType, data) { this.interactionStats.views.push({ widget_type: widgetType, data: data, timestamp: Date.now(), context: this.userContext }); if (window.GeeknDragonAnalytics) { window.GeeknDragonAnalytics.trackEvent('trust_widget_view', { widget_type: widgetType, page_type: this.userContext.page_type, user_segment: this.userContext.user_segment }); } } trackTrustSignalClick(signalKey, target) { this.interactionStats.clicks.push({ signal_key: signalKey, target: target, timestamp: Date.now(), context: this.userContext }); if (window.GeeknDragonAnalytics) { window.GeeknDragonAnalytics.trackEvent('trust_signal_click', { signal_key: signalKey, target: target, page_type: this.userContext.page_type }); } } trackTrustSignalHover(signalKey) { if (window.GeeknDragonAnalytics) { window.GeeknDragonAnalytics.trackEvent('trust_signal_hover', { signal_key: signalKey, page_type: this.userContext.page_type }); } } trackSocialProofView(element) { if (window.GeeknDragonAnalytics) { window.GeeknDragonAnalytics.trackEvent('social_proof_view', { element_type: element.className, scroll_depth: this.userContext.scroll_depth }); } } getTrustStats() { return { displayed_widgets: Array.from(this.displayedWidgets), interaction_stats: this.interactionStats, user_context: this.userContext, signals_available: Object.keys(this.trustSignals).length }; } refreshTrustSignals() { this.analyzeUserContext(); this.displayPageSpecificWidgets(); } forceShowWidget(signalKey) { if (this.trustSignals[signalKey]) { this.displayInlineWidget(signalKey, 0); } } } document.addEventListener('DOMContentLoaded', () => { window.GeeknDragonTrustWidgets=new DynamicTrustWidgets(); if (window.location.hostname==='localhost') { window._debugTrust=window.GeeknDragonTrustWidgets; } }); })();
/* Source: enhanced-snipcart-integration.js */
(function() { 'use strict'; class EnhancedSnipcartIntegration { constructor() { this.productConfigurations=new Map(); this.cartAnalytics={ addToCartCount: 0, variationSelections: {}, abandonedCarts: 0, checkoutInitiations: 0 }; this.config={ currency: 'CAD', locale: 'fr-CA', enableAnalytics: true, enableAbandonmentTracking: true, customizationPreview: true, smartDefaults: true }; this.productVariations={ 'lot10': { type: 'multiplier_selection', basePrice: 60.00, variations: [ { id: 'x1', label: 'x1 (Unitaire-Brillant)', priceModifier: 0, default: true }, { id: 'x10', label: 'x10 (Grav√©-Fini mat)', priceModifier: 0 }, { id: 'x100', label: 'x100 (Grav√©-Fini mat)', priceModifier: 0 }, { id: 'x1000', label: 'x1 000 (Grav√©-Fini mat)', priceModifier: 0 }, { id: 'x10000', label: 'x10 000 (Grav√©-Fini mat)', priceModifier: 0 } ], customFields: [ { name: 'multiplicateur', type: 'dropdown', required: true, defaultValue: 'x1' } ] }, 'lot25': { type: 'fixed_bundle', basePrice: 145.00, description: 'Collection compl√®te-25 pi√®ces uniques incluses', variations: [] }, 'lot50_marchand': { type: 'multiplier_selection', basePrice: 275.00, variations: [ { id: 'x1', label: 'x1 (Unitaire-Brillant)', priceModifier: 0 }, { id: 'x10', label: 'x10 (Grav√©-Fini mat)', priceModifier: 0 }, { id: 'x100', label: 'x100 (Grav√©-Fini mat)', priceModifier: 0 }, { id: 'x1000', label: 'x1 000 (Grav√©-Fini mat)', priceModifier: 0 }, { id: 'x10000', label: 'x10 000 (Grav√©-Fini mat)', priceModifier: 0 } ], customFields: [ { name: 'multiplicateur', type: 'dropdown', required: true, defaultValue: 'x1' } ] }, 'lot50_seigneur': { type: 'multiplier_selection', basePrice: 275.00, variations: [ { id: 'x1', label: 'x1 (Unitaire-Brillant)', priceModifier: 0, default: true }, { id: 'x10', label: 'x10 (Grav√©-Fini mat)', priceModifier: 0 }, { id: 'x100', label: 'x100 (Grav√©-Fini mat)', priceModifier: 0 }, { id: 'x1000', label: 'x1 000 (Grav√©-Fini mat)', priceModifier: 0 }, { id: 'x10000', label: 'x10 000 (Grav√©-Fini mat)', priceModifier: 0 } ], customFields: [ { name: 'multiplicateur', type: 'dropdown', required: true, defaultValue: 'x1' } ] }, 'pack_arsenal': { type: 'language_selection', basePrice: 49.99, variations: [ { id: 'fr', label: 'Fran√ßais', priceModifier: 0, default: true }, { id: 'en', label: 'English', priceModifier: 0 } ], customFields: [ { name: 'langue', type: 'dropdown', required: true, defaultValue: 'fr' } ] }, 'pack_butins': { type: 'language_selection', basePrice: 36.99, variations: [ { id: 'fr', label: 'Fran√ßais', priceModifier: 0, default: true }, { id: 'en', label: 'English', priceModifier: 0 } ], customFields: [ { name: 'langue', type: 'dropdown', required: true, defaultValue: 'fr' } ] }, 'pack_routes': { type: 'language_selection', basePrice: 34.99, variations: [ { id: 'fr', label: 'Fran√ßais', priceModifier: 0, default: true }, { id: 'en', label: 'English', priceModifier: 0 } ], customFields: [ { name: 'langue', type: 'dropdown', required: true, defaultValue: 'fr' } ] }, 'triptyque_mystere': { type: 'language_selection', basePrice: 59.99, variations: [ { id: 'fr', label: 'Fran√ßais', priceModifier: 0, default: true }, { id: 'en', label: 'English', priceModifier: 0 } ], customFields: [ { name: 'langue', type: 'dropdown', required: true, defaultValue: 'fr' }, { name: 'note_special', type: 'textarea', required: false, placeholder: 'Demande sp√©ciale pour votre tirage al√©atoire (optionnel)' } ] } }; this.init(); } async init() { await this.waitForSnipcart(); this.enhanceAddToCartButtons(); this.setupSnipcartEvents(); this.setupAnalytics(); this.setupUIEnhancements(); this.setupFormValidation(); } async waitForSnipcart() { return new Promise((resolve) => { if (window.Snipcart && window.Snipcart.api) { resolve(); return; } const checkSnipcart=() => { if (window.Snipcart && window.Snipcart.api) { resolve(); } else { setTimeout(checkSnipcart, 100); } }; checkSnipcart(); }); } enhanceAddToCartButtons() { document.addEventListener('click', (e) => { const button=e.target.closest('.gd-add-to-cart'); if (!button) return; e.preventDefault(); e.stopPropagation(); const productId=button.dataset.productId; const quantity=parseInt(button.dataset.quantity || '1', 10); this.showProductCustomizer(productId, quantity, button); }); } showProductCustomizer(productId, quantity, triggerButton) { const config=this.productVariations[productId]; if (!config || config.type==='fixed_bundle') { this.addToCartDirect(productId, quantity); return; } this.createCustomizerModal(productId, quantity, config, triggerButton); } createCustomizerModal(productId, quantity, config, triggerButton) { const existingModal=document.querySelector('.gd-product-customizer'); if (existingModal) { existingModal.remove(); } const modal=document.createElement('div'); modal.className='gd-product-customizer'; modal.innerHTML=this.generateCustomizerHTML(productId, quantity, config); document.body.appendChild(modal); requestAnimationFrame(() => { modal.classList.add('active'); }); this.setupCustomizerEvents(modal, productId, quantity, config, triggerButton); } generateCustomizerHTML(productId, quantity, config) { const productData=this.getProductData(productId); let variationsHTML=''; if (config.variations && config.variations.length > 0) { const variationType=config.type; if (variationType==='multiplier_selection') { variationsHTML=` <div class="customizer-section"> <h4 class="customizer-section-title"> <span class="icon">‚öñÔ∏è</span> Choisissez votre multiplicateur </h4> <div class="multiplier-grid"> ${config.variations.map(variation => ` <label class="multiplier-option ${variation.default ? 'selected' : ''}"> <input type="radio" name="multiplicateur" value="${variation.id}" ${variation.default ? 'checked' : ''}> <div class="multiplier-card"> <div class="multiplier-label">${variation.label}</div> <div class="multiplier-preview"> <img src="/images/optimized-modern/webp/${this.getPreviewImage(productId, variation.id)}.webp" alt="Aper√ßu ${variation.label}" loading="lazy"> </div> <div class="multiplier-description"> ${this.getMultiplierDescription(variation.id)} </div> </div> </label> `).join('')} </div> </div> `; } else if (variationType==='language_selection') { variationsHTML=` <div class="customizer-section"> <h4 class="customizer-section-title"> <span class="icon">üåç</span> Choisissez votre langue </h4> <div class="language-options"> ${config.variations.map(variation => ` <label class="language-option ${variation.default ? 'selected' : ''}"> <input type="radio" name="langue" value="${variation.id}" ${variation.default ? 'checked' : ''}> <div class="language-card"> <div class="language-flag"> ${variation.id==='fr' ? 'üá´üá∑' : 'üá¨üáß'} </div> <div class="language-label">${variation.label}</div> </div> </label> `).join('')} </div> </div> `; } } let customFieldsHTML=''; if (config.customFields) { const additionalFields=config.customFields.filter(field => !['multiplicateur', 'langue'].includes(field.name) ); if (additionalFields.length > 0) { customFieldsHTML=` <div class="customizer-section"> <h4 class="customizer-section-title"> <span class="icon">üìù</span> Personnalisation additionnelle </h4> ${additionalFields.map(field => this.generateCustomFieldHTML(field)).join('')} </div> `; } } return ` <div class="customizer-backdrop"></div> <div class="customizer-content"> <div class="customizer-header"> <div class="product-info"> <img src="${productData.image}" alt="${productData.name}" class="product-thumbnail"> <div class="product-details"> <h3 class="product-name">${productData.name}</h3> <div class="product-price">${config.basePrice.toFixed(2)} $ CAD</div> <div class="quantity-display">Quantit√©: <strong>${quantity}</strong></div> </div> </div> <button class="customizer-close" aria-label="Fermer"> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"> <line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line> </svg> </button> </div> <div class="customizer-body"> ${variationsHTML} ${customFieldsHTML} </div> <div class="customizer-footer"> <div class="total-price"> Total: <span class="price-amount">${(config.basePrice*quantity).toFixed(2)} $ CAD</span> </div> <div class="customizer-actions"> <button class="btn-cancel">Annuler</button> <button class="btn-add-to-cart btn-primary"> <svg class="cart-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"> <path d="M3 3h2l.4 2m0 0L8 17h8l3-8H5.4z"/> <circle cx="9" cy="20" r="1"/> <circle cx="20" cy="20" r="1"/> </svg> Ajouter au panier </button> </div> </div> </div> `; } generateCustomFieldHTML(field) { switch (field.type) { case 'textarea': return ` <div class="custom-field"> <label for="field_${field.name}">${field.label || field.name}</label> <textarea id="field_${field.name}" name="${field.name}" placeholder="${field.placeholder || ''}" ${field.required ? 'required' : ''}></textarea> </div> `; case 'dropdown': return ''; default: return ` <div class="custom-field"> <label for="field_${field.name}">${field.label || field.name}</label> <input type="text" id="field_${field.name}" name="${field.name}" placeholder="${field.placeholder || ''}" ${field.required ? 'required' : ''}> </div> `; } } setupCustomizerEvents(modal, productId, quantity, config, triggerButton) { modal.addEventListener('click', (e) => { if (e.target.classList.contains('customizer-backdrop') || e.target.closest('.customizer-close') || e.target.classList.contains('btn-cancel')) { this.closeCustomizer(modal); } }); modal.addEventListener('change', (e) => { if (e.target.type==='radio') { const container=e.target.closest('.multiplier-grid, .language-options'); if (container) { container.querySelectorAll('.multiplier-option, .language-option').forEach(option => { option.classList.remove('selected'); }); e.target.closest('.multiplier-option, .language-option').classList.add('selected'); } this.updateCustomizerPrice(modal, config, quantity); } }); modal.querySelector('.btn-add-to-cart').addEventListener('click', () => { this.processCustomizedAddToCart(modal, productId, quantity, config); }); modal.addEventListener('keydown', (e) => { if (e.key==='Escape') { this.closeCustomizer(modal); } }); } updateCustomizerPrice(modal, config, quantity) { const selectedVariations=this.getSelectedVariations(modal); let totalPrice=config.basePrice; Object.entries(selectedVariations).forEach(([key, value]) => { const variation=config.variations.find(v => v.id===value); if (variation && variation.priceModifier) { totalPrice += variation.priceModifier; } }); const finalPrice=totalPrice*quantity; modal.querySelector('.price-amount').textContent=`${finalPrice.toFixed(2)} $ CAD`; } getSelectedVariations(modal) { const variations={}; modal.querySelectorAll('input[type="radio"]:checked').forEach(radio => { variations[radio.name]=radio.value; }); modal.querySelectorAll('input[type="text"], textarea').forEach(input => { if (input.value.trim()) { variations[input.name]=input.value.trim(); } }); return variations; } async processCustomizedAddToCart(modal, productId, quantity, config) { const button=modal.querySelector('.btn-add-to-cart'); const originalText=button.innerHTML; button.innerHTML=` <svg class="loading-spinner" viewBox="0 0 24 24"> <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" opacity="0.3"/> <path d="M12,2 A10,10 0 0,1 22,12" stroke="currentColor" stroke-width="2" fill="none"/> </svg> Ajout en cours... `; button.disabled=true; try { const variations=this.getSelectedVariations(modal); const success=await this.addToCartWithVariations(productId, quantity, variations, config); if (success) { button.innerHTML=` <svg class="success-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"> <path d="M20 6L9 17l-5-5"/> </svg> Ajout√© ! `; button.classList.add('success'); setTimeout(() => { this.closeCustomizer(modal); this.showAddToCartFeedback(productId, quantity); }, 1000); } } catch (error) { button.innerHTML=` <svg class="error-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"> <circle cx="12" cy="12" r="10"/> <line x1="15" y1="9" x2="9" y2="15"/> <line x1="9" y1="9" x2="15" y2="15"/> </svg> Erreur-R√©essayer `; button.classList.add('error'); setTimeout(() => { button.innerHTML=originalText; button.disabled=false; button.classList.remove('error'); }, 2000); } } async addToCartWithVariations(productId, quantity, variations, config) { const productData=this.getProductData(productId); const customFields=[]; Object.entries(variations).forEach(([key, value]) => { if (value) { customFields.push({ name: key, value: value }); } }); let finalPrice=config.basePrice; Object.entries(variations).forEach(([key, value]) => { const variation=config.variations.find(v => v.id===value); if (variation && variation.priceModifier) { finalPrice += variation.priceModifier; } }); const configHash=this.generateConfigurationHash(productId, variations); const snipcartProductId=`${productId}_${configHash}`; let productName=productData.name; if (variations.multiplicateur && variations.multiplicateur!=='x1') { productName += ` (${variations.multiplicateur})`; } if (variations.langue && variations.langue!=='fr') { productName += `-English`; } try { window.Snipcart.api.cart.items.add({ id: snipcartProductId, name: productName, price: finalPrice, quantity: quantity, url: window.location.pathname, description: productData.description || '', image: productData.image, customFields: customFields.length > 0 ? customFields : undefined, categories: ['geek-dragon', productData.category || 'pieces'], metadata: { originalProductId: productId, variations: JSON.stringify(variations), configurationHash: configHash } }); this.trackAddToCart(productId, variations, finalPrice, quantity); return true; } catch (error) { return false; } } addToCartDirect(productId, quantity) { const productData=this.getProductData(productId); const config=this.productVariations[productId] || { basePrice: productData.price }; window.Snipcart.api.cart.items.add({ id: productId, name: productData.name, price: config.basePrice, quantity: quantity, url: window.location.pathname, description: productData.description || '', image: productData.image, categories: ['geek-dragon', productData.category || 'pieces'] }); this.trackAddToCart(productId, {}, config.basePrice, quantity); this.showAddToCartFeedback(productId, quantity); } closeCustomizer(modal) { modal.classList.add('closing'); setTimeout(() => { modal.remove(); }, 300); } showAddToCartFeedback(productId, quantity) { const productData=this.getProductData(productId); const notification=document.createElement('div'); notification.className='add-to-cart-notification'; notification.innerHTML=` <div class="notification-content"> <div class="notification-icon"> <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"> <path d="M20 6L9 17l-5-5"/> </svg> </div> <div class="notification-text"> <div class="notification-title">Produit ajout√© !</div> <div class="notification-details">${quantity}x ${productData.name}</div> </div> <button class="notification-close" aria-label="Fermer">√ó</button> </div> `; document.body.appendChild(notification); requestAnimationFrame(() => { notification.classList.add('show'); }); const closeNotification=() => { notification.classList.remove('show'); setTimeout(() => notification.remove(), 300); }; notification.querySelector('.notification-close').addEventListener('click', closeNotification); setTimeout(closeNotification, 4000); } setupSnipcartEvents() { document.addEventListener('snipcart.ready', () => { window.Snipcart.api.session.setLanguage(this.config.locale); window.Snipcart.events.on('cart.opened', () => { this.onCartOpened(); }); window.Snipcart.events.on('cart.closed', () => { this.onCartClosed(); }); window.Snipcart.events.on('item.added', (cartItem) => { this.onItemAdded(cartItem); }); window.Snipcart.events.on('item.removed', (cartItem) => { this.onItemRemoved(cartItem); }); window.Snipcart.events.on('checkout.step.completed', (step) => { this.onCheckoutStepCompleted(step); }); }); } setupAnalytics() { if (!this.config.enableAnalytics) return; if (typeof gtag!=='undefined') { this.gtag=gtag; } if (this.config.enableAbandonmentTracking) { this.setupAbandonmentTracking(); } } setupUIEnhancements() { this.injectCustomStyles(); this.enhanceQuantityControls(); this.setupProductPreviews(); } setupFormValidation() { document.addEventListener('input', (e) => { if (e.target.closest('.gd-product-customizer')) { this.validateCustomField(e.target); } }); } getProductData(productId) { const productCard=document.querySelector(`[data-product-id="${productId}"]`)?.closest('.product-card'); if (productCard) { const img=productCard.querySelector('.product-media'); return { name: productCard.querySelector('.product-title')?.textContent?.trim() || productId, price: parseFloat(productCard.querySelector('.product-price')?.textContent?.replace(/[^\d.]/g, '') || '0'), image: img?.src || img?.dataset?.src || '/images/placeholder.webp', description: productCard.querySelector('.product-description')?.textContent?.trim() || '', category: 'pieces' }; } return { name: productId, price: this.productVariations[productId]?.basePrice || 0, image: '/images/placeholder.webp', description: '', category: 'pieces' }; } getPreviewImage(productId, variationId) { const imageMap={ 'lot10': { 'x1': 'Vagabon', 'x10': 'Vagabonx10', 'x100': 'coin-copper-100', 'x1000': 'coin-copper-1000', 'x10000': 'coin-copper-10000' }, 'lot25': { 'x1': 'all252', 'x10': 'all25x10', 'x100': 'all25x100', 'x1000': 'all25x1000', 'x10000': 'all25x10000' } }; return imageMap[productId]?.[variationId] || 'coin-copper-10'; } getMultiplierDescription(variationId) { const descriptions={ 'x1': 'Finition brillante, sans gravure-aspect neuf', 'x10': 'Gravure nette, finition mate-facilite les calculs x10', 'x100': 'Gravure nette, finition mate-facilite les calculs x100', 'x1000': 'Gravure nette, finition mate-facilite les calculs x1000', 'x10000': 'Gravure nette, finition mate-facilite les calculs x10000' }; return descriptions[variationId] || ''; } generateConfigurationHash(productId, variations) { const configString=productId+JSON.stringify(variations); return btoa(configString).replace(/[^a-zA-Z0-9]/g, '').substr(0, 8); } trackAddToCart(productId, variations, price, quantity) { this.cartAnalytics.addToCartCount++; Object.entries(variations).forEach(([key, value]) => { if (!this.cartAnalytics.variationSelections[key]) { this.cartAnalytics.variationSelections[key]={}; } this.cartAnalytics.variationSelections[key][value]=(this.cartAnalytics.variationSelections[key][value] || 0)+1; }); if (this.gtag) { this.gtag('event', 'add_to_cart', { currency: 'CAD', value: price*quantity, items: [{ item_id: productId, item_name: this.getProductData(productId).name, category: 'JDR_Accessories', quantity: quantity, price: price }] }); } } onCartOpened() { if (this.gtag) { this.gtag('event', 'view_cart', { currency: 'CAD', value: window.Snipcart.api.cart.get().subtotal }); } } onCartClosed() { } onItemAdded(cartItem) { } onItemRemoved(cartItem) { } onCheckoutStepCompleted(step) { this.cartAnalytics.checkoutInitiations++; } setupAbandonmentTracking() { let cartOpenTime=null; window.Snipcart.events.on('cart.opened', () => { cartOpenTime=Date.now(); }); window.Snipcart.events.on('cart.closed', () => { if (cartOpenTime && Date.now()-cartOpenTime > 10000) { const items=window.Snipcart.api.cart.get().items; if (items.length > 0) { this.cartAnalytics.abandonedCarts++; } } }); } injectCustomStyles() { const styles=` <style> .gd-product-customizer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10000; display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; } .gd-product-customizer.active { opacity: 1; visibility: visible; } .gd-product-customizer.closing { opacity: 0; visibility: hidden; } .customizer-backdrop { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(5px); } .customizer-content { background: linear-gradient(145deg, #1e293b 0%, #334155 100%); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 20px; max-width: 600px; max-height: 90vh; width: 90%; position: relative; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5); overflow: hidden; color: white; transform: scale(0.9); transition: transform 0.3s ease; } .gd-product-customizer.active .customizer-content { transform: scale(1); } .customizer-header { padding: 2rem; border-bottom: 1px solid rgba(139, 92, 246, 0.2); display: flex; align-items: center; justify-content: space-between; } .product-info { display: flex; align-items: center; gap: 1rem; } .product-thumbnail { width: 60px; height: 60px; border-radius: 10px; object-fit: cover; } .product-name { font-size: 1.25rem; font-weight: 600; margin: 0 0 0.5rem 0; } .product-price { color: #8b5cf6; font-size: 1.1rem; font-weight: 500; } .quantity-display { color: #94a3b8; font-size: 0.9rem; } .customizer-close { background: none; border: none; color: #94a3b8; cursor: pointer; padding: 0.5rem; border-radius: 50%; transition: all 0.2s ease; } .customizer-close:hover { background: rgba(139, 92, 246, 0.1); color: #8b5cf6; } .customizer-close svg { width: 24px; height: 24px; } .customizer-body { padding: 2rem; max-height: 60vh; overflow-y: auto; } .customizer-section { margin-bottom: 2rem; } .customizer-section-title { display: flex; align-items: center; gap: 0.5rem; font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; color: #f1f5f9; } .customizer-section-title .icon { font-size: 1.2rem; } .multiplier-grid { display: grid; grid-template-columns: 1fr; gap: 1rem; } .multiplier-option { cursor: pointer; transition: all 0.2s ease; } .multiplier-card { border: 2px solid rgba(139, 92, 246, 0.2); border-radius: 12px; padding: 1rem; background: rgba(139, 92, 246, 0.05); transition: all 0.2s ease; display: flex; align-items: center; gap: 1rem; } .multiplier-option:hover .multiplier-card, .multiplier-option.selected .multiplier-card { border-color: #8b5cf6; background: rgba(139, 92, 246, 0.1); transform: translateY(-1px); } .multiplier-option input[type="radio"] { display: none; } .multiplier-label { font-weight: 500; min-width: 200px; } .multiplier-preview img { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; } .multiplier-description { color: #94a3b8; font-size: 0.85rem; flex: 1; } .language-options { display: flex; gap: 1rem; } .language-option { flex: 1; cursor: pointer; } .language-card { border: 2px solid rgba(139, 92, 246, 0.2); border-radius: 12px; padding: 1.5rem; text-align: center; background: rgba(139, 92, 246, 0.05); transition: all 0.2s ease; } .language-option:hover .language-card, .language-option.selected .language-card { border-color: #8b5cf6; background: rgba(139, 92, 246, 0.1); transform: translateY(-2px); } .language-option input[type="radio"] { display: none; } .language-flag { font-size: 2rem; margin-bottom: 0.5rem; } .language-label { font-weight: 500; } .custom-field { margin-bottom: 1rem; } .custom-field label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: #f1f5f9; } .custom-field input, .custom-field textarea { width: 100%; padding: 0.75rem; border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 8px; background: rgba(0, 0, 0, 0.2); color: white; font-size: 1rem; transition: border-color 0.2s ease; } .custom-field input:focus, .custom-field textarea:focus { outline: none; border-color: #8b5cf6; } .custom-field textarea { resize: vertical; min-height: 80px; } .customizer-footer { padding: 2rem; border-top: 1px solid rgba(139, 92, 246, 0.2); background: rgba(139, 92, 246, 0.05); } .total-price { text-align: center; font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem; } .price-amount { color: #8b5cf6; } .customizer-actions { display: flex; gap: 1rem; justify-content: center; } .customizer-actions button { padding: 0.75rem 2rem; border-radius: 8px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 0.5rem; border: none; } .btn-cancel { background: rgba(148, 163, 184, 0.1); color: #94a3b8; border: 1px solid rgba(148, 163, 184, 0.3); } .btn-cancel:hover { background: rgba(148, 163, 184, 0.2); color: white; } .btn-add-to-cart { background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%); color: white; } .btn-add-to-cart:hover:not(:disabled) { background: linear-gradient(135deg, #7c3aed 0%, #9333ea 100%); transform: translateY(-1px); } .btn-add-to-cart:disabled { opacity: 0.7; cursor: not-allowed; transform: none; } .btn-add-to-cart.success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); } .btn-add-to-cart.error { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); } .btn-add-to-cart svg { width: 18px; height: 18px; } .loading-spinner { animation: spin 1s linear infinite; } @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } } .add-to-cart-notification { position: fixed; top: 2rem; right: 2rem; z-index: 9999; background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border-radius: 12px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3); transform: translateX(100%); transition: transform 0.3s ease; max-width: 350px; } .add-to-cart-notification.show { transform: translateX(0); } .notification-content { display: flex; align-items: center; gap: 1rem; padding: 1rem 1.5rem; } .notification-icon svg { width: 24px; height: 24px; } .notification-title { font-weight: 600; margin-bottom: 0.25rem; } .notification-details { opacity: 0.9; font-size: 0.9rem; } .notification-close { background: none; border: none; color: white; cursor: pointer; font-size: 1.5rem; margin-left: auto; opacity: 0.7; transition: opacity 0.2s ease; } .notification-close:hover { opacity: 1; } @media (max-width: 768px) { .customizer-content { width: 95%; max-height: 95vh; } .customizer-header, .customizer-body, .customizer-footer { padding: 1.5rem; } .product-info { flex-direction: column; align-items: flex-start; gap: 0.5rem; } .language-options { flex-direction: column; } .multiplier-card { flex-direction: column; text-align: center; } .multiplier-label { min-width: auto; } .customizer-actions { flex-direction: column; } .add-to-cart-notification { top: 1rem; right: 1rem; left: 1rem; max-width: none; } } </style> `; document.head.insertAdjacentHTML('beforeend', styles); } enhanceQuantityControls() { } setupProductPreviews() { document.addEventListener('mouseenter', (e) => { const productCard=e.target.closest('.product-card'); if (productCard) { const video=productCard.querySelector('video[data-src]'); if (video && !video.src) { video.src=video.dataset.src; video.play(); } } }, true); } validateCustomField(field) { const isValid=field.checkValidity(); if (isValid) { field.style.borderColor='rgba(139, 92, 246, 0.3)'; } else { field.style.borderColor='#ef4444'; } return isValid; } getAnalytics() { return this.cartAnalytics; } getConfiguration(productId) { return this.productVariations[productId]; } updateConfiguration(productId, config) { this.productVariations[productId]={ ...this.productVariations[productId], ...config }; } } document.addEventListener('DOMContentLoaded', () => { window.GeeknDragonSnipcart=new EnhancedSnipcartIntegration(); if (window.location.hostname==='localhost') { window._debugSnipcart=window.GeeknDragonSnipcart; } }); })();
/* Source: intelligent-preloader.js */
(function() { 'use strict'; class IntelligentPreloader { constructor() { this.preloadQueue=new Set(); this.preloadCache=new Map(); this.userBehavior={ scrollSpeed: 0, timeOnPage: 0, interactions: 0, hoverTargets: new Set(), clickPatterns: [] }; this.config={ maxConcurrentPreloads: 3, preloadBudget: 5000000, connectionThreshold: 'fast', viewportMargin: '200px', hoverDelay: 150, idleTimeout: 2000 }; this.statistics={ preloadsExecuted: 0, preloadHits: 0, bytesPreloaded: 0, timeSaved: 0 }; this.resourcePriorities={ 'critical-page': 100, 'likely-next': 80, 'product-image': 70, 'product-page': 60, 'category': 50, 'media': 40, 'checkout': 90 }; this.init(); } async init() { await this.analyzeNetworkCapabilities(); this.startBehaviorAnalysis(); this.preloadCriticalResources(); this.setupPredictiveObservers(); this.initializeMLPatterns(); this.setupIdlePreloading(); } async analyzeNetworkCapabilities() { if ('connection' in navigator) { const conn=navigator.connection; this.networkInfo={ effectiveType: conn.effectiveType, downlink: conn.downlink, rtt: conn.rtt, saveData: conn.saveData }; this.adjustPreloadBudget(); conn.addEventListener('change', () => { this.analyzeNetworkCapabilities(); }); } else { await this.estimateConnectionSpeed(); } } adjustPreloadBudget() { const conn=this.networkInfo; if (conn.saveData) { this.config.preloadBudget=1000000; this.config.maxConcurrentPreloads=1; } else if (conn.effectiveType==='slow-2g' || conn.effectiveType==='2g') { this.config.preloadBudget=2000000; this.config.maxConcurrentPreloads=1; } else if (conn.effectiveType==='3g') { this.config.preloadBudget=3000000; this.config.maxConcurrentPreloads=2; } else if (conn.effectiveType==='4g') { this.config.preloadBudget=8000000; this.config.maxConcurrentPreloads=4; } } async estimateConnectionSpeed() { const testImage='/images/favicon.png?preload_test='+Date.now(); const startTime=performance.now(); try { await this.loadImage(testImage); const loadTime=performance.now()-startTime; if (loadTime < 200) { this.config.connectionThreshold='fast'; this.config.preloadBudget=8000000; } else if (loadTime < 500) { this.config.connectionThreshold='medium'; this.config.preloadBudget=4000000; } else { this.config.connectionThreshold='slow'; this.config.preloadBudget=1000000; } } catch (e) { this.config.connectionThreshold='slow'; this.config.preloadBudget=1000000; } } preloadCriticalResources() { const criticalResources=this.identifyCriticalResources(); criticalResources.forEach(resource => { this.schedulePreload(resource, 'critical-page'); }); } identifyCriticalResources() { const resources=[]; const currentPath=window.location.pathname; if (currentPath==='/' || currentPath==='/index.php') { resources.push({ url: '/boutique.php', type: 'document', reason: 'Homepage to shop flow' }); resources.push({ url: '/images/optimized-modern/webp/hero-boutique.webp', type: 'image', reason: 'Shop hero image' }); } if (currentPath.includes('boutique')) { const popularProducts=this.getPopularProducts(); popularProducts.forEach(product => { resources.push({ url: product.image, type: 'image', reason: `Popular product: ${product.name}` }); }); } if (this.isProductPage()) { resources.push({ url: this.getSnipcartCheckoutAssets(), type: 'script', reason: 'Checkout flow preparation' }); } return resources; } getPopularProducts() { return [ { name: 'Lot de 10 pi√®ces', image: '/images/optimized-modern/webp/lot10-hero.webp' }, { name: 'Lot de 25 pi√®ces', image: '/images/optimized-modern/webp/lot25-hero.webp' }, { name: 'Pack Arsenal Aventurier', image: '/images/optimized-modern/webp/pack-arsenal-hero.webp' } ]; } startBehaviorAnalysis() { let lastScrollY=window.scrollY; let scrollMeasurements=[]; window.addEventListener('scroll', () => { const currentScrollY=window.scrollY; const scrollDelta=Math.abs(currentScrollY-lastScrollY); scrollMeasurements.push(scrollDelta); if (scrollMeasurements.length > 10) { scrollMeasurements=scrollMeasurements.slice(-10); } this.userBehavior.scrollSpeed=scrollMeasurements.reduce((a, b) => a+b, 0)/scrollMeasurements.length; lastScrollY=currentScrollY; this.predictScrollBasedContent(currentScrollY, lastScrollY); }, { passive: true }); setInterval(() => { this.userBehavior.timeOnPage += 1000; }, 1000); ['click', 'keydown', 'touch'].forEach(eventType => { document.addEventListener(eventType, () => { this.userBehavior.interactions++; }); }); } predictScrollBasedContent(currentY, previousY) { const direction=currentY > previousY ? 'down' : 'up'; const scrollPercent=(currentY/(document.body.scrollHeight-window.innerHeight))*100; if (direction==='down' && scrollPercent > 70) { this.preloadFooterLinks(); } if (this.userBehavior.scrollSpeed > 50) { this.preloadViewportImages(400); } } setupPredictiveObservers() { this.setupViewportPreloader(); this.setupHoverPreloader(); this.setupClickPatternAnalysis(); this.setupFocusPrediction(); } setupViewportPreloader() { const observer=new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) { const element=entry.target; const links=element.querySelectorAll('a[href]'); links.forEach(link => { if (this.shouldPreloadLink(link)) { this.schedulePreload({ url: link.href, type: 'document', reason: 'Viewport intersection' }, 'likely-next'); } }); this.preloadNextLazyImages(element); } }); }, { rootMargin: this.config.viewportMargin }); document.querySelectorAll('section, .product-card, .hero-section').forEach(el => { observer.observe(el); }); } setupHoverPreloader() { let hoverTimer; document.addEventListener('mouseenter', (e) => { const link=e.target.closest('a[href]'); const productCard=e.target.closest('.product-card'); if (link || productCard) { hoverTimer=setTimeout(() => { if (link && this.shouldPreloadLink(link)) { this.userBehavior.hoverTargets.add(link.href); this.schedulePreload({ url: link.href, type: 'document', reason: 'Hover intent' }, 'likely-next'); } if (productCard) { this.preloadProductAssets(productCard); } }, this.config.hoverDelay); } }, true); document.addEventListener('mouseleave', (e) => { if (hoverTimer) { clearTimeout(hoverTimer); } }, true); } setupClickPatternAnalysis() { document.addEventListener('click', (e) => { const link=e.target.closest('a[href]'); if (link) { const pattern={ timestamp: Date.now(), source: window.location.pathname, target: link.pathname, element: this.getElementDescriptor(link) }; this.userBehavior.clickPatterns.push(pattern); if (this.userBehavior.clickPatterns.length > 20) { this.userBehavior.clickPatterns=this.userBehavior.clickPatterns.slice(-20); } this.predictNextPageFromPatterns(); } }); } setupFocusPrediction() { document.addEventListener('keydown', (e) => { if (e.key==='Tab') { const focusableElements=this.getFocusableElements(); const currentIndex=focusableElements.indexOf(document.activeElement); const nextIndex=e.shiftKey ? currentIndex-1 : currentIndex+1; if (nextIndex >= 0 && nextIndex < focusableElements.length) { const nextElement=focusableElements[nextIndex]; if (nextElement.tagName==='A' && nextElement.href) { this.schedulePreload({ url: nextElement.href, type: 'document', reason: 'Keyboard navigation prediction' }, 'likely-next'); } } } }); } initializeMLPatterns() { this.mlPatterns={ '/': [ { target: '/boutique.php', probability: 0.9, assets: ['shop-images'] } ], '/boutique.php': [ { target: '/lot10', probability: 0.7, assets: ['product-images', 'checkout-flow'] }, { target: '/lot25', probability: 0.6, assets: ['product-images', 'checkout-flow'] }, { target: '/pack-arsenal', probability: 0.5, assets: ['product-images'] } ], '/lot10': [ { target: 'checkout-flow', probability: 0.4, assets: ['snipcart-assets'] } ], '/lot25': [ { target: 'checkout-flow', probability: 0.4, assets: ['snipcart-assets'] } ] }; this.applyMLPredictions(); } applyMLPredictions() { const currentPath=window.location.pathname; const patterns=this.mlPatterns[currentPath]; if (!patterns) return; patterns.forEach(pattern => { if (pattern.probability > 0.6) { setTimeout(() => { if (pattern.target.startsWith('/')) { this.schedulePreload({ url: pattern.target, type: 'document', reason: `ML prediction (${Math.round(pattern.probability*100)}%)` }, 'likely-next'); } if (pattern.assets) { pattern.assets.forEach(assetType => { this.preloadAssetsByType(assetType); }); } }, 1000); } }); } setupIdlePreloading() { let idleTimer; let isIdle=false; const resetIdleTimer=() => { clearTimeout(idleTimer); isIdle=false; idleTimer=setTimeout(() => { isIdle=true; this.executeIdlePreloading(); }, this.config.idleTimeout); }; ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(eventType => { document.addEventListener(eventType, resetIdleTimer, { passive: true }); }); resetIdleTimer(); } executeIdlePreloading() { const idleQueue=[ ...this.getPredictedNextPages(), ...this.getPopularPageAssets(), ...this.getSeasonalContent() ]; idleQueue.forEach((resource, index) => { setTimeout(() => { if (this.isStillIdle()) { this.schedulePreload(resource, 'idle-time'); } }, index*500); }); } schedulePreload(resource, priority) { const resourceKey=`${resource.type}:${resource.url}`; if (this.preloadCache.has(resourceKey)) return; if (!this.hasPreloadBudget()) return; const preloadItem={ ...resource, priority: this.resourcePriorities[priority] || 50, scheduledAt: Date.now(), key: resourceKey }; this.preloadQueue.add(preloadItem); this.processPreloadQueue(); } async processPreloadQueue() { const sortedQueue=Array.from(this.preloadQueue).sort((a, b) => b.priority-a.priority); const activePreloads=Array.from(this.preloadQueue).filter(item => item.loading); if (activePreloads.length >= this.config.maxConcurrentPreloads) return; for (const item of sortedQueue.slice(0, this.config.maxConcurrentPreloads)) { if (item.loading) continue; item.loading=true; try { await this.executePreload(item); this.preloadQueue.delete(item); this.preloadCache.set(item.key, { loadedAt: Date.now(), success: true }); this.statistics.preloadsExecuted++; } catch (e) { this.preloadQueue.delete(item); this.preloadCache.set(item.key, { loadedAt: Date.now(), success: false, error: e.message }); } } } async executePreload(item) { const startTime=performance.now(); switch (item.type) { case 'document': await this.preloadDocument(item.url); break; case 'image': await this.preloadImage(item.url); break; case 'script': await this.preloadScript(item.url); break; case 'style': await this.preloadStyle(item.url); break; default: await this.preloadGeneric(item.url, item.type); } const loadTime=performance.now()-startTime; this.statistics.timeSaved += Math.max(0, 1000-loadTime); }ms)-${item.reason}`); } async preloadDocument(url) { const link=document.createElement('link'); link.rel='prefetch'; link.href=url; document.head.appendChild(link); return new Promise((resolve) => { link.onload=resolve; link.onerror=resolve; setTimeout(resolve, 2000); }); } async preloadImage(url) { return new Promise((resolve, reject) => { const img=new Image(); img.onload=() => { this.statistics.bytesPreloaded += this.estimateImageSize(img); resolve(); }; img.onerror=reject; img.src=url; }); } async preloadScript(url) { const link=document.createElement('link'); link.rel='preload'; link.as='script'; link.href=url; document.head.appendChild(link); return new Promise((resolve) => { link.onload=resolve; link.onerror=resolve; setTimeout(resolve, 3000); }); } async preloadStyle(url) { const link=document.createElement('link'); link.rel='preload'; link.as='style'; link.href=url; document.head.appendChild(link); return new Promise((resolve) => { link.onload=resolve; link.onerror=resolve; setTimeout(resolve, 2000); }); } async preloadGeneric(url, type) { const link=document.createElement('link'); link.rel='prefetch'; link.href=url; if (type) link.as=type; document.head.appendChild(link); return new Promise((resolve) => { link.onload=resolve; link.onerror=resolve; setTimeout(resolve, 2000); }); } preloadProductAssets(productCard) { const images=productCard.querySelectorAll('img[data-src], img[src]'); images.forEach(img => { const src=img.dataset.src || img.src; if (src && !this.preloadCache.has(`image:${src}`)) { this.schedulePreload({ url: src, type: 'image', reason: 'Product hover' }, 'product-image'); } }); const productLink=productCard.querySelector('a[href]'); if (productLink) { this.schedulePreload({ url: productLink.href, type: 'document', reason: 'Product card hover' }, 'product-page'); } } preloadAssetsByType(assetType) { switch (assetType) { case 'shop-images': this.getPopularProducts().forEach(product => { this.schedulePreload({ url: product.image, type: 'image', reason: 'Shop preparation' }, 'product-image'); }); break; case 'checkout-flow': this.schedulePreload({ url: 'https: type: 'style', reason: 'Checkout preparation' }, 'checkout'); break; case 'snipcart-assets': this.schedulePreload({ url: 'https: type: 'script', reason: 'Checkout preparation' }, 'checkout'); break; } } preloadFooterLinks() { const footer=document.querySelector('footer'); if (!footer) return; const links=footer.querySelectorAll('a[href]'); links.forEach(link => { if (this.shouldPreloadLink(link)) { this.schedulePreload({ url: link.href, type: 'document', reason: 'Footer approach' }, 'likely-next'); } }); } preloadViewportImages(margin=200) { const viewportHeight=window.innerHeight; const scrollY=window.scrollY; const images=document.querySelectorAll('img[data-src]:not([data-preloaded])'); images.forEach(img => { const rect=img.getBoundingClientRect(); const imgTop=rect.top+scrollY; if (imgTop <= scrollY+viewportHeight+margin) { const src=img.dataset.src; if (src) { this.schedulePreload({ url: src, type: 'image', reason: 'Extended viewport' }, 'product-image'); img.dataset.preloaded='true'; } } }); } shouldPreloadLink(link) { const href=link.href; if (!href.startsWith(window.location.origin)) return false; if (href.includes('#')) return false; if (href.includes('utm_') || href.includes('ref=')) return false; const importantPages=['/boutique.php', '/lot10', '/lot25', '/pack-arsenal']; if (importantPages.some(page => href.includes(page))) return true; return true; } predictNextPageFromPatterns() { const recentPatterns=this.userBehavior.clickPatterns.slice(-5); const currentPath=window.location.pathname; const targetCounts={}; recentPatterns.forEach(pattern => { if (pattern.source===currentPath) { targetCounts[pattern.target]=(targetCounts[pattern.target] || 0)+1; } }); const mostLikelyTarget=Object.entries(targetCounts) .sort(([,a], [,b]) => b-a)[0]; if (mostLikelyTarget) { this.schedulePreload({ url: mostLikelyTarget[0], type: 'document', reason: 'Pattern prediction' }, 'likely-next'); } } getPredictedNextPages() { const currentPath=window.location.pathname; const predictions=[]; if (currentPath==='/') { predictions.push({ url: '/boutique.php', type: 'document', reason: 'Homepage to shop prediction' }); } if (currentPath.includes('boutique')) { predictions.push({ url: '/lot10', type: 'document', reason: 'Popular product prediction' }); } return predictions; } getPopularPageAssets() { return [ { url: '/images/optimized-modern/webp/hero-boutique.webp', type: 'image', reason: 'Popular page asset' }, { url: '/css/boutique-style-global.css', type: 'style', reason: 'Shop page styles' } ]; } getSeasonalContent() { const month=new Date().getMonth(); const seasonal=[]; if (month===11 || month===0) { seasonal.push({ url: '/images/seasonal/holiday-banner.webp', type: 'image', reason: 'Holiday season content' }); } return seasonal; } hasPreloadBudget() { return this.statistics.bytesPreloaded < this.config.preloadBudget; } estimateImageSize(img) { const area=img.naturalWidth*img.naturalHeight; return Math.round(area*0.3); } isStillIdle() { return document.hidden || (Date.now()-this.lastInteraction > this.config.idleTimeout); } isProductPage() { return window.location.pathname.includes('lot') || window.location.pathname.includes('pack') || window.location.pathname.includes('triptyque'); } getSnipcartCheckoutAssets() { return [ 'https: 'https: ]; } getElementDescriptor(element) { return { tag: element.tagName.toLowerCase(), classes: Array.from(element.classList), text: element.textContent.trim().substring(0, 50) }; } getFocusableElements() { return Array.from(document.querySelectorAll( 'a[href], button, input, textarea, select, [tabindex]:not([tabindex="-1"])' )); } loadImage(src) { return new Promise((resolve, reject) => { const img=new Image(); img.onload=resolve; img.onerror=reject; img.src=src; }); } preloadNextLazyImages(container) { const lazyImages=container.querySelectorAll('img[data-src]:not([data-preloaded])'); Array.from(lazyImages).slice(0, 3).forEach(img => { this.schedulePreload({ url: img.dataset.src, type: 'image', reason: 'Next lazy images' }, 'product-image'); img.dataset.preloaded='true'; }); } getStatistics() { return { ...this.statistics, cacheSize: this.preloadCache.size, queueSize: this.preloadQueue.size, userBehavior: this.userBehavior, config: this.config, hitRate: this.statistics.preloadsExecuted > 0 ? (this.statistics.preloadHits/this.statistics.preloadsExecuted)*100 : 0 }; } forcePreload(url, type='document', reason='Manual') { this.schedulePreload({ url, type, reason }, 'critical-page'); } getCurrentPredictions() { return { nextPages: this.getPredictedNextPages(), hoverTargets: Array.from(this.userBehavior.hoverTargets), mlPredictions: this.mlPatterns[window.location.pathname] || [] }; } clearCache() { this.preloadCache.clear(); this.preloadQueue.clear(); } } document.addEventListener('DOMContentLoaded', () => { window.GeeknDragonPreloader=new IntelligentPreloader(); if (window.location.hostname==='localhost') { window._debugPreloader=window.GeeknDragonPreloader; setInterval(() => { const stats=window._debugPreloader.getStatistics(); }, 30000); } }); window.addEventListener('beforeunload', () => { const stats=window.GeeknDragonPreloader?.getStatistics(); if (stats && stats.preloadsExecuted > 0) { }ms √©conomis√©s`); } }); })();
/* Source: jdr-chatbot.js */
class JDRChatbot { constructor() { this.isOpen=false; this.conversationHistory=[]; this.userProfile={ experience: null, role: null, interests: [], budget_range: null }; this.knowledgeBase=this.initializeKnowledgeBase(); this.responses=this.initializeResponses(); this.productCatalog=this.initializeProductCatalog(); this.initializeChatbot(); this.bindEvents(); } initializeKnowledgeBase() { return { products: { 'pieces metalliques': { keywords: ['pi√®ce', 'm√©tal', 'm√©tallique', 'monnaie', 'or', 'argent', 'tr√©sor'], response: 'Nos pi√®ces m√©talliques transforment compl√®tement l\'exp√©rience de jeu ! Elles ajoutent un r√©alisme tactile qui immerge vraiment les joueurs. Quelle est votre exp√©rience avec le JDR ?', follow_up: ['experience_level', 'budget_discussion', 'quantity_needed'] }, 'multiplicateurs': { keywords: ['x10', 'x100', 'x1000', 'x10000', 'multiplicateur', 'd√©nomination'], response: 'Nos multiplicateurs permettent de g√©rer facilement toutes les valeurs ! x10 pour les √©changes courants, x100 pour les r√©compenses moyennes, x1000 pour les gros tr√©sors, et x10000 pour les fortunes l√©gendaires. Tous ont une gravure nette et finition mate pour une sensation premium.', follow_up: ['campaign_type', 'player_count', 'budget_discussion'] }, 'qualite': { keywords: ['qualit√©', 'finition', 'gravure', 'durabilit√©', 'fabrication'], response: 'Nos pi√®ces sont fabriqu√©es au Qu√©bec avec une gravure nette et finition mate qui r√©siste √† l\'usage intensif. Elles gardent leur beaut√© m√™me apr√®s des centaines de parties ! C\'est un investissement √† long terme.', follow_up: ['usage_frequency', 'care_instructions'] } }, jdr_advice: { 'debutant': { keywords: ['d√©butant', 'commencer', 'premier', 'nouvelle', 'apprendre'], response: 'Parfait ! Pour d√©buter, je recommande notre lot x10-il couvre 80% des situations de jeu et impressionne sans √™tre intimidant. Voulez-vous des conseils pour votre premi√®re session avec des pi√®ces m√©talliques ?', follow_up: ['first_session_tips', 'mj_or_player'] }, 'intermediaire': { keywords: ['interm√©diaire', 'quelques', 'ann√©es', 'exp√©rience'], response: 'Avec votre exp√©rience, vous allez adorer l\'impact des pi√®ces ! Le combo x10+x100 est id√©al pour enrichir vos parties existantes. Quel type de campagnes menez-vous g√©n√©ralement ?', follow_up: ['campaign_style', 'current_challenges'] }, 'expert': { keywords: ['expert', 'v√©t√©ran', 'ann√©es', 'exp√©riment√©', 'ma√Ætre'], response: 'En tant qu\'expert, vous comprendrez imm√©diatement la valeur ajout√©e ! Beaucoup de MJ exp√©riment√©s optent pour la gamme compl√®te (x10 √† x10000) pour une flexibilit√© totale. Recherchez-vous quelque chose de sp√©cifique ?', follow_up: ['specific_needs', 'advanced_usage'] } }, role_advice: { 'mj': { keywords: ['mj', 'ma√Ætre', 'jeu', 'dm', 'master', 'mener'], response: 'En tant que MJ, ces pi√®ces vont r√©volutionner vos r√©compenses ! Fini les "vous gagnez 500 pi√®ces d\'or" abstraites-maintenant vous pouvez litt√©ralement verser un tr√©sor sur la table. Quel est votre plus grand d√©fi en tant que MJ ?', follow_up: ['mj_challenges', 'party_size', 'reward_frequency'] }, 'joueur': { keywords: ['joueur', 'jouer', 'personnage', 'partie'], response: 'Comme joueur, vous allez vivre une exp√©rience totalement diff√©rente ! Tenir de vraies pi√®ces m√©talliques dans vos mains quand vous pillez un tr√©sor... c\'est magique ! Votre MJ utilise-t-il d√©j√† des accessoires ?', follow_up: ['current_accessories', 'convince_mj', 'gift_suggestion'] }, 'collectionneur': { keywords: ['collection', 'collectionneur', 'accessoire', 'objet'], response: 'Pour un collectionneur, nos pi√®ces repr√©sentent l\'excellence artisanale qu√©b√©coise ! Fabriqu√©es avec soin, elles gardent leur valeur et leur beaut√©. Cherchez-vous une pi√®ce sp√©cifique ou une collection compl√®te ?', follow_up: ['collection_goals', 'display_options', 'investment_value'] } }, usage_scenarios: { 'recompenses': { keywords: ['r√©compense', 'tr√©sor', 'butin', 'gain', 'loot'], response: 'Pour les r√©compenses, rien ne vaut l\'effet dramatique ! Versez les pi√®ces directement sur la table pendant que vous d√©crivez le tr√©sor. Le son m√©tallique ajoute une dimension sensorielle incroyable ! Combien de joueurs avez-vous habituellement ?', follow_up: ['party_size', 'reward_style', 'dramatic_effect'] }, 'economie': { keywords: ['√©conomie', 'commerce', 'marchand', 'acheter', 'vendre'], response: 'Pour une √©conomie immersive, les multiplicateurs sont essentiels ! x10 pour les achats courants, x100 pour l\'√©quipement, x1000 pour les biens rares, x10000 pour les propri√©t√©s. Votre campagne a-t-elle beaucoup d\'√©changes commerciaux ?', follow_up: ['economy_complexity', 'trading_frequency', 'merchant_interactions'] }, 'atmosphere': { keywords: ['atmosph√®re', 'immersion', 'ambiance', 'r√©alisme'], response: 'L\'atmosph√®re, c\'est notre sp√©cialit√© ! Nos pi√®ces transforment l\'abstract en concret. Quand vos joueurs entendent le tintement m√©tallique et sentent le poids r√©el, l\'immersion devient totale. Quel type d\'ambiance recherchez-vous ?', follow_up: ['atmosphere_goals', 'current_methods', 'enhancement_ideas'] } } }; } initializeResponses() { return { greetings: [ 'Salut ! Je suis votre assistant JDR sp√©cialis√©. Comment puis-je enrichir vos parties aujourd\'hui ? üé≤', 'Bonjour ! Pr√™t √† d√©couvrir comment nos pi√®ces m√©talliques vont transformer vos sessions ? ‚öîÔ∏è', 'Hey ! Que diriez-vous d\'ajouter plus de magie √† vos parties ? Je suis l√† pour vous guider ! ‚ú®' ], fallback: [ 'Int√©ressant ! Pouvez-vous m\'en dire plus ? Je suis l√† pour vous aider avec tout ce qui concerne le JDR et nos produits üéØ', 'Je vois ! Pouvez-vous pr√©ciser votre question ? Je connais bien nos pi√®ces et leur utilisation en jeu ü§î', 'Hmm, je n\'ai pas bien saisi. Reformulez-vous pour que je puisse mieux vous aider ? üí≠' ], clarifications: { experience_level: 'Dites-moi, quel est votre niveau d\'exp√©rience en JDR ? D√©butant, interm√©diaire ou expert ?', budget_discussion: 'Quel budget avez-vous en t√™te ? Nos lots vont de 60$ √† 950$ selon vos besoins.', mj_or_player: '√ätes-vous plut√¥t MJ (ma√Ætre de jeu) ou joueur ?', party_size: 'Combien de joueurs avez-vous habituellement dans votre groupe ?', campaign_type: 'Quel type de campagnes pr√©f√©rez-vous ? (Fantasy classique, homebrew, one-shots...)' }, recommendations: { starter: { product: 'lot10', reason: 'Parfait pour d√©buter ! Le lot x10 couvre la majorit√© des situations de jeu et impressionne sans compliquer les calculs.', price: '60$', next_step: 'Une fois que vous aurez vu l\'effet, vous voudrez probablement ajouter le x100 !' }, intermediate: { product: 'lot10+lot100', reason: 'La combinaison id√©ale ! x10 pour le quotidien, x100 pour les r√©compenses marquantes.', price: '110$', next_step: 'Cette base couvre 95% des besoins. Vous pourrez toujours ajouter les gros multiplicateurs plus tard.' }, complete: { product: 'collection_complete', reason: 'La collection compl√®te pour une flexibilit√© totale ! Tous les multiplicateurs de x10 √† x10000.', price: '950$', next_step: 'Investissement √† long terme qui transformera d√©finitivement vos parties.' } } }; } initializeProductCatalog() { return { lot10: { name: 'Lot de 10 pi√®ces m√©talliques (x10)', price: 60, description: '10 pi√®ces m√©talliques avec gravure nette et finition mate', best_for: ['d√©butants', 'd√©couverte', 'sessions courtes'], use_cases: ['achats courants', 'r√©compenses de base', 'initiation'] }, lot100: { name: 'Lot de 10 pi√®ces m√©talliques (x100)', price: 60, description: '10 pi√®ces m√©talliques x100 avec gravure nette et finition mate', best_for: ['interm√©diaires', 'r√©compenses moyennes'], use_cases: ['√©quipement', 'services', 'r√©compenses de qu√™te'] }, lot1000: { name: 'Lot de 10 pi√®ces m√©talliques (x1000)', price: 60, description: '10 pi√®ces m√©talliques x1000 avec gravure nette et finition mate', best_for: ['experts', 'gros tr√©sors', 'campagnes longues'], use_cases: ['tr√©sors importants', 'r√©compenses majeures', 'commerce de luxe'] }, lot10000: { name: 'Lot de 10 pi√®ces m√©talliques (x10000)', price: 60, description: '10 pi√®ces m√©talliques x10000 avec gravure nette et finition mate', best_for: ['experts', 'fortunes l√©gendaires'], use_cases: ['royaumes', 'fortunes dragon', 'propri√©t√©s majeures'] } }; } initializeChatbot() { this.createChatbotHTML(); this.injectChatbotStyles(); this.startAutoGreeting(); } bindEvents() { document.addEventListener('DOMContentLoaded', () => { this.attachEventListeners(); }); this.observeUserBehavior(); } createChatbotHTML() { const chatbotContainer=document.createElement('div'); chatbotContainer.className='jdr-chatbot-container'; chatbotContainer.innerHTML=` <!-- Bouton d'ouverture flottant --> <div class="chatbot-trigger" id="chatbot-trigger"> <div class="trigger-icon"> <i class="fas fa-dice-d20"></i> </div> <div class="trigger-notification" id="trigger-notification"> <span>Une question JDR ?</span> </div> </div> <!-- Interface du chatbot --> <div class="chatbot-interface" id="chatbot-interface"> <div class="chatbot-header"> <div class="chatbot-avatar"> <i class="fas fa-hat-wizard"></i> </div> <div class="chatbot-info"> <h3>Assistant JDR</h3> <p class="chatbot-status">En ligne-Pr√™t √† vous aider !</p> </div> <button class="chatbot-close" id="chatbot-close"> <i class="fas fa-times"></i> </button> </div> <div class="chatbot-messages" id="chatbot-messages"> <div class="message bot-message welcome-message"> <div class="message-avatar"> <i class="fas fa-hat-wizard"></i> </div> <div class="message-content"> <p>Salut ! Je suis votre assistant JDR sp√©cialis√©. Comment puis-je enrichir vos parties aujourd'hui ? üé≤</p> <div class="quick-options"> <button class="quick-option" data-action="product_advice"> üí∞ Conseils produits </button> <button class="quick-option" data-action="jdr_tips"> üé≠ Conseils JDR </button> <button class="quick-option" data-action="budget_help"> üíé Aide budget </button> </div> </div> </div> </div> <div class="chatbot-input-area"> <div class="input-container"> <input type="text" id="chatbot-input" placeholder="Posez votre question..." maxlength="500"> <button id="chatbot-send"> <i class="fas fa-paper-plane"></i> </button> </div> <div class="chatbot-typing" id="chatbot-typing"> <span></span> <span></span> <span></span> </div> </div> <div class="chatbot-footer"> <p>Propuls√© par l'expertise JDR GeeknDragon üá®üá¶</p> </div> </div> `; document.body.appendChild(chatbotContainer); } attachEventListeners() { const trigger=document.getElementById('chatbot-trigger'); const closeBtn=document.getElementById('chatbot-close'); const sendBtn=document.getElementById('chatbot-send'); const input=document.getElementById('chatbot-input'); trigger?.addEventListener('click', () => this.toggleChatbot()); closeBtn?.addEventListener('click', () => this.closeChatbot()); sendBtn?.addEventListener('click', () => this.sendMessage()); input?.addEventListener('keypress', (e) => { if (e.key==='Enter') this.sendMessage(); }); document.addEventListener('click', (e) => { if (e.target.classList.contains('quick-option')) { this.handleQuickOption(e.target.dataset.action); } }); } observeUserBehavior() { let timeOnSite=0; let productViews=0; let scrollDepth=0; setInterval(() => { timeOnSite += 1; if (timeOnSite===30 && !this.hasInteracted()) { this.showAutoPrompt('Besoin d\'aide pour choisir vos pi√®ces ? üí°'); } }, 1000); const productElements=document.querySelectorAll('.product-card, .product-item'); if (productElements.length > 0) { const observer=new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) { productViews++; if (productViews===3 && !this.hasInteracted()) { this.showAutoPrompt('Questions sur nos produits ? Je peux vous conseiller ! üéØ'); } } }); }, { threshold: 0.5 }); productElements.forEach(el => observer.observe(el)); } window.addEventListener('scroll', () => { const scrollPercent=(window.scrollY/(document.body.scrollHeight-window.innerHeight))*100; if (scrollPercent > 80 && !this.hasInteracted()) { this.showAutoPrompt('Vous cherchez quelque chose de sp√©cifique ? üîç'); } }); } toggleChatbot() { const chatInterface=document.getElementById('chatbot-interface'); const trigger=document.getElementById('chatbot-trigger'); if (!this.isOpen) { this.openChatbot(); } else { this.closeChatbot(); } } openChatbot() { const chatInterface=document.getElementById('chatbot-interface'); const trigger=document.getElementById('chatbot-trigger'); chatInterface.classList.add('active'); trigger.classList.add('hidden'); this.isOpen=true; this.focusInput(); this.trackChatbotOpen(); } closeChatbot() { const chatInterface=document.getElementById('chatbot-interface'); const trigger=document.getElementById('chatbot-trigger'); chatInterface.classList.remove('active'); trigger.classList.remove('hidden'); this.isOpen=false; this.trackChatbotClose(); } sendMessage() { const input=document.getElementById('chatbot-input'); const message=input.value.trim(); if (!message) return; this.addUserMessage(message); input.value=''; this.showTypingIndicator(); setTimeout(() => { this.processMessage(message); this.hideTypingIndicator(); }, 1000+Math.random()*1000); } addUserMessage(message) { const messagesContainer=document.getElementById('chatbot-messages'); const messageDiv=document.createElement('div'); messageDiv.className='message user-message'; messageDiv.innerHTML=` <div class="message-content"> <p>${this.escapeHtml(message)}</p> </div> <div class="message-time">${this.getCurrentTime()}</div> `; messagesContainer.appendChild(messageDiv); this.scrollToBottom(); this.conversationHistory.push({ type: 'user', content: message, timestamp: Date.now() }); } addBotMessage(message, options={}) { const messagesContainer=document.getElementById('chatbot-messages'); const messageDiv=document.createElement('div'); messageDiv.className='message bot-message'; let quickOptionsHtml=''; if (options.quickOptions) { quickOptionsHtml=` <div class="quick-options"> ${options.quickOptions.map(option => ` <button class="quick-option" data-action="${option.action}"> ${option.icon} ${option.text} </button> `).join('')} </div> `; } let productRecommendationHtml=''; if (options.productRecommendation) { const product=options.productRecommendation; productRecommendationHtml=` <div class="product-recommendation"> <h4>üí° Recommandation</h4> <div class="recommended-product"> <h5>${product.name}</h5> <p class="product-price">${product.price}$</p> <p class="product-reason">${product.reason}</p> <a href="/boutique.php#${product.product}" class="btn-view-product"> Voir le produit <i class="fas fa-external-link-alt"></i> </a> </div> </div> `; } messageDiv.innerHTML=` <div class="message-avatar"> <i class="fas fa-hat-wizard"></i> </div> <div class="message-content"> <p>${message}</p> ${productRecommendationHtml} ${quickOptionsHtml} </div> <div class="message-time">${this.getCurrentTime()}</div> `; messagesContainer.appendChild(messageDiv); this.scrollToBottom(); this.conversationHistory.push({ type: 'bot', content: message, timestamp: Date.now(), options: options }); } processMessage(message) { const lowerMessage=message.toLowerCase(); const analysis=this.analyzeMessage(lowerMessage); this.updateUserProfile(analysis); const response=this.generateResponse(analysis, message); this.addBotMessage(response.message, response.options); this.trackUserMessage(message, analysis); } analyzeMessage(message) { const analysis={ intent: 'unknown', entities: [], confidence: 0, keywords: [], sentiment: 'neutral' }; const intents={ 'product_inquiry': ['pi√®ce', 'lot', 'produit', 'acheter', 'prix', 'co√ªt'], 'jdr_advice': ['conseil', 'comment', 'utiliser', 'mj', 'joueur', 'partie', 'session'], 'experience_level': ['d√©butant', 'nouveau', 'expert', 'exp√©rience', 'premi√®re'], 'budget_question': ['budget', 'prix', 'co√ªt', 'cher', 'abordable', '√©conomique'], 'technical_specs': ['qualit√©', 'mat√©riau', 'fabrication', 'durabilit√©', 'finition'], 'greeting': ['salut', 'bonjour', 'hello', 'bonsoir'], 'comparison': ['versus', 'vs', 'comparer', 'diff√©rence', 'mieux'] }; let highestScore=0; Object.entries(intents).forEach(([intent, keywords]) => { const matches=keywords.filter(keyword => message.includes(keyword)); const score=matches.length/keywords.length; if (score > highestScore) { highestScore=score; analysis.intent=intent; analysis.confidence=score; analysis.keywords=matches; } }); const budgetMatch=message.match(/(\d+)\s*\$/); if (budgetMatch) { analysis.entities.push({ type: 'budget', value: parseInt(budgetMatch[1]) }); } const playerCountMatch=message.match(/(\d+)\s*(joueur|player)/); if (playerCountMatch) { analysis.entities.push({ type: 'player_count', value: parseInt(playerCountMatch[1]) }); } return analysis; } generateResponse(analysis, originalMessage) { let response={ message: '', options: {} }; switch (analysis.intent) { case 'greeting': response.message=this.getRandomResponse('greetings'); response.options.quickOptions=[ { action: 'product_advice', icon: 'üí∞', text: 'Conseils produits' }, { action: 'jdr_tips', icon: 'üé≠', text: 'Conseils JDR' }, { action: 'experience_check', icon: '‚≠ê', text: 'Mon niveau' } ]; break; case 'product_inquiry': response=this.handleProductInquiry(analysis); break; case 'jdr_advice': response=this.handleJDRAdvice(analysis); break; case 'budget_question': response=this.handleBudgetQuestion(analysis); break; case 'experience_level': response=this.handleExperienceLevel(analysis); break; case 'technical_specs': response.message='Nos pi√®ces sont fabriqu√©es au Qu√©bec avec une gravure nette et finition mate premium. Elles r√©sistent √† l\'usage intensif et gardent leur beaut√© apr√®s des centaines de parties ! Le poids et la texture ajoutent un r√©alisme tactile incomparable. Avez-vous des questions sp√©cifiques sur la fabrication ?'; response.options.quickOptions=[ { action: 'durability_info', icon: 'üõ°Ô∏è', text: 'Durabilit√©' }, { action: 'quebec_made', icon: 'üá®üá¶', text: 'Fait au Qu√©bec' }, { action: 'care_instructions', icon: '‚ú®', text: 'Entretien' } ]; break; default: response=this.handleUnknownQuery(analysis, originalMessage); } return response; } handleProductInquiry(analysis) { const budgetEntity=analysis.entities.find(e => e.type==='budget'); const playerEntity=analysis.entities.find(e => e.type==='player_count'); if (budgetEntity && budgetEntity.value < 60) { return { message: `Je comprends votre budget de ${budgetEntity.value}$. Nos pi√®ces commencent √† 60$ pour le lot x10. C'est un investissement qui transforme litt√©ralement l'exp√©rience de jeu ! Voulez-vous savoir pourquoi √ßa vaut chaque dollar ?`, options: { quickOptions: [ { action: 'value_explanation', icon: 'üí°', text: 'Pourquoi √ßa vaut le coup' }, { action: 'alternatives', icon: 'üîÑ', text: 'Autres options' }, { action: 'payment_plans', icon: 'üí≥', text: 'Plans de paiement' } ] } }; } if (!this.userProfile.experience) { return { message: 'Parfait ! Pour bien vous conseiller, quel est votre niveau d\'exp√©rience en JDR ? Cela m\'aidera √† recommander le lot id√©al pour vos besoins.', options: { quickOptions: [ { action: 'set_beginner', icon: 'üå±', text: 'D√©butant' }, { action: 'set_intermediate', icon: '‚öîÔ∏è', text: 'Interm√©diaire' }, { action: 'set_expert', icon: 'üëë', text: 'Expert' } ] } }; } return this.getRecommendationBasedOnProfile(); } handleJDRAdvice(analysis) { if (analysis.keywords.includes('mj')) { return { message: 'En tant que MJ, ces pi√®ces vont r√©volutionner vos r√©compenses ! Mon conseil : commencez par d√©crire le tr√©sor de mani√®re √©pique, puis versez litt√©ralement les pi√®ces sur la table. L\'effet sonore et visuel cr√©√© une immersion totale ! Quel est votre plus grand d√©fi en tant que MJ ?', options: { quickOptions: [ { action: 'reward_techniques', icon: 'üèÜ', text: 'Techniques de r√©compenses' }, { action: 'dramatic_effects', icon: 'üé≠', text: 'Effets dramatiques' }, { action: 'economy_management', icon: 'üí∞', text: 'Gestion √©conomie' } ] } }; } return { message: 'Excellent ! Les pi√®ces m√©talliques transforment compl√®tement l\'exp√©rience JDR. Elles ajoutent une dimension tactile et auditive qui rend chaque r√©compense memorable. √ätes-vous plut√¥t joueur ou MJ ?', options: { quickOptions: [ { action: 'set_player', icon: 'üé≤', text: 'Je suis joueur' }, { action: 'set_mj', icon: 'üëë', text: 'Je suis MJ' }, { action: 'both_roles', icon: 'üîÑ', text: 'Les deux' } ] } }; } handleBudgetQuestion(analysis) { const budgetEntity=analysis.entities.find(e => e.type==='budget'); return { message: 'Nos lots sont con√ßus pour tous les budgets ! Lot x10 (60$) pour d√©buter, combo x10+x100 (120$) pour une base solide, ou collection compl√®te (950$) pour une flexibilit√© totale. Quel est votre budget approximatif ?', options: { quickOptions: [ { action: 'budget_60', icon: 'üå±', text: '~60$ (Starter)' }, { action: 'budget_120', icon: '‚öîÔ∏è', text: '~120$ (√âquilibr√©)' }, { action: 'budget_300+', icon: 'üëë', text: '300$+ (Complet)' } ], productRecommendation: this.responses.recommendations.starter } }; } handleExperienceLevel(analysis) { if (analysis.keywords.includes('d√©butant') || analysis.keywords.includes('nouveau')) { this.userProfile.experience='debutant'; return { message: 'Parfait pour d√©buter ! Le lot x10 est id√©al-il couvre 80% des situations sans compliquer les calculs. L\'impact sur vos joueurs sera imm√©diat ! √ätes-vous MJ ou joueur ?', options: { productRecommendation: this.responses.recommendations.starter, quickOptions: [ { action: 'beginner_tips', icon: 'üí°', text: 'Conseils d√©butant' }, { action: 'first_session', icon: 'üéØ', text: 'Premi√®re session' } ] } }; } return { message: 'Dites-moi votre niveau d\'exp√©rience pour que je puisse vous conseiller au mieux !', options: { quickOptions: [ { action: 'set_beginner', icon: 'üå±', text: 'D√©butant' }, { action: 'set_intermediate', icon: '‚öîÔ∏è', text: 'Interm√©diaire' }, { action: 'set_expert', icon: 'üëë', text: 'Expert' } ] } }; } handleUnknownQuery(analysis, originalMessage) { const keywords=originalMessage.toLowerCase().split(' '); const allKnowledge={ ...this.knowledgeBase.products, ...this.knowledgeBase.jdr_advice }; let bestMatch=null; let bestScore=0; Object.entries(allKnowledge).forEach(([key, data]) => { const matches=keywords.filter(word => data.keywords.some(keyword => keyword.includes(word) || word.includes(keyword)) ); const score=matches.length/keywords.length; if (score > bestScore && score > 0.2) { bestScore=score; bestMatch=data; } }); if (bestMatch) { return { message: bestMatch.response, options: { quickOptions: bestMatch.follow_up?.map(action => ({ action: action, icon: this.getIconForAction(action), text: this.getTextForAction(action) })) || [] } }; } return { message: this.getRandomResponse('fallback'), options: { quickOptions: [ { action: 'product_advice', icon: 'üí∞', text: 'Conseils produits' }, { action: 'jdr_tips', icon: 'üé≠', text: 'Conseils JDR' }, { action: 'contact_human', icon: 'üë®‚Äçüíº', text: 'Parler √† un humain' } ] } }; } handleQuickOption(action) { let response={ message: '', options: {} }; switch (action) { case 'product_advice': response.message='Excellent ! Pour bien vous conseiller, parlez-moi de votre exp√©rience JDR et du type de parties que vous menez.'; response.options.quickOptions=[ { action: 'experience_check', icon: '‚≠ê', text: 'Mon niveau' }, { action: 'party_info', icon: 'üë•', text: 'Mon groupe' }, { action: 'budget_help', icon: 'üíé', text: 'Mon budget' } ]; break; case 'set_beginner': this.userProfile.experience='debutant'; response.message='Parfait ! En tant que d√©butant, je recommande fortement de commencer par notre lot x10. Il est parfait pour d√©couvrir l\'impact des pi√®ces m√©talliques sans compliquer vos parties.'; response.options.productRecommendation=this.responses.recommendations.starter; break; case 'set_intermediate': this.userProfile.experience='intermediaire'; response.message='Excellent ! Avec votre exp√©rience, la combinaison x10+x100 sera parfaite. Vous couvrirez 95% des situations et impressionnerez vos joueurs !'; response.options.productRecommendation=this.responses.recommendations.intermediate; break; case 'set_expert': this.userProfile.experience='expert'; response.message='Fantastique ! En tant qu\'expert, vous appr√©cierez la flexibilit√© totale de notre gamme compl√®te. Beaucoup de MJ exp√©riment√©s optent pour tous les multiplicateurs.'; response.options.productRecommendation=this.responses.recommendations.complete; break; case 'budget_60': response.message='Parfait ! Avec 60$, le lot x10 est exactement ce qu\'il vous faut. C\'est le choix le plus populaire et il transformera d√©j√† compl√®tement vos parties !'; response.options.productRecommendation=this.responses.recommendations.starter; break; case 'contact_human': response.message='Bien s√ªr ! Pour une assistance personnalis√©e, contactez notre √©quipe √† info@geekndragon.com ou appelez-nous. Nous sommes des passionn√©s de JDR comme vous ! üá®üá¶'; break; default: response.message='Int√©ressant ! Pouvez-vous m\'en dire plus sur ce que vous recherchez ?'; } this.addBotMessage(response.message, response.options); } updateUserProfile(analysis) { const budgetEntity=analysis.entities.find(e => e.type==='budget'); if (budgetEntity) { this.userProfile.budget_range=budgetEntity.value; } const playerEntity=analysis.entities.find(e => e.type==='player_count'); if (playerEntity) { this.userProfile.party_size=playerEntity.value; } if (analysis.keywords.includes('mj')) { this.userProfile.role='mj'; } else if (analysis.keywords.includes('joueur')) { this.userProfile.role='joueur'; } localStorage.setItem('jdr_chatbot_profile', JSON.stringify(this.userProfile)); } getRecommendationBasedOnProfile() { let recommendation=this.responses.recommendations.starter; if (this.userProfile.experience==='expert') { recommendation=this.responses.recommendations.complete; } else if (this.userProfile.experience==='intermediaire') { recommendation=this.responses.recommendations.intermediate; } return { message: `Bas√© sur votre profil, voici ma recommandation : ${recommendation.reason}`, options: { productRecommendation: recommendation, quickOptions: [ { action: 'why_this_choice', icon: '‚ùì', text: 'Pourquoi ce choix ?' }, { action: 'see_alternatives', icon: 'üîÑ', text: 'Voir alternatives' }, { action: 'add_to_cart', icon: 'üõí', text: 'Ajouter au panier' } ] } }; } getRandomResponse(category) { const responses=this.responses[category]; return responses[Math.floor(Math.random()*responses.length)]; } getIconForAction(action) { const icons={ 'experience_level': '‚≠ê', 'budget_discussion': 'üíé', 'party_size': 'üë•', 'campaign_type': 'üó∫Ô∏è', 'mj_or_player': 'üé≠', 'first_session_tips': 'üéØ', 'value_explanation': 'üí°', 'contact_human': 'üë®‚Äçüíº' }; return icons[action] || 'üí´'; } getTextForAction(action) { const texts={ 'experience_level': 'Mon niveau', 'budget_discussion': 'Budget', 'party_size': 'Taille groupe', 'campaign_type': 'Type campagne', 'mj_or_player': 'Mon r√¥le', 'first_session_tips': 'Premiers conseils', 'value_explanation': 'Pourquoi investir', 'contact_human': 'Aide humaine' }; return texts[action] || 'En savoir plus'; } showTypingIndicator() { const typing=document.getElementById('chatbot-typing'); typing.style.display='flex'; this.scrollToBottom(); } hideTypingIndicator() { const typing=document.getElementById('chatbot-typing'); typing.style.display='none'; } scrollToBottom() { const messagesContainer=document.getElementById('chatbot-messages'); setTimeout(() => { messagesContainer.scrollTop=messagesContainer.scrollHeight; }, 100); } focusInput() { setTimeout(() => { const input=document.getElementById('chatbot-input'); input?.focus(); }, 300); } getCurrentTime() { return new Date().toLocaleTimeString('fr-CA', { hour: '2-digit', minute: '2-digit' }); } escapeHtml(text) { const div=document.createElement('div'); div.textContent=text; return div.innerHTML; } hasInteracted() { return this.conversationHistory.length > 0 || this.isOpen; } showAutoPrompt(message) { const notification=document.getElementById('trigger-notification'); if (notification && !this.hasInteracted()) { notification.querySelector('span').textContent=message; notification.classList.add('pulse'); setTimeout(() => { notification.classList.remove('pulse'); }, 3000); } } startAutoGreeting() { setTimeout(() => { if (!this.hasInteracted()) { this.showAutoPrompt('Bonjour ! Des questions sur nos pi√®ces ? üëã'); } }, 5000); } trackChatbotOpen() { if (window.gtag) { gtag('event', 'chatbot_open', { event_category: 'JDR Chatbot', event_label: 'Chatbot Opened', value: 1 }); } } trackChatbotClose() { const sessionLength=this.conversationHistory.length; if (window.gtag) { gtag('event', 'chatbot_close', { event_category: 'JDR Chatbot', event_label: 'Chatbot Closed', value: sessionLength }); } } trackUserMessage(message, analysis) { if (window.gtag) { gtag('event', 'chatbot_user_message', { event_category: 'JDR Chatbot', event_label: analysis.intent, custom_parameters: { message_length: message.length, confidence: analysis.confidence, user_experience: this.userProfile.experience } }); } } injectChatbotStyles() { if (document.querySelector('#jdr-chatbot-styles')) return; const styles=document.createElement('style'); styles.id='jdr-chatbot-styles'; styles.textContent=` .jdr-chatbot-container { position: fixed; bottom: 20px; right: 20px; z-index: 10000; font-family: 'Cinzel', serif; } .chatbot-trigger { position: relative; background: linear-gradient(145deg, #d4af37, #b8941f); border-radius: 50%; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4); transition: all 0.3s ease; animation: float 3s ease-in-out infinite; } .chatbot-trigger:hover { transform: translateY(-5px) scale(1.05); box-shadow: 0 15px 35px rgba(212, 175, 55, 0.6); } .chatbot-trigger.hidden { opacity: 0; visibility: hidden; transform: scale(0.8); } @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } } .trigger-icon { color: #1a1008; font-size: 1.5rem; animation: spin 4s linear infinite; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } .trigger-notification { position: absolute; bottom: 70px; right: 0; background: linear-gradient(145deg, #2a1810, #1a1008); border: 2px solid #d4af37; border-radius: 15px; padding: 0.8rem 1rem; white-space: nowrap; opacity: 0; visibility: hidden; transition: all 0.3s ease; transform: translateY(10px); } .trigger-notification.pulse { opacity: 1; visibility: visible; transform: translateY(0); animation: gentle-pulse 2s ease-in-out infinite; } @keyframes gentle-pulse { 0%, 100% { box-shadow: 0 0 20px rgba(212, 175, 55, 0.3); } 50% { box-shadow: 0 0 30px rgba(212, 175, 55, 0.6); } } .trigger-notification span { color: #d4af37; font-size: 0.9rem; font-weight: 600; } .chatbot-interface { position: absolute; bottom: 0; right: 0; width: 380px; height: 600px; background: linear-gradient(145deg, #2a1810, #1a1008); border: 2px solid #d4af37; border-radius: 20px 20px 0 0; display: flex; flex-direction: column; opacity: 0; visibility: hidden; transform: translateY(20px) scale(0.95); transition: all 0.3s ease; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); } .chatbot-interface.active { opacity: 1; visibility: visible; transform: translateY(0) scale(1); } .chatbot-header { display: flex; align-items: center; padding: 1rem; border-bottom: 2px solid #8b7355; background: linear-gradient(145deg, #3a2420, #2a1810); border-radius: 18px 18px 0 0; } .chatbot-avatar { background: linear-gradient(145deg, #d4af37, #b8941f); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; margin-right: 1rem; } .chatbot-avatar i { color: #1a1008; font-size: 1.2rem; } .chatbot-info h3 { color: #d4af37; margin: 0 0 0.2rem 0; font-size: 1.1rem; font-weight: 700; } .chatbot-status { color: #8b7355; font-size: 0.8rem; margin: 0; } .chatbot-close { margin-left: auto; background: none; border: none; color: #8b7355; font-size: 1.2rem; cursor: pointer; padding: 0.5rem; border-radius: 50%; transition: all 0.3s ease; } .chatbot-close:hover { background: #8b7355; color: #1a1008; } .chatbot-messages { flex: 1; padding: 1rem; overflow-y: auto; display: flex; flex-direction: column; gap: 1rem; scrollbar-width: thin; scrollbar-color: #8b7355 transparent; } .chatbot-messages::-webkit-scrollbar { width: 6px; } .chatbot-messages::-webkit-scrollbar-track { background: transparent; } .chatbot-messages::-webkit-scrollbar-thumb { background: #8b7355; border-radius: 3px; } .message { display: flex; align-items: flex-start; gap: 0.8rem; animation: fadeInUp 0.3s ease; } @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } } .message.user-message { justify-content: flex-end; } .message.user-message .message-content { background: linear-gradient(145deg, #d4af37, #b8941f); color: #1a1008; margin-left: 2rem; } .message.bot-message .message-content { background: rgba(139, 115, 85, 0.2); border: 1px solid #8b7355; color: #c9b037; margin-right: 2rem; } .message-content { padding: 0.8rem 1rem; border-radius: 15px; flex: 1; word-wrap: break-word; } .message-content p { margin: 0; line-height: 1.4; } .message-avatar { background: linear-gradient(145deg, #d4af37, #b8941f); border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; } .message-avatar i { color: #1a1008; font-size: 0.9rem; } .message-time { font-size: 0.7rem; color: #8b7355; align-self: flex-end; margin-top: 0.3rem; } .quick-options { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.8rem; } .quick-option { background: rgba(212, 175, 55, 0.2); border: 1px solid #d4af37; color: #d4af37; padding: 0.4rem 0.8rem; border-radius: 20px; cursor: pointer; font-size: 0.8rem; font-weight: 600; transition: all 0.3s ease; white-space: nowrap; } .quick-option:hover { background: #d4af37; color: #1a1008; transform: translateY(-1px); } .product-recommendation { margin-top: 1rem; padding: 1rem; background: rgba(212, 175, 55, 0.1); border: 2px solid #d4af37; border-radius: 10px; } .product-recommendation h4 { color: #d4af37; margin: 0 0 0.8rem 0; font-size: 1rem; } .recommended-product h5 { color: #c9b037; margin: 0 0 0.5rem 0; font-size: 0.9rem; } .product-price { color: #d4af37; font-weight: 700; font-size: 1.1rem; margin: 0 0 0.5rem 0; } .product-reason { color: #8b7355; font-size: 0.8rem; margin: 0 0 0.8rem 0; line-height: 1.3; } .btn-view-product { display: inline-block; background: linear-gradient(145deg, #d4af37, #b8941f); color: #1a1008; padding: 0.5rem 1rem; border-radius: 20px; text-decoration: none; font-size: 0.8rem; font-weight: 600; transition: all 0.3s ease; } .btn-view-product:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4); } .chatbot-input-area { padding: 1rem; border-top: 2px solid #8b7355; background: linear-gradient(145deg, #3a2420, #2a1810); } .input-container { display: flex; gap: 0.5rem; align-items: center; } #chatbot-input { flex: 1; background: rgba(139, 115, 85, 0.2); border: 2px solid #8b7355; color: #c9b037; padding: 0.8rem; border-radius: 25px; outline: none; font-family: inherit; font-size: 0.9rem; transition: all 0.3s ease; } #chatbot-input:focus { border-color: #d4af37; box-shadow: 0 0 15px rgba(212, 175, 55, 0.3); } #chatbot-input::placeholder { color: #8b7355; } #chatbot-send { background: linear-gradient(145deg, #d4af37, #b8941f); border: none; color: #1a1008; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; } #chatbot-send:hover { transform: scale(1.1); box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4); } .chatbot-typing { display: none; justify-content: center; gap: 0.3rem; margin-top: 0.5rem; padding: 0.5rem; } .chatbot-typing span { width: 8px; height: 8px; background: #d4af37; border-radius: 50%; animation: typing-bounce 1.4s ease-in-out infinite; } .chatbot-typing span:nth-child(2) { animation-delay: 0.2s; } .chatbot-typing span:nth-child(3) { animation-delay: 0.4s; } @keyframes typing-bounce { 0%, 60%, 100% { transform: translateY(0); opacity: 0.5; } 30% { transform: translateY(-10px); opacity: 1; } } .chatbot-footer { padding: 0.5rem 1rem; text-align: center; border-top: 1px solid #8b7355; background: rgba(139, 115, 85, 0.1); } .chatbot-footer p { color: #8b7355; font-size: 0.7rem; margin: 0; } .welcome-message { background: rgba(212, 175, 55, 0.1); border: 2px solid #d4af37; border-radius: 15px; padding: 1rem; margin-bottom: 1rem; } @media (max-width: 480px) { .chatbot-interface { width: calc(100vw-40px); height: calc(100vh-100px); position: fixed; bottom: 20px; right: 20px; } .trigger-notification { display: none; } .chatbot-trigger { bottom: 80px; } } `; document.head.appendChild(styles); } } window.jdrChatbot=new JDRChatbot(); if (typeof module!=='undefined' && module.exports) { module.exports=JDRChatbot; }
/* Source: jdr-gallery.js */
class JDRGallery { constructor() { this.galleryData=this.initializeGalleryContent(); this.currentCategory='all'; this.isLoaded=false; this.bindEvents(); this.initializeGallery(); } initializeGalleryContent() { return { sessions: [ { id: 'session_001', title: 'Campagne Strahd-Ch√¢teau Ravenloft', description: 'Les pi√®ces x1000 cr√©ent une atmosph√®re parfaite pour les tr√©sors de Barovia', category: 'campaign', products: ['lot1000', 'lot100'], media: { type: 'image', src: '/images/gallery/strahd-session.webp', alt: 'Table de jeu avec pi√®ces m√©talliques dans ambiance gothique' }, testimonial: { author: 'Marc L., MJ depuis 8 ans', content: 'Mes joueurs ont litt√©ralement retenu leur souffle quand j\'ai sorti ces pi√®ces. L\'immersion √©tait totale !', rating: 5, location: 'Montr√©al, QC' }, stats: { session_duration: '4h30', players: 5, immersion_rating: 9.8, memorable_moments: 3 }, tags: ['campagne', 'atmosph√®re', 'tr√©sor', 'immersion'] }, { id: 'session_002', title: 'One-Shot Donjon du Dragon', description: 'Distribution √©pique de r√©compenses avec les lots x10 et x100', category: 'oneshot', products: ['lot10', 'lot100'], media: { type: 'video', src: '/images/gallery/dragon-dungeon.mp4', poster: '/images/gallery/dragon-dungeon-thumb.webp', alt: 'Joueurs d√©couvrant le tr√©sor du dragon' }, testimonial: { author: 'Sophie M., Joueuse passionn√©e', content: 'Le moment o√π le MJ a vers√© toutes ces pi√®ces sur la table... Magique ! On se sentait vraiment dans le jeu.', rating: 5, location: 'Qu√©bec, QC' }, stats: { session_duration: '3h15', players: 4, immersion_rating: 9.5, memorable_moments: 2 }, tags: ['oneshot', 'tr√©sor', 'r√©compense', 'magie'] }, { id: 'session_003', title: 'Campagne Homebrew-Le Royaume Perdu', description: '√âconomie complexe avec syst√®me mon√©taire complet utilisant tous les multiplicateurs', category: 'homebrew', products: ['lot10', 'lot100', 'lot1000', 'lot10000'], media: { type: 'image', src: '/images/gallery/homebrew-economy.webp', alt: 'Table montrant syst√®me √©conomique complexe avec toutes les d√©nominations' }, testimonial: { author: 'Alex R., MJ cr√©atif', content: 'Avec tous les multiplicateurs, j\'ai pu cr√©er une v√©ritable √©conomie. Les joueurs n√©gocient maintenant comme de vrais marchands !', rating: 5, location: 'Sherbrooke, QC' }, stats: { session_duration: '5h00', players: 6, immersion_rating: 9.9, memorable_moments: 5 }, tags: ['homebrew', '√©conomie', 'syst√®me', 'cr√©ativit√©'] }, { id: 'session_004', title: 'Session D√©couverte-Nouveaux Joueurs', description: 'Initiation au JDR avec l\'impact visuel des vraies pi√®ces m√©talliques', category: 'initiation', products: ['lot10'], media: { type: 'image', src: '/images/gallery/initiation-nouveaux.webp', alt: 'Nouveaux joueurs d√©couvrant les pi√®ces m√©talliques' }, testimonial: { author: 'Marie-Claude T., MJ d√©butante', content: 'M√™me pour ma premi√®re partie en tant que MJ, ces pi√®ces ont donn√© une cr√©dibilit√© imm√©diate √† mon univers !', rating: 5, location: 'Gatineau, QC' }, stats: { session_duration: '2h30', players: 3, immersion_rating: 8.7, memorable_moments: 2 }, tags: ['initiation', 'd√©butant', 'd√©couverte', 'accessible'] }, { id: 'session_005', title: 'Convention FLIM 2025', description: 'D√©monstration officielle lors du plus grand √©v√©nement JDR du Qu√©bec', category: 'convention', products: ['lot1000', 'lot10000'], media: { type: 'video', src: '/images/gallery/flim-2025-demo.mp4', poster: '/images/gallery/flim-2025-thumb.webp', alt: 'D√©monstration FLIM 2025 avec foule impressionn√©e' }, testimonial: { author: 'Organisation FLIM', content: 'GeeknDragon a √©t√© LA d√©couverte de notre convention. Tous les MJ pr√©sents voulaient ces pi√®ces !', rating: 5, location: 'FLIM 2025, QC' }, stats: { session_duration: '1h00', players: 25, immersion_rating: 10, memorable_moments: 8 }, tags: ['convention', 'd√©monstration', 'professionnel', 'reconnaissance'] } ], categories: { 'all': 'Toutes les sessions', 'campaign': 'Campagnes longues', 'oneshot': 'Sessions courtes', 'homebrew': 'Cr√©ations originales', 'initiation': 'D√©couverte JDR', 'convention': '√âv√©nements officiels' }, impactMetrics: { total_sessions: 127, average_immersion: 9.2, mj_satisfaction: 98, player_retention: 89, memorable_moments: 342 } }; } bindEvents() { document.addEventListener('DOMContentLoaded', () => { this.initializeGallery(); }); this.observeGalleryEntry(); } observeGalleryEntry() { if ('IntersectionObserver' in window) { const observer=new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting && !this.isLoaded) { this.loadGalleryContent(); this.isLoaded=true; } }); }, { threshold: 0.1 }); const triggerZones=[ '#jdr-gallery', '.gallery-trigger', '#testimonials-section' ]; triggerZones.forEach(selector => { const element=document.querySelector(selector); if (element) observer.observe(element); }); } else { setTimeout(() => this.loadGalleryContent(), 2000); } } initializeGallery() { const container=document.querySelector('#jdr-gallery'); if (container && !this.isLoaded) { this.loadGalleryContent(); this.isLoaded=true; } } loadGalleryContent() { this.createGalleryHTML(); this.bindGalleryInteractions(); this.startAutomaticSlideshow(); this.trackGalleryView(); } createGalleryHTML() { const container=this.getOrCreateGalleryContainer(); container.innerHTML=` <div class="jdr-gallery-wrapper"> <div class="gallery-header"> <h2 class="gallery-title"> <i class="fas fa-dice-d20"></i> Vrais joueurs, vraies parties, vrais r√©sultats </h2> <p class="gallery-subtitle"> D√©couvrez comment nos pi√®ces transforment l'exp√©rience JDR au Qu√©bec </p> ${this.createImpactMetrics()} </div> <div class="gallery-controls"> ${this.createCategoryFilters()} </div> <div class="gallery-grid" id="gallery-sessions"> ${this.renderGallerySessions()} </div> <div class="gallery-footer"> <button class="btn-load-more" onclick="jdrGallery.loadMoreSessions()"> <i class="fas fa-plus"></i> Voir plus de sessions </button> <div class="community-invite"> <p>Vous aussi, partagez vos sessions !</p> <a href="mailto:info@geekndragon.com?subject=Partage%20Session%20JDR" class="btn-share-session"> <i class="fas fa-camera"></i> Partager ma session </a> </div> </div> </div> `; this.injectGalleryStyles(); } createImpactMetrics() { const metrics=this.galleryData.impactMetrics; return ` <div class="impact-metrics"> <div class="metric"> <span class="metric-number">${metrics.total_sessions}+</span> <span class="metric-label">Sessions enrichies</span> </div> <div class="metric"> <span class="metric-number">${metrics.average_immersion}/10</span> <span class="metric-label">Immersion moyenne</span> </div> <div class="metric"> <span class="metric-number">${metrics.mj_satisfaction}%</span> <span class="metric-label">MJ satisfaits</span> </div> <div class="metric"> <span class="metric-number">${metrics.memorable_moments}+</span> <span class="metric-label">Moments inoubliables</span> </div> </div> `; } createCategoryFilters() { return ` <div class="category-filters"> ${Object.entries(this.galleryData.categories).map(([key, label]) => ` <button class="filter-btn ${key==='all' ? 'active' : ''}" data-category="${key}" onclick="jdrGallery.filterByCategory('${key}')"> ${label} </button> `).join('')} </div> `; } renderGallerySessions() { const sessions=this.getFilteredSessions(); return sessions.map(session => this.createSessionCard(session)).join(''); } createSessionCard(session) { return ` <div class="gallery-session ${session.category}" data-session="${session.id}"> <div class="session-media"> ${session.media.type==='video' ? this.createVideoElement(session.media) : this.createImageElement(session.media) } <div class="session-overlay"> <div class="session-stats"> <span><i class="fas fa-clock"></i> ${session.stats.session_duration}</span> <span><i class="fas fa-users"></i> ${session.stats.players} joueurs</span> <span><i class="fas fa-star"></i> ${session.stats.immersion_rating}/10</span> </div> </div> </div> <div class="session-content"> <h3 class="session-title">${session.title}</h3> <p class="session-description">${session.description}</p> <div class="session-products"> <span class="products-label">Produits utilis√©s:</span> ${session.products.map(productId => ` <span class="product-tag" data-product="${productId}"> ${this.getProductName(productId)} </span> `).join('')} </div> <div class="session-testimonial"> <div class="testimonial-content"> <i class="fas fa-quote-left"></i> <p>${session.testimonial.content}</p> </div> <div class="testimonial-author"> <div class="rating"> ${this.createStarRating(session.testimonial.rating)} </div> <span class="author-name">${session.testimonial.author}</span> <span class="author-location">${session.testimonial.location}</span> </div> </div> <div class="session-tags"> ${session.tags.map(tag => `<span class="tag">#${tag}</span>`).join('')} </div> </div> <div class="session-actions"> <button class="btn-view-details" onclick="jdrGallery.viewSessionDetails('${session.id}')"> <i class="fas fa-expand"></i> Voir les d√©tails </button> <button class="btn-similar-products" onclick="jdrGallery.showSimilarProducts('${session.id}')"> <i class="fas fa-shopping-cart"></i> Produits similaires </button> </div> </div> `; } createVideoElement(media) { return ` <video class="session-video" poster="${media.poster}" preload="metadata" onclick="jdrGallery.playVideo(this)"> <source src="${media.src}" type="video/mp4"> ${media.alt} </video> <div class="video-play-overlay"> <i class="fas fa-play"></i> </div> `; } createImageElement(media) { return ` <img class="session-image" src="${media.src}" alt="${media.alt}" loading="lazy"> `; } createStarRating(rating) { const stars=[]; for (let i=1; i <= 5; i++) { stars.push(`<i class="fas fa-star ${i <= rating ? 'filled' : ''}"></i>`); } return stars.join(''); } getProductName(productId) { const productNames={ 'lot10': 'Lot x10', 'lot100': 'Lot x100', 'lot1000': 'Lot x1000', 'lot10000': 'Lot x10000' }; return productNames[productId] || productId; } getFilteredSessions() { if (this.currentCategory==='all') { return this.galleryData.sessions; } return this.galleryData.sessions.filter(session => session.category===this.currentCategory ); } getOrCreateGalleryContainer() { let container=document.querySelector('#jdr-gallery'); if (!container) { const insertionPoints=[ '#testimonials-section', '.trust-signals', '.main-content', 'main' ]; let insertionPoint=null; for (const selector of insertionPoints) { insertionPoint=document.querySelector(selector); if (insertionPoint) break; } if (insertionPoint) { container=document.createElement('section'); container.id='jdr-gallery'; container.className='gallery-section'; insertionPoint.insertAdjacentElement('afterend', container); } else { container=document.createElement('section'); container.id='jdr-gallery'; container.className='gallery-section'; document.body.appendChild(container); } } return container; } filterByCategory(category) { this.currentCategory=category; document.querySelectorAll('.filter-btn').forEach(btn => { btn.classList.remove('active'); }); document.querySelector(`[data-category="${category}"]`).classList.add('active'); const grid=document.querySelector('#gallery-sessions'); grid.style.opacity='0.3'; setTimeout(() => { grid.innerHTML=this.renderGallerySessions(); grid.style.opacity='1'; this.trackCategoryFilter(category); }, 200); } viewSessionDetails(sessionId) { const session=this.galleryData.sessions.find(s => s.id===sessionId); if (!session) return; this.showDetailModal(session); this.trackSessionView(sessionId); } showDetailModal(session) { const modal=document.createElement('div'); modal.className='session-detail-modal'; modal.innerHTML=` <div class="modal-backdrop" onclick="jdrGallery.closeModal()"></div> <div class="modal-content"> <div class="modal-header"> <h2>${session.title}</h2> <button class="modal-close" onclick="jdrGallery.closeModal()"> <i class="fas fa-times"></i> </button> </div> <div class="modal-body"> <div class="session-media-large"> ${session.media.type==='video' ? this.createVideoElement(session.media) : this.createImageElement(session.media) } </div> <div class="session-details-full"> <p class="session-description-full">${session.description}</p> <div class="session-stats-detailed"> <h3>Statistiques de la session</h3> <div class="stats-grid"> <div class="stat"> <span class="stat-label">Dur√©e</span> <span class="stat-value">${session.stats.session_duration}</span> </div> <div class="stat"> <span class="stat-label">Joueurs</span> <span class="stat-value">${session.stats.players}</span> </div> <div class="stat"> <span class="stat-label">Immersion</span> <span class="stat-value">${session.stats.immersion_rating}/10</span> </div> <div class="stat"> <span class="stat-label">Moments marquants</span> <span class="stat-value">${session.stats.memorable_moments}</span> </div> </div> </div> <div class="testimonial-expanded"> <h3>T√©moignage complet</h3> <blockquote> ${session.testimonial.content} <footer> ‚Äî ${session.testimonial.author}, ${session.testimonial.location} </footer> </blockquote> </div> <div class="products-showcase"> <h3>Produits utilis√©s dans cette session</h3> ${session.products.map(productId => ` <a href="/boutique.php#${productId}" class="product-link-modal"> ${this.getProductName(productId)} <i class="fas fa-external-link-alt"></i> </a> `).join('')} </div> </div> </div> </div> `; document.body.appendChild(modal); setTimeout(() => modal.classList.add('active'), 10); } closeModal() { const modal=document.querySelector('.session-detail-modal'); if (modal) { modal.classList.remove('active'); setTimeout(() => modal.remove(), 300); } } playVideo(videoElement) { if (videoElement.paused) { document.querySelectorAll('.session-video').forEach(video => { if (video!==videoElement) video.pause(); }); videoElement.play(); videoElement.nextElementSibling.style.display='none'; this.trackVideoPlay(videoElement.getAttribute('data-session') || 'unknown'); } else { videoElement.pause(); videoElement.nextElementSibling.style.display='flex'; } } showSimilarProducts(sessionId) { const session=this.galleryData.sessions.find(s => s.id===sessionId); if (!session || !window.productRecommendations) return; window.productRecommendations.showRecommendations({ context: 'gallery_session', products: session.products, user_interest: session.category }); this.trackProductInterest(sessionId, session.products); } bindGalleryInteractions() { window.addEventListener('scroll', this.throttle(() => { this.handleInfiniteScroll(); }, 200)); document.querySelectorAll('.gallery-session').forEach(card => { card.addEventListener('mouseenter', () => { this.preloadSessionMedia(card.dataset.session); }); }); } startAutomaticSlideshow() { setInterval(() => { this.highlightRandomSession(); }, 10000); } highlightRandomSession() { const sessions=document.querySelectorAll('.gallery-session'); if (sessions.length===0) return; sessions.forEach(s => s.classList.remove('highlighted')); const randomIndex=Math.floor(Math.random()*sessions.length); sessions[randomIndex].classList.add('highlighted'); } loadMoreSessions() { const loadingBtn=document.querySelector('.btn-load-more'); loadingBtn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Chargement...'; setTimeout(() => { loadingBtn.innerHTML='<i class="fas fa-check"></i> Toutes les sessions charg√©es'; loadingBtn.disabled=true; this.trackLoadMore(); }, 1500); } handleInfiniteScroll() { const gallery=document.querySelector('#jdr-gallery'); if (!gallery) return; const rect=gallery.getBoundingClientRect(); const isNearBottom=rect.bottom-window.innerHeight < 200; if (isNearBottom && !this.isLoadingMore) { this.loadMoreSessions(); } } preloadSessionMedia(sessionId) { const session=this.galleryData.sessions.find(s => s.id===sessionId); if (!session) return; if (session.media.type==='video' && session.media.poster) { const img=new Image(); img.src=session.media.poster; } } throttle(func, limit) { let inThrottle; return function() { const args=arguments; const context=this; if (!inThrottle) { func.apply(context, args); inThrottle=true; setTimeout(() => inThrottle=false, limit); } }; } trackGalleryView() { if (window.gtag) { gtag('event', 'gallery_view', { event_category: 'JDR Gallery', event_label: 'Gallery Loaded', value: 1 }); } } trackCategoryFilter(category) { if (window.gtag) { gtag('event', 'gallery_filter', { event_category: 'JDR Gallery', event_label: category, value: 1 }); } } trackSessionView(sessionId) { if (window.gtag) { gtag('event', 'session_detail_view', { event_category: 'JDR Gallery', event_label: sessionId, value: 1 }); } } trackVideoPlay(sessionId) { if (window.gtag) { gtag('event', 'video_play', { event_category: 'JDR Gallery', event_label: sessionId, value: 1 }); } } trackProductInterest(sessionId, products) { if (window.gtag) { gtag('event', 'product_interest_from_gallery', { event_category: 'JDR Gallery', event_label: sessionId, custom_parameters: { interested_products: products.join(',') } }); } } trackLoadMore() { if (window.gtag) { gtag('event', 'gallery_load_more', { event_category: 'JDR Gallery', event_label: 'Load More Sessions', value: 1 }); } } injectGalleryStyles() { if (document.querySelector('#jdr-gallery-styles')) return; const styles=document.createElement('style'); styles.id='jdr-gallery-styles'; styles.textContent=` .jdr-gallery-wrapper { max-width: 1200px; margin: 0 auto; padding: 3rem 1rem; font-family: 'Cinzel', serif; } .gallery-header { text-align: center; margin-bottom: 3rem; } .gallery-title { font-size: 2.5rem; color: #d4af37; margin-bottom: 1rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); } .gallery-subtitle { font-size: 1.2rem; color: #8b7355; margin-bottom: 2rem; } .impact-metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; margin-top: 2rem; } .metric { text-align: center; padding: 1.5rem; background: linear-gradient(145deg, #2a1810, #1a1008); border-radius: 15px; border: 2px solid #d4af37; box-shadow: 0 8px 25px rgba(212, 175, 55, 0.2); } .metric-number { display: block; font-size: 2.5rem; font-weight: bold; color: #d4af37; margin-bottom: 0.5rem; } .metric-label { color: #8b7355; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; } .category-filters { display: flex; justify-content: center; gap: 1rem; margin-bottom: 3rem; flex-wrap: wrap; } .filter-btn { padding: 0.8rem 1.5rem; background: #2a1810; color: #8b7355; border: 2px solid #8b7355; border-radius: 25px; cursor: pointer; transition: all 0.3s ease; font-family: 'Cinzel', serif; font-weight: 600; } .filter-btn:hover, .filter-btn.active { background: linear-gradient(145deg, #d4af37, #b8941f); color: #1a1008; border-color: #d4af37; transform: translateY(-2px); box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3); } .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem; margin-bottom: 3rem; } .gallery-session { background: linear-gradient(145deg, #2a1810, #1a1008); border-radius: 20px; border: 2px solid #8b7355; overflow: hidden; transition: all 0.3s ease; position: relative; } .gallery-session:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(212, 175, 55, 0.2); border-color: #d4af37; } .gallery-session.highlighted { border-color: #d4af37; box-shadow: 0 0 30px rgba(212, 175, 55, 0.4); animation: pulse-gold 2s infinite; } @keyframes pulse-gold { 0%, 100% { box-shadow: 0 0 30px rgba(212, 175, 55, 0.4); } 50% { box-shadow: 0 0 50px rgba(212, 175, 55, 0.7); } } .session-media { position: relative; height: 250px; overflow: hidden; } .session-image, .session-video { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease; } .gallery-session:hover .session-image, .gallery-session:hover .session-video { transform: scale(1.05); } .session-overlay { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.8)); padding: 1rem; } .session-stats { display: flex; justify-content: space-around; color: #d4af37; font-size: 0.9rem; font-weight: 600; } .session-stats span { display: flex; align-items: center; gap: 0.3rem; } .video-play-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(212, 175, 55, 0.9); border-radius: 50%; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; } .video-play-overlay:hover { background: #d4af37; transform: translate(-50%, -50%) scale(1.1); } .video-play-overlay i { color: #1a1008; font-size: 1.5rem; margin-left: 3px; } .session-content { padding: 1.5rem; } .session-title { color: #d4af37; font-size: 1.4rem; margin-bottom: 0.8rem; font-weight: 700; } .session-description { color: #8b7355; line-height: 1.6; margin-bottom: 1rem; } .session-products { margin-bottom: 1.5rem; } .products-label { color: #d4af37; font-weight: 600; display: block; margin-bottom: 0.5rem; } .product-tag { display: inline-block; background: #8b7355; color: #1a1008; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem; font-weight: 600; margin-right: 0.5rem; margin-bottom: 0.3rem; cursor: pointer; transition: all 0.3s ease; } .product-tag:hover { background: #d4af37; transform: translateY(-1px); } .session-testimonial { background: rgba(139, 115, 85, 0.1); border-left: 4px solid #d4af37; padding: 1rem; margin-bottom: 1rem; border-radius: 0 10px 10px 0; } .testimonial-content p { font-style: italic; color: #c9b037; margin-bottom: 0.8rem; line-height: 1.5; } .testimonial-content i { color: #d4af37; font-size: 1.2rem; margin-right: 0.5rem; } .testimonial-author { display: flex; flex-direction: column; gap: 0.2rem; } .rating { margin-bottom: 0.3rem; } .rating i { color: #d4af37; font-size: 0.9rem; } .rating i.filled { color: #d4af37; } .rating i:not(.filled) { color: #8b7355; } .author-name { font-weight: 600; color: #d4af37; font-size: 0.9rem; } .author-location { color: #8b7355; font-size: 0.8rem; } .session-tags { margin-bottom: 1rem; } .tag { display: inline-block; background: rgba(212, 175, 55, 0.2); color: #d4af37; padding: 0.2rem 0.6rem; border-radius: 10px; font-size: 0.7rem; margin-right: 0.3rem; margin-bottom: 0.3rem; } .session-actions { display: flex; gap: 1rem; padding: 0 1.5rem 1.5rem; } .btn-view-details, .btn-similar-products { flex: 1; padding: 0.8rem; border: 2px solid #8b7355; background: transparent; color: #8b7355; border-radius: 10px; cursor: pointer; transition: all 0.3s ease; font-family: 'Cinzel', serif; font-weight: 600; text-align: center; } .btn-view-details:hover { background: #8b7355; color: #1a1008; transform: translateY(-2px); } .btn-similar-products:hover { background: #d4af37; border-color: #d4af37; color: #1a1008; transform: translateY(-2px); } .gallery-footer { text-align: center; padding-top: 2rem; border-top: 2px solid #8b7355; } .btn-load-more, .btn-share-session { padding: 1rem 2rem; background: linear-gradient(145deg, #d4af37, #b8941f); color: #1a1008; border: none; border-radius: 25px; cursor: pointer; font-family: 'Cinzel', serif; font-weight: 700; font-size: 1rem; transition: all 0.3s ease; margin: 0.5rem; text-decoration: none; display: inline-block; } .btn-load-more:hover, .btn-share-session:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(212, 175, 55, 0.4); } .community-invite { margin-top: 2rem; padding: 2rem; background: rgba(139, 115, 85, 0.1); border-radius: 15px; border: 2px solid #8b7355; } .community-invite p { color: #8b7355; margin-bottom: 1rem; font-size: 1.1rem; } .session-detail-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s ease; } .session-detail-modal.active { opacity: 1; visibility: visible; } .modal-backdrop { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); cursor: pointer; } .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(145deg, #2a1810, #1a1008); border: 2px solid #d4af37; border-radius: 20px; max-width: 800px; max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5); } .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 1.5rem; border-bottom: 2px solid #8b7355; } .modal-header h2 { color: #d4af37; margin: 0; font-size: 1.8rem; } .modal-close { background: none; border: none; color: #8b7355; font-size: 1.5rem; cursor: pointer; padding: 0.5rem; border-radius: 50%; transition: all 0.3s ease; } .modal-close:hover { background: #8b7355; color: #1a1008; } .modal-body { padding: 1.5rem; } .session-media-large { margin-bottom: 2rem; border-radius: 15px; overflow: hidden; } .session-media-large img, .session-media-large video { width: 100%; height: auto; display: block; } @media (max-width: 768px) { .gallery-grid { grid-template-columns: 1fr; } .impact-metrics { grid-template-columns: repeat(2, 1fr); } .category-filters { justify-content: flex-start; overflow-x: auto; padding-bottom: 1rem; } .filter-btn { white-space: nowrap; flex-shrink: 0; } .session-actions { flex-direction: column; } .modal-content { margin: 1rem; max-width: calc(100%-2rem); } } `; document.head.appendChild(styles); } } window.jdrGallery=new JDRGallery(); if (typeof module!=='undefined' && module.exports) { module.exports=JDRGallery; }
/* Source: jdr-interactions.js */
(function() { 'use strict'; const SOUNDS={ coinDrop: null, treasureFound: null, buttonHover: null }; function initSounds() { if (SOUNDS.coinDrop) return; try { const audioContext=new (window.AudioContext || window.webkitAudioContext)(); SOUNDS.coinDrop=createCoinSound(audioContext); SOUNDS.treasureFound=createTreasureSound(audioContext); SOUNDS.buttonHover=createHoverSound(audioContext); } catch (e) { } } function createCoinSound(ctx) { return () => { if (!ctx) return; const oscillator=ctx.createOscillator(); const gainNode=ctx.createGain(); oscillator.connect(gainNode); gainNode.connect(ctx.destination); oscillator.frequency.setValueAtTime(800, ctx.currentTime); oscillator.frequency.exponentialRampToValueAtTime(400, ctx.currentTime+0.1); gainNode.gain.setValueAtTime(0.1, ctx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime+0.1); oscillator.start(ctx.currentTime); oscillator.stop(ctx.currentTime+0.1); }; } function createTreasureSound(ctx) { return () => { if (!ctx) return; const oscillator=ctx.createOscillator(); const gainNode=ctx.createGain(); oscillator.connect(gainNode); gainNode.connect(ctx.destination); oscillator.frequency.setValueAtTime(523, ctx.currentTime); oscillator.frequency.setValueAtTime(659, ctx.currentTime+0.1); oscillator.frequency.setValueAtTime(784, ctx.currentTime+0.2); gainNode.gain.setValueAtTime(0.05, ctx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime+0.3); oscillator.start(ctx.currentTime); oscillator.stop(ctx.currentTime+0.3); }; } function createHoverSound(ctx) { return () => { if (!ctx) return; const oscillator=ctx.createOscillator(); const gainNode=ctx.createGain(); oscillator.connect(gainNode); gainNode.connect(ctx.destination); oscillator.frequency.setValueAtTime(1000, ctx.currentTime); gainNode.gain.setValueAtTime(0.02, ctx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime+0.05); oscillator.start(ctx.currentTime); oscillator.stop(ctx.currentTime+0.05); }; } function handleAddToCart(button) { button.classList.add('add-to-cart-success'); if (SOUNDS.coinDrop) { SOUNDS.coinDrop(); } showToast('Tr√©sor ajout√© √† votre sac ! üèÜ', 'success'); setTimeout(() => { button.classList.remove('add-to-cart-success'); }, 800); } function showToast(message, type='info', duration=3000) { const existingToasts=document.querySelectorAll('.toast-notification'); existingToasts.forEach(toast => toast.remove()); const toast=document.createElement('div'); toast.className=`toast-notification toast-${type}`; toast.textContent=message; document.body.appendChild(toast); setTimeout(() => toast.classList.add('show'), 10); setTimeout(() => { toast.classList.add('hide'); setTimeout(() => toast.remove(), 500); }, duration); } function handleProductHover(card) { if (SOUNDS.buttonHover && Math.random() > 0.7) { SOUNDS.buttonHover(); } if (card.dataset.price && parseFloat(card.dataset.price) > 100) { if (SOUNDS.treasureFound) { setTimeout(() => SOUNDS.treasureFound(), 200); } } } function initScrollAnimations() { const observer=new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('animate-treasure-reveal'); observer.unobserve(entry.target); } }); }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' }); document.querySelectorAll('.product-card').forEach(card => { observer.observe(card); }); document.querySelectorAll('.shop-section, .features-section').forEach(section => { observer.observe(section); }); } function enhanceQuantityControls() { document.addEventListener('click', function(e) { if (!e.target.matches('.quantity-btn')) return; e.preventDefault(); const btn=e.target; const target=btn.getAttribute('data-target'); const qtyEl=document.getElementById('qty-'+target); if (!qtyEl) return; let qty=parseInt(qtyEl.textContent, 10); const isPlus=btn.classList.contains('plus'); const isMinus=btn.classList.contains('minus'); if (isPlus) { qty=Math.min(qty+1, 99); if (SOUNDS.coinDrop) SOUNDS.coinDrop(); } else if (isMinus) { qty=Math.max(qty-1, 1); } qtyEl.textContent=qty; qtyEl.style.transform='scale(1.3)'; qtyEl.style.color='#8b5cf6'; setTimeout(() => { qtyEl.style.transform='scale(1)'; qtyEl.style.color=''; }, 200); const addBtn=btn.closest('.product-card').querySelector('.gd-add-to-cart'); if (addBtn) { addBtn.setAttribute('data-quantity', qty.toString()); } }); } function enhanceQuebecBadge() { const badges=document.querySelectorAll('.quebec-badge, [data-quebec="true"]'); badges.forEach(badge => { badge.classList.add('quebec-badge'); badge.addEventListener('mouseenter', () => { if (SOUNDS.treasureFound) { setTimeout(() => SOUNDS.treasureFound(), 100); } }); }); } function enhanceHeroQuebecBadge() { const heroQuebecSection=document.querySelector('.hero-text .flex.items-center'); if (heroQuebecSection) { heroQuebecSection.classList.add('quebec-badge'); } } function trackInteractions() { let interactions=0; document.addEventListener('click', function(e) { if (e.target.matches('.btn, .product-card, .quantity-btn')) { interactions++; if (typeof gtag!=='undefined') { gtag('event', 'interaction', { 'event_category': 'engagement', 'event_label': e.target.className, 'value': interactions }); } } }); } document.addEventListener('DOMContentLoaded', function() { document.addEventListener('click', function() { initSounds(); }, { once: true }); document.addEventListener('click', function(e) { if (e.target.closest('.gd-add-to-cart')) { handleAddToCart(e.target.closest('.gd-add-to-cart')); } }); document.addEventListener('mouseenter', function(e) { if (e.target.matches('.product-card')) { handleProductHover(e.target); } }, true); initScrollAnimations(); enhanceQuantityControls(); enhanceQuebecBadge(); enhanceHeroQuebecBadge(); trackInteractions(); }); const criticalCSS=` .product-card { will-change: transform; } .btn-primary { will-change: transform, box-shadow; } .quantity-btn { will-change: transform; } `; const style=document.createElement('style'); style.textContent=criticalCSS; document.head.appendChild(style); })();
/* Source: lazy-load-enhanced.js */
(function lazyLoadEnhanced() { const config={ rootMargin: '50px 0px', threshold: 0.01, loadDelay: 100, }; const loadTimeouts=new Map(); function loadImage(img) { if (img.dataset.src) { const tempImg=new Image(); tempImg.onload=function handleImageLoad() { const imageElement=img; imageElement.src=imageElement.dataset.src; imageElement.classList.add('lazy-loaded'); delete imageElement.dataset.src; if (imageElement.dataset.bg==='true') { imageElement.style.backgroundImage=`url(${imageElement.src})`; } }; tempImg.src=img.dataset.src; } if (img.dataset.srcset) { const imageElement=img; imageElement.srcset=imageElement.dataset.srcset; delete imageElement.dataset.srcset; } } const imageObserver=new IntersectionObserver((entries, observer) => { entries.forEach((entry) => { if (entry.isIntersecting) { const img=entry.target; const timeout=setTimeout(() => { loadImage(img); observer.unobserve(img); loadTimeouts.delete(img); }, config.loadDelay); loadTimeouts.set(img, timeout); } else if (loadTimeouts.has(entry.target)) { clearTimeout(loadTimeouts.get(entry.target)); loadTimeouts.delete(entry.target); } }); }, config); const videoObserver=new IntersectionObserver((entries) => { entries.forEach((entry) => { const video=entry.target; if (entry.isIntersecting) { if (!video.src && video.dataset.src) { const videoElement=video; videoElement.src=videoElement.dataset.src; videoElement.load(); delete videoElement.dataset.src; } if (video.muted && video.loop && video.paused) { video.play().catch(() => { }); } } else if (!video.paused && video.muted && video.loop) { video.pause(); } }); }, { rootMargin: '0px', threshold: 0.25, }); function initLazyLoading() { const images=document.querySelectorAll('img[loading="lazy"]'); images.forEach((img) => { if (!('loading' in HTMLImageElement.prototype)) { imageObserver.observe(img); } }); const lazyImages=document.querySelectorAll('img[data-src]'); lazyImages.forEach((img) => imageObserver.observe(img)); const videos=document.querySelectorAll('video[data-src], video:not([data-no-lazy])'); videos.forEach((video) => { const videoElement=video; videoElement.preload='none'; videoObserver.observe(videoElement); }); } function optimizeHeroImages() { const heroImages=document.querySelectorAll('.hero-videos video, [data-hero-image]'); heroImages.forEach((media) => { if (media.tagName==='VIDEO') { const videoElement=media; videoElement.preload='metadata'; if (document.readyState==='complete') { setTimeout(() => { videoElement.preload='auto'; videoElement.load(); }, 1000); } } }); } function optimizeProductImages() { const productImages=document.querySelectorAll('.card-product img, .product-media'); productImages.forEach((img) => { const imageElement=img; imageElement.loading='lazy'; imageElement.decoding='async'; }); } if (document.readyState==='loading') { document.addEventListener('DOMContentLoaded', () => { initLazyLoading(); optimizeHeroImages(); optimizeProductImages(); }); } else { initLazyLoading(); optimizeHeroImages(); optimizeProductImages(); } }());
/* Source: media-optimization.js */
(function() { 'use strict'; class MediaOptimizer { constructor() { this.supportsWebP=false; this.supportsAVIF=false; this.connectionSpeed='unknown'; this.deviceCapabilities={}; this.init(); } async init() { await this.detectImageFormats(); this.analyzeConnection(); this.analyzeDeviceCapabilities(); this.optimizeExistingMedia(); this.setupMediaObserver(); } async detectImageFormats() { this.supportsWebP=await this.testImageFormat('data:image/webp;base64,UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA=='); this.supportsAVIF=await this.testImageFormat('data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgABogQEAwgMg8f8D if (this.supportsAVIF) { } else if (this.supportsWebP) { } } async testImageFormat(dataUri) { return new Promise((resolve) => { const img=new Image(); img.onload=() => resolve(img.width===2 && img.height===2); img.onerror=() => resolve(false); img.src=dataUri; }); } analyzeConnection() { if ('connection' in navigator) { const conn=navigator.connection; this.connectionSpeed=conn.effectiveType || 'unknown'; if (conn.effectiveType==='slow-2g' || conn.effectiveType==='2g') { this.connectionSpeed='slow'; } else if (conn.effectiveType==='3g') { this.connectionSpeed='medium'; } else { this.connectionSpeed='fast'; } } else { this.estimateConnectionSpeed(); } } estimateConnectionSpeed() { const startTime=performance.now(); const testImage=new Image(); testImage.onload=() => { const loadTime=performance.now()-startTime; if (loadTime > 1000) { this.connectionSpeed='slow'; } else if (loadTime > 500) { this.connectionSpeed='medium'; } else { this.connectionSpeed='fast'; } }ms)`); }; testImage.src='/images/favicon.png?t='+Date.now(); } analyzeDeviceCapabilities() { this.deviceCapabilities={ screenWidth: window.screen.width, screenHeight: window.screen.height, pixelRatio: window.devicePixelRatio || 1, hardwareConcurrency: navigator.hardwareConcurrency || 2, memory: navigator.deviceMemory || 'unknown', isMobile: /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent), isTouch: 'ontouchstart' in window }; this.qualityLevel=this.calculateOptimalQuality(); } calculateOptimalQuality() { let score=0; if (this.connectionSpeed==='fast') score += 3; else if (this.connectionSpeed==='medium') score += 2; else score += 1; if (this.deviceCapabilities.memory >= 8) score += 3; else if (this.deviceCapabilities.memory >= 4) score += 2; else score += 1; if (this.deviceCapabilities.hardwareConcurrency >= 8) score += 2; else if (this.deviceCapabilities.hardwareConcurrency >= 4) score += 1; if (this.deviceCapabilities.pixelRatio >= 2) score += 1; if (score >= 8) return 'high'; if (score >= 5) return 'medium'; return 'low'; } optimizeExistingMedia() { const images=document.querySelectorAll('img[src]:not([data-optimized])'); images.forEach(img => this.optimizeImage(img)); const videos=document.querySelectorAll('video[src]:not([data-optimized])'); videos.forEach(video => this.optimizeVideo(video)); this.optimizeBackgroundImages(); } optimizeImage(img) { if (img.dataset.optimized) return; const originalSrc=img.src; const optimizedSrc=this.getOptimizedImageSrc(originalSrc); if ('loading' in HTMLImageElement.prototype) { img.loading='lazy'; } else { this.setupIntersectionObserver(img); } if (optimizedSrc!==originalSrc) { img.src=optimizedSrc; } this.addResponsiveSrcSet(img, originalSrc); img.dataset.optimized='true'; } getOptimizedImageSrc(src) { const url=new URL(src, window.location.origin); const params=new URLSearchParams(); if (this.supportsAVIF) { params.set('format', 'avif'); } else if (this.supportsWebP) { params.set('format', 'webp'); } const quality=this.getOptimalImageQuality(); if (quality < 90) { params.set('quality', quality.toString()); } params.set('progressive', 'true'); if (params.toString()) { url.search=params.toString(); } return url.toString(); } getOptimalImageQuality() { return { 'high': 90, 'medium': 75, 'low': 60 }[this.qualityLevel] || 75; } addResponsiveSrcSet(img, originalSrc) { if (img.srcset) return; const baseSrc=originalSrc.replace(/\.(jpg|jpeg|png|webp)$/i, ''); const ext=this.supportsWebP ? 'webp' : 'jpg'; const srcset=[ `${baseSrc}_400w.${ext} 400w`, `${baseSrc}_800w.${ext} 800w`, `${baseSrc}_1200w.${ext} 1200w`, `${baseSrc}_1600w.${ext} 1600w` ].join(', '); img.srcset=srcset; img.sizes='(max-width: 768px) 400px, (max-width: 1024px) 800px, 1200px'; } optimizeVideo(video) { if (video.dataset.optimized) return; video.preload=this.connectionSpeed==='fast' ? 'metadata' : 'none'; video.muted=true; video.playsInline=true; this.addVideoSources(video); this.setupVideoIntersectionObserver(video); video.dataset.optimized='true'; } addVideoSources(video) { const originalSrc=video.src; if (!originalSrc) return; const qualities=this.getVideoQualities(); qualities.forEach(quality => { const source=document.createElement('source'); source.src=this.getVideoSrcForQuality(originalSrc, quality); source.type='video/mp4'; source.media=quality.media; video.appendChild(source); }); video.removeAttribute('src'); } getVideoQualities() { const qualities=[ { name: 'high', media: '(min-width: 1024px)' }, { name: 'medium', media: '(min-width: 768px)' }, { name: 'low', media: '(max-width: 767px)' } ]; if (this.connectionSpeed==='slow') { return qualities.filter(q => q.name==='low'); } return qualities; } getVideoSrcForQuality(src, quality) { const url=new URL(src, window.location.origin); url.searchParams.set('quality', quality.name); return url.toString(); } setupMediaObserver() { const observer=new MutationObserver((mutations) => { mutations.forEach(mutation => { mutation.addedNodes.forEach(node => { if (node.nodeType===1) { if (node.tagName==='IMG') { this.optimizeImage(node); } if (node.tagName==='VIDEO') { this.optimizeVideo(node); } const images=node.querySelectorAll && node.querySelectorAll('img:not([data-optimized])'); if (images) { images.forEach(img => this.optimizeImage(img)); } const videos=node.querySelectorAll && node.querySelectorAll('video:not([data-optimized])'); if (videos) { videos.forEach(video => this.optimizeVideo(video)); } } }); }); }); observer.observe(document.body, { childList: true, subtree: true }); } setupIntersectionObserver(img) { const observer=new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) { const target=entry.target; const src=target.dataset.src || target.src; if (src && src!==target.src) { target.src=src; } observer.unobserve(target); } }); }, { rootMargin: '50px 0px', threshold: 0.1 }); observer.observe(img); } setupVideoIntersectionObserver(video) { const observer=new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) { if (video.paused && this.connectionSpeed!=='slow') { video.play().catch(() => { }); } } else { if (!video.paused) { video.pause(); } } }); }, { threshold: 0.5 }); observer.observe(video); } optimizeBackgroundImages() { const elementsWithBg=document.querySelectorAll('[style*="background-image"]'); elementsWithBg.forEach(element => { const style=getComputedStyle(element); const bgImage=style.backgroundImage; if (bgImage && bgImage!=='none') { const urlMatch=bgImage.match(/url\(['"]?([^'"]+)['"]?\)/); if (urlMatch) { const originalUrl=urlMatch[1]; const optimizedUrl=this.getOptimizedImageSrc(originalUrl); element.style.backgroundImage=`url('${optimizedUrl}')`; } } }); } reoptimize() { this.analyzeConnection(); this.analyzeDeviceCapabilities(); this.optimizeExistingMedia(); } getStats() { const optimizedImages=document.querySelectorAll('img[data-optimized]').length; const optimizedVideos=document.querySelectorAll('video[data-optimized]').length; return { formats: { avif: this.supportsAVIF, webp: this.supportsWebP }, connection: this.connectionSpeed, quality: this.qualityLevel, device: this.deviceCapabilities, optimized: { images: optimizedImages, videos: optimizedVideos } }; } } document.addEventListener('DOMContentLoaded', () => { window.GeeknDragonMediaOptimizer=new MediaOptimizer(); if (window.location.hostname==='localhost') { window._debugMedia=window.GeeknDragonMediaOptimizer; } }); })();
/* Source: performance-monitor.js */
(function() { 'use strict'; class PerformanceMonitor { constructor() { this.metrics={ webVitals: {}, business: {}, technical: {}, userExperience: {} }; this.thresholds={ LCP: { good: 2500, poor: 4000 }, FID: { good: 100, poor: 300 }, CLS: { good: 0.1, poor: 0.25 }, FCP: { good: 1800, poor: 3000 }, TTFB: { good: 800, poor: 1800 } }; this.observers=[]; this.startTime=performance.now(); this.isMonitoring=false; this.init(); } async init() { await this.loadWebVitalsLibrary(); this.startWebVitalsMonitoring(); this.startBusinessMetrics(); this.startTechnicalMetrics(); this.startUserExperienceMetrics(); this.setupAutomaticReporting(); this.isMonitoring=true; } async loadWebVitalsLibrary() { if (window.webVitals) return; try { const script=document.createElement('script'); script.src='https: script.async=true; await new Promise((resolve, reject) => { script.onload=resolve; script.onerror=reject; document.head.appendChild(script); }); } catch (e) { this.usePerformanceObserverFallback(); } } startWebVitalsMonitoring() { if (window.webVitals) { webVitals.onLCP(this.handleLCP.bind(this)); webVitals.onFID(this.handleFID.bind(this)); webVitals.onCLS(this.handleCLS.bind(this)); webVitals.onFCP(this.handleFCP.bind(this)); webVitals.onTTFB(this.handleTTFB.bind(this)); } else { this.usePerformanceObserverFallback(); } } handleLCP(metric) { this.metrics.webVitals.LCP={ value: metric.value, rating: this.getRating(metric.value, 'LCP'), entries: metric.entries, timestamp: Date.now() }; this.reportMetric('LCP', this.metrics.webVitals.LCP); if (this.metrics.webVitals.LCP.rating==='poor') { this.alertPerformanceIssue('LCP', metric.value); } } handleFID(metric) { this.metrics.webVitals.FID={ value: metric.value, rating: this.getRating(metric.value, 'FID'), entries: metric.entries, timestamp: Date.now() }; this.reportMetric('FID', this.metrics.webVitals.FID); if (this.metrics.webVitals.FID.rating==='poor') { this.alertPerformanceIssue('FID', metric.value); } } handleCLS(metric) { this.metrics.webVitals.CLS={ value: metric.value, rating: this.getRating(metric.value, 'CLS'), entries: metric.entries, timestamp: Date.now() }; this.reportMetric('CLS', this.metrics.webVitals.CLS); if (this.metrics.webVitals.CLS.rating==='poor') { this.alertPerformanceIssue('CLS', metric.value); } } handleFCP(metric) { this.metrics.webVitals.FCP={ value: metric.value, rating: this.getRating(metric.value, 'FCP'), timestamp: Date.now() }; this.reportMetric('FCP', this.metrics.webVitals.FCP); } handleTTFB(metric) { this.metrics.webVitals.TTFB={ value: metric.value, rating: this.getRating(metric.value, 'TTFB'), timestamp: Date.now() }; this.reportMetric('TTFB', this.metrics.webVitals.TTFB); } startBusinessMetrics() { this.monitorSnipcartPerformance(); this.monitorProductImageLoading(); this.monitorCartInteractions(); this.monitorCheckoutFlow(); } monitorSnipcartPerformance() { const originalFetch=window.fetch; window.fetch=async (...args) => { const [url]=args; if (url.includes('snipcart') || url.includes('api.snipcart')) { const startTime=performance.now(); try { const response=await originalFetch.apply(this, args); const endTime=performance.now(); this.metrics.business.snipcart_api={ url: url, duration: endTime-startTime, success: response.ok, status: response.status, timestamp: Date.now() }; if (endTime-startTime > 2000) { this.alertPerformanceIssue('SNIPCART_SLOW', endTime-startTime); } return response; } catch (error) { const endTime=performance.now(); this.metrics.business.snipcart_api={ url: url, duration: endTime-startTime, success: false, error: error.message, timestamp: Date.now() }; this.alertPerformanceIssue('SNIPCART_ERROR', error.message); throw error; } } return originalFetch.apply(this, args); }; } monitorProductImageLoading() { const observer=new PerformanceObserver((list) => { list.getEntries().forEach(entry => { if (entry.name.includes('/images/') && entry.name.includes('product')) { this.metrics.business.product_images=this.metrics.business.product_images || []; this.metrics.business.product_images.push({ url: entry.name, loadTime: entry.responseEnd-entry.startTime, size: entry.transferSize || 0, rating: entry.responseEnd-entry.startTime < 1000 ? 'good' : entry.responseEnd-entry.startTime < 2500 ? 'needs-improvement' : 'poor', timestamp: Date.now() }); if (this.metrics.business.product_images.length > 50) { this.metrics.business.product_images=this.metrics.business.product_images.slice(-50); } } }); }); observer.observe({ entryTypes: ['resource'] }); this.observers.push(observer); } monitorCartInteractions() { let interactionStartTime; document.addEventListener('click', (e) => { if (e.target.closest('.gd-add-to-cart, .snipcart-add-item')) { interactionStartTime=performance.now(); const observer=new MutationObserver(() => { const cart=document.querySelector('.snipcart-cart'); if (cart && cart.style.display!=='none') { const interactionTime=performance.now()-interactionStartTime; this.metrics.business.cart_interaction={ type: 'add_to_cart', duration: interactionTime, rating: interactionTime < 500 ? 'excellent' : interactionTime < 1000 ? 'good' : interactionTime < 2000 ? 'needs-improvement' : 'poor', timestamp: Date.now() }; observer.disconnect(); if (interactionTime > 2000) { this.alertPerformanceIssue('CART_SLOW', interactionTime); } } }); observer.observe(document.body, { childList: true, subtree: true, attributes: true, attributeFilter: ['style', 'class'] }); setTimeout(() => observer.disconnect(), 5000); } }); } monitorCheckoutFlow() { const observer=new MutationObserver((mutations) => { mutations.forEach(mutation => { mutation.addedNodes.forEach(node => { if (node.nodeType===1 && node.classList) { if (node.classList.contains('snipcart-checkout')) { this.metrics.business.checkout_start={ timestamp: Date.now(), page_load_time: performance.now()-this.startTime }; } if (node.classList.contains('snipcart-checkout-step-payment')) { this.metrics.business.checkout_payment_step={ timestamp: Date.now(), time_to_payment: Date.now()-(this.metrics.business.checkout_start?.timestamp || Date.now()) }; } } }); }); }); observer.observe(document.body, { childList: true, subtree: true }); this.observers.push(observer); } startTechnicalMetrics() { this.monitorMemoryUsage(); this.monitorNetworkConditions(); this.monitorBrowserCapabilities(); this.monitorErrorRates(); } monitorMemoryUsage() { if ('memory' in performance) { setInterval(() => { this.metrics.technical.memory={ used: performance.memory.usedJSHeapSize, total: performance.memory.totalJSHeapSize, limit: performance.memory.jsHeapSizeLimit, usage_percentage: (performance.memory.usedJSHeapSize/performance.memory.jsHeapSizeLimit)*100, timestamp: Date.now() }; if (this.metrics.technical.memory.usage_percentage > 80) { this.alertPerformanceIssue('HIGH_MEMORY_USAGE', this.metrics.technical.memory.usage_percentage); } }, 10000); } } monitorNetworkConditions() { if ('connection' in navigator) { const updateConnectionInfo=() => { this.metrics.technical.network={ effectiveType: navigator.connection.effectiveType, downlink: navigator.connection.downlink, rtt: navigator.connection.rtt, saveData: navigator.connection.saveData, timestamp: Date.now() }; }; updateConnectionInfo(); navigator.connection.addEventListener('change', updateConnectionInfo); } } monitorBrowserCapabilities() { this.metrics.technical.capabilities={ webp: this.testImageFormat('data:image/webp;base64,UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA=='), avif: this.testImageFormat('data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYx'), webgl: !!document.createElement('canvas').getContext('webgl'), webgl2: !!document.createElement('canvas').getContext('webgl2'), intersectionObserver: 'IntersectionObserver' in window, serviceWorker: 'serviceWorker' in navigator, pushManager: 'PushManager' in window, hardwareConcurrency: navigator.hardwareConcurrency || 'unknown', deviceMemory: navigator.deviceMemory || 'unknown', timestamp: Date.now() }; } async testImageFormat(dataUri) { return new Promise((resolve) => { const img=new Image(); img.onload=() => resolve(true); img.onerror=() => resolve(false); img.src=dataUri; }); } monitorErrorRates() { let errorCount=0; let totalInteractions=0; window.addEventListener('error', (e) => { errorCount++; this.metrics.technical.error_rate=(errorCount/Math.max(totalInteractions, 1))*100; this.logError('JavaScript Error', e.error, e.filename, e.lineno); }); window.addEventListener('unhandledrejection', (e) => { errorCount++; this.metrics.technical.error_rate=(errorCount/Math.max(totalInteractions, 1))*100; this.logError('Promise Rejection', e.reason); }); ['click', 'keydown', 'scroll'].forEach(eventType => { document.addEventListener(eventType, () => { totalInteractions++; }, { passive: true }); }); } startUserExperienceMetrics() { this.monitorScrollBehavior(); this.monitorInteractionResponsiveness(); this.monitorFormPerformance(); this.monitorAccessibility(); } monitorScrollBehavior() { let scrollCount=0; let totalScrollDistance=0; let lastScrollY=window.scrollY; const scrollHandler=() => { scrollCount++; totalScrollDistance += Math.abs(window.scrollY-lastScrollY); lastScrollY=window.scrollY; this.metrics.userExperience.scroll={ scroll_count: scrollCount, average_scroll_distance: totalScrollDistance/scrollCount, current_scroll_percentage: (window.scrollY/(document.body.scrollHeight-window.innerHeight))*100, timestamp: Date.now() }; }; window.addEventListener('scroll', scrollHandler, { passive: true }); } monitorInteractionResponsiveness() { let interactionTimes=[]; ['click', 'keydown', 'input'].forEach(eventType => { document.addEventListener(eventType, (e) => { const startTime=performance.now(); requestAnimationFrame(() => { const responseTime=performance.now()-startTime; interactionTimes.push(responseTime); if (interactionTimes.length > 100) { interactionTimes=interactionTimes.slice(-100); } this.metrics.userExperience.responsiveness={ average_response_time: interactionTimes.reduce((a, b) => a+b, 0)/interactionTimes.length, p95_response_time: this.getPercentile(interactionTimes, 95), slow_interactions: interactionTimes.filter(t => t > 16).length, total_interactions: interactionTimes.length, timestamp: Date.now() }; }); }, { passive: true }); }); } monitorFormPerformance() { const forms=document.querySelectorAll('form, .snipcart-form'); forms.forEach(form => { let formStartTime; form.addEventListener('focusin', () => { if (!formStartTime) { formStartTime=performance.now(); } }); form.addEventListener('submit', () => { if (formStartTime) { const completionTime=performance.now()-formStartTime; this.metrics.userExperience.form_performance={ completion_time: completionTime, form_id: form.id || 'unnamed_form', rating: completionTime < 30000 ? 'fast' : completionTime < 120000 ? 'normal' : 'slow', timestamp: Date.now() }; } }); }); } monitorAccessibility() { const checks={ alt_text_missing: document.querySelectorAll('img:not([alt])').length, links_without_text: document.querySelectorAll('a:empty').length, buttons_without_text: document.querySelectorAll('button:empty').length, form_labels_missing: document.querySelectorAll('input:not([aria-label]):not([aria-labelledby])').length }; this.metrics.userExperience.accessibility={ ...checks, total_issues: Object.values(checks).reduce((sum, count) => sum+count, 0), timestamp: Date.now() }; } getRating(value, metric) { const thresholds=this.thresholds[metric]; if (!thresholds) return 'unknown'; if (value <= thresholds.good) return 'good'; if (value <= thresholds.poor) return 'needs-improvement'; return 'poor'; } getPercentile(arr, percentile) { const sorted=arr.slice().sort((a, b) => a-b); const index=Math.ceil((percentile/100)*sorted.length)-1; return sorted[index] || 0; } usePerformanceObserverFallback() { try { const lcpObserver=new PerformanceObserver((list) => { const entries=list.getEntries(); const lastEntry=entries[entries.length-1]; this.handleLCP({ value: lastEntry.startTime, entries }); }); lcpObserver.observe({ entryTypes: ['largest-contentful-paint'] }); const fcpObserver=new PerformanceObserver((list) => { const entries=list.getEntries(); entries.forEach(entry => { if (entry.name==='first-contentful-paint') { this.handleFCP({ value: entry.startTime }); } }); }); fcpObserver.observe({ entryTypes: ['paint'] }); this.observers.push(lcpObserver, fcpObserver); } catch (e) { } } setupAutomaticReporting() { setInterval(() => { this.sendMetricsToServer(); }, 30000); window.addEventListener('beforeunload', () => { this.sendFinalReport(); }); setInterval(() => { this.generateSessionReport(); }, 300000); } async sendMetricsToServer() { if (!this.isMonitoring) return; const payload={ timestamp: Date.now(), page_url: window.location.pathname, user_agent: navigator.userAgent, viewport: `${window.innerWidth}x${window.innerHeight}`, metrics: this.metrics }; try { await fetch('/api/performance-metrics', { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest' }, body: JSON.stringify(payload) }); } catch (e) { } } sendFinalReport() { const report=this.generateSessionReport(); if (navigator.sendBeacon) { navigator.sendBeacon('/api/performance-session-end', JSON.stringify(report)); } } generateSessionReport() { const sessionDuration=Date.now()-this.startTime; return { session_id: this.getSessionId(), duration: sessionDuration, page_url: window.location.pathname, web_vitals_summary: this.getWebVitalsSummary(), business_summary: this.getBusinessSummary(), technical_summary: this.getTechnicalSummary(), ux_summary: this.getUXSummary(), overall_score: this.calculateOverallScore(), recommendations: this.generateRecommendations(), timestamp: Date.now() }; } getSessionId() { if (!sessionStorage.getItem('gd_perf_session')) { sessionStorage.setItem('gd_perf_session', 'session_'+Date.now()+'_'+Math.random().toString(36).substr(2, 9)); } return sessionStorage.getItem('gd_perf_session'); } getWebVitalsSummary() { const vitals=this.metrics.webVitals; let score=0; let total=0; Object.entries(vitals).forEach(([key, data]) => { total++; if (data.rating==='good') score += 100; else if (data.rating==='needs-improvement') score += 50; }); return { score: total > 0 ? score/total : 0, details: vitals }; } getBusinessSummary() { const business=this.metrics.business; return { snipcart_health: business.snipcart_api?.success ? 'healthy' : 'issues', average_image_load_time: this.getAverageImageLoadTime(), cart_performance: business.cart_interaction?.rating || 'unknown', checkout_conversion_rate: this.estimateConversionHealth() }; } getAverageImageLoadTime() { const images=this.metrics.business.product_images || []; if (images.length===0) return 0; const total=images.reduce((sum, img) => sum+img.loadTime, 0); return total/images.length; } estimateConversionHealth() { const webVitalsScore=this.getWebVitalsSummary().score; const cartPerf=this.metrics.business.cart_interaction?.rating; if (webVitalsScore > 80 && cartPerf==='excellent') return 'optimal'; if (webVitalsScore > 60 && cartPerf!=='poor') return 'good'; return 'needs-improvement'; } getTechnicalSummary() { return { memory_health: this.metrics.technical.memory?.usage_percentage < 60 ? 'healthy' : 'warning', network_quality: this.metrics.technical.network?.effectiveType || 'unknown', error_rate: this.metrics.technical.error_rate || 0, browser_compatibility: this.calculateCompatibilityScore() }; } calculateCompatibilityScore() { const caps=this.metrics.technical.capabilities || {}; const modernFeatures=['webp', 'intersectionObserver', 'serviceWorker']; const supported=modernFeatures.filter(feature => caps[feature]).length; return (supported/modernFeatures.length)*100; } getUXSummary() { const ux=this.metrics.userExperience; return { scroll_engagement: ux.scroll?.current_scroll_percentage > 50 ? 'engaged' : 'limited', interaction_smoothness: ux.responsiveness?.average_response_time < 16 ? 'smooth' : 'choppy', accessibility_score: this.calculateAccessibilityScore(), form_usability: ux.form_performance?.rating || 'unknown' }; } calculateAccessibilityScore() { const a11y=this.metrics.userExperience.accessibility || {}; const totalIssues=a11y.total_issues || 0; if (totalIssues===0) return 100; if (totalIssues < 5) return 80; if (totalIssues < 10) return 60; return 40; } calculateOverallScore() { const webVitals=this.getWebVitalsSummary().score; const business=this.getBusinessHealth(); const technical=this.getTechnicalHealth(); const ux=this.getUXHealth(); return Math.round((webVitals*0.3+business*0.3+technical*0.2+ux*0.2)); } getBusinessHealth() { const summary=this.getBusinessSummary(); let score=0; if (summary.snipcart_health==='healthy') score += 25; if (summary.average_image_load_time < 1000) score += 25; if (summary.cart_performance==='excellent') score += 25; if (summary.checkout_conversion_rate==='optimal') score += 25; return score; } getTechnicalHealth() { const summary=this.getTechnicalSummary(); let score=0; if (summary.memory_health==='healthy') score += 25; if (summary.error_rate < 1) score += 25; if (summary.browser_compatibility > 80) score += 25; if (summary.network_quality==='4g') score += 25; return score; } getUXHealth() { const summary=this.getUXSummary(); let score=0; if (summary.scroll_engagement==='engaged') score += 25; if (summary.interaction_smoothness==='smooth') score += 25; if (summary.accessibility_score > 80) score += 25; if (summary.form_usability==='fast') score += 25; return score; } generateRecommendations() { const recommendations=[]; const overall=this.calculateOverallScore(); if (this.metrics.webVitals.LCP?.rating==='poor') { recommendations.push('Optimiser le temps de chargement du plus grand √©l√©ment (LCP > 4s)'); } if (this.metrics.webVitals.FID?.rating==='poor') { recommendations.push('R√©duire le temps de r√©ponse aux interactions (FID > 300ms)'); } if (this.metrics.webVitals.CLS?.rating==='poor') { recommendations.push('Stabiliser la mise en page pour √©viter les d√©placements (CLS > 0.25)'); } if (this.getAverageImageLoadTime() > 2000) { recommendations.push('Optimiser la compression des images produits'); } if (this.metrics.business.cart_interaction?.rating==='poor') { recommendations.push('Am√©liorer la r√©activit√© du syst√®me de panier'); } if (this.metrics.technical.memory?.usage_percentage > 70) { recommendations.push('Optimiser l\'utilisation m√©moire JavaScript'); } if (this.metrics.technical.error_rate > 2) { recommendations.push('R√©duire le taux d\'erreurs JavaScript'); } if (overall < 60) { recommendations.push('Performance g√©n√©rale √† am√©liorer-score global faible'); } return recommendations; } reportMetric(metricName, data) { if (window.GeeknDragonAnalytics) { window.GeeknDragonAnalytics.trackEvent('performance_metric', { metric_name: metricName, metric_value: data.value, metric_rating: data.rating }); } } alertPerformanceIssue(issueType, value) { fetch('/api/performance-alert', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ issue_type: issueType, value: value, timestamp: Date.now(), page_url: window.location.pathname, user_agent: navigator.userAgent }) }).catch(e => ); } logError(type, error, filename, lineno) { const errorData={ type: type, message: error.message || error, filename: filename, line: lineno, stack: error.stack, timestamp: Date.now(), page_url: window.location.pathname }; fetch('/api/error-log', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(errorData) }).catch(() => {}); } getMetrics() { return this.metrics; } getOverallScore() { return this.calculateOverallScore(); } getRecommendations() { return this.generateRecommendations(); } getSessionReport() { return this.generateSessionReport(); } forceReport() { this.sendMetricsToServer(); return this.generateSessionReport(); } destroy() { this.observers.forEach(observer => observer.disconnect()); this.isMonitoring=false; } } document.addEventListener('DOMContentLoaded', () => { window.GeeknDragonPerformanceMonitor=new PerformanceMonitor(); if (window.location.hostname==='localhost') { window._debugPerf=window.GeeknDragonPerformanceMonitor; setInterval(() => { const report=window._debugPerf.getSessionReport(); }, 60000); } }); })();
/* Source: product-gallery.js */
(function productGallery() { const config={ zoomLevel: 2, transitionDuration: 300, swipeThreshold: 50, autoCloseDelay: 5000, }; const state={ currentIndex: 0, images: [], isZoomed: false, isDragging: false, startX: 0, startY: 0, currentX: 0, currentY: 0, }; const elements={}; function setupImageData() { const thumbnails=document.querySelectorAll('.thumbnail'); state.images=Array.from(thumbnails).map((thumb) => ({ src: thumb.dataset.src || thumb.src, alt: thumb.alt || '', type: thumb.dataset.type || 'image', })); } function switchToImage(index) { if (index < 0 || index >= state.images.length) return; state.currentIndex=index; const image=state.images[index]; if (elements.mainMedia) { elements.mainMedia.src=image.src; elements.mainMedia.alt=image.alt; } const thumbnails=document.querySelectorAll('.thumbnail'); thumbnails.forEach((thumb, i) => { if (i===index) { thumb.classList.add('active'); } else { thumb.classList.remove('active'); } }); } function toggleZoom() { if (!elements.mainMedia) return; state.isZoomed=!state.isZoomed; elements.mainMedia.style.transform=state.isZoomed ? `scale(${config.zoomLevel})` : 'scale(1)'; } function openFullscreen() { if (!elements.fullscreenModal) return; elements.fullscreenModal.style.display='flex'; document.body.style.overflow='hidden'; if (elements.fullscreenMedia) { const currentImage=state.images[state.currentIndex]; elements.fullscreenMedia.src=currentImage.src; elements.fullscreenMedia.alt=currentImage.alt; } } function closeFullscreen() { if (!elements.fullscreenModal) return; elements.fullscreenModal.style.display='none'; document.body.style.overflow=''; state.isZoomed=false; } function navigateGallery(direction) { const newIndex=state.currentIndex+direction; if (newIndex >= 0 && newIndex < state.images.length) { switchToImage(newIndex); } } function bindEvents() { const thumbnails=document.querySelectorAll('.thumbnail'); thumbnails.forEach((thumb, index) => { thumb.addEventListener('click', () => switchToImage(index)); }); if (elements.zoomBtn) { elements.zoomBtn.addEventListener('click', toggleZoom); } if (elements.fullscreenBtn) { elements.fullscreenBtn.addEventListener('click', openFullscreen); } if (elements.closeBtn) { elements.closeBtn.addEventListener('click', closeFullscreen); } if (elements.fsPrev) { elements.fsPrev.addEventListener('click', () => navigateGallery(-1)); } if (elements.fsNext) { elements.fsNext.addEventListener('click', () => navigateGallery(1)); } document.addEventListener('keydown', (e) => { if (elements.fullscreenModal && elements.fullscreenModal.style.display==='flex') { switch (e.key) { case 'Escape': closeFullscreen(); break; case 'ArrowLeft': navigateGallery(-1); break; case 'ArrowRight': navigateGallery(1); break; default: break; } } }); } function setupElements() { elements.mainMedia=document.getElementById('main-media'); elements.thumbnails=document.querySelectorAll('.thumbnail'); elements.fullscreenModal=document.getElementById('fullscreen-modal'); elements.fullscreenMedia=document.getElementById('fullscreen-media'); elements.zoomBtn=document.getElementById('zoom-btn'); elements.fullscreenBtn=document.getElementById('fullscreen-btn'); elements.closeBtn=document.getElementById('close-fullscreen'); elements.fsPrev=document.getElementById('fs-prev'); elements.fsNext=document.getElementById('fs-next'); } function init() { if (!document.querySelector('.product-gallery-container')) return; setupElements(); setupImageData(); bindEvents(); } if (document.readyState==='loading') { document.addEventListener('DOMContentLoaded', init); } else { init(); } }());
/* Source: product-recommendations.js */
(function() { 'use strict'; class ProductRecommendationSystem { constructor() { this.recommendations=[]; this.userContext={}; this.displayedRecommendations=new Set(); this.interactionData={ views: [], clicks: [], hovers: [], dismissals: [] }; this.config={ maxDisplayed: 6, refreshInterval: 300000, animationDelay: 100, trackingEnabled: true, autoRefresh: true }; this.templates=this.initializeTemplates(); this.init(); } async init() { await this.gatherUserContext(); await this.loadInitialRecommendations(); this.displayContextualRecommendations(); this.setupInteractionTracking(); if (this.config.autoRefresh) { this.setupAutoRefresh(); } } async gatherUserContext() { this.userContext={ session_id: this.getSessionId(), page_url: window.location.pathname, page_views: this.getPageViews(), time_on_site: this.getTimeOnSite(), scroll_depth: this.getScrollDepth(), interactions_count: this.getInteractionsCount(), cart_products: this.getCartProducts(), cart_value: this.getCartValue(), device_type: this.getDeviceType(), preferred_themes: this.getPreferredThemes(), price_sensitivity: this.getPriceSensitivity(), user_segment: this.detectUserSegment(), viewed_products: this.getViewedProducts(), previous_purchases: this.getPreviousPurchases(), ab_tests: this.getABTestVariations(), referrer: document.referrer, timestamp: Date.now() }; } async loadInitialRecommendations() { const pageContext=this.getPageContext(); try { const response=await fetch('/api/recommendations', { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest' }, body: JSON.stringify({ context: this.userContext, page_context: pageContext, current_product: this.getCurrentProductId(), max_results: this.config.maxDisplayed }) }); if (response.ok) { const data=await response.json(); this.recommendations=data.recommendations || []; this.userContext.user_profile=data.detected_profile || 'nouveau_joueur'; } else { this.loadFallbackRecommendations(); } } catch (error) { this.loadFallbackRecommendations(); } } displayContextualRecommendations() { const pageContext=this.getPageContext(); switch (pageContext) { case 'homepage': this.displayHomepageRecommendations(); break; case 'product_page': this.displayProductPageRecommendations(); break; case 'boutique': this.displayShopRecommendations(); break; case 'cart': this.displayCartRecommendations(); break; default: this.displayGenericRecommendations(); } } displayHomepageRecommendations() { const container=document.querySelector('.hero-recommendations') || this.createRecommendationContainer('hero-recommendations', 'hero-section'); if (!container) return; const topRecommendations=this.recommendations.slice(0, 3); container.innerHTML=` <div class="recommendations-header"> <h3 class="text-2xl font-bold text-purple-800 mb-4"> <i class="fas fa-magic mr-2"></i> Recommand√© pour vous </h3> <p class="text-gray-600 mb-6">S√©lection personnalis√©e bas√©e sur votre profil de joueur</p> </div> <div class="recommendations-grid grid grid-cols-1 md:grid-cols-3 gap-6"> ${topRecommendations.map((rec, index) => this.renderRecommendationCard(rec, 'homepage', index)).join('')} </div> `; this.animateRecommendations(container); this.trackRecommendationViews(topRecommendations, 'homepage'); } displayProductPageRecommendations() { const relatedContainer=this.createRecommendationContainer('related-products', '.product-details', 'afterend'); const relatedRecs=this.recommendations.filter(r => ['upsell', 'cross_sell', 'complementary'].includes(r.recommendation_type) ); if (relatedRecs.length > 0 && relatedContainer) { relatedContainer.innerHTML=` <section class="related-products bg-gradient-to-r from-purple-50 to-blue-50 py-12 mt-12 rounded-xl"> <div class="container mx-auto px-4"> <h3 class="text-3xl font-bold text-center mb-8 text-purple-800"> <i class="fas fa-sparkles mr-2"></i> Perfectionnez votre collection </h3> <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"> ${relatedRecs.slice(0, 3).map((rec, index) => this.renderRecommendationCard(rec, 'product_page', index)).join('')} </div> </div> </section> `; this.animateRecommendations(relatedContainer); this.trackRecommendationViews(relatedRecs.slice(0, 3), 'product_page'); } this.displayFloatingRecommendation(); } displayShopRecommendations() { const container=this.createRecommendationContainer('shop-recommendations', '.products-grid', 'beforebegin'); if (!container) return; const personalizedRecs=this.recommendations.filter(r => r.confidence > 0.7).slice(0, 4); container.innerHTML=` <section class="shop-recommendations bg-white border-2 border-purple-200 rounded-xl p-6 mb-8 shadow-lg"> <div class="flex items-center justify-between mb-6"> <div> <h3 class="text-2xl font-bold text-purple-800"> <i class="fas fa-user-crown mr-2"></i> S√©lection personnalis√©e </h3> <p class="text-gray-600">Bas√©e sur votre profil : <span class="font-semibold">${this.getProfileDisplayName()}</span></p> </div> <button class="refresh-recommendations text-purple-600 hover:text-purple-800 transition-colors"> <i class="fas fa-sync-alt"></i> </button> </div> <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"> ${personalizedRecs.map((rec, index) => this.renderCompactRecommendationCard(rec, 'boutique', index)).join('')} </div> </section> `; container.querySelector('.refresh-recommendations')?.addEventListener('click', () => { this.refreshRecommendations('boutique'); }); this.animateRecommendations(container); this.trackRecommendationViews(personalizedRecs, 'boutique'); } displayCartRecommendations() { const container=this.createRecommendationContainer('cart-recommendations', '.cart-summary', 'afterend'); if (!container) return; const cartRecs=this.recommendations.filter(r => ['category_completion', 'value_threshold', 'impulse'].includes(r.recommendation_type) ); container.innerHTML=` <div class="cart-recommendations bg-yellow-50 border border-yellow-200 rounded-lg p-6 mt-6"> <h3 class="text-xl font-bold text-yellow-800 mb-4"> <i class="fas fa-lightbulb mr-2"></i> Compl√©tez votre commande </h3> <div class="space-y-4"> ${cartRecs.slice(0, 3).map((rec, index) => this.renderCartRecommendationCard(rec, index)).join('')} </div> </div> `; this.animateRecommendations(container); this.trackRecommendationViews(cartRecs.slice(0, 3), 'cart'); } displayFloatingRecommendation() { if (document.querySelector('.floating-recommendation')) return; const topRec=this.recommendations.find(r => r.confidence > 0.8); if (!topRec) return; const widget=document.createElement('div'); widget.className='floating-recommendation fixed bottom-4 right-4 z-50 max-w-sm bg-white rounded-xl shadow-2xl border-2 border-purple-200 p-4 transform translate-y-full transition-transform duration-500'; widget.dataset.recommendationId=topRec.product.id; widget.innerHTML=` <div class="flex items-start space-x-3"> <img src="/images/optimized-modern/webp/${topRec.product.id}-thumb.webp" alt="${topRec.product.name}" class="w-16 h-16 rounded-lg object-cover"> <div class="flex-1"> <p class="text-sm text-purple-600 font-semibold mb-1">Recommand√© pour vous</p> <h4 class="text-sm font-bold text-gray-800 mb-1">${topRec.product.name}</h4> <p class="text-xs text-gray-600 mb-2">${topRec.reason}</p> <div class="flex items-center justify-between"> <span class="text-lg font-bold text-purple-600">${topRec.product.price}$ CAD</span> <button class="add-floating-rec bg-purple-600 text-white px-3 py-1 rounded text-xs hover:bg-purple-700 transition-colors"> Ajouter </button> </div> </div> <button class="close-floating text-gray-400 hover:text-gray-600"> <i class="fas fa-times"></i> </button> </div> `; document.body.appendChild(widget); setTimeout(() => { widget.style.transform='translateY(0)'; }, 3000); widget.querySelector('.close-floating').addEventListener('click', () => { this.dismissFloatingRecommendation(widget, topRec); }); widget.querySelector('.add-floating-rec').addEventListener('click', () => { this.addRecommendationToCart(topRec); this.dismissFloatingRecommendation(widget, topRec); }); setTimeout(() => { if (document.body.contains(widget)) { this.dismissFloatingRecommendation(widget, topRec); } }, 15000); } renderRecommendationCard(recommendation, context, index) { const product=recommendation.product; const confidence=Math.round(recommendation.confidence*100); return ` <div class="recommendation-card group bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden border-2 border-transparent hover:border-purple-200 transform hover:-translate-y-2" data-rec-id="${product.id}" data-rec-type="${recommendation.recommendation_type}" data-rec-index="${index}" style="animation-delay: ${index*this.config.animationDelay}ms"> <div class="relative overflow-hidden"> <img src="/images/optimized-modern/webp/${product.id}-hero.webp" alt="${product.name}" class="w-full h-48 object-cover group-hover:scale-110 transition-transform duration-500"> <div class="absolute top-3 left-3"> <span class="bg-purple-600 text-white px-2 py-1 rounded-full text-xs font-semibold"> <i class="fas fa-robot mr-1"></i> ${confidence}% match </span> </div> ${recommendation.urgency ? ` <div class="absolute top-3 right-3"> <span class="bg-red-500 text-white px-2 py-1 rounded-full text-xs font-semibold animate-pulse"> <i class="fas fa-clock mr-1"></i> Derni√®re chance </span> </div> ` : ''} </div> <div class="p-6"> <h4 class="text-lg font-bold text-gray-800 mb-2 group-hover:text-purple-600 transition-colors"> ${product.name} </h4> <p class="text-sm text-gray-600 mb-3"> <i class="fas fa-info-circle mr-1 text-purple-500"></i> ${recommendation.reason} </p> <div class="flex items-center justify-between mb-4"> <span class="text-2xl font-bold text-purple-600">${product.price}$ CAD</span> ${recommendation.value_increase ? ` <span class="text-xs text-green-600 font-semibold"> +${recommendation.value_increase}$ de valeur </span> ` : ''} </div> <div class="flex space-x-2"> <button class="add-recommendation flex-1 bg-gradient-to-r from-purple-600 to-blue-600 text-white py-2 px-4 rounded-lg hover:from-purple-700 hover:to-blue-700 transition-all duration-300 transform hover:scale-105"> <i class="fas fa-shopping-cart mr-2"></i> Ajouter au panier </button> <button class="view-recommendation bg-gray-100 text-gray-600 py-2 px-3 rounded-lg hover:bg-gray-200 transition-colors"> <i class="fas fa-eye"></i> </button> </div> </div> </div> `; } renderCompactRecommendationCard(recommendation, context, index) { const product=recommendation.product; return ` <div class="compact-rec-card bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-4 hover:shadow-lg transition-all duration-300 border border-purple-100 hover:border-purple-300" data-rec-id="${product.id}" data-rec-type="${recommendation.recommendation_type}" data-rec-index="${index}"> <div class="flex items-center space-x-3"> <img src="/images/optimized-modern/webp/${product.id}-thumb.webp" alt="${product.name}" class="w-12 h-12 rounded-lg object-cover"> <div class="flex-1"> <h5 class="font-semibold text-sm text-gray-800 mb-1">${product.name}</h5> <p class="text-xs text-gray-600 mb-2">${recommendation.reason}</p> <div class="flex items-center justify-between"> <span class="text-sm font-bold text-purple-600">${product.price}$ CAD</span> <button class="add-compact-rec bg-purple-600 text-white px-2 py-1 rounded text-xs hover:bg-purple-700 transition-colors">+</button> </div> </div> </div> </div> `; } renderCartRecommendationCard(recommendation, index) { const product=recommendation.product; return ` <div class="cart-rec-card flex items-center space-x-4 bg-white rounded-lg p-4 border border-yellow-200 hover:border-yellow-400 transition-colors" data-rec-id="${product.id}" data-rec-type="${recommendation.recommendation_type}" data-rec-index="${index}"> <img src="/images/optimized-modern/webp/${product.id}-thumb.webp" alt="${product.name}" class="w-16 h-16 rounded-lg object-cover"> <div class="flex-1"> <h5 class="font-semibold text-gray-800 mb-1">${product.name}</h5> <p class="text-sm text-gray-600 mb-2">${recommendation.reason}</p> <span class="text-lg font-bold text-yellow-600">${product.price}$ CAD</span> </div> <button class="add-cart-rec bg-yellow-500 text-white px-4 py-2 rounded-lg hover:bg-yellow-600 transition-colors"> <i class="fas fa-plus mr-1"></i> Ajouter </button> </div> `; } setupInteractionTracking() { document.addEventListener('click', (e) => { const recCard=e.target.closest('[data-rec-id]'); if (!recCard) return; const recId=recCard.dataset.recId; const recType=recCard.dataset.recType; const recIndex=parseInt(recCard.dataset.recIndex); if (e.target.matches('.add-recommendation, .add-compact-rec, .add-cart-rec, .add-floating-rec')) { this.trackRecommendationClick(recId, recType, recIndex, 'add_to_cart'); this.addRecommendationToCart(this.findRecommendationById(recId)); } else if (e.target.matches('.view-recommendation')) { this.trackRecommendationClick(recId, recType, recIndex, 'view_product'); this.viewRecommendationProduct(recId); } }); document.addEventListener('mouseenter', (e) => { const recCard=e.target.closest('[data-rec-id]'); if (recCard && !recCard.dataset.hoverTracked) { recCard.dataset.hoverTracked='true'; this.trackRecommendationHover(recCard.dataset.recId, recCard.dataset.recType); } }, true); } trackRecommendationViews(recommendations, context) { recommendations.forEach((rec, index) => { this.interactionData.views.push({ product_id: rec.product.id, recommendation_type: rec.recommendation_type, context: context, position: index, confidence: rec.confidence, timestamp: Date.now() }); this.displayedRecommendations.add(rec.product.id); }); this.sendInteractionData('view'); } trackRecommendationClick(productId, recType, index, action) { this.interactionData.clicks.push({ product_id: productId, recommendation_type: recType, position: index, action: action, timestamp: Date.now() }); this.sendInteractionData('click'); if (window.GeeknDragonAnalytics) { window.GeeknDragonAnalytics.trackEvent('recommendation_click', { product_id: productId, recommendation_type: recType, position: index, action: action }); } } trackRecommendationHover(productId, recType) { this.interactionData.hovers.push({ product_id: productId, recommendation_type: recType, timestamp: Date.now() }); } addRecommendationToCart(recommendation) { const product=recommendation.product; if (window.Snipcart) { window.Snipcart.api.items.add({ id: product.id, name: product.name, price: product.price, url: window.location.href, description: `Recommand√©: ${recommendation.reason}` }); } this.showRecommendationFeedback(`‚ú® ${product.name} ajout√© au panier !`, 'success'); if (window.GeeknDragonAnalytics) { window.GeeknDragonAnalytics.trackAddToCart({ id: product.id, name: product.name, price: product.price, category: product.category, source: 'recommendation' }); } } viewRecommendationProduct(productId) { const productUrl=this.getProductUrl(productId); window.open(productUrl, '_blank'); } dismissFloatingRecommendation(widget, recommendation) { widget.style.transform='translateY(100%)'; setTimeout(() => { if (document.body.contains(widget)) { document.body.removeChild(widget); } }, 500); this.interactionData.dismissals.push({ product_id: recommendation.product.id, recommendation_type: recommendation.recommendation_type, timestamp: Date.now() }); } createRecommendationContainer(className, selector, position='beforeend') { const existing=document.querySelector(`.${className}`); if (existing) return existing; const target=document.querySelector(selector); if (!target) return null; const container=document.createElement('div'); container.className=className; if (position==='afterend') { target.insertAdjacentElement('afterend', container); } else if (position==='beforebegin') { target.insertAdjacentElement('beforebegin', container); } else { target.appendChild(container); } return container; } animateRecommendations(container) { const cards=container.querySelectorAll('.recommendation-card, .compact-rec-card, .cart-rec-card'); cards.forEach((card, index) => { card.style.opacity='0'; card.style.transform='translateY(20px)'; setTimeout(() => { card.style.transition='opacity 0.5s ease, transform 0.5s ease'; card.style.opacity='1'; card.style.transform='translateY(0)'; }, index*this.config.animationDelay); }); } showRecommendationFeedback(message, type='info') { const toast=document.createElement('div'); toast.className=`fixed top-4 right-4 z-50 px-6 py-3 rounded-lg text-white font-semibold transform translate-x-full transition-transform duration-300 ${ type==='success' ? 'bg-green-500' : type==='error' ? 'bg-red-500' : 'bg-blue-500' }`; toast.textContent=message; document.body.appendChild(toast); setTimeout(() => { toast.style.transform='translateX(0)'; }, 100); setTimeout(() => { toast.style.transform='translateX(100%)'; setTimeout(() => { if (document.body.contains(toast)) { document.body.removeChild(toast); } }, 300); }, 3000); } getPageContext() { const path=window.location.pathname; if (path==='/' || path==='/index.php') return 'homepage'; if (path.includes('boutique')) return 'boutique'; if (path.includes('lot') || path.includes('pack') || path.includes('triptyque')) return 'product_page'; if (path.includes('cart') || document.querySelector('.snipcart-cart')) return 'cart'; return 'general'; } getCurrentProductId() { const path=window.location.pathname; const productMatch=path.match(/\/(lot\d+|pack-[\w-]+|triptyque-[\w-]+)/); return productMatch ? productMatch[1] : null; } getSessionId() { return sessionStorage.getItem('gd_session_id') || 'anonymous_'+Date.now(); } getPageViews() { const views=parseInt(sessionStorage.getItem('gd_page_views') || '0'); sessionStorage.setItem('gd_page_views', (views+1).toString()); return views+1; } getTimeOnSite() { const startTime=parseInt(sessionStorage.getItem('gd_session_start') || Date.now().toString()); return Date.now()-startTime; } getScrollDepth() { const scrollPercent=Math.round( (window.scrollY/(document.body.scrollHeight-window.innerHeight))*100 ); return Math.min(100, Math.max(0, scrollPercent)); } getInteractionsCount() { return parseInt(sessionStorage.getItem('gd_interactions') || '0'); } getCartProducts() { if (window.Snipcart?.store?.getState) { const cart=window.Snipcart.store.getState().cart; return cart.items.items.map(item => item.id); } return []; } getCartValue() { if (window.Snipcart?.store?.getState) { const cart=window.Snipcart.store.getState().cart; return cart.subtotal; } return 0; } getDeviceType() { const width=window.innerWidth; if (width < 768) return 'mobile'; if (width < 1024) return 'tablet'; return 'desktop'; } getPreferredThemes() { const viewedPages=JSON.parse(sessionStorage.getItem('gd_viewed_pages') || '[]'); const themes=[]; if (viewedPages.some(p => p.includes('lot'))) themes.push('aventure', 'combat'); if (viewedPages.some(p => p.includes('pack'))) themes.push('√©quipement', 'exploration'); if (viewedPages.some(p => p.includes('triptyque'))) themes.push('h√©ros', 'myst√®re'); return themes.length > 0 ? themes : ['aventure', 'exploration']; } getPriceSensitivity() { const cartValue=this.getCartValue(); const pageViews=this.getPageViews(); if (cartValue===0 && pageViews > 5) return 'high'; if (cartValue > 200) return 'low'; return 'medium'; } detectUserSegment() { const pageViews=this.getPageViews(); const cartValue=this.getCartValue(); const timeOnSite=this.getTimeOnSite(); if (pageViews===1 && cartValue===0) return 'nouveau_visiteur'; if (cartValue > 200 || timeOnSite > 600000) return 'collectionneur'; if (cartValue > 100) return 'joueur_r√©gulier'; return 'nouveau_joueur'; } getViewedProducts() { return JSON.parse(sessionStorage.getItem('gd_viewed_products') || '[]'); } getPreviousPurchases() { return JSON.parse(localStorage.getItem('gd_purchase_history') || '[]'); } getABTestVariations() { if (window.GeeknDragonABTesting) { return window.GeeknDragonABTesting.activeTests; } return {}; } getProfileDisplayName() { const profiles={ 'nouveau_joueur': 'Nouveau Joueur', 'joueur_r√©gulier': 'Joueur R√©gulier', 'ma√Ætre_de_jeu': 'Ma√Ætre de Jeu', 'collectionneur': 'Collectionneur' }; return profiles[this.userContext.user_profile] || 'Joueur'; } getProductUrl(productId) { const urls={ 'lot10': '/lot10.php', 'lot25': '/lot25.php', 'lot50-essence': '/lot50-essence.php', 'lot50-tresorerie': '/lot50-tresorerie.php', 'pack-182-arsenal-aventurier': '/pack-arsenal.php', 'pack-182-butins-ingenieries': '/pack-butins.php', 'pack-182-routes-services': '/pack-routes.php', 'triptyque-aleatoire': '/triptyque.php' }; return urls[productId] || '/boutique.php'; } findRecommendationById(productId) { return this.recommendations.find(r => r.product.id===productId); } async sendInteractionData(type) { if (!this.config.trackingEnabled) return; try { await fetch('/api/recommendations/track', { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest' }, body: JSON.stringify({ type: type, data: this.interactionData[type==='view' ? 'views' : 'clicks'], context: this.userContext, timestamp: Date.now() }) }); } catch (error) { } } async refreshRecommendations(context) { await this.gatherUserContext(); await this.loadInitialRecommendations(); this.displayContextualRecommendations(); } setupAutoRefresh() { setInterval(() => { this.refreshRecommendations(this.getPageContext()); }, this.config.refreshInterval); } loadFallbackRecommendations() { this.recommendations=[ { product: { id: 'lot10', name: 'Lot de 10 pi√®ces m√©talliques', price: 60 }, reason: 'Choix populaire des nouveaux joueurs', confidence: 0.8, recommendation_type: 'popular' }, { product: { id: 'triptyque-aleatoire', name: 'Triptyque H√©ros Al√©atoire', price: 25 }, reason: 'Parfait compl√©ment pour vos aventures', confidence: 0.7, recommendation_type: 'complementary' } ]; } initializeTemplates() { return { }; } getRecommendationStats() { return { total_displayed: this.displayedRecommendations.size, interaction_data: this.interactionData, user_context: this.userContext, recommendations_count: this.recommendations.length }; } forceRefresh() { this.refreshRecommendations(this.getPageContext()); } } document.addEventListener('DOMContentLoaded', () => { window.GeeknDragonRecommendations=new ProductRecommendationSystem(); if (window.location.hostname==='localhost') { window._debugRecs=window.GeeknDragonRecommendations; } }); })();
/* Source: reviews-system.js */
(function() { 'use strict'; class ReviewsSystem { constructor() { this.currentProduct=this.detectCurrentProduct(); this.displayedReviews=[]; this.reviewsStats={}; this.userInteractions={ helpful_votes: new Set(), unhelpful_votes: new Set(), submitted_reviews: new Set() }; this.config={ maxReviewLength: 2000, minReviewLength: 10, autoLoadMore: true, animationDuration: 300, rateLimitMinutes: 60 }; this.init(); } async init() { await this.loadReviews(); this.renderReviewComponents(); this.setupEventListeners(); this.loadUserInteractions(); } async loadReviews(filters={}) { const defaultFilters={ product_id: this.currentProduct, limit: 10, offset: 0, sort_by: 'recent' }; const requestFilters={ ...defaultFilters, ...filters }; try { const response=await fetch('/api/reviews', { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest' }, body: JSON.stringify({ filters: requestFilters }) }); if (response.ok) { const data=await response.json(); if (filters.offset===0) { this.displayedReviews=data.reviews; this.reviewsStats={ total_count: data.total_count, average_rating: data.average_rating, rating_distribution: data.rating_distribution, pagination: data.pagination }; } else { this.displayedReviews=[...this.displayedReviews, ...data.reviews]; this.reviewsStats.pagination=data.pagination; } return data; } else { return null; } } catch (error) { return null; } } renderReviewComponents() { const pageType=this.detectPageType(); switch (pageType) { case 'product': this.renderProductPageReviews(); break; case 'homepage': this.renderHomepageTestimonials(); break; case 'boutique': this.renderShopReviewsSummary(); break; default: this.renderGenericReviews(); } } renderProductPageReviews() { const container=this.findOrCreateContainer('product-reviews', '.product-details'); if (!container) return; container.innerHTML=` <section class="product-reviews bg-white rounded-xl shadow-lg p-8 mt-12"> <!-- Header avec statistiques --> <div class="reviews-header mb-8"> <div class="flex items-center justify-between mb-6"> <h3 class="text-3xl font-bold text-gray-800"> <i class="fas fa-star text-yellow-400 mr-2"></i> Avis clients </h3> <button class="write-review-btn bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors"> <i class="fas fa-pen mr-2"></i> √âcrire un avis </button> </div> <div class="reviews-stats-container"> ${this.renderReviewsStats()} </div> </div> <!-- Formulaire de soumission (masqu√© par d√©faut) --> <div class="review-form-container hidden mb-8"> ${this.renderReviewForm()} </div> <!-- Filtres et tri --> <div class="reviews-controls mb-6"> ${this.renderReviewControls()} </div> <!-- Liste des reviews --> <div class="reviews-list"> ${this.renderReviewsList()} </div> <!-- Bouton charger plus --> <div class="load-more-container text-center mt-8"> ${this.renderLoadMoreButton()} </div> </section> `; this.animateComponent(container); } renderHomepageTestimonials() { const container=this.findOrCreateContainer('homepage-testimonials', '.hero-section', 'afterend'); if (!container) return; const featuredReviews=this.displayedReviews .filter(review => review.rating >= 4) .sort((a, b) => b.helpful_score-a.helpful_score) .slice(0, 3); container.innerHTML=` <section class="homepage-testimonials py-16 bg-gradient-to-r from-purple-50 to-blue-50"> <div class="container mx-auto px-4"> <div class="text-center mb-12"> <h2 class="text-4xl font-bold text-gray-800 mb-4"> <i class="fas fa-quote-left text-purple-600 mr-3"></i> Ce que disent nos joueurs </h2> <p class="text-xl text-gray-600">Plus de ${this.reviewsStats.total_count || 0} avis clients authentiques</p> <div class="flex justify-center items-center mt-6 space-x-4"> <div class="flex items-center"> ${this.renderStarRating(this.reviewsStats.average_rating)} <span class="ml-2 text-2xl font-bold text-gray-800"> ${(this.reviewsStats.average_rating || 0).toFixed(1)}/5 </span> </div> <span class="text-gray-400">|</span> <span class="text-gray-600">Note moyenne sur tous nos produits</span> </div> </div> <div class="testimonials-carousel"> <div class="grid grid-cols-1 md:grid-cols-3 gap-8"> ${featuredReviews.map((review, index) => this.renderTestimonialCard(review, index)).join('')} </div> </div> <div class="text-center mt-12"> <a href="/boutique.php" class="inline-block bg-purple-600 hover:bg-purple-700 text-white px-8 py-4 rounded-lg font-semibold text-lg transition-colors"> D√©couvrir nos produits <i class="fas fa-arrow-right ml-2"></i> </a> </div> </div> </section> `; } renderShopReviewsSummary() { const container=this.findOrCreateContainer('shop-reviews-summary', '.products-grid', 'beforebegin'); if (!container) return; container.innerHTML=` <div class="shop-reviews-summary bg-white border-2 border-purple-200 rounded-xl p-6 mb-8 shadow-lg"> <div class="flex items-center justify-between"> <div class="flex items-center space-x-6"> <div class="text-center"> <div class="text-3xl font-bold text-purple-600">${(this.reviewsStats.average_rating || 0).toFixed(1)}</div> <div class="flex justify-center mt-1"> ${this.renderStarRating(this.reviewsStats.average_rating)} </div> <div class="text-sm text-gray-600 mt-1">${this.reviewsStats.total_count || 0} avis</div> </div> <div class="border-l border-gray-200 pl-6"> <h3 class="text-lg font-semibold text-gray-800 mb-2"> <i class="fas fa-award text-yellow-500 mr-2"></i> Qualit√© reconnue par nos clients </h3> <p class="text-gray-600"> ${Math.round((this.reviewsStats.average_rating || 0)/5*100)}% de satisfaction ‚Ä¢ Fabrication qu√©b√©coise certifi√©e FLIM 2025 </p> </div> </div> <div class="text-center"> <button class="write-review-btn bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-all transform hover:scale-105"> <i class="fas fa-pen mr-2"></i> Partager votre avis </button> </div> </div> </div> `; } renderReviewForm() { return ` <div class="review-form bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-6 border-2 border-purple-200"> <h4 class="text-xl font-semibold text-gray-800 mb-6"> <i class="fas fa-edit text-purple-600 mr-2"></i> Partagez votre exp√©rience </h4> <form class="review-submission-form space-y-6"> <input type="hidden" name="product_id" value="${this.currentProduct || ''}"> <!-- Note --> <div> <label class="block text-sm font-medium text-gray-700 mb-2"> Votre note <span class="text-red-500">*</span> </label> <div class="star-rating-input flex items-center space-x-1"> ${Array.from({length: 5}, (_, i) => ` <button type="button" class="star-btn text-3xl text-gray-300 hover:text-yellow-400 transition-colors" data-rating="${i+1}"> <i class="fas fa-star"></i> </button> `).join('')} <span class="ml-4 text-sm text-gray-600 rating-text">Cliquez sur les √©toiles</span> </div> <input type="hidden" name="rating" class="rating-input" required> </div> <!-- Nom --> <div> <label for="author_name" class="block text-sm font-medium text-gray-700 mb-2"> Votre nom <span class="text-red-500">*</span> </label> <input type="text" id="author_name" name="author_name" required maxlength="100" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Entrez votre nom ou pseudonyme"> </div> <!-- Email (optionnel) --> <div> <label for="author_email" class="block text-sm font-medium text-gray-700 mb-2"> Email (optionnel) </label> <input type="email" id="author_email" name="author_email" maxlength="200" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Pour √™tre notifi√© de la validation"> <p class="text-xs text-gray-500 mt-1">Ne sera pas affich√© publiquement</p> </div> <!-- Contenu --> <div> <label for="review_content" class="block text-sm font-medium text-gray-700 mb-2"> Votre avis <span class="text-red-500">*</span> </label> <textarea id="review_content" name="content" required minlength="${this.config.minReviewLength}" maxlength="${this.config.maxReviewLength}" rows="5" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none" placeholder="Partagez votre exp√©rience avec ce produit... Qu'est-ce qui vous a plu ? Comment l'utilisez-vous dans vos parties ?"></textarea> <div class="flex justify-between mt-2"> <span class="text-xs text-gray-500">Minimum ${this.config.minReviewLength} caract√®res</span> <span class="text-xs text-gray-500 char-counter">0/${this.config.maxReviewLength}</span> </div> </div> <!-- Boutons --> <div class="flex items-center justify-between pt-4"> <button type="button" class="cancel-review-btn text-gray-600 hover:text-gray-800 font-medium transition-colors"> <i class="fas fa-times mr-1"></i> Annuler </button> <button type="submit" class="submit-review-btn bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white px-8 py-3 rounded-lg font-semibold transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"> <i class="fas fa-paper-plane mr-2"></i> Envoyer mon avis </button> </div> </form> </div> `; } renderReviewsStats() { if (!this.reviewsStats.rating_distribution) { return '<div class="text-center text-gray-500">Aucun avis pour le moment</div>'; } const total=this.reviewsStats.total_count; return ` <div class="reviews-stats grid grid-cols-1 md:grid-cols-2 gap-8"> <!-- Note moyenne --> <div class="text-center"> <div class="text-5xl font-bold text-purple-600 mb-2"> ${(this.reviewsStats.average_rating || 0).toFixed(1)} </div> <div class="flex justify-center mb-2"> ${this.renderStarRating(this.reviewsStats.average_rating)} </div> <p class="text-gray-600">Bas√© sur ${total} avis</p> </div> <!-- Distribution des notes --> <div class="rating-distribution space-y-2"> ${Array.from({length: 5}, (_, i) => { const stars=5-i; const count=this.reviewsStats.rating_distribution[stars] || 0; const percentage=total > 0 ? (count/total)*100 : 0; return ` <div class="flex items-center space-x-3"> <span class="text-sm font-medium w-16">${stars} √©toile${stars > 1 ? 's' : ''}</span> <div class="flex-1 bg-gray-200 rounded-full h-2"> <div class="bg-yellow-400 h-2 rounded-full transition-all duration-500" style="width: ${percentage}%"></div> </div> <span class="text-sm text-gray-600 w-12">${count}</span> </div> `; }).join('')} </div> </div> `; } renderReviewControls() { return ` <div class="flex flex-wrap items-center justify-between gap-4 p-4 bg-gray-50 rounded-lg"> <div class="flex items-center space-x-4"> <span class="text-sm font-medium text-gray-700">Trier par:</span> <select class="sort-select border border-gray-300 rounded px-3 py-1 text-sm focus:ring-2 focus:ring-purple-500"> <option value="recent">Plus r√©cents</option> <option value="rating_high">Note √©lev√©e</option> <option value="rating_low">Note faible</option> <option value="helpful">Plus utiles</option> </select> </div> <div class="flex items-center space-x-4"> <span class="text-sm font-medium text-gray-700">Filtrer par note:</span> <div class="flex space-x-1"> <button class="rating-filter-btn px-3 py-1 rounded text-sm border transition-colors hover:bg-purple-50" data-rating="all"> Tous </button> ${Array.from({length: 5}, (_, i) => ` <button class="rating-filter-btn px-3 py-1 rounded text-sm border transition-colors hover:bg-purple-50" data-rating="${5-i}"> ${5-i}‚òÖ </button> `).join('')} </div> </div> </div> `; } renderReviewsList() { if (this.displayedReviews.length===0) { return ` <div class="empty-reviews text-center py-12"> <i class="fas fa-comment-slash text-6xl text-gray-300 mb-4"></i> <h4 class="text-xl font-semibold text-gray-600 mb-2">Aucun avis pour le moment</h4> <p class="text-gray-500 mb-6">Soyez le premier √† partager votre exp√©rience !</p> <button class="write-review-btn bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors"> <i class="fas fa-pen mr-2"></i> √âcrire le premier avis </button> </div> `; } return ` <div class="reviews-container space-y-6"> ${this.displayedReviews.map((review, index) => this.renderReviewCard(review, index)).join('')} </div> `; } renderReviewCard(review, index) { return ` <div class="review-card bg-white border border-gray-200 rounded-lg p-6 hover:shadow-lg transition-all duration-300" data-review-id="${review.review_id}" style="animation-delay: ${index*100}ms"> <!-- Header --> <div class="flex items-start justify-between mb-4"> <div class="flex items-center space-x-3"> <div class="w-12 h-12 rounded-full bg-gradient-to-r from-purple-400 to-blue-400 flex items-center justify-center text-white font-bold text-lg"> ${review.display_name.charAt(0).toUpperCase()} </div> <div> <p class="font-semibold text-gray-800"> ${review.display_name} ${review.is_verified ? '<i class="fas fa-check-circle text-green-500 ml-1" title="Acheteur v√©rifi√©"></i>' : ''} </p> <p class="text-sm text-gray-500">${review.time_ago}</p> </div> </div> <div class="text-right"> <div class="flex items-center mb-1"> ${this.renderStarRating(review.rating)} </div> <span class="text-sm font-medium text-gray-600">${review.rating}/5</span> </div> </div> <!-- Contenu --> <div class="mb-4"> <p class="text-gray-800 leading-relaxed"> ${this.formatReviewContent(review.content)} </p> </div> <!-- Actions --> <div class="flex items-center justify-between pt-4 border-t border-gray-100"> <div class="flex items-center space-x-4"> <button class="helpful-btn flex items-center space-x-1 text-gray-600 hover:text-green-600 transition-colors ${this.userInteractions.helpful_votes.has(review.review_id) ? 'text-green-600' : ''}" data-review-id="${review.review_id}" data-action="helpful"> <i class="fas fa-thumbs-up"></i> <span>Utile</span> <span class="helpful-count">(${review.helpful_votes || 0})</span> </button> <button class="unhelpful-btn flex items-center space-x-1 text-gray-600 hover:text-red-600 transition-colors ${this.userInteractions.unhelpful_votes.has(review.review_id) ? 'text-red-600' : ''}" data-review-id="${review.review_id}" data-action="unhelpful"> <i class="fas fa-thumbs-down"></i> <span>Pas utile</span> <span class="unhelpful-count">(${review.unhelpful_votes || 0})</span> </button> </div> <button class="flag-btn text-gray-400 hover:text-red-500 text-sm transition-colors" data-review-id="${review.review_id}"> <i class="fas fa-flag mr-1"></i> Signaler </button> </div> </div> `; } renderTestimonialCard(review, index) { return ` <div class="testimonial-card bg-white rounded-xl shadow-lg p-8 border-2 border-transparent hover:border-purple-200 transition-all duration-300 transform hover:-translate-y-2" style="animation-delay: ${index*200}ms"> <div class="flex items-center mb-4"> ${this.renderStarRating(review.rating)} <span class="ml-2 font-bold text-purple-600">${review.rating}/5</span> </div> <blockquote class="text-gray-700 text-lg leading-relaxed mb-6 italic"> "${this.truncateText(review.content, 150)}" </blockquote> <div class="flex items-center"> <div class="w-12 h-12 rounded-full bg-gradient-to-r from-purple-400 to-blue-400 flex items-center justify-center text-white font-bold text-lg mr-4"> ${review.display_name.charAt(0).toUpperCase()} </div> <div> <p class="font-semibold text-gray-800"> ${review.display_name} ${review.is_verified ? '<i class="fas fa-check-circle text-green-500 ml-1" title="Acheteur v√©rifi√©"></i>' : ''} </p> <p class="text-sm text-gray-500">${review.time_ago}</p> </div> </div> </div> `; } renderLoadMoreButton() { if (!this.reviewsStats.pagination || !this.reviewsStats.pagination.has_next) { return ''; } return ` <button class="load-more-btn bg-purple-100 hover:bg-purple-200 text-purple-700 px-8 py-3 rounded-lg font-semibold transition-colors"> <i class="fas fa-chevron-down mr-2"></i> Charger plus d'avis </button> `; } setupEventListeners() { document.addEventListener('click', (e) => { if (e.target.closest('.write-review-btn')) { e.preventDefault(); this.toggleReviewForm(); } }); document.addEventListener('submit', (e) => { if (e.target.matches('.review-submission-form')) { e.preventDefault(); this.submitReview(e.target); } }); document.addEventListener('click', (e) => { if (e.target.closest('.star-btn')) { e.preventDefault(); this.handleStarRating(e.target.closest('.star-btn')); } }); document.addEventListener('input', (e) => { if (e.target.matches('#review_content')) { this.updateCharacterCounter(e.target); } }); document.addEventListener('click', (e) => { if (e.target.closest('.helpful-btn, .unhelpful-btn')) { e.preventDefault(); this.handleReviewVote(e.target.closest('.helpful-btn, .unhelpful-btn')); } if (e.target.closest('.flag-btn')) { e.preventDefault(); this.handleReviewFlag(e.target.closest('.flag-btn')); } }); document.addEventListener('change', (e) => { if (e.target.matches('.sort-select')) { this.handleSort(e.target.value); } }); document.addEventListener('click', (e) => { if (e.target.matches('.rating-filter-btn')) { e.preventDefault(); this.handleRatingFilter(e.target); } }); document.addEventListener('click', (e) => { if (e.target.closest('.load-more-btn')) { e.preventDefault(); this.loadMoreReviews(); } }); document.addEventListener('click', (e) => { if (e.target.matches('.cancel-review-btn')) { e.preventDefault(); this.hideReviewForm(); } }); } toggleReviewForm() { const container=document.querySelector('.review-form-container'); if (!container) return; if (container.classList.contains('hidden')) { container.classList.remove('hidden'); this.animateComponent(container); container.scrollIntoView({ behavior: 'smooth', block: 'center' }); setTimeout(() => { const firstInput=container.querySelector('#author_name'); if (firstInput) firstInput.focus(); }, 300); } else { this.hideReviewForm(); } } hideReviewForm() { const container=document.querySelector('.review-form-container'); if (container) { container.classList.add('hidden'); const form=container.querySelector('.review-submission-form'); if (form) { form.reset(); this.resetStarRating(); this.updateCharacterCounter(container.querySelector('#review_content')); } } } handleStarRating(starBtn) { const rating=parseInt(starBtn.dataset.rating); const container=starBtn.closest('.star-rating-input'); const hiddenInput=container.parentElement.querySelector('.rating-input'); const ratingText=container.querySelector('.rating-text'); const stars=container.querySelectorAll('.star-btn'); stars.forEach((star, index) => { const starIcon=star.querySelector('i'); if (index < rating) { starIcon.className='fas fa-star text-yellow-400'; } else { starIcon.className='fas fa-star text-gray-300'; } }); hiddenInput.value=rating; const ratingTexts=['', 'D√©cevant', 'Passable', 'Correct', 'Tr√®s bien', 'Excellent']; ratingText.textContent=ratingTexts[rating]; } resetStarRating() { const container=document.querySelector('.star-rating-input'); if (!container) return; const stars=container.querySelectorAll('.star-btn i'); stars.forEach(star => { star.className='fas fa-star text-gray-300'; }); const hiddenInput=container.parentElement.querySelector('.rating-input'); const ratingText=container.querySelector('.rating-text'); if (hiddenInput) hiddenInput.value=''; if (ratingText) ratingText.textContent='Cliquez sur les √©toiles'; } updateCharacterCounter(textarea) { if (!textarea) return; const counter=textarea.parentElement.querySelector('.char-counter'); if (!counter) return; const current=textarea.value.length; const max=this.config.maxReviewLength; counter.textContent=`${current}/${max}`; if (current > max*0.9) { counter.className='text-xs text-red-500 char-counter'; } else if (current > max*0.75) { counter.className='text-xs text-yellow-500 char-counter'; } else { counter.className='text-xs text-gray-500 char-counter'; } } async submitReview(form) { const submitBtn=form.querySelector('.submit-review-btn'); const originalText=submitBtn.innerHTML; if (this.isRateLimited()) { this.showMessage('Vous devez attendre avant de soumettre un nouvel avis.', 'warning'); return; } submitBtn.disabled=true; submitBtn.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i>Envoi en cours...'; try { const formData=new FormData(form); const reviewData=Object.fromEntries(formData.entries()); const response=await fetch('/api/reviews/submit', { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest' }, body: JSON.stringify(reviewData) }); const result=await response.json(); if (result.success) { this.showMessage(result.message || 'Merci pour votre avis ! Il sera publi√© apr√®s validation.', 'success'); this.hideReviewForm(); this.recordReviewSubmission(); if (window.GeeknDragonAnalytics) { window.GeeknDragonAnalytics.trackEvent('review_submitted', { product_id: reviewData.product_id, rating: reviewData.rating, status: result.status }); } } else { this.showMessage(result.error || 'Erreur lors de l\'envoi. Veuillez r√©essayer.', 'error'); } } catch (error) { this.showMessage('Erreur de connexion. Veuillez r√©essayer.', 'error'); } finally { submitBtn.disabled=false; submitBtn.innerHTML=originalText; } } async handleReviewVote(btn) { const reviewId=btn.dataset.reviewId; const action=btn.dataset.action; const voteSet=action==='helpful' ? this.userInteractions.helpful_votes : this.userInteractions.unhelpful_votes; const oppositeSet=action==='helpful' ? this.userInteractions.unhelpful_votes : this.userInteractions.helpful_votes; if (voteSet.has(reviewId)) { this.showMessage('Vous avez d√©j√† vot√© pour cet avis.', 'info'); return; } try { const response=await fetch('/api/reviews/vote', { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest' }, body: JSON.stringify({ review_id: reviewId, action: action }) }); const result=await response.json(); if (result.success) { voteSet.add(reviewId); oppositeSet.delete(reviewId); btn.classList.add(action==='helpful' ? 'text-green-600' : 'text-red-600'); const counter=btn.querySelector(`.${action}-count`); if (counter) { const currentCount=parseInt(counter.textContent.replace(/[()]/g, '')); counter.textContent=`(${currentCount+1})`; } this.saveUserInteractions(); if (window.GeeknDragonAnalytics) { window.GeeknDragonAnalytics.trackEvent('review_voted', { review_id: reviewId, vote_type: action }); } } } catch (error) { this.showMessage('Erreur lors du vote.', 'error'); } } async handleReviewFlag(btn) { const reviewId=btn.dataset.reviewId; const reason=prompt('Pourquoi signalez-vous cet avis ?\n\n1. Contenu inappropri√©\n2. Faux avis\n3. Spam\n4. Autre\n\nEntrez le num√©ro ou d√©crivez la raison:'); if (!reason || reason.trim()==='') { return; } try { const response=await fetch('/api/reviews/flag', { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-Requested-With': 'XMLHttpRequest' }, body: JSON.stringify({ review_id: reviewId, reason: reason.trim() }) }); const result=await response.json(); if (result.success) { this.showMessage('Signalement enregistr√©. Merci de nous aider √† maintenir la qualit√©.', 'success'); btn.disabled=true; btn.innerHTML='<i class="fas fa-check mr-1"></i>Signal√©'; btn.classList.add('text-gray-400'); if (window.GeeknDragonAnalytics) { window.GeeknDragonAnalytics.trackEvent('review_flagged', { review_id: reviewId, reason: reason }); } } else { this.showMessage(result.error || 'Erreur lors du signalement.', 'error'); } } catch (error) { this.showMessage('Erreur de connexion.', 'error'); } } async handleSort(sortBy) { const currentOffset=this.displayedReviews.length; await this.loadReviews({ offset: 0, sort_by: sortBy }); const container=document.querySelector('.reviews-list'); if (container) { container.innerHTML=this.renderReviewsList(); this.animateComponent(container); } const loadMoreContainer=document.querySelector('.load-more-container'); if (loadMoreContainer) { loadMoreContainer.innerHTML=this.renderLoadMoreButton(); } } handleRatingFilter(btn) { const rating=btn.dataset.rating; document.querySelectorAll('.rating-filter-btn').forEach(b => { b.classList.remove('bg-purple-100', 'text-purple-700', 'border-purple-300'); b.classList.add('bg-white', 'text-gray-600', 'border-gray-300'); }); btn.classList.remove('bg-white', 'text-gray-600', 'border-gray-300'); btn.classList.add('bg-purple-100', 'text-purple-700', 'border-purple-300'); const reviewCards=document.querySelectorAll('.review-card'); reviewCards.forEach(card => { const reviewId=card.dataset.reviewId; const review=this.displayedReviews.find(r => r.review_id===reviewId); if (rating==='all' || (review && review.rating==rating)) { card.style.display='block'; this.animateComponent(card); } else { card.style.display='none'; } }); } async loadMoreReviews() { const currentOffset=this.displayedReviews.length; const data=await this.loadReviews({ offset: currentOffset }); if (data && data.reviews.length > 0) { const reviewsContainer=document.querySelector('.reviews-container'); if (reviewsContainer) { const newReviewsHTML=data.reviews.map((review, index) => this.renderReviewCard(review, currentOffset+index) ).join(''); reviewsContainer.insertAdjacentHTML('beforeend', newReviewsHTML); } const loadMoreContainer=document.querySelector('.load-more-container'); if (loadMoreContainer) { loadMoreContainer.innerHTML=this.renderLoadMoreButton(); } } } detectCurrentProduct() { const path=window.location.pathname; const productMatch=path.match(/\/(lot\d+|pack-[\w-]+|triptyque-[\w-]+)/); return productMatch ? productMatch[1] : null; } detectPageType() { const path=window.location.pathname; if (path==='/' || path==='/index.php') return 'homepage'; if (path.includes('boutique')) return 'boutique'; if (this.currentProduct) return 'product'; return 'general'; } findOrCreateContainer(className, selector, position='beforeend') { let container=document.querySelector(`.${className}`); if (!container) { const target=document.querySelector(selector); if (!target) return null; container=document.createElement('div'); container.className=className; if (position==='afterend') { target.insertAdjacentElement('afterend', container); } else if (position==='beforebegin') { target.insertAdjacentElement('beforebegin', container); } else { target.appendChild(container); } } return container; } renderStarRating(rating, maxStars=5) { if (!rating) rating=0; return Array.from({length: maxStars}, (_, i) => { const starClass=i < Math.floor(rating) ? 'fas fa-star text-yellow-400' : i < Math.ceil(rating) ? 'fas fa-star-half-alt text-yellow-400' : 'fas fa-star text-gray-300'; return `<i class="${starClass}"></i>`; }).join(''); } formatReviewContent(content) { return content .replace(/\n/g, '<br>') .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') .replace(/\*(.*?)\*/g, '<em>$1</em>'); } truncateText(text, maxLength) { if (text.length <= maxLength) return text; return text.substring(0, maxLength).replace(/\s+\S*$/, '')+'...'; } animateComponent(element) { element.style.opacity='0'; element.style.transform='translateY(20px)'; setTimeout(() => { element.style.transition=`opacity ${this.config.animationDuration}ms ease, transform ${this.config.animationDuration}ms ease`; element.style.opacity='1'; element.style.transform='translateY(0)'; }, 50); } showMessage(message, type='info') { const toast=document.createElement('div'); toast.className=`fixed top-4 right-4 z-50 max-w-sm p-4 rounded-lg shadow-lg text-white transform translate-x-full transition-transform duration-300 ${ type==='success' ? 'bg-green-500' : type==='error' ? 'bg-red-500' : type==='warning' ? 'bg-yellow-500' : 'bg-blue-500' }`; toast.innerHTML=` <div class="flex items-center space-x-2"> <i class="fas ${ type==='success' ? 'fa-check-circle' : type==='error' ? 'fa-exclamation-circle' : type==='warning' ? 'fa-exclamation-triangle' : 'fa-info-circle' }"></i> <span>${message}</span> <button class="ml-2 hover:bg-white hover:bg-opacity-20 rounded p-1"> <i class="fas fa-times"></i> </button> </div> `; document.body.appendChild(toast); setTimeout(() => { toast.style.transform='translateX(0)'; }, 100); const closeBtn=toast.querySelector('button'); const closeToast=() => { toast.style.transform='translateX(100%)'; setTimeout(() => { if (document.body.contains(toast)) { document.body.removeChild(toast); } }, 300); }; closeBtn.addEventListener('click', closeToast); setTimeout(closeToast, 5000); } isRateLimited() { const lastSubmission=localStorage.getItem('gd_last_review_submission'); if (!lastSubmission) return false; const timeSinceLastSubmission=Date.now()-parseInt(lastSubmission); const rateLimitMs=this.config.rateLimitMinutes*60*1000; return timeSinceLastSubmission < rateLimitMs; } recordReviewSubmission() { localStorage.setItem('gd_last_review_submission', Date.now().toString()); } loadUserInteractions() { const stored=localStorage.getItem('gd_review_interactions'); if (stored) { try { const data=JSON.parse(stored); this.userInteractions.helpful_votes=new Set(data.helpful_votes || []); this.userInteractions.unhelpful_votes=new Set(data.unhelpful_votes || []); this.userInteractions.submitted_reviews=new Set(data.submitted_reviews || []); } catch (e) { } } } saveUserInteractions() { const data={ helpful_votes: Array.from(this.userInteractions.helpful_votes), unhelpful_votes: Array.from(this.userInteractions.unhelpful_votes), submitted_reviews: Array.from(this.userInteractions.submitted_reviews) }; localStorage.setItem('gd_review_interactions', JSON.stringify(data)); } getReviewsStats() { return { total_reviews: this.displayedReviews.length, average_rating: this.reviewsStats.average_rating, current_product: this.currentProduct, user_interactions: { helpful_votes: this.userInteractions.helpful_votes.size, unhelpful_votes: this.userInteractions.unhelpful_votes.size, submitted_reviews: this.userInteractions.submitted_reviews.size } }; } refreshReviews() { return this.loadReviews({ offset: 0 }); } } document.addEventListener('DOMContentLoaded', () => { window.GeeknDragonReviews=new ReviewsSystem(); if (window.location.hostname==='localhost') { window._debugReviews=window.GeeknDragonReviews; } }); })();
/* Source: universal-image-gallery.js */
(function universalImageGallery() { const config={ excludeSelectors: [ '.logo', '.site-logo', '[data-no-gallery]', '.payment-icons img', '.social-icon', '.header img', 'svg', '.actualites img', '.news img', '#actus img', '.testimonials img', '.team img', 'img[src*="logo"]', 'img[src*="favicon"]', 'img[src*="icon"]', 'img[src*=".svg"]', 'img[alt*="Logo"]', 'img[alt*="Icon"]', ], productSelectors: [ '.product-media', '.card-product img', '[data-gallery]', '.gallery-image', '.product-image', ], zoomLevel: 2.5, transitionDuration: 300, swipeThreshold: 50, }; const state={ currentImageIndex: 0, galleryImages: [], isModalOpen: false, isZoomed: false, }; let modal=null; let modalImg=null; let closeBtn=null; let prevBtn=null; let nextBtn=null; function isExcluded(img) { return config.excludeSelectors.some((selector) => { try { return img.matches(selector) || img.closest(selector); } catch (e) { return false; } }); } function injectStyles() { if (document.getElementById('universal-gallery-styles')) return; const style=document.createElement('style'); style.id='universal-gallery-styles'; style.textContent=` .universal-gallery-modal { display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); animation: fadeIn 0.3s ease; } .gallery-content { position: relative; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; } .gallery-main-image { max-width: 90%; max-height: 90%; object-fit: contain; transition: transform 0.3s ease; cursor: zoom-in; } .gallery-main-image.zoomed { transform: scale(2.5); cursor: zoom-out; } .gallery-close { position: absolute; top: 20px; right: 30px; color: white; font-size: 30px; cursor: pointer; z-index: 10001; } .gallery-nav { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.2); color: white; border: none; font-size: 30px; padding: 10px 15px; cursor: pointer; border-radius: 3px; transition: background 0.3s ease; } .gallery-nav:hover { background: rgba(255,255,255,0.4); } .gallery-prev { left: 20px; } .gallery-next { right: 20px; } .gallery-counter { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); color: white; background: rgba(0,0,0,0.7); padding: 5px 15px; border-radius: 15px; } @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } } `; document.head.appendChild(style); } function updateModal() { const currentImage=state.galleryImages[state.currentImageIndex]; if (currentImage && modalImg) { modalImg.src=currentImage.src; modalImg.alt=currentImage.alt || 'Image de galerie'; const counter=modal.querySelector('.gallery-counter'); if (counter) { counter.querySelector('.current').textContent=state.currentImageIndex+1; counter.querySelector('.total').textContent=state.galleryImages.length; } prevBtn.style.display=state.currentImageIndex > 0 ? 'block' : 'none'; nextBtn.style.display=state.currentImageIndex < state.galleryImages.length-1 ? 'block' : 'none'; } } function navigateGallery(direction) { const newIndex=state.currentImageIndex+direction; if (newIndex >= 0 && newIndex < state.galleryImages.length) { state.currentImageIndex=newIndex; updateModal(); } } function toggleZoom() { state.isZoomed=!state.isZoomed; modalImg.classList.toggle('zoomed', state.isZoomed); } function closeGallery() { if (modal) { modal.style.display='none'; document.body.style.overflow=''; state.isModalOpen=false; state.isZoomed=false; if (modalImg) { modalImg.classList.remove('zoomed'); } } } function handleKeyboard(e) { if (!state.isModalOpen) return; switch (e.key) { case 'Escape': closeGallery(); break; case 'ArrowLeft': navigateGallery(-1); break; case 'ArrowRight': navigateGallery(1); break; default: break; } } function attachModalEvents() { closeBtn.addEventListener('click', closeGallery); modal.addEventListener('click', (e) => { if (e.target===modal) closeGallery(); }); prevBtn.addEventListener('click', () => navigateGallery(-1)); nextBtn.addEventListener('click', () => navigateGallery(1)); modalImg.addEventListener('click', toggleZoom); document.addEventListener('keydown', handleKeyboard); } function createModal() { if (modal) return; modal=document.createElement('div'); modal.className='universal-gallery-modal'; modal.innerHTML=` <div class="gallery-content"> <span class="gallery-close">&times;</span> <img class="gallery-main-image" alt="Gallery image"> <button class="gallery-nav gallery-prev">&#8249;</button> <button class="gallery-nav gallery-next">&#8250;</button> <div class="gallery-counter"> <span class="current">1</span>/<span class="total">1</span> </div> </div> `; document.body.appendChild(modal); modalImg=modal.querySelector('.gallery-main-image'); closeBtn=modal.querySelector('.gallery-close'); prevBtn=modal.querySelector('.gallery-prev'); nextBtn=modal.querySelector('.gallery-next'); injectStyles(); attachModalEvents(); } function getAllGalleryImages() { const allImages=document.querySelectorAll('img'); return Array.from(allImages).filter((img) => { if (isExcluded(img)) return false; return config.productSelectors.some((selector) => { try { return img.matches(selector) || img.closest(selector); } catch (e) { return false; } }); }); } function openGallery(clickedImage) { createModal(); state.galleryImages=getAllGalleryImages(); state.currentImageIndex=state.galleryImages.indexOf(clickedImage); state.isModalOpen=true; state.isZoomed=false; if (state.currentImageIndex===-1) { state.currentImageIndex=0; } modal.style.display='block'; document.body.style.overflow='hidden'; updateModal(); } function initUniversalGallery() { config.productSelectors.forEach((selector) => { const images=document.querySelectorAll(selector); images.forEach((img) => { if (!isExcluded(img) && !img.dataset.galleryEnabled) { const imageElement=img; imageElement.style.cursor='zoom-in'; imageElement.addEventListener('click', () => openGallery(imageElement)); imageElement.dataset.galleryEnabled='true'; } }); }); } if (document.readyState==='loading') { document.addEventListener('DOMContentLoaded', initUniversalGallery); } else { initUniversalGallery(); } const observer=new MutationObserver(() => { initUniversalGallery(); }); observer.observe(document.body, { childList: true, subtree: true, }); }());
/* Source: value-calculator.js */
(function() { 'use strict'; class ValueCalculator { constructor() { this.calculations={ current: {}, scenarios: [], savings: {} }; this.productData={ 'lot10': { name: 'Lot de 10 pi√®ces m√©talliques', price: 60, pieces_count: 10, durability_years: 10, immersion_boost: 85, time_saved_per_session: 15, categories: ['Pi√®ces', '√âconomie', 'Temps'], alternatives: ['Fausse monnaie papier', 'Pi√®ces plastique', 'Calcul manuel'] }, 'lot25': { name: 'Lot de 25 pi√®ces m√©talliques', price: 130, pieces_count: 25, durability_years: 15, immersion_boost: 92, time_saved_per_session: 25, categories: ['Pi√®ces', '√âconomie', 'Collection'], alternatives: ['Multiple lots plastique', 'Syst√®me maison', 'Apps mobiles'] }, 'lot50-essence': { name: 'Lot de 50 pi√®ces-Essence Double', price: 240, pieces_count: 50, durability_years: 20, immersion_boost: 98, time_saved_per_session: 35, categories: ['Pi√®ces', 'Premium', 'Prestige'], alternatives: ['Figurines √©quivalentes', 'Multiple syst√®mes', 'Solutions digitales'] }, 'pack-182-arsenal-aventurier': { name: 'Pack 182 cartes-Arsenal Aventurier', price: 70, pieces_count: 182, durability_years: 8, immersion_boost: 78, time_saved_per_session: 20, categories: ['Cartes', '√âquipement', 'Aventure'], alternatives: ['Cartes maison', 'PDF imprim√©s', 'Apps num√©riques'] } }; this.comparisonData={ alternatives: { 'figurines_premium': { cost_per_piece: 25, name: 'Figurines premium (25$/unit√©)' }, 'figurines_standard': { cost_per_piece: 12, name: 'Figurines standard (12$/unit√©)' }, 'pieces_plastique': { cost_per_piece: 1.5, name: 'Pi√®ces plastique (1.50$/unit√©)' }, 'cartes_imprimees': { cost_per_piece: 0.85, name: 'Cartes imprim√©es maison (0.85$/carte)' }, 'solutions_digitales': { cost_monthly: 15, name: 'Solutions digitales (15$/mois)' }, 'temps_creation': { hourly_rate: 25, hours_per_piece: 0.5, name: 'Cr√©ation manuelle (25$/h)' } }, hidden_costs: { 'replacement_rate': 0.15, 'storage_cost': 24, 'maintenance_hours': 2, 'setup_time_minutes': 8 }, benefits: { 'immersion_value': 45, 'time_value': 0.75, 'social_value': 30, 'durability_bonus': 1.8 } }; this.userProfile={ sessions_per_month: 4, players_count: 4, session_duration: 180, mj_experience: 'intermediate', budget_annual: 300, value_priorities: ['immersion', 'time', 'durability'] }; this.init(); } async init() { this.currentProduct=this.detectCurrentProduct(); this.renderCalculator(); this.setupEventListeners(); this.calculateValue(); } renderCalculator() { const pageType=this.detectPageType(); switch (pageType) { case 'product': this.renderProductCalculator(); break; case 'homepage': this.renderHomepageValueDemo(); break; case 'boutique': this.renderShopComparison(); break; default: this.renderGenericCalculator(); } } renderProductCalculator() { const container=this.findOrCreateContainer('product-value-calculator', '.product-details'); if (!container) return; const product=this.productData[this.currentProduct]; if (!product) return; container.innerHTML=` <section class="value-calculator bg-gradient-to-r from-green-50 to-blue-50 rounded-xl shadow-lg p-8 mt-12 border-2 border-green-200"> <div class="text-center mb-8"> <h3 class="text-3xl font-bold text-gray-800 mb-4"> <i class="fas fa-calculator text-green-600 mr-3"></i> Calculateur de Valeur ROI </h3> <p class="text-xl text-gray-600">D√©couvrez les √©conomies r√©elles vs les alternatives</p> </div> <!-- Configuration utilisateur --> <div class="user-config bg-white rounded-lg p-6 mb-8 shadow-sm"> <h4 class="text-lg font-semibold text-gray-800 mb-4"> <i class="fas fa-sliders-h text-blue-600 mr-2"></i> Configurez votre profil de jeu </h4> <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"> <div> <label class="block text-sm font-medium text-gray-700 mb-2">Sessions par mois</label> <input type="range" id="sessions-range" min="1" max="20" value="4" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"> <div class="flex justify-between text-xs text-gray-500 mt-1"> <span>1</span> <span class="sessions-value font-bold text-blue-600">4</span> <span>20</span> </div> </div> <div> <label class="block text-sm font-medium text-gray-700 mb-2">Nombre de joueurs</label> <input type="range" id="players-range" min="2" max="8" value="4" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"> <div class="flex justify-between text-xs text-gray-500 mt-1"> <span>2</span> <span class="players-value font-bold text-blue-600">4</span> <span>8</span> </div> </div> <div> <label class="block text-sm font-medium text-gray-700 mb-2">Dur√©e moyenne (heures)</label> <input type="range" id="duration-range" min="2" max="8" value="3" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"> <div class="flex justify-between text-xs text-gray-500 mt-1"> <span>2h</span> <span class="duration-value font-bold text-blue-600">3h</span> <span>8h</span> </div> </div> </div> </div> <!-- R√©sultats de calcul --> <div class="calculation-results"> ${this.renderCalculationResults(product)} </div> <!-- Comparaison d√©taill√©e --> <div class="comparison-details mt-8"> ${this.renderDetailedComparison(product)} </div> <!-- Facteurs de valeur --> <div class="value-factors mt-8"> ${this.renderValueFactors(product)} </div> <!-- CTA --> <div class="text-center mt-8 p-6 bg-gradient-to-r from-green-600 to-blue-600 rounded-lg text-white"> <h4 class="text-2xl font-bold mb-2">√âconomisez <span class="total-savings">127$</span> d√®s la premi√®re ann√©e !</h4> <p class="mb-4 opacity-90">Sans compter la valeur immersion et le gain de temps</p> <button class="bg-white text-green-600 px-8 py-3 rounded-lg font-bold text-lg hover:bg-gray-100 transition-colors transform hover:scale-105"> <i class="fas fa-shopping-cart mr-2"></i> Profiter de ces √©conomies </button> </div> </section> `; this.animateComponent(container); } renderHomepageValueDemo() { const container=this.findOrCreateContainer('homepage-value-demo', '.hero-section', 'afterend'); if (!container) return; container.innerHTML=` <section class="value-demo py-16 bg-white"> <div class="container mx-auto px-4"> <div class="text-center mb-12"> <h2 class="text-4xl font-bold text-gray-800 mb-4"> üí∞ Pourquoi nos produits sont-ils plus rentables ? </h2> <p class="text-xl text-gray-600">Comparaison objective avec les alternatives du march√©</p> </div> <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center"> <!-- Calculateur rapide --> <div class="quick-calculator bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-8 border-2 border-purple-200"> <h3 class="text-2xl font-bold text-gray-800 mb-6">Calculateur rapide</h3> <div class="space-y-4 mb-6"> <div> <label class="block text-sm font-medium text-gray-700 mb-2">Votre budget JDR annuel</label> <input type="range" id="budget-range" min="100" max="1000" value="300" step="50" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer"> <div class="text-center mt-2"> <span class="budget-value text-2xl font-bold text-purple-600">300$</span> <span class="text-gray-500">/an</span> </div> </div> </div> <div class="results-preview bg-white rounded-lg p-4"> <div class="grid grid-cols-2 gap-4 text-center"> <div> <div class="text-3xl font-bold text-green-600 savings-amount">+127$</div> <div class="text-sm text-gray-600">√âconomies r√©elles</div> </div> <div> <div class="text-3xl font-bold text-blue-600 time-saved">45h</div> <div class="text-sm text-gray-600">Temps √©conomis√©</div> </div> </div> </div> <button class="w-full mt-4 bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg font-semibold transition-colors"> Voir le calcul d√©taill√© </button> </div> <!-- Infographie comparative --> <div class="comparison-infographic"> <h3 class="text-2xl font-bold text-gray-800 mb-6">VS les alternatives</h3> <div class="space-y-6"> ${this.renderComparisonItems()} </div> </div> </div> </div> </section> `; } renderShopComparison() { const container=this.findOrCreateContainer('shop-value-comparison', '.products-grid', 'beforebegin'); if (!container) return; container.innerHTML=` <div class="value-comparison bg-gradient-to-r from-green-100 to-blue-100 rounded-xl p-6 mb-8 shadow-lg"> <div class="flex items-center justify-between"> <div> <h3 class="text-xl font-bold text-gray-800 mb-2"> <i class="fas fa-chart-line text-green-600 mr-2"></i> Valeur exceptionnelle garantie </h3> <p class="text-gray-600">Nos produits vous font √©conomiser en moyenne <span class="font-bold text-green-600">127$ par an</span> vs les alternatives</p> </div> <div class="text-center"> <button class="value-calculator-trigger bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors"> <i class="fas fa-calculator mr-2"></i> Calculer mes √©conomies </button> </div> </div> </div> `; } renderCalculationResults(product) { return ` <div class="results-grid grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"> <!-- √âconomies directes --> <div class="result-card bg-white rounded-lg p-6 shadow-sm border-l-4 border-green-500"> <div class="flex items-center justify-between mb-4"> <h4 class="text-lg font-semibold text-gray-800">√âconomies directes</h4> <i class="fas fa-piggy-bank text-green-500 text-2xl"></i> </div> <div class="text-3xl font-bold text-green-600 mb-2 direct-savings">127$</div> <p class="text-sm text-gray-600">Premi√®re ann√©e vs alternatives</p> <div class="mt-3 text-xs text-gray-500"> <div class="flex justify-between"> <span>Co√ªt produit:</span> <span class="product-cost">${product.price}$</span> </div> <div class="flex justify-between"> <span>Alternative √©quiv.:</span> <span class="alternative-cost">187$</span> </div> </div> </div> <!-- Valeur temps --> <div class="result-card bg-white rounded-lg p-6 shadow-sm border-l-4 border-blue-500"> <div class="flex items-center justify-between mb-4"> <h4 class="text-lg font-semibold text-gray-800">Temps √©conomis√©</h4> <i class="fas fa-clock text-blue-500 text-2xl"></i> </div> <div class="text-3xl font-bold text-blue-600 mb-2 time-saved">${product.time_saved_per_session*12}min</div> <p class="text-sm text-gray-600">Par mois de jeu</p> <div class="mt-3 text-xs text-gray-500"> <div class="flex justify-between"> <span>Valeur √©conomique:</span> <span class="time-value">45$</span> </div> <div class="flex justify-between"> <span>Sur 3 ans:</span> <span class="time-total">162$</span> </div> </div> </div> <!-- ROI total --> <div class="result-card bg-white rounded-lg p-6 shadow-sm border-l-4 border-purple-500"> <div class="flex items-center justify-between mb-4"> <h4 class="text-lg font-semibold text-gray-800">ROI Total</h4> <i class="fas fa-trophy text-purple-500 text-2xl"></i> </div> <div class="text-3xl font-bold text-purple-600 mb-2 total-roi">+285%</div> <p class="text-sm text-gray-600">Retour sur investissement</p> <div class="mt-3 text-xs text-gray-500"> <div class="flex justify-between"> <span>√âconomies 3 ans:</span> <span class="roi-total">289$</span> </div> <div class="flex justify-between"> <span>Durabilit√©:</span> <span class="durability">${product.durability_years} ans</span> </div> </div> </div> </div> `; } renderDetailedComparison(product) { return ` <div class="detailed-comparison bg-white rounded-lg p-6 shadow-sm"> <h4 class="text-xl font-semibold text-gray-800 mb-6"> <i class="fas fa-balance-scale text-gray-600 mr-2"></i> Comparaison d√©taill√©e sur 3 ans </h4> <div class="comparison-table overflow-x-auto"> <table class="w-full text-sm"> <thead> <tr class="border-b-2 border-gray-200"> <th class="text-left py-3 px-2">Crit√®re</th> <th class="text-center py-3 px-2 text-green-600 font-bold">${product.name}</th> <th class="text-center py-3 px-2 text-gray-600">Alternative 1</th> <th class="text-center py-3 px-2 text-gray-600">Alternative 2</th> </tr> </thead> <tbody class="comparison-rows"> ${this.renderComparisonRows(product)} </tbody> </table> </div> </div> `; } renderComparisonRows(product) { const rows=[ { criterion: 'Co√ªt initial', geekndragon: `${product.price}$`, alt1: '187$', alt2: '245$', winner: 'geekndragon' }, { criterion: 'Durabilit√©', geekndragon: `${product.durability_years} ans`, alt1: '2-3 ans', alt2: '1-2 ans', winner: 'geekndragon' }, { criterion: 'Temps de setup', geekndragon: '30 sec', alt1: '5 min', alt2: '8 min', winner: 'geekndragon' }, { criterion: 'Immersion', geekndragon: `${product.immersion_boost}%`, alt1: '45%', alt2: '60%', winner: 'geekndragon' }, { criterion: 'Maintenance', geekndragon: 'Aucune', alt1: 'Remplacement 15%/an', alt2: 'Fragile', winner: 'geekndragon' }, { criterion: 'Co√ªt total 3 ans', geekndragon: `${product.price}$`, alt1: '298$', alt2: '445$', winner: 'geekndragon' } ]; return rows.map(row => ` <tr class="border-b border-gray-100 hover:bg-gray-50"> <td class="py-3 px-2 font-medium">${row.criterion}</td> <td class="py-3 px-2 text-center ${row.winner==='geekndragon' ? 'text-green-600 font-bold' : ''}">${row.geekndragon}</td> <td class="py-3 px-2 text-center ${row.winner==='alt1' ? 'text-green-600 font-bold' : 'text-gray-600'}">${row.alt1}</td> <td class="py-3 px-2 text-center ${row.winner==='alt2' ? 'text-green-600 font-bold' : 'text-gray-600'}">${row.alt2}</td> </tr> `).join(''); } renderValueFactors(product) { return ` <div class="value-factors bg-white rounded-lg p-6 shadow-sm"> <h4 class="text-xl font-semibold text-gray-800 mb-6"> <i class="fas fa-gem text-purple-600 mr-2"></i> Facteurs de valeur uniques </h4> <div class="grid grid-cols-1 md:grid-cols-2 gap-6"> <div class="factor-item"> <div class="flex items-start space-x-3 mb-4"> <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center"> <i class="fas fa-shield-alt text-green-600"></i> </div> <div> <h5 class="font-semibold text-gray-800">Durabilit√© exceptionnelle</h5> <p class="text-sm text-gray-600">Fabrication artisanale qu√©b√©coise, garantie ${product.durability_years} ans vs 1-3 ans pour les alternatives</p> </div> </div> </div> <div class="factor-item"> <div class="flex items-start space-x-3 mb-4"> <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center"> <i class="fas fa-magic text-blue-600"></i> </div> <div> <h5 class="font-semibold text-gray-800">Immersion maximale</h5> <p class="text-sm text-gray-600">Sensation m√©tallique authentique, +${product.immersion_boost}% d'immersion mesur√©e</p> </div> </div> </div> <div class="factor-item"> <div class="flex items-start space-x-3 mb-4"> <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center"> <i class="fas fa-clock text-purple-600"></i> </div> <div> <h5 class="font-semibold text-gray-800">Gain de temps</h5> <p class="text-sm text-gray-600">${product.time_saved_per_session} minutes √©conomis√©es par session, soit ${product.time_saved_per_session*48}h/an</p> </div> </div> </div> <div class="factor-item"> <div class="flex items-start space-x-3 mb-4"> <div class="w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center"> <i class="fas fa-star text-yellow-600"></i> </div> <div> <h5 class="font-semibold text-gray-800">Valeur de collection</h5> <p class="text-sm text-gray-600">Augmente en valeur avec le temps, contrairement aux alternatives jetables</p> </div> </div> </div> </div> </div> `; } renderComparisonItems() { const items=[ { category: 'Figurines premium', gd_cost: '60$', alt_cost: '250$', saving: '190$', description: 'Pour √©quivalent 10 pi√®ces qualit√©' }, { category: 'Solutions digitales', gd_cost: '70$ (une fois)', alt_cost: '180$/an', saving: '540$ (3 ans)', description: 'Apps et outils num√©riques' }, { category: 'Cartes imprim√©es', gd_cost: '70$', alt_cost: '155$', saving: '85$', description: 'Impression+plastification' } ]; return items.map(item => ` <div class="comparison-item bg-white rounded-lg p-4 shadow-sm border-l-4 border-green-500"> <div class="flex justify-between items-center mb-2"> <h4 class="font-semibold text-gray-800">${item.category}</h4> <span class="text-sm font-bold text-green-600">√âconomie: ${item.saving}</span> </div> <div class="grid grid-cols-2 gap-4 text-sm"> <div> <span class="text-gray-600">GeeknDragon:</span> <span class="font-bold text-blue-600"> ${item.gd_cost}</span> </div> <div> <span class="text-gray-600">Alternative:</span> <span class="font-bold text-red-600"> ${item.alt_cost}</span> </div> </div> <p class="text-xs text-gray-500 mt-2">${item.description}</p> </div> `).join(''); } calculateValue() { const sessionsPerMonth=this.userProfile.sessions_per_month; const playersCount=this.userProfile.players_count; const sessionDuration=this.userProfile.session_duration; if (!this.currentProduct) return; const product=this.productData[this.currentProduct]; if (!product) return; const calculations={ alternative_cost: this.calculateAlternativeCost(product), direct_savings: this.calculateDirectSavings(product), time_value: this.calculateTimeValue(product, sessionsPerMonth), total_roi: this.calculateTotalROI(product), durability_value: this.calculateDurabilityValue(product) }; this.calculations.current=calculations; this.updateCalculatorDisplay(calculations); } calculateAlternativeCost(product) { const alternatives={ 'lot10': { figurines: 250, plastique: 90, creation: 125 }, 'lot25': { figurines: 625, plastique: 185, creation: 280 }, 'lot50-essence': { figurines: 1250, plastique: 340, creation: 560 }, 'pack-182-arsenal-aventurier': { impression: 155, digital: 180, creation: 230 } }; return alternatives[product.name.toLowerCase().replace(/\s+/g, '-')] || alternatives.lot10; } calculateDirectSavings(product) { const altCost=this.calculateAlternativeCost(product); const avgAltCost=Object.values(altCost).reduce((sum, cost) => sum+cost, 0)/Object.values(altCost).length; return Math.round(avgAltCost-product.price); } calculateTimeValue(product, sessionsPerMonth) { const minutesSavedPerMonth=product.time_saved_per_session*sessionsPerMonth; const minutesSavedPerYear=minutesSavedPerMonth*12; const hoursSavedPerYear=minutesSavedPerYear/60; const timeValuePerYear=hoursSavedPerYear*25; return { minutes_per_month: minutesSavedPerMonth, hours_per_year: Math.round(hoursSavedPerYear*10)/10, value_per_year: Math.round(timeValuePerYear) }; } calculateTotalROI(product) { const directSavings=this.calculateDirectSavings(product); const timeValue=this.calculateTimeValue(product, this.userProfile.sessions_per_month); const durabilityBonus=product.durability_years*15; const totalValue3Years=directSavings+(timeValue.value_per_year*3)+durabilityBonus; const roi=((totalValue3Years-product.price)/product.price)*100; return { total_value_3_years: Math.round(totalValue3Years), roi_percentage: Math.round(roi), break_even_months: Math.round((product.price/(directSavings/12+timeValue.value_per_year/12))*10)/10 }; } calculateDurabilityValue(product) { const replacementCostPerYear=product.price*0.15; const savingsOverLifetime=replacementCostPerYear*product.durability_years; return { replacement_savings: Math.round(savingsOverLifetime), durability_years: product.durability_years, annual_replacement_cost: Math.round(replacementCostPerYear) }; } updateCalculatorDisplay(calculations) { this.updateElement('.direct-savings', `${calculations.direct_savings}$`); this.updateElement('.time-saved', `${calculations.time_value.hours_per_year}h`); this.updateElement('.total-roi', `+${calculations.total_roi.roi_percentage}%`); this.updateElement('.total-savings', `${calculations.direct_savings+calculations.time_value.value_per_year}$`); this.updateElement('.alternative-cost', `${Math.round(calculations.direct_savings+this.productData[this.currentProduct].price)}$`); this.updateElement('.time-value', `${calculations.time_value.value_per_year}$`); this.updateElement('.roi-total', `${calculations.total_roi.total_value_3_years}$`); } updateElement(selector, value) { const element=document.querySelector(selector); if (element) { element.textContent=value; element.style.transition='all 0.3s ease'; element.style.transform='scale(1.05)'; element.style.color='#10b981'; setTimeout(() => { element.style.transform='scale(1)'; element.style.color=''; }, 300); } } setupEventListeners() { document.addEventListener('input', (e) => { if (e.target.matches('#sessions-range')) { this.userProfile.sessions_per_month=parseInt(e.target.value); this.updateElement('.sessions-value', e.target.value); this.calculateValue(); } if (e.target.matches('#players-range')) { this.userProfile.players_count=parseInt(e.target.value); this.updateElement('.players-value', e.target.value); this.calculateValue(); } if (e.target.matches('#duration-range')) { this.userProfile.session_duration=parseInt(e.target.value)*60; this.updateElement('.duration-value', `${e.target.value}h`); this.calculateValue(); } if (e.target.matches('#budget-range')) { this.userProfile.budget_annual=parseInt(e.target.value); this.updateElement('.budget-value', `${e.target.value}$`); this.calculateHomepageDemo(); } }); document.addEventListener('click', (e) => { if (e.target.closest('.value-calculator-trigger')) { e.preventDefault(); this.showFullCalculator(); } }); } calculateHomepageDemo() { const budget=this.userProfile.budget_annual; const avgSavings=Math.round(budget*0.42); const timeSaved=Math.round(budget/6.7); this.updateElement('.savings-amount', `+${avgSavings}$`); this.updateElement('.time-saved', `${timeSaved}h`); } showFullCalculator() { const calculator=document.querySelector('.value-calculator'); if (calculator) { calculator.scrollIntoView({ behavior: 'smooth', block: 'center' }); } else { window.location.href='/calculateur-valeur.php'; } } detectCurrentProduct() { const path=window.location.pathname; const productMatch=path.match(/\/(lot\d+|pack-[\w-]+|triptyque-[\w-]+)/); return productMatch ? productMatch[1] : null; } detectPageType() { const path=window.location.pathname; if (path==='/' || path==='/index.php') return 'homepage'; if (path.includes('boutique')) return 'boutique'; if (this.currentProduct) return 'product'; return 'general'; } findOrCreateContainer(className, selector, position='beforeend') { let container=document.querySelector(`.${className}`); if (!container) { const target=document.querySelector(selector); if (!target) return null; container=document.createElement('div'); container.className=className; if (position==='afterend') { target.insertAdjacentElement('afterend', container); } else if (position==='beforebegin') { target.insertAdjacentElement('beforebegin', container); } else { target.appendChild(container); } } return container; } animateComponent(element) { element.style.opacity='0'; element.style.transform='translateY(30px)'; setTimeout(() => { element.style.transition='opacity 0.6s ease, transform 0.6s ease'; element.style.opacity='1'; element.style.transform='translateY(0)'; }, 100); } getCalculationResults() { return this.calculations.current; } getUserProfile() { return this.userProfile; } updateUserProfile(updates) { this.userProfile={ ...this.userProfile, ...updates }; this.calculateValue(); } exportCalculation() { const results=this.getCalculationResults(); const product=this.productData[this.currentProduct]; return { product: product, user_profile: this.userProfile, calculations: results, summary: { total_savings_first_year: results.direct_savings+results.time_value.value_per_year, roi_3_years: results.total_roi.roi_percentage, break_even: results.total_roi.break_even_months }, generated_at: new Date().toISOString() }; } } document.addEventListener('DOMContentLoaded', () => { window.GeeknDragonValueCalculator=new ValueCalculator(); if (window.location.hostname==='localhost') { window._debugCalc=window.GeeknDragonValueCalculator; } }); })();
