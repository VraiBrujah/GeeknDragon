class SnipcartUtils{static createAddToCartButton(t,e={}){const{quantity:i=1,customFields:a={},className:r="snipcart-add-item btn-cart-icon",text:n="Ajouter au panier",useIconButton:o=!0,...u}=e,c=document.createElement("button");if(c.className=r,o){const t=document.createElement("img");t.src="/media/branding/icons/ajout.webp",t.alt=n,t.className="btn-cart-icon-img",t.loading="lazy",c.appendChild(t),c.setAttribute("aria-label",n),c.setAttribute("title",n)}else c.textContent=n;const s={"data-item-id":t.id,"data-item-name":t.name,"data-item-description":t.summary||t.description||"","data-item-price":t.price.toString(),"data-item-quantity":i.toString()};return t.name_en&&(s["data-item-name-en"]=t.name_en),t.summary_en&&(s["data-item-description-en"]=t.summary_en),t.url&&(s["data-item-url"]=t.url),Object.entries(s).forEach(([t,e])=>{c.setAttribute(t,e)}),Object.entries(a).forEach(([t,e])=>{const i=t.replace("custom","");c.setAttribute(`data-item-custom${i}-name`,e.name),c.setAttribute(`data-item-custom${i}-type`,e.type),c.setAttribute(`data-item-custom${i}-options`,e.options),c.setAttribute(`data-item-custom${i}-value`,e.value),e.role&&c.setAttribute(`data-item-custom${i}-role`,e.role)}),Object.entries(u).forEach(([t,e])=>{c.setAttribute(t,e)}),c}static playSound(t,e=.5){try{const i=new Audio(t);i.volume=Math.max(0,Math.min(1,e)),i.play().catch(t=>{console.debug("Audio autoplay bloqué:",t)})}catch(t){console.debug("Erreur lecture audio:",t)}}static async addToCart(t,e={}){if(this.playSound("media/sounds/coin-drop.mp3",.5),window.Snipcart&&window.Snipcart.api&&window.Snipcart.api.cart)try{const i=this.extractProductDataFromButton(this.createAddToCartButton(t,e));return await window.Snipcart.api.cart.items.add(i),!0}catch(t){}const i=this.createAddToCartButton(t,e);return i.style.display="none",document.body.appendChild(i),i.click(),setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},300),!0}static addFromButton(t,e=null){e&&(e.preventDefault(),e.stopPropagation()),this.playSound("media/sounds/coin-drop.mp3",.5);const i=this.extractProductDataFromButton(t);if(window.Snipcart&&window.Snipcart.api&&window.Snipcart.api.cart)try{return window.Snipcart.api.cart.items.add(i),!0}catch(t){}const a=t.cloneNode(!0);return a.style.display="none",document.body.appendChild(a),setTimeout(()=>{a.click(),document.body.removeChild(a)},10),!0}static extractProductDataFromButton(t){const e={id:t.getAttribute("data-item-id"),name:t.getAttribute("data-item-name"),price:parseFloat(t.getAttribute("data-item-price")||"0"),url:t.getAttribute("data-item-url")||window.location.href,quantity:parseInt(t.getAttribute("data-item-quantity")||"1"),description:t.getAttribute("data-item-description")},i=t.getAttribute("data-item-image");i&&(e.image=i),e.customFields=[];for(let i=1;i<=5;i++){const a=t.getAttribute(`data-item-custom${i}-name`),r=t.getAttribute(`data-item-custom${i}-value`);a&&r&&e.customFields.push({name:a,value:r})}return e}static async addMultipleToCart(t,e=null){if(!t||0===t.length)return void(e&&e(0,0));let i=0,a=0;const r=()=>{if(window.Snipcart&&window.Snipcart.api&&window.Snipcart.api.cart)try{return window.Snipcart.api.cart.items.count()||0}catch(t){return 0}return 0};for(let n=0;n<t.length;n++){const o=t[n],u=r();try{if(await this.addToCart(o.product,{quantity:o.quantity,customFields:o.customFields||{}})){let t=0;const e=3;for(;t<e;){await new Promise(t=>setTimeout(t,150));if(r()>u){a++;break}t++}}i++,e&&e(a,t.length,i),n<t.length-1&&await new Promise(t=>setTimeout(t,400))}catch(r){i++,e&&e(a,t.length,i),n<t.length-1&&await new Promise(t=>setTimeout(t,600))}}}static updateCartButton(t,e={}){const{quantity:i,metal:a,multiplier:r,triptych:n,language:o}=e;void 0!==i&&t.setAttribute("data-item-quantity",i.toString()),this.updateCustomFields(t,e)}static updateCustomFields(t,e){const{metal:i,multiplier:a,triptych:r,language:n}=e;if(void 0!==i){const e=this.findCustomFieldByRole(t,"metal");e&&t.setAttribute(`data-item-custom${e}-value`,i)}if(void 0!==a){const e=this.findCustomFieldByRole(t,"multiplier");e&&t.setAttribute(`data-item-custom${e}-value`,a.toString())}if(void 0!==r){const e=this.findCustomFieldByRole(t,"triptych");e&&t.setAttribute(`data-item-custom${e}-value`,r)}if(void 0!==n){const e=this.findCustomFieldByRole(t,"language");e&&t.setAttribute(`data-item-custom${e}-value`,n)}}static findCustomFieldByRole(t,e){const i=Array.from(t.attributes);for(const t of i){const i=t.name.match(/^data-item-custom(\d+)-role$/);if(i&&t.value===e)return i[1]}return null}static extractProductDataFromButton(t){return{id:t.getAttribute("data-item-id"),name:t.getAttribute("data-item-name"),description:t.getAttribute("data-item-description"),price:parseFloat(t.getAttribute("data-item-price")),quantity:parseInt(t.getAttribute("data-item-quantity")),url:t.getAttribute("data-item-url")}}static createLotProductData(t){const{product:e,quantity:i,customFields:a,displayName:r}=t;return{product:{id:e.id,name:r||e.name,summary:e.summary,price:e.price,url:`product.php?id=${encodeURIComponent(e.id)}`},quantity:i,customFields:a||{}}}static translateMetal(t,e="fr"){const i=`shop.converter.metals.${t}`,a=this.getTranslation(i);if(a)return a;return{fr:{copper:"cuivre",silver:"argent",electrum:"électrum",gold:"or",platinum:"platine"},en:{copper:"copper",silver:"silver",electrum:"electrum",gold:"gold",platinum:"platinum"}}[e]?.[t]||t}static getCurrentLang(){return document.documentElement.lang||"fr"}static getTranslation(t,e=""){if(window.i18n){const i=t.split(".");let a=window.i18n;for(const t of i){if(!a||"object"!=typeof a||!(t in a))return e;a=a[t]}return"string"==typeof a?a:e}return e}}window.SnipcartUtils=SnipcartUtils;