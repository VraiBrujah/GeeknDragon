class SnipcartUtils{static createAddToCartButton(t,e={}){const{quantity:i=1,customFields:a={},className:n="snipcart-add-item btn-cart-icon",text:r="Ajouter au panier",useIconButton:o=!0,...u}=e,c=document.createElement("button");if(c.className=n,o){const t=document.createElement("img");t.src="/media/branding/icons/ajout.webp",t.alt=r,t.className="btn-cart-icon-img",t.loading="lazy",c.appendChild(t),c.setAttribute("aria-label",r),c.setAttribute("title",r)}else c.textContent=r;const s={"data-item-id":t.id,"data-item-name":t.name,"data-item-description":t.summary||t.description||"","data-item-price":t.price.toString(),"data-item-quantity":i.toString()};t.name_en&&(s["data-item-name-en"]=t.name_en),t.summary_en&&(s["data-item-description-en"]=t.summary_en),t.url&&(s["data-item-url"]=t.url),Object.entries(s).forEach(([t,e])=>{c.setAttribute(t,e)});const d=this.normalizeCustomFields(a);return Object.entries(d).forEach(([t,e])=>{const i=t.replace("custom","");c.setAttribute(`data-item-custom${i}-name`,e.name),c.setAttribute(`data-item-custom${i}-type`,e.type),c.setAttribute(`data-item-custom${i}-options`,e.options),c.setAttribute(`data-item-custom${i}-value`,e.value),e.role&&c.setAttribute(`data-item-custom${i}-role`,e.role)}),Object.entries(u).forEach(([t,e])=>{c.setAttribute(t,e)}),c}static playSound(t,e=.5){try{const i=new Audio(t);i.volume=Math.max(0,Math.min(1,e)),i.play().catch(t=>{console.debug("Audio autoplay bloqué:",t)})}catch(t){console.debug("Erreur lecture audio:",t)}}static async addToCart(t,e={}){if(this.playSound("media/sounds/coin-drop.mp3",.5),window.Snipcart&&window.Snipcart.api&&window.Snipcart.api.cart)try{const i=this.extractProductDataFromButton(this.createAddToCartButton(t,e));return await window.Snipcart.api.cart.items.add(i),!0}catch(t){}const i=this.createAddToCartButton(t,e);return i.style.display="none",document.body.appendChild(i),i.click(),setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},300),!0}static addFromButton(t,e=null){e&&(e.preventDefault(),e.stopPropagation()),this.playSound("media/sounds/coin-drop.mp3",.5);const i=this.extractProductDataFromButton(t);if(window.Snipcart&&window.Snipcart.api&&window.Snipcart.api.cart)try{return window.Snipcart.api.cart.items.add(i),!0}catch(t){}const a=t.cloneNode(!0);return a.style.display="none",document.body.appendChild(a),setTimeout(()=>{a.click(),document.body.removeChild(a)},10),!0}static extractProductDataFromButton(t){const e={id:t.getAttribute("data-item-id"),name:t.getAttribute("data-item-name"),price:parseFloat(t.getAttribute("data-item-price")||"0"),url:t.getAttribute("data-item-url")||window.location.href,quantity:parseInt(t.getAttribute("data-item-quantity")||"1"),description:t.getAttribute("data-item-description")},i=t.getAttribute("data-item-image");i&&(e.image=i),e.customFields=[];for(let i=1;i<=5;i++){const a=t.getAttribute(`data-item-custom${i}-name`),n=t.getAttribute(`data-item-custom${i}-value`);a&&n&&e.customFields.push({name:a,value:n})}return e}static async addMultipleToCart(t,e=null){if(!t||0===t.length)return void(e&&e(0,0));let i=0,a=0;const n=()=>{if(window.Snipcart&&window.Snipcart.api&&window.Snipcart.api.cart)try{return window.Snipcart.api.cart.items.count()||0}catch(t){return 0}return 0};for(let r=0;r<t.length;r++){const o=t[r],u=n();try{if(await this.addToCart(o.product,{quantity:o.quantity,customFields:o.customFields||{}})){let t=0;const e=3;for(;t<e;){await new Promise(t=>setTimeout(t,150));if(n()>u){a++;break}t++}}i++,e&&e(a,t.length,i),r<t.length-1&&await new Promise(t=>setTimeout(t,400))}catch(n){i++,e&&e(a,t.length,i),r<t.length-1&&await new Promise(t=>setTimeout(t,600))}}}static updateCartButton(t,e={}){const{quantity:i,metal:a,multiplier:n,triptych:r,language:o}=e;void 0!==i&&t.setAttribute("data-item-quantity",i.toString()),this.updateCustomFields(t,e)}static updateCustomFields(t,e){const{metal:i,multiplier:a,triptych:n,language:r}=e;if(void 0!==i){const e=this.findCustomFieldByRole(t,"metal");e&&t.setAttribute(`data-item-custom${e}-value`,i)}if(void 0!==a){const e=this.findCustomFieldByRole(t,"multiplier");e&&t.setAttribute(`data-item-custom${e}-value`,a.toString())}if(void 0!==n){const e=this.findCustomFieldByRole(t,"triptych");e&&t.setAttribute(`data-item-custom${e}-value`,n)}if(void 0!==r){const e=this.findCustomFieldByRole(t,"language");e&&t.setAttribute(`data-item-custom${e}-value`,r)}}static findCustomFieldByRole(t,e){const i=Array.from(t.attributes);for(const t of i){const i=t.name.match(/^data-item-custom(\d+)-role$/);if(i&&t.value===e)return i[1]}return null}static normalizeCustomFields(t){const e={};let i=1;if(t.custom1||t.custom2)return t;const a=Object.entries(t).find(([t])=>t.includes("metal")),n=Object.entries(t).find(([t])=>t.includes("multiplier")),r=document.documentElement?.lang||"fr";if(a){const[,t]=a;e.custom1={name:"fr"===r?"Métal":"Metal",type:"dropdown",options:"copper[+0.00]|silver[+0.00]|electrum[+0.00]|gold[+0.00]|platinum[+0.00]",value:t.value,role:"metal"},i++}if(n){const[,t]=n;e[`custom${i}`]={name:"fr"===r?"Multiplicateur":"Multiplier",type:"dropdown",options:"1[+0.00]|10[+10.00]|100[+95.00]|1000[+950.00]|10000[+9500.00]",value:t.value.toString(),role:"multiplier"}}return e}static extractProductDataFromButton(t){return{id:t.getAttribute("data-item-id"),name:t.getAttribute("data-item-name"),description:t.getAttribute("data-item-description"),price:parseFloat(t.getAttribute("data-item-price")),quantity:parseInt(t.getAttribute("data-item-quantity")),url:t.getAttribute("data-item-url")}}static createLotProductData(t){const{product:e,quantity:i,customFields:a,displayName:n}=t;return{product:{id:e.id,name:n||e.name,summary:e.summary,price:e.price,url:`product.php?id=${encodeURIComponent(e.id)}`},quantity:i,customFields:a||{}}}static translateMetal(t,e="fr"){const i=`shop.converter.metals.${t}`,a=this.getTranslation(i);if(a)return a;return{fr:{copper:"cuivre",silver:"argent",electrum:"électrum",gold:"or",platinum:"platine"},en:{copper:"copper",silver:"silver",electrum:"electrum",gold:"gold",platinum:"platinum"}}[e]?.[t]||t}static getCurrentLang(){return document.documentElement.lang||"fr"}static getTranslation(t,e=""){if(window.i18n){const i=t.split(".");let a=window.i18n;for(const t of i){if(!a||"object"!=typeof a||!(t in a))return e;a=a[t]}return"string"==typeof a?a:e}return e}}window.SnipcartUtils=SnipcartUtils;