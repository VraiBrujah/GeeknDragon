function fullyVisible(t){const e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}(()=>{const t=(t,e=document)=>e.querySelector(t),e=(t,e=document)=>Array.from(e.querySelectorAll(t)),n=Object.freeze({language:1,multiplier:2}),i=t=>"string"==typeof t?t.trim().toLowerCase():"",a=(t,e)=>{const n=i(e);if(!t||!n)return null;const a=Array.from(t.attributes||[]);for(const t of a){const e=/^data-item-custom(\d+)-role$/i.exec(t.name);if(!e)continue;if(i(t.value)!==n)continue;const a=parseInt(e[1],10);if(Number.isFinite(a)&&a>0)return a}return null},o=["fr","en"],s="fr",r=window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,l=()=>{const e=t("header");return e?e.offsetHeight:0};window.whenSnipcart=t=>{if(window.Snipcart&&window.Snipcart.store&&window.Snipcart.api)return void t();const e=setInterval(()=>{window.Snipcart&&window.Snipcart.store&&window.Snipcart.api&&(clearInterval(e),t())},200)},window.GD=Object.assign(window.GD||{},{qs:t,qsa:e,throttle:(t,e=100)=>{let n=0,i=null;return function(...a){const o=Date.now();o-n>=e?(n=o,t.apply(this,a)):i||(i=setTimeout(()=>{n=Date.now(),i=null,t.apply(this,a)},e-(o-n)))}},debounce:(t,e=120)=>{let n;return function(...i){clearTimeout(n),n=setTimeout(()=>t.apply(this,i),e)}},createEl:(t,e={},n=[])=>{const i=document.createElement(t);return Object.entries(e).forEach(([t,e])=>{"class"===t?i.className=e:"style"===t?Object.assign(i.style,e):null!=e&&i.setAttribute(t,e)}),[].concat(n).forEach(t=>{"string"==typeof t?i.appendChild(document.createTextNode(t)):t&&i.appendChild(t)}),i},getLang:()=>{const t=localStorage.getItem("lang"),e=(t=>{try{const e=document.cookie.match(new RegExp(`(?:^|; )${t}=([^;]+)`));return e?e[1]:null}catch(t){return null}})("lang"),n=document.documentElement.lang,i=(t||e||n||s).toLowerCase();return o.includes(i)?i:s},setLang:t=>{const e=o.includes(t)?t:s;return localStorage.setItem("lang",e),localStorage.setItem("snipcartLanguage",e),((t,e,n=31536e3)=>{try{document.cookie=`${t}=${e};path=/;max-age=${n}`}catch(t){}})("lang",e),document.documentElement.lang=e,e},smoothScrollTo:(t,e={})=>{const n=Math.max(0,t.getBoundingClientRect().top+window.pageYOffset-(e.offset??l()+12));r?window.scrollTo(0,n):window.scrollTo({top:n,behavior:"smooth"})},getHeaderOffset:l,focusTrap:t=>{let n=[],i=null,a=null;const o=t=>{"Tab"===t.key&&n.length&&(t.shiftKey&&document.activeElement===i?(t.preventDefault(),a.focus()):t.shiftKey||document.activeElement!==a||(t.preventDefault(),i.focus()))};return{mount(){n=e('a[href], button:not([disabled]), select, textarea, input, [tabindex]:not([tabindex="-1"])',t),[i]=n,a=n[n.length-1],t.addEventListener("keydown",o)},unmount(){t.removeEventListener("keydown",o)}}},customFields:{indexesByRole:n,normalizeRole:i,findIndexOnButton:a,resolveIndex:(t,{button:e=null,fallbackIndexes:o=[],position:s=0}={})=>{if(!t)return null;const r=parseInt(t.dataset?.customIndex??"",10);if(Number.isFinite(r)&&r>0)return r;const l=i((t.dataset?.itemCustomRole??t.dataset?.customRole)||"");if(l){const t=a(e,l);if(Number.isFinite(t)&&t>0)return t;const i=n[l];if(Number.isFinite(i)&&i>0)return i}if(Array.isArray(o)&&o.length>0){const t=o[s];if(Number.isFinite(t)&&t>0)return t;const e=o[o.length-1];if(Number.isFinite(e)&&e>0)return e}return null}}})})(),document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector("header");if(!t)return;const e=()=>{const e=t.getBoundingClientRect().height||96;document.documentElement.style.setProperty("--header-height",`${e}px`),document.documentElement.style.setProperty("--gd-header-h",`${e}px`)};e(),new ResizeObserver(e).observe(t),window.addEventListener("resize",e)}),document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("lang-switcher");let e=window.GD.getLang();["fr","en"].includes(e)||(e="fr"),e=window.GD.setLang(e);var n,i;n=e,document.querySelectorAll(".flag-btn[data-lang]").forEach(t=>{t.dataset.lang===n?t.setAttribute("aria-current","true"):t.removeAttribute("aria-current")}),whenSnipcart(()=>window.Snipcart.api.session.setLanguage(e)),document.querySelectorAll(".flag-btn[data-lang]").forEach(t=>{t.addEventListener("click",()=>{const e=t.dataset.lang;window.GD.setLang(e);let n=window.location.pathname;if("fr"!==e){const t=new URLSearchParams(window.location.search);t.set("lang",e),n+="?"+t.toString()}window.location.hash&&(n+=window.location.hash),window.location.href=n})}),i=e,fetch(`/lang/${i}.json`).then(t=>t.ok?t.json():null).then(t=>{if(!t)return;window.i18n=t,document.querySelectorAll("[data-i18n]").forEach(e=>{const n=e.dataset.i18n.split(".");let i=t;n.forEach(t=>{i&&(i=i[t])}),null!=i&&(e.innerHTML=i)}),document.querySelectorAll("[data-name-fr]").forEach(t=>{const e="en"===i?t.dataset.nameEn:t.dataset.nameFr;e&&(t.innerHTML=e)}),document.querySelectorAll("[data-desc-fr]").forEach(t=>{}),document.querySelectorAll("[data-alt-fr]").forEach(t=>{const e="en"===i?t.dataset.altEn:t.dataset.altFr;e&&t.setAttribute("alt",e)});const e=/(multiplicat(eur|or)|multiplier)/i,n=window.GD?.customFields||{},a="function"==typeof n.findIndexOnButton?n.findIndexOnButton:()=>null;document.querySelectorAll(".snipcart-add-item").forEach(n=>{"en"===i?(n.dataset.itemNameEn&&n.setAttribute("data-item-name",n.dataset.itemNameEn),n.dataset.itemDescriptionEn&&(n.dataset.itemDescription=n.dataset.itemDescriptionEn,n.setAttribute("data-item-description",n.dataset.itemDescriptionEn))):(n.dataset.itemNameFr&&n.setAttribute("data-item-name",n.dataset.itemNameFr),n.dataset.itemDescriptionFr&&(n.dataset.itemDescription=n.dataset.itemDescriptionFr,n.setAttribute("data-item-description",n.dataset.itemDescriptionFr)));const o=a(n,"multiplier"),s=(()=>{const t=Number.parseInt(o,10);return Number.isFinite(t)&&t>0?t:null})();if(null!==s&&n.hasAttribute(`data-item-custom${s}-name`)&&t?.product?.multiplier){const i=n.getAttribute(`data-item-custom${s}-name`)||"",a=n.dataset[`itemCustom${s}Role`]||"",o=a&&"multiplier"===a.toLowerCase()||n.hasAttribute("data-multiplier-label")||n.dataset.multiplierLabel&&["1","true","yes","oui"].includes(n.dataset.multiplierLabel.toLowerCase()),r=e.test(i);(o||r)&&n.setAttribute(`data-item-custom${s}-name`,t.product.multiplier)}}),document.querySelectorAll('[data-role^="multiplier-"]').forEach(t=>{const{role:e}=t.dataset,n=e?.split("-")[1];n&&t.closest(".multiplier-wrapper")?.classList.toggle("hidden",n!==i)}),"function"==typeof window.updatePlus&&document.querySelectorAll(".btn-shop[data-item-id]").forEach(t=>{window.updatePlus(t.dataset.itemId)})}).catch(()=>{t&&t.classList.add("hidden")})}),document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".fade-up").forEach(t=>{new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&t.target.classList.add("animate")})},{threshold:.1}).observe(t)}),document.body.addEventListener("click",t=>{const e=t.target.closest('a[href^="#"]:not([href="#"])');if(!e)return;const n=e.getAttribute("href").slice(1),i=document.getElementById(n);i&&(t.preventDefault(),window.GD.smoothScrollTo(i),e.matches("nav .nav-link")&&(document.querySelectorAll("nav .nav-link.is-active").forEach(t=>t.classList.remove("is-active")),e.classList.add("is-active")))},{passive:!1})}),document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("menu-btn"),e=document.getElementById("mobile-menu"),n=document.getElementById("menu-overlay"),i=document.getElementById("menu-close");if(!t||!e||!n)return;const a=window.GD.focusTrap(e),o=()=>{e.classList.add("translate-x-full"),e.classList.remove("translate-x-0"),n.classList.remove("opacity-100"),n.classList.add("opacity-0"),n.addEventListener("transitionend",()=>n.classList.add("hidden"),{once:!0}),e.addEventListener("transitionend",()=>{e.classList.add("hidden")},{once:!0}),t.setAttribute("aria-expanded","false"),e.setAttribute("aria-hidden","true"),a.unmount(),t.focus()};t.addEventListener("click",()=>{"true"===t.getAttribute("aria-expanded")?o():(()=>{e.classList.remove("hidden"),n.classList.remove("hidden"),requestAnimationFrame(()=>{e.classList.remove("translate-x-full"),e.classList.add("translate-x-0"),n.classList.remove("opacity-0"),n.classList.add("opacity-100")}),t.setAttribute("aria-expanded","true"),e.setAttribute("aria-hidden","false"),a.mount();const i=e.querySelector("a,button");i&&i.focus()})()}),e.querySelectorAll("a").forEach(t=>t.addEventListener("click",o)),n.addEventListener("click",o),i&&i.addEventListener("click",o),document.addEventListener("keydown",e=>{"Escape"===e.key&&"true"===t.getAttribute("aria-expanded")&&o()})}),document.addEventListener("DOMContentLoaded",()=>{const t=t=>{document.querySelectorAll('nav .nav-link.is-active, nav .nav-link[aria-current="page"]').forEach(t=>{t.classList.remove("is-active"),t.removeAttribute("aria-current")}),t&&(t.classList.add("is-active"),t.setAttribute("aria-current","page"))};document.querySelectorAll("nav .nav-link").forEach(e=>{e.addEventListener("click",n=>{n.metaKey||n.ctrlKey||n.shiftKey||n.altKey||t(e)})});const e=new Map;if(document.querySelectorAll('nav .nav-link[href*="#"]').forEach(t=>{const n=t.getAttribute("href").split("#")[1],i=n&&document.getElementById(n);i&&e.set(i,t)}),e.size){const n=new IntersectionObserver(n=>{let i=null;for(const t of n)t.isIntersecting&&(!i||t.intersectionRatio>i.intersectionRatio)&&(i=t);i&&t(e.get(i.target))},{rootMargin:"0px 0px -55% 0px",threshold:[.25,.5,.75]});e.forEach((t,e)=>n.observe(e))}document.querySelectorAll("nav .relative.group").forEach(t=>{const e=t.querySelector("ul");e&&(t.addEventListener("focusin",()=>e.classList.remove("hidden")),t.addEventListener("focusout",n=>{t.contains(n.relatedTarget)||e.classList.add("hidden")}))})}),document.addEventListener("DOMContentLoaded",()=>{const t=["video1","video2","video3"].map(t=>document.getElementById(t)).filter(Boolean).filter(t=>!t.closest(".hero-videos"));let e,n=0,i=!1;t.forEach(t=>{if(t.closest(".hero-videos"))return void log("Skipping hero video from app.js management:",t);t.dataset.userPaused="false",t.dataset.autoPaused="false";const e=()=>t.classList.add("scale-105","z-10"),n=()=>t.classList.remove("scale-105","z-10");t.addEventListener("play",()=>{e(),t.dataset.userPaused="false",t.dataset.autoPaused="false"}),t.addEventListener("playing",e),t.addEventListener("pause",()=>{n(),"true"===t.dataset.autopausing?t.dataset.autopausing="false":t.dataset.userPaused="true"}),t.addEventListener("ended",n)});const a=new IntersectionObserver(t=>{t.forEach(t=>{const e=t.target;e.closest('[data-managed-by="hero-videos"]')||(t.isIntersecting?"true"===e.dataset.autoPaused&&"true"!==e.dataset.userPaused&&(e.play(),e.dataset.autoPaused="false"):e.paused||(e.dataset.autopausing="true",e.dataset.autoPaused="true",e.pause(),e.classList.remove("scale-105","z-10")))})},{threshold:.2});function o(t){const e=document.querySelector(`.mute-btn[data-video="${t.id}"]`);e&&(e.textContent=t.muted?"🔇":"🔊")}t.forEach(t=>{t.closest('[data-managed-by="hero-videos"]')||t.closest(".hero-videos")||a.observe(t)});const s=()=>{if(i)return;i=!0;const e=t[n];e&&!e.paused&&(e.muted=!1,o(e))};function r(a){a.muted=!i,a.currentTime=0,a.play().then(()=>{i&&(a.muted=!1),o(a)}).catch(()=>{a.muted=!0,a.play(),o(a)}),a.onended=()=>{n+=1,n<t.length&&e(n)}}["click","touchstart","keydown","wheel"].forEach(t=>window.addEventListener(t,s,{once:!0,passive:!0})),document.querySelectorAll(".mute-btn").forEach(e=>{const n=t.find(t=>t.id===e.dataset.video);n&&e.addEventListener("click",t=>{t.stopPropagation(),n.muted=!n.muted,o(n)})}),e=e=>{const n=t[e];if(!n)return;t.forEach((t,n)=>{n!==e&&(t.pause(),t.currentTime=0)});const i=new IntersectionObserver(t=>{t[0].isIntersecting&&fullyVisible(n)&&(i.disconnect(),r(n))},{threshold:1});i.observe(n)},t.forEach((t,e)=>{t.addEventListener("click",()=>{t.paused?(i||s(),n=e,r(t)):t.pause()})}),t.length&&e(n)}),document.addEventListener("DOMContentLoaded",()=>{const t=window.stock||{},e=t=>{const e=Number.parseInt(t,10);return Number.isFinite(e)&&e>0?e:null},n=window.GD?.customFields||{},i="function"==typeof n.resolveIndex?n.resolveIndex:null,a=e=>{const n=t[e],i=parseInt(document.getElementById(`qty-${e}`)?.textContent||"1",10),a=document.querySelector(`.quantity-btn.plus[data-target="${e}"]`),o=document.querySelector(`.btn-shop[data-item-id="${e}"]`),s=null!=n&&(n<=0||i>=n),r=void 0!==o?.dataset.hidePrice,l=o?parseFloat(o.dataset.itemPrice||"0"):0,c=window.i18n?.product||{},u=c.add||"Ajouter",d=c.insufficientStock||"Stock insuffisant";if(a){const t=i+1;a.disabled=null!=n&&(n<=0||t>n),a.title=a.disabled?d:""}if(o){const t=o.querySelector('[data-i18n="product.add"]');let e=o.querySelector(".price-text");e||(e=document.createElement("span"),e.className="price-text",o.append(" ",e)),o.disabled=s,o.title=s?d:"",t&&(t.textContent=s?d:u),e.textContent=s||r||!l?"":`— ${l*i} $`}};window.updatePlus=a,document.querySelectorAll(".quantity-btn").forEach(e=>{e.addEventListener("click",()=>{const n=e.dataset.target,i=document.getElementById(`qty-${n}`);if(!i)return;let o=parseInt(i.textContent,10)||1;const s=t[n];e.classList.contains("minus")?o=Math.max(1,o-1):(null==s||o+1<=s)&&(o+=1),i.textContent=o;const r=document.querySelector(`.btn-shop[data-item-id="${n}"]`);r&&r.setAttribute("data-item-quantity",String(o)),a(n)})}),document.querySelectorAll(".quantity-selector").forEach(t=>{a(t.dataset.id)}),document.querySelectorAll(".btn-shop[data-item-id]").forEach(t=>{const e=t.dataset.itemId;document.querySelector(`.quantity-selector[data-id="${e}"]`)||a(e)});const o=(t,{onUpdate:n}={})=>{document.querySelectorAll(t).forEach(t=>{const o=t.dataset.target;if(!o)return;const s=document.querySelector(`.btn-shop[data-item-id="${o}"]`),r=i?i(t,{button:s}):null;let l=e(r);l||(l=e(t.dataset.customIndex)??1),t.dataset.customIndex=String(l);const c=()=>{const e=parseInt(document.getElementById(`qty-${o}`)?.textContent||"1",10);s&&(s.setAttribute(`data-item-custom${l}-value`,t.value),s.setAttribute("data-item-quantity",String(e)),"function"==typeof n&&n({id:o,addBtn:s,select:t,value:t.value,index:l})),a(o)};c(),t.addEventListener("change",c)})};o(".multiplier-select",{onUpdate:({addBtn:t})=>{const e="en"===document.documentElement.lang?"itemNameEn":"itemNameFr",n=t.dataset.gdBaseName||t.getAttribute("data-item-name")||"";!t.dataset.gdBaseName&&n&&(t.dataset.gdBaseName=n);const i=t.dataset[e]||t.dataset.gdBaseName||n;i&&t.setAttribute("data-item-name",i)}}),o(".language-select"),o(".triptych-select"),document.querySelectorAll(".swiper").forEach(t=>{if(t.classList.contains("swiper-thumbs"))return;const e=t.parentElement.querySelector(".swiper-thumbs");if(e){const n=new Swiper(e,{slidesPerView:4,freeMode:!0,watchSlidesProgress:!0});new Swiper(t,{loop:!0,autoplay:{delay:5e3},navigation:{nextEl:t.querySelector(".swiper-button-next"),prevEl:t.querySelector(".swiper-button-prev")},thumbs:{swiper:n}})}else new Swiper(t,{loop:!0,autoplay:{delay:5e3},navigation:{nextEl:t.querySelector(".swiper-button-next"),prevEl:t.querySelector(".swiper-button-prev")}})}),window.Fancybox&&Fancybox.bind("[data-fancybox]",{backdrop:"blur",dragToClose:!0,closeButton:"top",placeFocusBack:!0,on:{close:()=>window.history.back()}})}),document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelectorAll(".snipcart-checkout"),e=document.querySelectorAll(".snipcart-customer-signin"),n=()=>"visible"===window.Snipcart?.store?.getState()?.cart?.status,i=()=>"visible"===window.Snipcart?.store?.getState()?.customer?.status;t.forEach(t=>t.addEventListener("click",t=>{window.Snipcart?.store&&window.Snipcart?.api?.theme&&n()&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),window.Snipcart.api.theme.cart.close(),t.currentTarget.blur())})),e.forEach(t=>t.addEventListener("click",t=>{window.Snipcart?.store&&window.Snipcart?.api?.theme&&i()&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),window.Snipcart.api.theme.customer.close(),t.currentTarget.blur())}));const a=()=>{const a=n(),o=i();t.forEach(t=>t.classList.toggle("is-active",a)),e.forEach(t=>t.classList.toggle("is-active",o))};window.addEventListener("snipcart.ready",a),window.addEventListener("snipcart.opened",a),window.addEventListener("snipcart.closed",a);!function t(){window.Snipcart&&window.Snipcart.store?(()=>{try{const{store:t}=window.Snipcart;t&&t.subscribe(()=>a())}catch(t){}})():setTimeout(t,300)}()}),document.addEventListener("DOMContentLoaded",()=>{if(!("loading"in HTMLImageElement.prototype)){const t=document.querySelectorAll('img[loading="lazy"]');if(!t.length)return;const e=new IntersectionObserver((t,e)=>{t.forEach(t=>{if(!t.isIntersecting)return;const n=t.target,{src:i}=n.dataset,{srcset:a}=n.dataset;i&&(n.src=i),a&&(n.srcset=a),e.unobserve(n)})},{rootMargin:"100px 0px"});t.forEach(t=>e.observe(t))}}),document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("back-to-top");if(t){t.addEventListener("click",t=>{t.preventDefault(),window.scrollTo({top:0,behavior:"smooth"})});const e=throttle(()=>{t.classList.toggle("opacity-0",window.pageYOffset<500),t.classList.toggle("pointer-events-none",window.pageYOffset<500)},100);window.addEventListener("scroll",e,{passive:!0}),e()}document.querySelectorAll("[data-collapse]").forEach(t=>{const e=document.querySelector(t.dataset.collapse);if(!e)return;t.setAttribute("aria-expanded","false"),e.hidden=!0;const n=()=>{e.hidden=!1,t.setAttribute("aria-expanded","true"),e.style.height="auto";const n=`${e.clientHeight}px`;e.style.height="0px",requestAnimationFrame(()=>{e.style.height=n}),e.addEventListener("transitionend",()=>{e.style.height="auto"},{once:!0})},i=()=>{t.setAttribute("aria-expanded","false"),e.style.height=`${e.clientHeight}px`,requestAnimationFrame(()=>{e.style.height="0px"}),e.addEventListener("transitionend",()=>{e.hidden=!0,e.style.height=""},{once:!0})};t.addEventListener("click",e=>{e.preventDefault(),("true"===t.getAttribute("aria-expanded")?i:n)()})})}),document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector("header");if(!t)return;const e=((t,e=80)=>{let n=0;return()=>{const i=Date.now();i-n>e&&(n=i,t())}})(()=>{t.classList.toggle("shadow-2xl",window.pageYOffset>8),t.classList.toggle("backdrop-blur-md",window.pageYOffset>8)});window.addEventListener("scroll",e,{passive:!0}),e()}),(()=>{const t=window.GD?.customFields||{},e="function"==typeof t.resolveIndex?t.resolveIndex:null,n=()=>{!0!==window.__snipcartQtyPatch&&(document.addEventListener("click",t=>{const n=t.target.closest(".snipcart-add-item");if(!n)return;const i=n.getAttribute("data-item-id")||n.dataset.itemId;if(!i)return;const a=document.getElementById(`qty-${i}`);if(a){const t=parseInt(a.textContent,10);!Number.isNaN(t)&&t>0&&n.setAttribute("data-item-quantity",String(t))}const o=Array.from(document.querySelectorAll("select[data-target]")).filter(t=>t.dataset.target===i);if(o.length){const t=(t=>{const e=[];return Array.from(t.attributes).forEach(t=>{const n=/^data-item-custom(\d+)-/i.exec(t.name);if(!n)return;const i=parseInt(n[1],10);Number.isFinite(i)&&e.push(i)}),e.sort((t,e)=>t-e)})(n),i=n.getAttribute("data-item-name")||"",a=n.dataset.itemNameFr||i,s=n.dataset.itemNameEn||i;o.forEach((o,r)=>{let l=null;if(e&&(l=e(o,{button:n,fallbackIndexes:t,position:r})),!Number.isFinite(l)||l<=0){l=(t=>{const e=parseInt(t,10);return Number.isFinite(e)&&e>0?e:null})(o.dataset.customIndex||"")??t[r]??t[t.length-1]??r+1}o.dataset.customIndex=String(l);const c=null==o.value?"":`${o.value}`;let u=c;if(o.classList.contains("multiplier-select")){const t=c&&""!==`${c}`.trim()?`${c}`:"1";u=t,a&&!n.dataset.gdBaseNameFr&&(n.dataset.gdBaseNameFr=a),s&&!n.dataset.gdBaseNameEn&&(n.dataset.gdBaseNameEn=s);const e=("en"===("en"===document.documentElement.lang?"en":"fr")?n.dataset.gdBaseNameEn||s:n.dataset.gdBaseNameFr||a)||n.dataset.gdBaseName||i||n.getAttribute("data-item-name")||"";e&&(n.dataset.gdBaseName||(n.dataset.gdBaseName=e),n.setAttribute("data-item-name",e)),n.dataset.gdMultiplier=t}n.setAttribute(`data-item-custom${l}-value`,u)})}},{passive:!0}),window.__snipcartQtyPatch=!0)};window.__ensureSnipcartQtyPatch=n;document.addEventListener("DOMContentLoaded",()=>{const t=t=>{const e=t.dataset.target,n=t.dataset.customIndex,i=document.querySelector(`.snipcart-add-item[data-item-id="${e}"]`);i&&n&&i.setAttribute(`data-item-custom${n}-value`,t.value)};document.querySelectorAll("select[data-target][data-custom-index]").forEach(e=>{e.addEventListener("change",()=>t(e)),t(e)}),document.querySelectorAll(".snipcart-add-item").forEach(e=>{e.addEventListener("click",n=>{const i=e.dataset.itemId||e.getAttribute("data-item-id");document.querySelectorAll(`select[data-target="${i}"]`).forEach(e=>t(e))})})}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n,{once:!0}):n()})(),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("snipcart")});const toggleSnipcartScroll=()=>{const t=document.getElementById("snipcart"),e=!!t?.querySelector(".snipcart-order"),n="visible"===window.Snipcart?.store?.getState()?.cart?.status;document.body.classList.toggle("snipcart-open",n&&!e)};function copyEmailToClipboard(t,e){"use strict";navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(t).then(()=>{showCopyFeedback(e,!0)}).catch(n=>{fallbackCopyEmail(t,e)}):fallbackCopyEmail(t,e)}function fallbackCopyEmail(t,e){"use strict";const n=document.createElement("textarea");n.value=t,n.style.position="fixed",n.style.opacity="0",document.body.appendChild(n),n.select();try{showCopyFeedback(e,document.execCommand("copy"))}catch(t){showCopyFeedback(e,!1)}finally{document.body.removeChild(n)}}function showCopyFeedback(t,e){"use strict";const n=t.querySelector(".copy-feedback");if(n)if(e)n.classList.remove("hidden"),n.classList.add("animate-pulse"),setTimeout(()=>{n.classList.add("hidden"),n.classList.remove("animate-pulse")},2e3);else{const t=n.textContent;n.textContent="✗ Erreur",n.classList.remove("hidden","bg-green-600"),n.classList.add("bg-red-600"),setTimeout(()=>{n.textContent=t,n.classList.add("hidden","bg-green-600"),n.classList.remove("bg-red-600")},2e3)}}function playSound(t,e=.5){try{const n=new Audio(t);n.volume=Math.max(0,Math.min(1,e)),n.play().catch(t=>{console.debug("Audio autoplay bloqué:",t)})}catch(t){console.debug("Erreur lecture audio:",t)}}window.addEventListener("snipcart.opened",toggleSnipcartScroll),window.addEventListener("snipcart.closed",toggleSnipcartScroll),window.addEventListener("snipcart.ready",()=>{const t=document.getElementById("snipcart");t&&new MutationObserver(toggleSnipcartScroll).observe(t,{childList:!0,subtree:!0}),toggleSnipcartScroll()}),document.addEventListener("DOMContentLoaded",()=>{const t=()=>{document.documentElement.getAttribute("data-cmp-status")};document.addEventListener("cmpConsentUpdate",t=>{const e=t.detail?.purposes||{};e.analytics,e.marketing,document.dispatchEvent(new CustomEvent("gdConsentUpdate",{detail:{purposes:e,timestamp:Date.now()}}))}),t(),["snipcart_*","PHPSESSID","lang_preference","cart_session"].forEach(t=>{document.documentElement.setAttribute(`data-cookie-essential-${t.replace("*","all")}`,"true")});const e=setInterval(()=>{const n=document.documentElement.getAttribute("data-cmp-status");n&&"unknown"!==n&&(clearInterval(e),t())},500);setTimeout(()=>clearInterval(e),1e4)}),(()=>{function t(t=".hero-text h1",e=50,n=500){const i=document.querySelector(t);if(i&&!i.dataset.typed){const t=i.textContent.trim();i.textContent="",i.dataset.typed="true",i.hasAttribute("data-i18n")&&(i.dataset.originalI18n=i.getAttribute("data-i18n"),i.removeAttribute("data-i18n"));let a=0;const o=()=>{a<t.length&&(i.textContent+=t.charAt(a),a++,setTimeout(o,e))};setTimeout(o,n)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>t()):t(),document.addEventListener("languageChanged",()=>{const e=document.querySelector(".hero-text h1");e&&(e.dataset.typed=!1,e.dataset.originalI18n&&e.setAttribute("data-i18n",e.dataset.originalI18n),setTimeout(()=>t(),100))}),window.initTypewriterTitle=t})(),(()=>{class t{constructor(){this.nav=document.querySelector(".shop-quick-links"),this.hero=document.querySelector("section.min-h-screen"),this.links=this.nav?Array.from(this.nav.querySelectorAll('a[href^="#"]')):[],this.sections=[],this.isSticky=!1,this.scrollThreshold=0,this.nav&&this.hero&&this.init()}init(){this.updateScrollThreshold(),this.links.forEach(t=>{const e=t.getAttribute("href").substring(1),n=document.getElementById(e);n&&this.sections.push({id:e,element:n,link:t})}),window.addEventListener("scroll",this.handleScroll.bind(this),{passive:!0}),window.addEventListener("resize",this.debounce(()=>this.updateScrollThreshold(),200)),this.links.forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();const n=t.getAttribute("href").substring(1),i=document.getElementById(n);if(i){const t=i.offsetTop-(this.isSticky?this.nav.offsetHeight+parseInt(getComputedStyle(document.documentElement).getPropertyValue("--header-height")||"0"):0);window.scrollTo({top:t,behavior:"smooth"})}})}),this.handleScroll()}updateScrollThreshold(){this.hero&&(this.scrollThreshold=this.hero.offsetHeight-100)}handleScroll(){const t=window.scrollY||window.pageYOffset;t>this.scrollThreshold&&!this.isSticky?(this.nav.classList.add("sticky-active"),this.isSticky=!0):t<=this.scrollThreshold&&this.isSticky&&(this.nav.classList.remove("sticky-active"),this.isSticky=!1),this.isSticky&&this.updateActiveSection(t)}updateActiveSection(t){let e=null;const n=this.nav.offsetHeight+parseInt(getComputedStyle(document.documentElement).getPropertyValue("--header-height")||"0")+50;for(let i=this.sections.length-1;i>=0;i--){const a=this.sections[i];if(t>=a.element.offsetTop-n){e=a;break}}this.links.forEach(t=>t.classList.remove("active")),e&&e.link.classList.add("active")}debounce(t,e){let n;return function(...i){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),t(...i)},e)}}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>new t):new t})(),window.copyEmailToClipboard=copyEmailToClipboard,document.addEventListener("DOMContentLoaded",()=>{document.addEventListener("snipcart.ready",()=>{window.Snipcart.events.on("item.added",t=>{playSound("media/sounds/coin-drop.mp3",.5)})}),document.addEventListener("click",t=>{t.target.closest(".snipcart-add-item")&&setTimeout(()=>{playSound("media/sounds/coin-drop.mp3",.5)},50)})});class CurrencyConverterPremium{constructor(){this.tauxChange={copper:1,silver:10,electrum:50,gold:100,platinum:1e3},this.multiplicateursDisponibles=[1,10,100,1e3,1e4],this.nf=new Intl.NumberFormat("fr-FR"),this.editMode=!0,this.productPrices={single:10,trio:25,septuple:50},this.sourceInputs=null,this.multiplierInputs=null,this.bestDisplay=null,this.metalCards={},this.donneesMetaux={copper:{name:"Cuivre",nameEn:"Copper",emoji:"🪙",color:"amber"},silver:{name:"Argent",nameEn:"Silver",emoji:"🥈",color:"gray"},electrum:{name:"Électrum",nameEn:"Electrum",emoji:"⚡",color:"yellow"},gold:{name:"Or",nameEn:"Gold",emoji:"🥇",color:"yellow"},platinum:{name:"Platine",nameEn:"Platinum",emoji:"💎",color:"cyan"}},this.callbacksChangement=[],this.cacheCalculs=new Map,this.stats={conversionsTotal:0,cacheHits:0,dernierCalcul:null},this.init()}init(){this.loadProductPrices(),this.addTranslationSupport(),this.refreshDOMReferences(),this.setupEventListeners(),this.updateDisplay(),this.displayDefaultOptimalRecommendationMessage(),this.displayDefaultRecommendationMessage()}async loadProductPrices(){try{window.products&&(this.productPrices.single=window.products["coin-custom-single"]?.price||10,this.productPrices.trio=window.products["coin-trio-customizable"]?.price||25,this.productPrices.septuple=window.products["coin-septuple-free"]?.price||50)}catch(t){}}refreshDOMReferences(){const t=document.getElementById("currency-converter-premium");t&&(this.sourceInputs=t.querySelectorAll("input[data-currency]"),this.multiplierInputs=t.querySelectorAll(".multiplier-input"),this.bestDisplay=document.getElementById("currency-best"),Object.keys(this.donneesMetaux).forEach(t=>{const e=document.getElementById(`${t}-card`);e&&(this.metalCards[t]=e)}))}ajouterCallbackChangement(t){"function"==typeof t&&this.callbacksChangement.push(t)}notifierChangement(t){this.callbacksChangement.forEach(e=>{try{e(t)}catch(t){}})}getCurrentLang(){return document.documentElement.lang||"fr"}getTranslation(t,e=""){if(window.i18n){const n=t.split(".");let i=window.i18n;for(const t of n){if(!i||"object"!=typeof i||!(t in i))return e;i=i[t]}return"string"==typeof i?i:e}return e}obtenirNomMetal(t){const e=this.getCurrentLang(),n=this.donneesMetaux[t];return"en"===e?n.nameEn:n.name}setupEventListeners(){const t=document.getElementById("currency-converter-premium");if(!t)return;const e=(t,e)=>{let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>t.apply(this,i),e)}},n=e(()=>{this.mettreAJourDepuisSources(),this.notifierChangement(this.obtenirValeursActuelles())},150),i=e(()=>{this.mettreAJourDepuisMultiplicateurs(),this.notifierChangement(this.obtenirValeursActuelles())},150);t.addEventListener("input",t=>{t.target.matches("input[data-currency]")?(t.target.value=t.target.value.replace(/[^0-9]/g,""),n()):t.target.matches(".multiplier-input")&&(t.target.value=t.target.value.replace(/[^0-9]/g,""),i())},{passive:!0}),t.addEventListener("focus",t=>{t.target.matches("input[data-currency]")&&"0"===t.target.value&&(t.target.value="")},{passive:!0})}convertirMontant(t,e=this.multiplicateursDisponibles,n=!1){if(t<0)throw new Error("Le montant ne peut pas être négatif");if(!Array.isArray(e)||0===e.length)throw new Error("Les multiplicateurs doivent être un tableau non vide");this.stats.conversionsTotal++,this.stats.dernierCalcul=new Date;const i=`${t}_${e.join("_")}_${n}`;if(this.cacheCalculs.has(i))return this.stats.cacheHits++,this.cacheCalculs.get(i);const a=this.calculerRepartitionOptimale(t,e,n);return setTimeout(()=>this.cacheCalculs.delete(i),3e5),this.cacheCalculs.set(i,a),a}calculerRepartitionOptimale(t,e,n){if(0===t)return[];if(n)return this.obtenirRepartitionUtilisateur();const i=this.findMinimalCoins(t,!1);return this.formaterSolutionStandard(i)}formaterSolutionStandard(t){return t&&0!==t.length?t.map(t=>({metal:t.currency,multiplicateur:t.multiplier,quantite:t.quantity,valeurUnitaire:this.tauxChange[t.currency]*t.multiplier,valeurTotale:this.tauxChange[t.currency]*t.multiplier*t.quantity,typeLot:t.lotType||"unitaire"})):[]}calculerTotalPieces(t){return Array.isArray(t)?t.reduce((t,e)=>t+(e.quantite||0),0):0}calculerValeurTotale(t){return Array.isArray(t)?t.reduce((t,e)=>t+(e.valeurTotale||0),0):0}formaterPourAffichage(t,e=!0){if(!Array.isArray(t)||0===t.length)return"";const n=t.map(t=>{const n=this.donneesMetaux[t.metal],i=this.obtenirNomMetal(t.metal);let a=`${this.nf.format(t.quantite)} ${n.emoji} ${i.toLowerCase()}`;return e&&1!==t.multiplicateur&&(a+=` (×${this.nf.format(t.multiplicateur)})`),"trio"!==t.typeLot&&"septuple"!==t.typeLot||(a+=" 📦"),a});if(n.length>1){const t=n.pop();return`${n.join(", ")} ${this.getTranslation("shop.converter.and","et")} ${t}`}return n[0]||""}getCurrentValues(){this.sourceInputs||this.refreshDOMReferences();const t={copper:0,silver:0,electrum:0,gold:0,platinum:0},e=this.getTotalBaseValue();return this.sourceInputs&&this.sourceInputs.forEach(e=>{const{currency:n}=e.dataset,i=Math.max(0,parseInt(e.value)||0);t[n]=i}),{values:t,baseValue:e,breakdown:this.getOptimalBreakdown(e)}}obtenirValeursActuelles(){return this.getCurrentValues()}obtenirRepartitionUtilisateur(){const t=this.getUserMultiplierBreakdown();return this.formaterSolutionStandard(t)}onChange(t){this.ajouterCallbackChangement(t)}notifyChange(t){this.notifierChangement(t)}getCurrencyName(t){return this.obtenirNomMetal(t)}getTotalBaseValue(){return this.sourceInputs||this.refreshDOMReferences(),this.sourceInputs&&0!==this.sourceInputs.length?Array.from(this.sourceInputs).reduce((t,e)=>{const{currency:n}=e.dataset;return t+Math.max(0,parseInt(e.value)||0)*this.tauxChange[n]},0):0}mettreAJourDepuisSources(){const t=this.getTotalBaseValue();this.updateMultiplierTableWithOptimization(t),this.updateMetalCards(t),this.updateOptimalRecommendationsFromUser(t),this.updateOptimalLotsRecommendations(t),this.updateCoinLotsRecommendations(t,!0)}updateFromSources(){this.mettreAJourDepuisSources()}mettreAJourDepuisMultiplicateurs(){let t=0;this.multiplierInputs.forEach(e=>{const{currency:n}=e.closest("tr").dataset,i=parseInt(e.dataset.multiplier),a=parseInt(e.value.replace(/\s/g,""))||0;t+=a*this.tauxChange[n]*i}),this.sourceInputs.forEach(t=>{t.value="0"}),this.distributeOptimally(t),this.updateMetalCards(t),this.updateOptimalRecommendationsFromUser(t),this.updateOptimalLotsRecommendations(t),this.updateCoinLotsRecommendations(t,!0)}updateFromMultipliers(){this.mettreAJourDepuisMultiplicateurs()}updateMultiplierTableWithOptimization(t){if(0===t)return void this.multiplierInputs.forEach(t=>{t.value=""});const e=this.calculateOptimalMultiplierTable(t);this.multiplierInputs.forEach(t=>{t.value=""}),e.forEach(t=>{const e=Array.from(this.multiplierInputs).find(e=>{const{currency:n}=e.closest("tr").dataset,i=parseInt(e.dataset.multiplier);return n===t.currency&&i===t.multiplier});e&&t.quantity>0&&(e.value=t.quantity.toString())})}calculateOptimalMultiplierTable(t){if(0===t)return[];const e=[];Object.keys(this.tauxChange).forEach(t=>{this.multiplicateursDisponibles.forEach(n=>{e.push({currency:t,multiplier:n,value:this.tauxChange[t]*n})})}),e.sort((t,e)=>e.value-t.value);const n=[];let i=t;return e.forEach(t=>{if(i>=t.value){const e=Math.floor(i/t.value);e>0&&(n.push({currency:t.currency,multiplier:t.multiplier,quantity:e}),i-=e*t.value)}}),n}distributeOptimally(t){let e=t;["platinum","gold","electrum","silver","copper"].forEach(t=>{const n=document.querySelector(`input[data-currency="${t}"]`),i=this.tauxChange[t],a=Math.floor(e/i);a>0&&(n.value=a.toString(),e-=a*i)})}updateMetalCards(t){0!==t?Object.keys(this.tauxChange).forEach(e=>{if(!this.metalCards[e])return;const n=this.donneesMetaux[e],i=this.tauxChange[e],a=Math.floor(t/i);if(0===a)return void(this.metalCards[e].innerHTML="");const o=this.getMinimalCoinsBreakdown(a),s=t%i;let r="";s>0&&(r=this.getOptimalBreakdown(s)),this.metalCards[e].innerHTML=`\n        <div class="currency-total-card bg-gradient-to-br from-${n.color}-900/20 to-${n.color}-800/20 rounded-xl p-6 border border-${n.color}-700/30">\n          <div class="flex items-center justify-between mb-4">\n            <h6 class="text-${n.color}-300 font-bold text-lg">${n.emoji} ${this.obtenirNomMetal(e)}</h6>\n            <span class="text-2xl font-bold text-${n.color}-300">${this.nf.format(a)}</span>\n          </div>\n          \n          <div class="space-y-2 mb-4">\n            <div class="text-sm">\n              <span class="text-gray-300">${this.getTranslation("shop.converter.minimalCoins","Nombre minimal de pièces")}:</span>\n            </div>\n            ${o.map(t=>`\n              <div class="flex justify-between text-sm pl-2">\n                <span class="text-gray-300">${1===t.multiplier?this.getTranslation("shop.converter.units","Unités"):`Multiplicateur ×${this.nf.format(t.multiplier)}`}:</span>\n                <span class="text-${n.color}-300 font-medium">${this.nf.format(t.quantity)}</span>\n              </div>\n            `).join("")}\n            <div class="border-t border-${n.color}-700/30 pt-2 mt-3">\n              <div class="flex justify-between text-sm">\n                <span class="text-gray-300">${this.getTranslation("shop.converter.totalCoins","Total pièces")}:</span>\n                <span class="text-${n.color}-300 font-bold">${this.nf.format(o.reduce((t,e)=>t+e.quantity,0))}</span>\n              </div>\n            </div>\n          </div>\n          \n          ${r?`\n            <div class="border-t border-${n.color}-700/30 pt-3">\n              <p class="text-xs text-gray-400">${this.getTranslation("shop.converter.remainder","Reste")}: ${r}</p>\n            </div>\n          `:""}\n        </div>\n      `}):Object.keys(this.metalCards).forEach(t=>{this.metalCards[t]&&(this.metalCards[t].innerHTML="")})}getMinimalCoinsBreakdown(t){const e=[];let n=t;return this.multiplicateursDisponibles.slice().reverse().forEach(t=>{const i=Math.floor(n/t);i>0&&(e.push({multiplier:t,quantity:i}),n-=i*t)}),e}getOptimalBreakdown(t){if(t<=0)return"";const e=this.findMinimalCoins(t,!1);return e&&0!==e.length?this.formatSolutionForDisplay(e):""}findMinimalCoins(t,e=!1){let n=null,i=1/0;const a=this.findMetalPrioritySolution(t,e);if(a&&a.length>0){const t=this.calculateSolutionCost(a);t<i&&(i=t,n=a)}const o=this.findCostOptimalSolution(t,e);if(o&&o.length>0){const t=this.calculateSolutionCost(o);t<i&&(i=t,n=o)}if(!n){const e=this.findFallbackSolution(t);e&&e.length>0&&(n=e)}return n}findCostOptimalSolution(t,e=!1){const n=this.convertValueToCoins(t,e);return this.applyBulkDiscounts(n)}findMetalPrioritySolution(t,e=!1){const n=[];let i=t;if(e)return this.getUserMultiplierBreakdown();const a=[];return["platinum","gold","electrum","silver","copper"].forEach(t=>{this.multiplicateursDisponibles.slice().reverse().forEach(e=>{a.push({currency:t,multiplier:e,value:this.tauxChange[t]*e})})}),a.sort((t,e)=>e.value-t.value),a.forEach(t=>{if(i>=t.value){const e=Math.floor(i/t.value);e>0&&(n.push({currency:t.currency,multiplier:t.multiplier,quantity:e,value:t.value}),i-=e*t.value)}}),n}applyBulkDiscounts(t){const e=[];return t.forEach(t=>{const{currency:n,multiplier:i,quantity:a}=t;if(a>=7){const n=Math.floor(a/7),i=a%7;if(n>0&&e.push({...t,quantity:n,lotType:"septuple",economyGained:n*(7*this.productPrices.single-this.productPrices.septuple)}),i>=3){const n=Math.floor(i/3),a=i%3;n>0&&e.push({...t,quantity:n,lotType:"trio",economyGained:n*(3*this.productPrices.single-this.productPrices.trio)}),a>0&&e.push({...t,quantity:a,lotType:"single"})}else i>0&&e.push({...t,quantity:i,lotType:"single"})}else if(a>=3){const n=Math.floor(a/3),i=a%3;e.push({...t,quantity:n,lotType:"trio",economyGained:n*(3*this.productPrices.single-this.productPrices.trio)}),i>0&&e.push({...t,quantity:i,lotType:"single"})}else e.push({...t,lotType:"single"})}),e}calculateSolutionCost(t){return t.reduce((t,e)=>{const{quantity:n,lotType:i}=e;switch(i){case"septuple":return t+n*this.productPrices.septuple;case"trio":return t+n*this.productPrices.trio;default:return t+n*this.productPrices.single}},0)}convertValueToCoins(t,e=!1){const n=[];let i=t;const a=[];return["platinum","gold","electrum","silver","copper"].forEach(t=>{this.multiplicateursDisponibles.slice().reverse().forEach(e=>{a.push({currency:t,multiplier:e,value:this.tauxChange[t]*e})})}),a.sort((t,e)=>e.value-t.value),a.forEach(t=>{if(i>=t.value){const e=Math.floor(i/t.value);e>0&&(n.push({currency:t.currency,multiplier:t.multiplier,quantity:e,value:t.value}),i-=e*t.value)}}),n}optimizeQuantityForBulk(t,e,n){const i=this.tauxChange[e]*n;return t>=7||t>=3?{quantity:t,totalValue:t*i,hasBulkDiscount:!0}:{quantity:t,totalValue:t*i,hasBulkDiscount:!1}}addTranslationSupport(){if(window.i18n&&window.i18n.shop&&window.i18n.shop.converter){const{converter:t}=window.i18n.shop;t.cost||(t.cost="Coût"),t.economy||(t.economy="Économie"),t.bulkDiscount||(t.bulkDiscount="Remise sur quantité"),t.lotType||(t.lotType="Type de lot")}}findFallbackSolution(t){const e=[];return["platinum","gold","electrum","silver","copper"].forEach(t=>{this.multiplicateursDisponibles.forEach(n=>{e.push({currency:t,multiplier:n,value:this.tauxChange[t]*n})})}),e.sort((t,e)=>e.value-t.value),this.greedyFallback(t,e)}greedyFallback(t,e){const n=[];let i=t;return e.forEach(t=>{if(i>=t.value){const e=Math.floor(i/t.value);e>0&&(n.push({...t,quantity:e}),i-=e*t.value)}}),n}balancedDistributionStrategy(t,e){const n=[];let i=t;for(const t of this.multiplicateursDisponibles.slice().reverse()){const a=["platinum","gold","electrum","silver","copper"];for(const o of a){const a=e.find(e=>e.currency===o&&e.multiplier===t);a&&i>=a.value&&(n.push({...a,quantity:1}),i-=a.value)}}if(n.reduce((t,e)=>t+e.value*e.quantity,0)/t>=.9&&n.length>=20&&t>=5e4)return i>0&&e.forEach(t=>{if(i>=t.value){const e=Math.floor(i/t.value);if(e>0){const a=n.find(e=>e.currency===t.currency&&e.multiplier===t.multiplier);a?a.quantity+=e:n.push({...t,quantity:e}),i-=e*t.value}}}),n;if(t>=1e5){const n=[];let i=t;const a=["platinum","gold","electrum","silver","copper"];for(const t of a){const a=e.find(e=>e.currency===t&&1===e.multiplier);a&&i>=a.value&&(n.push({...a,quantity:1}),i-=a.value)}for(const t of[100,1e4]){let o=!1;for(const s of a){const a=e.find(e=>e.currency===s&&e.multiplier===t);a&&i>=a.value&&(n.push({...a,quantity:1}),i-=a.value,o=!0)}if(!o)break}return e.forEach(t=>{if(i>=t.value){const e=Math.floor(i/t.value);if(e>0){const a=n.find(e=>e.currency===t.currency&&e.multiplier===t.multiplier);a?a.quantity+=e:n.push({...t,quantity:e}),i-=e*t.value}}}),n}return null}calculateRemainderPieces(t){let e=0,n=t;return["platinum","gold","electrum","silver","copper"].forEach(t=>{const i=this.tauxChange[t],a=Math.floor(n/i);a>0&&(e+=a,n-=a*i)}),e}getRemainderBreakdown(t){const e=[];let n=t;return["platinum","gold","electrum","silver"].forEach(t=>{const i=this.tauxChange[t],a=Math.floor(n/i);if(a>0){const o=this.donneesMetaux[t];e.push(`${a} ${o.emoji} ${this.obtenirNomMetal(t).toLowerCase()}`),n-=a*i}}),n>0&&e.push(`${n} ${this.donneesMetaux.copper.emoji} ${this.getCurrencyName("copper").toLowerCase()}`),e.join(", ")}formatSolutionForDisplay(t){if(!t||0===t.length)return"";const e={};t.forEach(t=>{const n=`${t.currency}_${t.multiplier}`;e[n]||(e[n]={currency:t.currency,multiplier:t.multiplier,totalQuantity:0,lotTypes:[]}),e[n].totalQuantity+=t.quantity,t.lotType&&e[n].lotTypes.push(t.lotType)});const n=Object.values(e).map(t=>{const e=this.donneesMetaux[t.currency],n=t.lotTypes.some(t=>"trio"===t||"septuple"===t)?"📦":"";return 1===t.multiplier?`${this.nf.format(t.totalQuantity)} ${e.emoji} ${this.obtenirNomMetal(t.currency).toLowerCase()} ${n}`:`${this.nf.format(t.totalQuantity)} ${e.emoji} ${this.obtenirNomMetal(t.currency).toLowerCase()} (×${this.nf.format(t.multiplier)}) ${n}`});if(n.length>1){const t=n.pop();return`${n.join(", ")} ${this.getTranslation("shop.converter.and","et")} ${t}`}return n.join("")}calculateTotalPiecesFromSolution(t){return t&&0!==t.length?t.reduce((t,e)=>t+e.quantity,0):0}calculateEconomyGained(t){return t&&0!==t.length?t.reduce((t,e)=>t+(e.economyGained||0),0):0}calculateTotalPieces(t){if(t<=0)return 0;const e=this.findMinimalCoins(t,!1);return e&&0!==e.length?this.calculateTotalPiecesFromSolution(e):0}updateCoinLotsRecommendations(t,e=!1){const n=document.getElementById("coin-lots-recommendations");n&&(n.style.display="block",0!==t?window.CoinLotOptimizer?(this.showCalculatingIndicator(),setTimeout(()=>{try{const n={};if(e){this.getUserMultiplierBreakdown().forEach(t=>{const e=`${t.currency}_${t.multiplier}`;n[e]=(n[e]||0)+t.quantity})}else{this.findMinimalCoins(t,!1).forEach(t=>{const e=`${t.currency}_${t.multiplier}`;n[e]=(n[e]||0)+t.quantity})}const i=(new window.CoinLotOptimizer).findOptimalProductCombination(n);i&&i.length>0?this.displayRecommendations(i):this.displayNoRecommendationsMessage()}catch(t){this.displayNoRecommendationsMessage()}finally{this.hideCalculatingIndicator()}},100)):this.displayNoRecommendationsMessage():this.displayDefaultRecommendationMessage())}updateOptimalLotsRecommendations(t){const e=document.getElementById("optimal-lots-recommendations");e&&(e.style.display="block",0!==t?window.CoinLotOptimizer?(this.showOptimalCalculatingIndicator(),setTimeout(()=>{try{const e={};this.findMinimalCoins(t,!1).forEach(t=>{const n=`${t.currency}_${t.multiplier}`;e[n]=(e[n]||0)+t.quantity});const n=(new window.CoinLotOptimizer).findOptimalProductCombination(e);n&&n.length>0?this.displayOptimalRecommendations(n):this.displayNoOptimalRecommendationsMessage()}catch(t){this.displayNoOptimalRecommendationsMessage()}finally{this.hideOptimalCalculatingIndicator()}},100)):this.displayNoOptimalRecommendationsMessage():this.displayDefaultOptimalRecommendationMessage())}showCalculatingIndicator(){const t=document.getElementById("coin-lots-content");if(!t)return;const e="en"===this.getCurrentLang()?"Analyzing personalized collections...":"Analyse des collections personnalisées...";t.innerHTML=`\n      <div class="calculating-indicator flex items-center justify-center p-8">\n        <div class="text-center">\n          <div class="mb-4">\n            <div class="w-8 h-8 border-4 border-green-400 border-t-transparent rounded-full animate-spin mx-auto"></div>\n          </div>\n          <p class="text-green-300 font-medium">${e}</p>\n          <div class="flex justify-center mt-2 space-x-1">\n            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>\n            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse" style="animation-delay: 0.2s"></div>\n            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse" style="animation-delay: 0.4s"></div>\n          </div>\n        </div>\n      </div>\n    `}displayDefaultRecommendationMessage(){const t=document.getElementById("coin-lots-content"),e=document.getElementById("add-all-lots-to-cart");if(t){const e=this.getTranslation("money.converter.lotsRecommendations.promptMessage","Définissez votre trésor dans le convertisseur"),n=this.getTranslation("money.converter.lotsRecommendations.promptSubMessage","pour découvrir vos collections personnalisées");t.innerHTML=`\n        <div class="text-center py-8">\n          <div class="w-16 h-16 bg-green-600/20 rounded-full flex items-center justify-center mx-auto mb-4">\n            <div class="w-8 h-8 bg-green-500/50 rounded-full"></div>\n          </div>\n          <p class="text-gray-300 text-sm mb-2">${e}</p>\n          <p class="text-gray-400 text-xs">${n}</p>\n        </div>\n      `}e&&(e.style.display="none")}displayNoRecommendationsMessage(){const t=document.getElementById("coin-lots-content"),e=document.getElementById("add-all-lots-to-cart");if(t){const e=this.getTranslation("money.converter.lotsRecommendations.noLotsMessage","Aucune collection disponible."),n=this.getTranslation("money.converter.lotsRecommendations.noLotsSubMessage","Modifiez votre trésor pour découvrir de nouvelles options");t.innerHTML=`\n        <div class="text-center py-8">\n          <div class="w-16 h-16 bg-gray-600/20 rounded-full flex items-center justify-center mx-auto mb-4">\n            <div class="w-8 h-8 border-2 border-gray-500/50 rounded-full border-dashed"></div>\n          </div>\n          <p class="text-gray-300 text-sm mb-2">${e}</p>\n          <p class="text-gray-400 text-xs">${n}</p>\n        </div>\n      `}e&&(e.style.display="none")}displayRecommendations(t){const e=document.getElementById("coin-lots-content"),n=document.getElementById("add-all-lots-to-cart");if(!e)return;this.getCurrentLang();let i='<div class="space-y-4">',a=0;t.forEach((t,e)=>{const n=t.totalCost||t.price*t.quantity;a+=n,i+=`\n        <div class="bg-gray-800/50 rounded-lg p-4 border border-gray-600/30">\n          <div class="flex justify-between items-center">\n            <div class="flex-1">\n              <h6 class="font-medium text-gray-200">${t.displayName}</h6>\n              <p class="text-sm text-gray-400">Quantité: ${t.quantity}</p>\n            </div>\n            <div class="text-right">\n              <p class="font-bold text-green-400">$${n.toFixed(2)}</p>\n              <p class="text-xs text-gray-400">$${t.price.toFixed(2)} / unité</p>\n            </div>\n          </div>\n        </div>\n      `}),i+=`\n      <div class="border-t border-gray-600/30 pt-4">\n        <div class="flex justify-between items-center text-lg font-bold">\n          <span class="text-gray-200">Total:</span>\n          <span class="text-green-400">$${a.toFixed(2)}</span>\n        </div>\n      </div>\n    </div>`,e.innerHTML=i,n&&(n.style.display="block",n.dataset.lotsData=JSON.stringify(t))}hideCalculatingIndicator(){}showOptimalCalculatingIndicator(){const t=document.getElementById("optimal-lots-content");if(!t)return;const e="en"===this.getCurrentLang()?"Analyzing optimal forging combinations...":"Analyse des combinaisons de forge optimales...";t.innerHTML=`\n      <div class="calculating-indicator flex items-center justify-center p-8">\n        <div class="text-center">\n          <div class="mb-4">\n            <div class="w-8 h-8 border-4 border-purple-400 border-t-transparent rounded-full animate-spin mx-auto"></div>\n          </div>\n          <p class="text-purple-300 font-medium">${e}</p>\n          <div class="flex justify-center mt-2 space-x-1">\n            <div class="w-2 h-2 bg-purple-400 rounded-full animate-pulse"></div>\n            <div class="w-2 h-2 bg-purple-400 rounded-full animate-pulse" style="animation-delay: 0.2s"></div>\n            <div class="w-2 h-2 bg-purple-400 rounded-full animate-pulse" style="animation-delay: 0.4s"></div>\n          </div>\n        </div>\n      </div>\n    `}displayDefaultOptimalRecommendationMessage(){const t=document.getElementById("optimal-lots-content"),e=document.getElementById("add-all-optimal-lots-to-cart");if(t){const e=this.getTranslation("money.converter.optimalLots.promptMessage","Configurez votre trésor dans le convertisseur"),n=this.getTranslation("money.converter.optimalLots.promptSubMessage","pour découvrir les collections les plus efficaces");t.innerHTML=`\n        <div class="text-center py-8">\n          <div class="w-16 h-16 bg-purple-600/20 rounded-full flex items-center justify-center mx-auto mb-4">\n            <div class="w-8 h-8 bg-purple-500/50 rounded-full"></div>\n          </div>\n          <p class="text-gray-300 text-sm mb-2">${e}</p>\n          <p class="text-gray-400 text-xs">${n}</p>\n        </div>\n      `}e&&(e.style.display="none")}displayNoOptimalRecommendationsMessage(){const t=document.getElementById("optimal-lots-content"),e=document.getElementById("add-all-optimal-lots-to-cart");if(t){const e=this.getTranslation("money.converter.optimalLots.noLotsMessage","Aucune solution optimale disponible."),n=this.getTranslation("money.converter.optimalLots.noLotsSubMessage","Ajustez votre trésor pour explorer d'autres configurations");t.innerHTML=`\n        <div class="text-center py-8">\n          <div class="w-16 h-16 bg-gray-600/20 rounded-full flex items-center justify-center mx-auto mb-4">\n            <div class="w-8 h-8 border-2 border-gray-500/50 rounded-full border-dashed"></div>\n          </div>\n          <p class="text-gray-300 text-sm mb-2">${e}</p>\n          <p class="text-gray-400 text-xs">${n}</p>\n        </div>\n      `}e&&(e.style.display="none")}displayOptimalRecommendations(t){const e=document.getElementById("optimal-lots-content"),n=document.getElementById("add-all-optimal-lots-to-cart");if(!e)return;this.getCurrentLang();let i='<div class="space-y-4">',a=0;t.forEach((t,e)=>{const n=t.totalCost||t.price*t.quantity;a+=n,i+=`\n        <div class="bg-purple-800/30 rounded-lg p-4 border border-purple-600/40">\n          <div class="flex justify-between items-center">\n            <div class="flex-1">\n              <h6 class="font-medium text-gray-200">${t.displayName}</h6>\n              <p class="text-sm text-gray-400">Quantité: ${t.quantity}</p>\n            </div>\n            <div class="text-right">\n              <p class="font-bold text-purple-400">$${n.toFixed(2)}</p>\n              <p class="text-xs text-gray-400">$${t.price.toFixed(2)} / unité</p>\n            </div>\n          </div>\n        </div>\n      `}),i+=`\n      <div class="border-t border-purple-600/30 pt-4">\n        <div class="flex justify-between items-center text-lg font-bold">\n          <span class="text-gray-200">Total optimal:</span>\n          <span class="text-purple-400">$${a.toFixed(2)}</span>\n        </div>\n      </div>\n    </div>`,e.innerHTML=i,n&&(n.style.display="block",n.dataset.lotsData=JSON.stringify(t))}hideOptimalCalculatingIndicator(){}updateDisplay(){this.updateFromSources()}destroy(){const t=document.getElementById("currency-converter-premium");if(t){const e=t.cloneNode(!0);t.parentNode.replaceChild(e,t)}}viderCache(){this.cacheCalculs.clear(),this.stats.cacheHits=0}obtenirStatistiques(){return{...this.stats,tailleCache:this.cacheCalculs.size,tauxCacheHit:this.stats.conversionsTotal>0?`${(this.stats.cacheHits/this.stats.conversionsTotal*100).toFixed(2)}%`:"0%"}}reinitialiserStatistiques(){this.stats={conversionsTotal:0,cacheHits:0,dernierCalcul:null}}validerDonnees(t,e){switch(e){case"number":return"number"==typeof t&&!isNaN(t)&&t>=0;case"array":return Array.isArray(t)&&t.length>0;case"repartition":return Array.isArray(t)&&t.every(t=>t.metal&&"number"==typeof t.multiplicateur&&"number"==typeof t.quantite);default:return!1}}getUserMultiplierBreakdown(){this.multiplierInputs||this.refreshDOMReferences();const t=[];return this.multiplierInputs&&this.multiplierInputs.forEach(e=>{const{currency:n}=e.closest("tr").dataset,i=parseInt(e.dataset.multiplier),a=parseInt(e.value.replace(/\s/g,""))||0;a>0&&t.push({currency:n,multiplier:i,quantity:a,value:this.tauxChange[n]*i})}),t}formatBreakdownText(t){if(!t||0===t.length)return"";const e=t.map(t=>{const e=this.donneesMetaux[t.currency];return`${this.nf.format(t.quantity)} ${e.emoji} ${this.obtenirNomMetal(t.currency).toLowerCase()} (×${this.nf.format(t.multiplier)})`});if(e.length>1){const t=e.pop();return`${e.join(", ")} ${this.getTranslation("shop.converter.and","et")} ${t}`}return e.join("")}updateOptimalRecommendationsFromUser(t){if(this.bestDisplay||this.refreshDOMReferences(),!this.bestDisplay)return;if(0===t){const t=this.getTranslation("shop.converter.enterAmounts","Entrez des montants pour voir les recommandations optimales");return void(this.bestDisplay.innerHTML=t)}const e=this.getUserMultiplierBreakdown(),n=e.reduce((t,e)=>t+e.quantity,0),i=this.findMinimalCoins(t,!1),a=i?i.reduce((t,e)=>t+e.quantity,0):1/0;let o,s,r;n>0&&n<=a?(o=e,s=n,r="user"):i?(o=i,s=a,r="algorithm"):(o=e.length>0?e:[],s=n,r="user");const l=this.formatBreakdownText(o),c="user"===r?'<span class="text-blue-600">✏️</span>':'<span class="text-green-600">🤖</span>',u=Math.floor(t/this.tauxChange.gold),d=t%this.tauxChange.gold;let m="";if(u>0){if(m=`${this.nf.format(u)} 🥇 ${this.getCurrencyName("gold").toLowerCase()}`,d>0){const t=this.getOptimalBreakdown(d);m+=` ${this.getTranslation("shop.converter.and","et")} ${t}`}}else m=this.getOptimalBreakdown(t);const p=this.getTranslation("shop.converter.optimalConversion","Conversion optimale"),h=this.getTranslation("shop.converter.total","Total"),f=this.getTranslation("shop.converter.value","Valeur");this.bestDisplay.innerHTML=`\n      <div class="text-center">\n        <p class="text-lg mb-2"><strong>${p}:</strong> ${c}</p>\n        <p class="text-indigo-300 font-medium mb-2">${l}</p>\n        <p class="text-sm text-gray-400">${h}: ${this.nf.format(s)} ${this.getTranslation("shop.converter.coins","pièces")}</p>\n        <p class="text-sm text-gray-400"><br>${f}: ${m}</p>\n      </div>\n    `}}window.addEventListener("beforeunload",()=>{window.converterInstance&&"function"==typeof window.converterInstance.destroy&&window.converterInstance.destroy()});let converterInitialized=!1;const initConverter=()=>{converterInitialized||(converterInitialized=!0,setTimeout(()=>{document.getElementById("currency-converter-premium")&&(window.converterInstance=new CurrencyConverterPremium,window.currencyConverter=window.converterInstance)},100))};document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("currency-converter-premium");if(!t)return;const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(initConverter(),e.disconnect())})},{threshold:.1});e.observe(t),["click","scroll","touchstart"].forEach(t=>{document.addEventListener(t,()=>{setTimeout(initConverter,500)},{once:!0,passive:!0})})});class CoinLotOptimizer{constructor(){this.tauxChange={copper:1,silver:10,electrum:50,gold:100,platinum:1e3},this.multiplicateursDisponibles=[1,10,100,1e3,1e4],this.nomsMetaux={fr:{copper:"Cuivre",silver:"Argent",electrum:"Électrum",gold:"Or",platinum:"Platine"},en:{copper:"Copper",silver:"Silver",electrum:"Electrum",gold:"Gold",platinum:"Platinum"}}}getCurrentLang(){return document.documentElement?.lang||"fr"}findOptimalProductCombination(t){if(!t||0===Object.keys(t).length)return[];if(!window.products)return[];const e=this.generateAllProductVariations(),n=this.knapsackOptimize(t,e);return this.formatSolution(n)}generateAllProductVariations(){const t=[];return Object.entries(window.products).forEach(([e,n])=>{n&&"pieces"===n.category&&(n.customizable?this.generateCustomizableVariations(e,n,t):this.generateFixedVariations(e,n,t))}),t}generateCustomizableVariations(t,e,n){const i=e.metals_en||["copper","silver","electrum","gold","platinum"],a=e.multipliers||[1,10,100,1e3,1e4];if("coin-quintessence-metals"===t)a.forEach(a=>{const o={};i.forEach(t=>{o[`${t}_${a}`]=1}),n.push({productId:t,name:e.name,price:e.price,type:"quintessence",multiplier:a,capacity:o,coinsProvided:i.length})});else{Object.values(e.coin_lots)[0];i.forEach(i=>{a.forEach(a=>{if(e.coin_lots[i]){const o={};o[`${i}_${a}`]=e.coin_lots[i],n.push({productId:t,name:e.name,price:e.price,type:"normal",metal:i,multiplier:a,capacity:o,coinsProvided:e.coin_lots[i]})}})})}}generateFixedVariations(t,e,n){const i=e.multipliers||[];if(i.length>0)i.forEach(i=>{const a={};let o=0;e.coin_lots&&Object.entries(e.coin_lots).forEach(([t,e])=>{"number"==typeof e&&e>0&&(a[`${t}_${i}`]=e,o+=e)}),Object.keys(a).length>0&&n.push({productId:t,name:e.name,price:e.price,type:"fixed_multiplier",multiplier:i,capacity:a,coinsProvided:o})});else{const i={};let a=0;e.coin_lots&&Object.entries(e.coin_lots).forEach(([t,e])=>{"number"==typeof e?(i[`${t}_1`]=e,a+=e):"object"==typeof e&&null!==e&&Object.entries(e).forEach(([e,n])=>{n>0&&(i[`${t}_${e}`]=n,a+=n)})}),Object.keys(i).length>0&&n.push({productId:t,name:e.name,price:e.price,type:"fixed_complete",capacity:i,coinsProvided:a})}}knapsackOptimize(t,e){const n=[];this.findBruteForceOptimal(t,e).forEach(t=>n.push(t)),e.forEach(e=>{if(this.canCoverAllNeeds(e,t)){const i=this.calculateRequiredQuantity(e,t),a=e.price*i;n.push({items:[{variation:e,quantity:i}],totalCost:a,type:"single"})}});const i=e.filter(t=>"quintessence"===t.type);this.findQuintessenceCombinations(t,i).forEach(t=>{const e=t.reduce((t,e)=>t+e.variation.price*e.quantity,0);n.push({items:t,totalCost:e,type:"quintessence_multiple"})});if(this.findDecompositionSolutions(t,e).forEach(t=>{n.push({items:t,totalCost:t.reduce((t,e)=>t+e.variation.price*e.quantity,0),type:"decomposition"});t.reduce((t,e)=>t+e.variation.price*e.quantity,0)}),i.forEach(i=>{const a=this.calculateCoverage(i,t,1),o=this.calculateRemainingNeeds(t,a);if(Object.keys(o).length>0){const t=this.findComplementSolution(o,e);if(t){const e=[{variation:i,quantity:1},...t],a=e.reduce((t,e)=>t+e.variation.price*e.quantity,0);n.push({items:e,totalCost:a,type:"combined"})}}}),n.length<3){const i=this.findCustomCoinsSolution(t,e);if(i&&i.length>0){const t=i.reduce((t,e)=>t+e.variation.price*e.quantity,0);n.push({items:i,totalCost:t,type:"custom_fallback"})}}this.findBulkOptimizedSolutions(t,e).forEach(t=>{n.push({items:t,totalCost:t.reduce((t,e)=>t+e.variation.price*e.quantity,0),type:"bulk_optimized"})});const a=n.filter(e=>this.validateSolution(e.items,t)).map(t=>{const n=this.optimizeWithBulkLots(t.items,e),i=this.calculateSolutionCost(n);return{...t,items:n,totalCost:i,type:`${t.type}_bulk_optimized`}});if(a.sort((t,e)=>t.totalCost-e.totalCost),a.length>0){return a[0].items}return[]}canCoverAllNeeds(t,e){for(const[n,i]of Object.entries(e))if(i>0&&(!t.capacity[n]||0===t.capacity[n]))return!1;return!0}calculateRequiredQuantity(t,e){let n=1;for(const[i,a]of Object.entries(e))if(a>0&&t.capacity[i]){const e=Math.ceil(a/t.capacity[i]);n=Math.max(n,e)}return n}calculateCoverage(t,e,n=1){const i={};for(const[a,o]of Object.entries(e)){const e=(t.capacity[a]||0)*n;e>0&&(i[a]=Math.min(o,e))}return i}calculateRemainingNeeds(t,e){const n={};for(const[i,a]of Object.entries(t)){const t=a-(e[i]||0);t>0&&(n[i]=t)}return n}findBruteForceOptimal(t,e){const n=[],i=this.calculateMaxReasonableQuantity(t);if(e.forEach(e=>{for(let a=1;a<=i;a++)if(this.canCoverWithQuantity(e,t,a)){if(this.isWastefulSolution(e,t,a))continue;const i=e.price*a;n.push({items:[{variation:e,quantity:a}],totalCost:i,type:"brute_force_single"})}}),Object.keys(t).length>1&&n.length<5&&this.findBruteForce2Products(t,e,n,i),0===n.length||n.every(t=>t.totalCost>50)){const i=this.createIndividualSolution(t,e);i&&n.push(i)}return n.sort((t,e)=>t.totalCost-e.totalCost)}findBruteForce2Products(t,e,n,i){const a=Math.min(e.length,10);for(let i=0;i<a;i++)for(let o=i+1;o<a;o++){const a=e[i],s=e[o];for(let e=1;e<=3;e++)for(let i=1;i<=3;i++)if(this.canCoverWith2Products(a,e,s,i,t)){const t=a.price*e+s.price*i;n.push({items:[{variation:a,quantity:e},{variation:s,quantity:i}],totalCost:t,type:"brute_force_double"})}}}canCoverWithQuantity(t,e,n){const i={};return Object.entries(t.capacity).forEach(([t,e])=>{i[t]=e*n}),Object.entries(e).every(([t,e])=>e<=(i[t]||0))}isWastefulSolution(t,e,n){if("quintessence"===t.type){const i=Object.keys(e).map(t=>t.split("_")[0]),a=[...new Set(i)];if(a.length<=2)return!0;const o=Object.values(e).reduce((t,e)=>t+e,0);if(10*o<t.price*n)return!0;if(o<=3&&a.length<=2)return!0}const i=Object.values(t.capacity).reduce((t,e)=>t+e*n,0);return(i-Object.values(e).reduce((t,e)=>t+e,0))/i>.7}createIndividualSolution(t,e){const n=[];let i=0;for(const[a,o]of Object.entries(t)){if(o<=0)continue;const[t,s]=a.split("_"),r=e.find(t=>"normal"===t.type&&"coin-custom-single"===t.productId&&1===t.capacity[a]);if(!r)return null;n.push({variation:r,quantity:o}),i+=r.price*o}return 0===n.length?null:{items:n,totalCost:i,type:"individual_fallback"}}canCoverWith2Products(t,e,n,i,a){const o={};return Object.entries(t.capacity).forEach(([t,n])=>{o[t]=(o[t]||0)+n*e}),Object.entries(n.capacity).forEach(([t,e])=>{o[t]=(o[t]||0)+e*i}),Object.entries(a).every(([t,e])=>e<=(o[t]||0))}calculateMaxReasonableQuantity(t){const e=Object.values(t).reduce((t,e)=>t+e,0);return e<=5?8:e<=10?5:e<=20?3:2}findCustomCoinsSolution(t,e){const n=e.filter(t=>"coin-custom-single"===t.productId&&"normal"===t.type),i=[];for(const[e,a]of Object.entries(t)){if(a<=0)continue;const[t,o]=e.split("_"),s=n.find(e=>e.metal===t&&e.multiplier==o);if(!s)return null;i.push({variation:s,quantity:a})}return i.length>0?i:null}findComplementSolution(t,e){return this.findCustomCoinsSolution(t,e)}formatSolution(t){if(!t||0===t.length)return[];const e=[],n=this.getCurrentLang();for(const i of t){const{variation:t}=i;let a=t.name;const o={};if("quintessence"===t.type)a+=` (×${t.multiplier})`,o[`multiplier-${t.productId}`]={role:"multiplier",value:t.multiplier};else if("normal"===t.type&&t.metal&&t.multiplier){a+=` (${this.nomsMetaux[n][t.metal]||t.metal} ×${t.multiplier})`,o[`metal-${t.productId}`]={role:"metal",value:t.metal},o[`multiplier-${t.productId}`]={role:"multiplier",value:t.multiplier}}else"fixed_multiplier"===t.type&&(a+=` (×${t.multiplier})`,o[`multiplier-${t.productId}`]={role:"multiplier",value:t.multiplier});e.push({productId:t.productId,displayName:a,price:t.price,quantity:i.quantity,totalCost:t.price*i.quantity,customFields:o,url:`/${n}/products/${t.productId}/`,image:window.products[t.productId]?.images?.[0]||null,description:window.products[t.productId]?.description||""})}return e}findQuintessenceCombinations(t,e){const n=[],i=this.multiplicateursDisponibles.map(e=>this.identifyQuintessencePattern(t,e)).filter(t=>t.matches>=4);for(let a=0;a<i.length;a++)for(let o=a+1;o<i.length;o++){const s=i[a],r=i[o];if(s.multiplier!==r.multiplier&&s.matches>=4&&r.matches>=4){const i=e.find(t=>t.multiplier===s.multiplier),a=e.find(t=>t.multiplier===r.multiplier);if(i&&a){const e=[{variation:i,quantity:1},{variation:a,quantity:1}],o={...t};e.forEach(t=>{Object.entries(t.variation.capacity).forEach(([t,e])=>{o[t]&&(o[t]=Math.max(0,o[t]-e))})});const s=this.generateAllProductVariations().filter(t=>"normal"===t.type&&"coin-custom-single"===t.productId),r=this.findCustomCoinsSolution(o,s);if(r){const i=[...e,...r];i.reduce((t,e)=>t+e.variation.price*e.quantity,0);this.validateSolution(i,t)&&n.push(i)}}}}for(let i=2;i<=Math.min(3,e.length);i++){this.generateCombinations(e,i).forEach(e=>{const i=this.testQuintessenceCombination(t,e);i&&i.length>0&&n.push(i)})}return n}generateCombinations(t,e){if(1===e)return t.map(t=>[t]);if(e>t.length)return[];const n=[];for(let i=0;i<=t.length-e;i++){this.generateCombinations(t.slice(i+1),e-1).forEach(e=>{n.push([t[i],...e])})}return n}testQuintessenceCombination(t,e){const n={};e.forEach(t=>{Object.entries(t.capacity).forEach(([t,e])=>{n[t]=(n[t]||0)+e})});for(const[e,i]of Object.entries(t))if(i>0&&(!n[e]||n[e]<i))return null;return e.map(t=>({variation:t,quantity:1}))}findDecompositionSolutions(t,e){const n=[],i=(e.filter(t=>"quintessence"===t.type),this.multiplicateursDisponibles.map(e=>this.identifyQuintessencePattern(t,e)).filter(t=>t.matches>=4));for(let a=0;a<i.length;a++){const o=this.buildMultiPatternSolution(t,[i[a]],e);o&&o.length>0&&n.push(o);for(let o=a+1;o<i.length;o++){const s=this.buildMultiPatternSolution(t,[i[a],i[o]],e);s&&s.length>0&&n.push(s);for(let s=o+1;s<i.length;s++){const r=this.buildMultiPatternSolution(t,[i[a],i[o],i[s]],e);r&&r.length>0&&n.push(r)}}}return n}identifyQuintessencePattern(t,e){let n=0;const i=[];return["platinum","gold","electrum","silver","copper"].forEach(a=>{const o=`${a}_${e}`;t[o]&&t[o]>=1&&(n++,i.push(a))}),{multiplier:e,matches:n,matchingMetals:i,isComplete:5===n,isPartial:n>=4&&n<5}}buildMultiPatternSolution(t,e,n){const i=[],a={...t};e.forEach(t=>{if(t.matches>=4){const e=n.find(e=>"quintessence"===e.type&&e.multiplier===t.multiplier);e&&(i.push({variation:e,quantity:1}),Object.entries(e.capacity).forEach(([t,e])=>{a[t]&&(a[t]=Math.max(0,a[t]-e))}))}});const o=n.filter(t=>"normal"===t.type&&"coin-custom-single"===t.productId);return Object.entries(a).forEach(([t,e])=>{if(e>0){const[n,a]=t.split("_"),s=o.find(t=>t.metal===n&&t.multiplier===parseInt(a));s&&i.push({variation:s,quantity:e})}}),i.length>0&&this.validateSolution(i,t)?i:null}validateSolution(t,e){const n={};t.forEach(t=>{t.variation&&t.variation.capacity&&Object.entries(t.variation.capacity).forEach(([e,i])=>{n[e]=(n[e]||0)+i*t.quantity})});let i=!0;const a=[];for(const[t,o]of Object.entries(e))if(o>0){const e=n[t]||0;e<o&&(i=!1,a.push(`${t} (besoin ${o}, couvert ${e})`))}return!!i}findBulkOptimizedSolutions(t,e){const n=[],i=this.groupIdenticalNeeds(t);return Object.entries(i).forEach(([i,a])=>{if(a>=3){const[o,s]=i.split("_"),r=this.findBestBulkSolution(o,parseInt(s),a,e);if(r&&r.length>0){const a={...t};delete a[i];const o=this.findComplementSolution(a,e);o?n.push([...r,...o]):0===Object.keys(a).length&&n.push(r)}}}),n}groupIdenticalNeeds(t){return t}findBestBulkSolution(t,e,n,i){const a=[],o=i.find(n=>"coin-trio-customizable"===n.productId&&n.metal===t&&n.multiplier===e),s=i.find(n=>"coin-septuple-free"===n.productId&&n.metal===t&&n.multiplier===e),r=i.find(n=>"coin-custom-single"===n.productId&&n.metal===t&&n.multiplier===e);if(n>=7&&s){const t=Math.floor(n/7),e=n%7,i=[];if(t>0&&i.push({variation:s,quantity:t}),e>=3&&o){const t=Math.floor(e/3),n=e%3;t>0&&i.push({variation:o,quantity:t}),n>0&&r&&i.push({variation:r,quantity:n})}else e>0&&r&&i.push({variation:r,quantity:e});a.push(i)}if(n>=3&&o){const t=Math.floor(n/3),e=n%3,i=[];t>0&&i.push({variation:o,quantity:t}),e>0&&r&&i.push({variation:r,quantity:e}),a.push(i)}if(r&&a.push([{variation:r,quantity:n}]),a.length>0){const t=a.reduce((t,e)=>e.reduce((t,e)=>t+e.variation.price*e.quantity,0)<t.reduce((t,e)=>t+e.variation.price*e.quantity,0)?e:t);t.reduce((t,e)=>t+e.variation.price*e.quantity,0);return t}return null}optimizeWithBulkLots(t,e){const n={};t.forEach(t=>{const e=`${t.variation.productId}_${t.variation.metal||"none"}_${t.variation.multiplier||"none"}`;n[e]||(n[e]={variation:t.variation,totalQuantity:0,items:[]}),n[e].totalQuantity+=t.quantity,n[e].items.push(t)});const i=[];return Object.values(n).forEach(t=>{const{variation:n,totalQuantity:a}=t;if("coin-custom-single"===n.productId&&a>=3){const{metal:t}=n,{multiplier:o}=n;if(t&&o){const s=this.findBestBulkSolution(t,o,a,e);if(s){if(s.reduce((t,e)=>t+e.variation.price*e.quantity,0)<a*n.price)return void i.push(...s)}}}i.push(...t.items)}),i}calculateSolutionCost(t){return t.reduce((t,e)=>t+e.variation.price*e.quantity,0)}completeWithCustomPieces(t,e){const n=[...t],i=[];if(window.products&&window.products["coin-custom-single"]){const t=window.products["coin-custom-single"],e=t.metals_en||["copper","silver","electrum","gold","platinum"],n=t.multipliers||[1,10,100,1e3,1e4];e.forEach(e=>{n.forEach(n=>{t.coin_lots[e]&&i.push({productId:"coin-custom-single",name:t.name,price:t.price,type:"normal",metal:e,multiplier:n,capacity:{[`${e}_${n}`]:t.coin_lots[e]},coinsProvided:t.coin_lots[e]})})})}return Object.entries(e).forEach(([t,e])=>{if(e>0){const[a,o]=t.split("_"),s=i.find(t=>t.metal===a&&t.multiplier===parseInt(o));s&&n.push({variation:s,quantity:e})}}),n.length>0&&this.validateSolution(n,originalNeeds)?n:null}}window.CoinLotOptimizer=CoinLotOptimizer;class SnipcartUtils{static createAddToCartButton(t,e={}){const{quantity:n=1,customFields:i={},className:a="snipcart-add-item btn-cart-icon",text:o="Ajouter au panier",useIconButton:s=!0,...r}=e,l=document.createElement("button");if(l.className=a,s){const t=document.createElement("img");t.src="/media/branding/icons/ajout.webp",t.alt=o,t.className="btn-cart-icon-img",t.loading="lazy",l.appendChild(t),l.setAttribute("aria-label",o),l.setAttribute("title",o)}else l.textContent=o;const c={"data-item-id":t.id,"data-item-name":t.name,"data-item-description":t.summary||t.description||"","data-item-price":t.price.toString(),"data-item-quantity":n.toString()};t.name_en&&(c["data-item-name-en"]=t.name_en),t.summary_en&&(c["data-item-description-en"]=t.summary_en),t.url&&(c["data-item-url"]=t.url),Object.entries(c).forEach(([t,e])=>{l.setAttribute(t,e)});const u=this.normalizeCustomFields(i);return Object.entries(u).forEach(([t,e])=>{const n=t.replace("custom","");l.setAttribute(`data-item-custom${n}-name`,e.name),l.setAttribute(`data-item-custom${n}-type`,e.type),l.setAttribute(`data-item-custom${n}-options`,e.options),l.setAttribute(`data-item-custom${n}-value`,e.value),e.role&&l.setAttribute(`data-item-custom${n}-role`,e.role)}),Object.entries(r).forEach(([t,e])=>{l.setAttribute(t,e)}),l}static playSound(t,e=.5){try{const n=new Audio(t);n.volume=Math.max(0,Math.min(1,e)),n.play().catch(t=>{console.debug("Audio autoplay bloqué:",t)})}catch(t){console.debug("Erreur lecture audio:",t)}}static async addToCart(t,e={}){if(this.playSound("media/sounds/coin-drop.mp3",.5),window.Snipcart&&window.Snipcart.api&&window.Snipcart.api.cart)try{const n=this.extractProductDataFromButton(this.createAddToCartButton(t,e));return await window.Snipcart.api.cart.items.add(n),!0}catch(t){}const n=this.createAddToCartButton(t,e);return n.style.display="none",document.body.appendChild(n),n.click(),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},300),!0}static addFromButton(t,e=null){e&&(e.preventDefault(),e.stopPropagation()),this.playSound("media/sounds/coin-drop.mp3",.5);const n=this.extractProductDataFromButton(t);if(window.Snipcart&&window.Snipcart.api&&window.Snipcart.api.cart)try{return window.Snipcart.api.cart.items.add(n),!0}catch(t){}const i=t.cloneNode(!0);return i.style.display="none",document.body.appendChild(i),setTimeout(()=>{i.click(),document.body.removeChild(i)},10),!0}static extractProductDataFromButton(t){const e={id:t.getAttribute("data-item-id"),name:t.getAttribute("data-item-name"),price:parseFloat(t.getAttribute("data-item-price")||"0"),url:t.getAttribute("data-item-url")||window.location.href,quantity:parseInt(t.getAttribute("data-item-quantity")||"1"),description:t.getAttribute("data-item-description")},n=t.getAttribute("data-item-image");n&&(e.image=n),e.customFields=[];for(let n=1;n<=5;n++){const i=t.getAttribute(`data-item-custom${n}-name`),a=t.getAttribute(`data-item-custom${n}-value`);i&&a&&e.customFields.push({name:i,value:a})}return e}static async addMultipleToCart(t,e=null){if(!t||0===t.length)return void(e&&e(0,0));let n=0,i=0;const a=()=>{if(window.Snipcart&&window.Snipcart.api&&window.Snipcart.api.cart)try{return window.Snipcart.api.cart.items.count()||0}catch(t){return 0}return 0};for(let o=0;o<t.length;o++){const s=t[o],r=a();try{if(await this.addToCart(s.product,{quantity:s.quantity,customFields:s.customFields||{}})){let t=0;const e=3;for(;t<e;){await new Promise(t=>setTimeout(t,150));if(a()>r){i++;break}t++}}n++,e&&e(i,t.length,n),o<t.length-1&&await new Promise(t=>setTimeout(t,400))}catch(a){n++,e&&e(i,t.length,n),o<t.length-1&&await new Promise(t=>setTimeout(t,600))}}}static updateCartButton(t,e={}){const{quantity:n,metal:i,multiplier:a,triptych:o,language:s}=e;void 0!==n&&t.setAttribute("data-item-quantity",n.toString()),this.updateCustomFields(t,e)}static updateCustomFields(t,e){const{metal:n,multiplier:i,triptych:a,language:o}=e;if(void 0!==n){const e=this.findCustomFieldByRole(t,"metal");e&&t.setAttribute(`data-item-custom${e}-value`,n)}if(void 0!==i){const e=this.findCustomFieldByRole(t,"multiplier");e&&t.setAttribute(`data-item-custom${e}-value`,i.toString())}if(void 0!==a){const e=this.findCustomFieldByRole(t,"triptych");e&&t.setAttribute(`data-item-custom${e}-value`,a)}if(void 0!==o){const e=this.findCustomFieldByRole(t,"language");e&&t.setAttribute(`data-item-custom${e}-value`,o)}}static findCustomFieldByRole(t,e){const n=Array.from(t.attributes);for(const t of n){const n=t.name.match(/^data-item-custom(\d+)-role$/);if(n&&t.value===e)return n[1]}return null}static normalizeCustomFields(t){const e={};let n=1;if(t.custom1||t.custom2)return t;const i=Object.entries(t).find(([t])=>t.includes("metal")),a=Object.entries(t).find(([t])=>t.includes("multiplier")),o=document.documentElement?.lang||"fr";if(i){const[,t]=i;e.custom1={name:"fr"===o?"Métal":"Metal",type:"dropdown",options:"copper[+0.00]|silver[+0.00]|electrum[+0.00]|gold[+0.00]|platinum[+0.00]",value:t.value,role:"metal"},n++}if(a){const[,t]=a;e[`custom${n}`]={name:"fr"===o?"Multiplicateur":"Multiplier",type:"dropdown",options:"1[+0.00]|10[+10.00]|100[+95.00]|1000[+950.00]|10000[+9500.00]",value:t.value.toString(),role:"multiplier"}}return e}static extractProductDataFromButton(t){return{id:t.getAttribute("data-item-id"),name:t.getAttribute("data-item-name"),description:t.getAttribute("data-item-description"),price:parseFloat(t.getAttribute("data-item-price")),quantity:parseInt(t.getAttribute("data-item-quantity")),url:t.getAttribute("data-item-url")}}static createLotProductData(t){const{product:e,quantity:n,customFields:i,displayName:a}=t;return{product:{id:e.id,name:a||e.name,summary:e.summary,price:e.price,url:`product.php?id=${encodeURIComponent(e.id)}`},quantity:n,customFields:i||{}}}static translateMetal(t,e="fr"){const n=`shop.converter.metals.${t}`,i=this.getTranslation(n);if(i)return i;return{fr:{copper:"cuivre",silver:"argent",electrum:"électrum",gold:"or",platinum:"platine"},en:{copper:"copper",silver:"silver",electrum:"electrum",gold:"gold",platinum:"platinum"}}[e]?.[t]||t}static getCurrentLang(){return document.documentElement.lang||"fr"}static getTranslation(t,e=""){if(window.i18n){const n=t.split(".");let i=window.i18n;for(const t of n){if(!i||"object"!=typeof i||!(t in i))return e;i=i[t]}return"string"==typeof i?i:e}return e}}window.SnipcartUtils=SnipcartUtils;