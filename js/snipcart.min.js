!function(){const t=(t,e=document)=>e.querySelector(t),e=(t,e=document)=>Array.from(e.querySelectorAll(t));function n(e){!function(e){if(!e||"1"===e.dataset.trashMoved)return;const n=t(".snipcart-item-line__title",e)||t(".snipcart-item-line__information .snipcart__font--regular",e)||t("[data-item-name]",e),o=t(".snipcart-item-line__actions button",e)||t('[data-action="item:remove"]',e)||t("button.snipcart__button--icon",e)||t('button[title="Remove item"]',e);if(!n||!o)return;o.style.margin="0";let a=t(".__remove-left",e);a||(a=document.createElement("span"),a.className="__remove-left",a.style.display="inline-flex",a.style.alignItems="center",a.style.marginRight="8px"),n.parentNode.insertBefore(a,n),a.appendChild(o),e.dataset.trashMoved="1"}(e),function(e){if(!e)return;const n=t(".snipcart-item-line__quantity",e)||t("[data-item-quantity]",e)||e,o=t('input[type="number"]',n)||t('input[name="quantity"]',n);if(!o||o.closest(".__qty-stepped"))return;const a=document.createElement("div");a.className="__qty-stepped",a.style.display="inline-flex",a.style.alignItems="center",a.style.gap="6px";const r=(t,e)=>{const n=document.createElement("button");return n.type="button",n.className="__qty-btn gd-qty-button",n.setAttribute("aria-label",e),n.textContent=t,n},s=r("−","Diminuer la quantité"),i=r("+","Augmenter la quantité");o.classList.add("gd-qty-input"),n.insertBefore(a,o),a.appendChild(s),a.appendChild(o),a.appendChild(i);const c=()=>{o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0}))};s.addEventListener("click",()=>{const t=parseInt(o.step||"1",10),e=parseInt(o.min??"1",10),n=Math.max(e,parseInt(o.value||"1",10)-t);o.value=String(n),c()}),i.addEventListener("click",()=>{const t=parseInt(o.step||"1",10),e=o.max?parseInt(o.max,10):null;let n=parseInt(o.value||"1",10)+t;e&&(n=Math.min(e,n)),o.value=String(n),c()})}(e)}function o(){e(".snipcart-item-line").forEach(n)}function a(){try{const n=t(".snipcart-cart-summary")||t(".snipcart-checkout__content--summary")||t(".snipcart-summary")||t(".snipcart__box--summary")||t(".snipcart-summary-fees")||t('[class*="summary"]');if(!n){console.warn("⚠️ Section résumé du panier non trouvée");const t=e("*").find(t=>t.textContent?.toLowerCase().includes("sous-total"));return t?(console.log('✅ Élément contenant "sous-total" trouvé, utilisation du parent'),a.call(null,t.closest('[class*="summary"]')||t.parentElement)):void 0}const o=window.Snipcart?.store?.getState()?.cart;if(!o)return void console.warn("⚠️ Données du panier non disponibles");let r=o.discounts;if(console.log("🔍 cart.discounts brut:",r),console.log("🔍 Type de discounts:",typeof r,"IsArray:",Array.isArray(r)),Array.isArray(r)||(r=r&&"object"==typeof r?r.items&&Array.isArray(r.items)?r.items:r.discounts&&Array.isArray(r.discounts)?r.discounts:Object.values(r):[]),r=r.filter(t=>t&&(t.name||t.amount||t.rate)),console.log("🔍 Promotions après traitement:",r),e(".__gd-promo-line").forEach(t=>t.remove()),e(".snipcart-cart-summary-item, .snipcart-summary-fees__item").forEach(e=>{const n=e.textContent||"";if(n.includes("Promotions")||n.includes("Promotion")){const n=t(".snipcart-cart-summary-fees__amount",e)||t(".snipcart-summary-fees__amount",e);n&&n.textContent.includes("-")&&(e.style.display="none",e.setAttribute("data-gd-hidden","true"))}}),e("button, a").forEach(t=>{(t.textContent||"").includes("Promotions")&&t.closest(".snipcart-cart-summary-item")&&(t.style.display="none")}),0===r.length)return void console.log("ℹ️ Aucune promotion à afficher");const s=t(".snipcart-cart-summary-item--subtotal",n)||t(".snipcart-summary-fees__item--subtotal",n)||t(".snipcart-cart-summary-item",n)||t(".snipcart-summary-fees__item",n)||Array.from(e("*",n)).find(t=>t.textContent?.toLowerCase().includes("sous-total"));if(!s)return void console.warn("⚠️ Ligne sous-total non trouvée");r.forEach((t,e)=>{const n="function"==typeof t.name?t.name():t.name,a="function"==typeof t.type?t.type():t.type,r="function"==typeof t.amountSaved?t.amountSaved():t.amountSaved,i="function"==typeof t.value?t.value():t.value;console.log(`🔍 Promotion ${e+1}:`,{name:n,type:a,amountSaved:r,value:i,raw:t});const c=document.createElement("div");c.className="__gd-promo-line snipcart-cart-summary-item",c.style.cssText="\n          display: flex !important;\n          justify-content: space-between;\n          align-items: center;\n          padding: 12px 0;\n          border-bottom: 1px solid var(--gd-border, rgba(255,255,255,0.1));\n          color: var(--gd-success, #10b981);\n          font-size: 0.95rem;\n        ";const l=document.createElement("span");l.className="__gd-promo-name",l.textContent=n||`Promotion ${e+1}`,l.style.cssText="\n          flex: 1;\n          font-weight: 500;\n          color: var(--gd-success, #10b981);\n        ";const u=document.createElement("span");u.className="__gd-promo-amount";let m="";console.log(`💰 Calcul montant promotion ${e+1}:`,{amountSaved:r,value:i,type:a}),m="FixedAmount"===a||r>0?`-${function(t,e="CAD"){try{return new Intl.NumberFormat("fr-CA",{style:"currency",currency:e}).format(t)}catch(n){return`${t.toFixed(2)} ${e}`}}(r,o.currency)}`:i>0?`-${(100*i).toFixed(0)}%`:"Appliqué",u.textContent=m,u.style.cssText="\n          font-weight: 600;\n          color: var(--gd-success, #10b981);\n        ",c.appendChild(l),c.appendChild(u),s.parentNode.insertBefore(c,s)}),console.log(`✅ ${r.length} promotion(s) affichée(s) dynamiquement`)}catch(t){console.error("Erreur lors de l'affichage des promotions:",t)}}!function(t){if(window.Snipcart&&window.Snipcart.events)return t();let e=0,n=!1;const o=()=>{n||(n=!0,document.removeEventListener("snipcart.ready",o),a&&clearInterval(a),t())};document.addEventListener("snipcart.ready",o);const a=setInterval(()=>{e++,window.Snipcart&&window.Snipcart.events?n||(n=!0,document.removeEventListener("snipcart.ready",o),clearInterval(a),t()):(e%20==0&&console.log(`Snipcart: attente... (${e/10}s)`,{snipcart:!!window.Snipcart,events:!(!window.Snipcart||!window.Snipcart.events)}),e>=100&&(console.error("Snipcart: échec de chargement après 10s"),n||(n=!0,document.removeEventListener("snipcart.ready",o),clearInterval(a)),setTimeout(()=>{console.warn("Snipcart: tentative d'initialisation forcée..."),t()},500)))},100)}(function(){try{if(!window.Snipcart)return void console.warn("⚠️ Snipcart non disponible lors de l'initialisation des customizations");localStorage.getItem("snipcartLanguage")&&window.Snipcart,o(),function(){const t=document.getElementById("snipcart");if(!t||t.__observerMounted)return;new MutationObserver(t=>{let o=!1;for(const a of t)"childList"===a.type&&(e(".snipcart-item-line",a.target).forEach(n),(a.target.classList?.contains("snipcart-cart-summary")||a.target.classList?.contains("snipcart-checkout__content--summary")||a.target.classList?.contains("snipcart-summary")||a.target.querySelector?.(".snipcart-cart-summary, .snipcart-checkout__content--summary, .snipcart-summary"))&&(o=!0));o&&setTimeout(a,50)}).observe(t,{subtree:!0,childList:!0}),t.__observerMounted=!0}(),a();const t=window.Snipcart?.events;t?.on&&["item.added","item.updated","cart.opened","cart.closed","cart.confirmed","discount.applied","discount.removed"].forEach(e=>{t.on(e,()=>{o(),setTimeout(a,100)})}),("#debug"===window.location.hash||window.location.search.includes("debug=1"))&&console.log("🎨 Snipcart customizations initialisées:",{api:!!window.Snipcart?.api,events:!!window.Snipcart?.events,store:!!window.Snipcart?.store})}catch(t){console.error("💥 Erreur lors de l'initialisation des customizations Snipcart:",t),console.error("État Snipcart:",{snipcart:!!window.Snipcart,api:!!window.Snipcart?.api,events:!!window.Snipcart?.events})}}),void 0!==window.addEventListener&&window.addEventListener("popstate",()=>{setTimeout(()=>{window.Snipcart&&window.Snipcart.events&&o()},100)})}();