!function(){const t=(t,e=document)=>e.querySelector(t),e=(t,e=document)=>Array.from(e.querySelectorAll(t));function n(e){!function(e){if(!e||"1"===e.dataset.trashMoved)return;const n=t(".snipcart-item-line__title",e)||t(".snipcart-item-line__information .snipcart__font--regular",e)||t("[data-item-name]",e),o=t(".snipcart-item-line__actions button",e)||t('[data-action="item:remove"]',e)||t("button.snipcart__button--icon",e)||t('button[title="Remove item"]',e);if(!n||!o)return;o.style.margin="0";let i=t(".__remove-left",e);i||(i=document.createElement("span"),i.className="__remove-left",i.style.display="inline-flex",i.style.alignItems="center",i.style.marginRight="8px"),n.parentNode.insertBefore(i,n),i.appendChild(o),e.dataset.trashMoved="1"}(e),function(e){if(!e)return;const n=t(".snipcart-item-line__quantity",e)||t("[data-item-quantity]",e)||e,o=t('input[type="number"]',n)||t('input[name="quantity"]',n);if(!o||o.closest(".__qty-stepped"))return;const i=document.createElement("div");i.className="__qty-stepped",i.style.display="inline-flex",i.style.alignItems="center",i.style.gap="6px";const a=(t,e)=>{const n=document.createElement("button");return n.type="button",n.className="__qty-btn gd-qty-button",n.setAttribute("aria-label",e),n.textContent=t,n},r=a("−","Diminuer la quantité"),s=a("+","Augmenter la quantité");o.classList.add("gd-qty-input"),n.insertBefore(i,o),i.appendChild(r),i.appendChild(o),i.appendChild(s);const c=()=>{o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0}))};r.addEventListener("click",()=>{const t=parseInt(o.step||"1",10),e=parseInt(o.min??"1",10),n=Math.max(e,parseInt(o.value||"1",10)-t);o.value=String(n),c()}),s.addEventListener("click",()=>{const t=parseInt(o.step||"1",10),e=o.max?parseInt(o.max,10):null;let n=parseInt(o.value||"1",10)+t;e&&(n=Math.min(e,n)),o.value=String(n),c()})}(e)}function o(){e(".snipcart-item-line").forEach(n)}function i(){try{const n=t(".snipcart-cart-summary")||t(".snipcart-checkout__content--summary")||t(".snipcart-summary")||t(".snipcart__box--summary")||t(".snipcart-summary-fees")||t('[class*="summary"]');if(!n){console.warn("⚠️ Section résumé du panier non trouvée");const t=e("*").find(t=>t.textContent?.toLowerCase().includes("sous-total"));return t?(console.log('✅ Élément contenant "sous-total" trouvé, utilisation du parent'),i.call(null,t.closest('[class*="summary"]')||t.parentElement)):void 0}const o=window.Snipcart?.store?.getState()?.cart;if(!o)return void console.warn("⚠️ Données du panier non disponibles");let a=o.discounts;if(console.log("🔍 cart.discounts brut:",a),console.log("🔍 Type de discounts:",typeof a,"IsArray:",Array.isArray(a)),Array.isArray(a)||(a=a&&"object"==typeof a?a.items&&Array.isArray(a.items)?a.items:a.discounts&&Array.isArray(a.discounts)?a.discounts:Object.values(a):[]),a=a.filter(t=>t&&(t.name||t.amount||t.rate)),a.sort((t,e)=>("FixedAmount"===("function"==typeof t.type?t.type():t.type)?0:1)-("FixedAmount"===("function"==typeof e.type?e.type():e.type)?0:1)),console.log("🔍 Promotions après traitement et tri:",a),e(".__gd-promo-line").forEach(t=>t.remove()),e(".snipcart-cart-summary-item, .snipcart-summary-fees__item").forEach(e=>{const n=e.textContent||"";if(n.includes("Promotions")||n.includes("Promotion")){const n=t(".snipcart-cart-summary-fees__amount",e)||t(".snipcart-summary-fees__amount",e);n&&n.textContent.includes("-")&&(e.style.display="none",e.setAttribute("data-gd-hidden","true"))}}),e("button, a").forEach(t=>{(t.textContent||"").includes("Promotions")&&t.closest(".snipcart-cart-summary-item")&&(t.style.display="none")}),0===a.length)return void console.log("ℹ️ Aucune promotion à afficher");const r=t(".snipcart-cart-summary-item--subtotal",n)||t(".snipcart-summary-fees__item--subtotal",n)||t(".snipcart-cart-summary-item",n)||t(".snipcart-summary-fees__item",n)||Array.from(e("*",n)).find(t=>t.textContent?.toLowerCase().includes("sous-total"));if(!r)return void console.warn("⚠️ Ligne sous-total non trouvée");a.forEach((t,e)=>{const n="function"==typeof t.name?t.name():t.name,i="function"==typeof t.type?t.type():t.type,a="function"==typeof t.amountSaved?t.amountSaved():t.amountSaved,s="function"==typeof t.value?t.value():t.value;console.log(`🔍 Promotion ${e+1}:`,{name:n,type:i,amountSaved:a,value:s,raw:t});const c=document.createElement("div");c.className="__gd-promo-line snipcart-cart-summary-item",c.style.cssText="\n          display: flex !important;\n          justify-content: space-between;\n          align-items: center;\n          padding: 12px 0;\n          border-bottom: 1px solid var(--gd-border, rgba(255,255,255,0.1));\n          color: var(--gd-success, #10b981);\n          font-size: 0.95rem;\n        ";const u=document.createElement("span");u.className="__gd-promo-name",u.textContent=n||`Promotion ${e+1}`,u.style.cssText="\n          flex: 1;\n          font-weight: 500;\n          color: var(--gd-success, #10b981);\n        ";const m=document.createElement("span");m.className="__gd-promo-amount";let l="";console.log(`💰 Calcul montant promotion ${e+1}:`,{amountSaved:a,value:s,type:i}),l="FixedAmount"===i||a>0?`-${function(t,e="CAD"){try{return new Intl.NumberFormat("fr-CA",{style:"currency",currency:e}).format(t)}catch(n){return`${t.toFixed(2)} ${e}`}}(a,o.currency)}`:s>0?`-${(100*s).toFixed(0)}%`:"Appliqué",m.textContent=l,m.style.cssText="\n          font-weight: 600;\n          color: var(--gd-success, #10b981);\n        ",c.appendChild(u),c.appendChild(m),r.parentNode.insertBefore(c,r)}),console.log(`✅ ${a.length} promotion(s) affichée(s) dynamiquement`)}catch(t){console.error("Erreur lors de l'affichage des promotions:",t)}}function a(t){let e="function"==typeof t.name?t.name():t.name;e=e.replace(/\s*\([^)]+\)\s*$/,"").trim();const n=t.customFields||[],o=[];return n.forEach(t=>{const e=("function"==typeof t.name?t.name():t.name)||"",n=("function"==typeof t.value?t.value():t.value)||"";e.toLowerCase().includes("métal")||e.toLowerCase().includes("metal")?o.push(n):(e.toLowerCase().includes("multiplicateur")||e.toLowerCase().includes("multiplier"))&&o.push(`×${n}`)}),o.length>0?`${e} (${o.join(" ")})`:e}function r(t,e){try{window.Snipcart?.api?.cart?.items?.update({uniqueId:t,name:e}),console.log(`✅ Nom mis à jour: ${e}`)}catch(t){console.warn("⚠️ Erreur mise à jour nom:",t)}}function s(){const t=window.Snipcart?.store?.getState()?.cart;if(!t)return;const n=t.items||[];e(".snipcart-summary-item__title, .snipcart__item__title, .snipcart-order-item__title").forEach(t=>{if("true"===t.dataset.gdVariationsInjected)return;const e=t.textContent.trim(),o=n.find(t=>{const n="function"==typeof t.name?t.name():t.name;return n.includes(e)||e.includes(n)});if(!o)return;const i=a(o);if(!e.includes("(")&&i!==e){const e=i.match(/\(([^)]+)\)/);if(e){const n=document.createElement("span");n.className="gd-item-variations",n.style.cssText="\n            color: #94a3b8;\n            font-weight: 400;\n            font-size: 0.9em;\n            margin-left: 0.25rem;\n          ",n.textContent=` (${e[1]})`,t.appendChild(n),t.dataset.gdVariationsInjected="true"}}})}!function(t){if(window.Snipcart&&window.Snipcart.events)return t();let e=0,n=!1;const o=()=>{n||(n=!0,document.removeEventListener("snipcart.ready",o),i&&clearInterval(i),t())};document.addEventListener("snipcart.ready",o);const i=setInterval(()=>{e++,window.Snipcart&&window.Snipcart.events?n||(n=!0,document.removeEventListener("snipcart.ready",o),clearInterval(i),t()):(e%20==0&&console.log(`Snipcart: attente... (${e/10}s)`,{snipcart:!!window.Snipcart,events:!(!window.Snipcart||!window.Snipcart.events)}),e>=100&&(console.error("Snipcart: échec de chargement après 10s"),n||(n=!0,document.removeEventListener("snipcart.ready",o),clearInterval(i)),setTimeout(()=>{console.warn("Snipcart: tentative d'initialisation forcée..."),t()},500)))},100)}(function(){try{if(!window.Snipcart)return void console.warn("⚠️ Snipcart non disponible lors de l'initialisation des customizations");localStorage.getItem("snipcartLanguage")&&window.Snipcart,o(),function(){const t=document.getElementById("snipcart");if(!t||t.__observerMounted)return;new MutationObserver(t=>{let o=!1;for(const i of t)"childList"===i.type&&(e(".snipcart-item-line",i.target).forEach(n),(i.target.classList?.contains("snipcart-cart-summary")||i.target.classList?.contains("snipcart-checkout__content--summary")||i.target.classList?.contains("snipcart-summary")||i.target.querySelector?.(".snipcart-cart-summary, .snipcart-checkout__content--summary, .snipcart-summary"))&&(o=!0));o&&setTimeout(i,50)}).observe(t,{subtree:!0,childList:!0}),t.__observerMounted=!0}(),i(),function(){try{const t=window.Snipcart?.events;if(!t)return void console.warn("⚠️ Events Snipcart non disponibles pour variations dynamiques");t.on("item.updated",t=>{const e=t.item||t,n="function"==typeof e.uniqueId?e.uniqueId():e.uniqueId,o=a(e);("function"==typeof e.name?e.name():e.name)!==o&&r(n,o)}),t.on("item.added",t=>{const e=t.item||t,n="function"==typeof e.uniqueId?e.uniqueId():e.uniqueId;setTimeout(()=>{const t=a(e);r(n,t)},100)}),t.on("page.change",()=>{setTimeout(s,200)}),t.on("cart.opened",()=>{setTimeout(s,200)});const e=document.getElementById("snipcart");e&&!e.__gdVariationsObserverMounted&&(new MutationObserver(t=>{let e=!1;for(const n of t)if("childList"===n.type&&Array.from(n.addedNodes).some(t=>1===t.nodeType&&(t.classList?.contains("snipcart-summary")||t.classList?.contains("snipcart-checkout__content--summary")||t.querySelector?.(".snipcart-summary, .snipcart-checkout__content--summary")))){e=!0;break}e&&setTimeout(s,50)}).observe(e,{childList:!0,subtree:!0}),e.__gdVariationsObserverMounted=!0),setTimeout(s,500),console.log("🎨 Système de variations dynamiques initialisé")}catch(t){console.error("💥 Erreur initialisation variations dynamiques:",t)}}();const t=window.Snipcart?.events;t?.on&&["item.added","item.updated","cart.opened","cart.closed","cart.confirmed","discount.applied","discount.removed"].forEach(e=>{t.on(e,()=>{o(),setTimeout(i,100)})}),("#debug"===window.location.hash||window.location.search.includes("debug=1"))&&console.log("🎨 Snipcart customizations initialisées:",{api:!!window.Snipcart?.api,events:!!window.Snipcart?.events,store:!!window.Snipcart?.store})}catch(t){console.error("💥 Erreur lors de l'initialisation des customizations Snipcart:",t),console.error("État Snipcart:",{snipcart:!!window.Snipcart,api:!!window.Snipcart?.api,events:!!window.Snipcart?.events})}}),void 0!==window.addEventListener&&window.addEventListener("popstate",()=>{setTimeout(()=>{window.Snipcart&&window.Snipcart.events&&o()},100)})}();