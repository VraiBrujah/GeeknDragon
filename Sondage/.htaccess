# Configuration Apache pour système de sondages OrIA

# Activer RewriteEngine
RewriteEngine On

# Bloquer accès aux fichiers sensibles
<FilesMatch "\.(json|md|gitignore)$">
    <IfModule mod_authz_core.c>
        # Apache 2.4
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        # Apache 2.2
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>

# Exception : permettre accès aux .md dans /sondages/ via API uniquement
<Files "*.md">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
</Files>

# Bloquer accès direct aux dossiers reponses et sondages
RedirectMatch 403 ^/reponses/.*
RedirectMatch 403 ^/sondages/.*

# Page d'index par défaut
DirectoryIndex index.php

# Headers de sécurité
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "DENY"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"

    # CSP pour sécurité accrue
    Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; connect-src 'self';"
</IfModule>

# Compression gzip
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# Cache control
<IfModule mod_expires.c>
    ExpiresActive On

    # Assets statiques (long cache)
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType image/webp "access plus 1 year"

    # API et HTML (pas de cache)
    ExpiresByType text/html "access plus 0 seconds"
    ExpiresByType application/json "access plus 0 seconds"
</IfModule>

# Empêcher listing des dossiers
Options -Indexes

# Encodage UTF-8 par défaut
AddDefaultCharset UTF-8
