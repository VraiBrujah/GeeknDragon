<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Calculateur GeeknDragon</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            color: var(--light-text);
        }
        .test-section {
            margin-bottom: 3rem;
            padding: 2rem;
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 8px;
        }
        .test-input {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            align-items: center;
        }
        .test-input input {
            padding: 0.5rem;
            border-radius: 4px;
            border: 1px solid var(--secondary-color);
            background: var(--dark-bg);
            color: var(--light-text);
        }
        .test-input button {
            padding: 0.5rem 1rem;
            background: var(--gradient-secondary);
            color: var(--dark-bg);
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-results {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
        }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üßÆ Test du Calculateur Intelligent GeeknDragon</h1>
        
        <div class="test-section">
            <h2>Test Rapide</h2>
            <div class="test-input">
                <label>Tr√©sor en pi√®ces d'or :</label>
                <input type="number" id="testGoldInput" value="847" min="0">
                <button onclick="testQuick()">Calculer Recommandations</button>
            </div>
            <div id="testResults" class="test-results"></div>
        </div>

        <div class="test-section">
            <h2>Calculateur Complet</h2>
            <div id="currency-converter">
                <h4>Convertisseur de monnaie</h4>
                <div class="converter-inputs">
                    <p>Monnaies sources</p>
                    <table id="currency-sources">
                        <thead>
                            <tr>
                                <th>pi√®ce de cuivre</th>
                                <th>pi√®ce d'argent</th>
                                <th>pi√®ce d'√©lectrum</th>
                                <th>pi√®ce d'or</th>
                                <th>pi√®ce de platine</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="number" min="0" step="1" value="0" data-currency="copper"></td>
                                <td><input type="number" min="0" step="1" value="0" data-currency="silver"></td>
                                <td><input type="number" min="0" step="1" value="0" data-currency="electrum"></td>
                                <td><input type="number" min="0" step="1" value="1847" data-currency="gold"></td>
                                <td><input type="number" min="0" step="1" value="0" data-currency="platinum"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div id="currency-equivalences" class="hidden">
                    <h5>√âquivalences par monnaie</h5>
                    <table id="currency-equivalences-list">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>√âquivalence</th>
                                <th>Reste</th>
                                <th>Nombre total de pi√®ces</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                        <tfoot>
                            <tr class="totals-header">
                                <th></th>
                                <th>Total :</th>
                                <th>Total en or</th>
                                <th>Nombre total de pi√®ces :</th>
                            </tr>
                            <tr class="totals-values">
                                <td></td>
                                <td id="currency-total-breakdown"></td>
                                <td id="currency-total-gold"></td>
                                <td id="currency-total-pieces"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>

            <!-- Section Recommandations -->
            <div id="gd-recommendations" class="hidden">
                <h3>üéí Lots Geek&Dragon Recommand√©s</h3>
                <div class="gd-recommendations-content">
                    <!-- Contenu g√©n√©r√© dynamiquement -->
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>Cas de Test Pr√©d√©finis</h2>
            <div style="display: grid; gap: 1rem; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                <button onclick="testCase(50)" class="btn-secondary">50 po (Petit tr√©sor)</button>
                <button onclick="testCase(185)" class="btn-secondary">185 po (Moyen)</button>
                <button onclick="testCase(847)" class="btn-secondary">847 po (Grand)</button>
                <button onclick="testCase(2350)" class="btn-secondary">2,350 po (√ânorme)</button>
                <button onclick="testCase(10000)" class="btn-secondary">10,000 po (L√©gendaire)</button>
            </div>
        </div>
    </div>

    <script>
        // Variables globales pour les tests
        window.SNIPCART_API_KEY = 'test_key';
        
        // Mock Snipcart pour les tests
        window.Snipcart = {
            api: {
                cart: {
                    items: {
                        add: function(item) {
                            console.log('üõí Produit ajout√© au panier Snipcart (mock):', item);
                            // Simuler un d√©lai
                            setTimeout(() => {
                                console.log('‚úÖ Ajout confirm√©');
                            }, 100);
                        }
                    }
                }
            }
        };
        
        // Fonctions de test
        function testQuick() {
            const goldAmount = parseInt(document.getElementById('testGoldInput').value) || 0;
            const copperValue = goldAmount * 100; // Conversion en pi√®ces de cuivre
            
            // Simuler les recommandations (copie de la logique du calculateur)
            const recommendations = generateTestRecommendations(copperValue);
            
            const resultsDiv = document.getElementById('testResults');
            if (recommendations.length === 0) {
                resultsDiv.innerHTML = '<p>Aucune recommandation pour ce montant</p>';
                return;
            }
            
            let html = `<h4>Recommandations pour ${goldAmount} po (${copperValue} pc) :</h4>`;
            recommendations.forEach((rec, index) => {
                html += `
                    <div style="margin: 1rem 0; padding: 1rem; border: 1px solid var(--secondary-color); border-radius: 4px;">
                        <strong>${index + 1}. ${rec.label}</strong> - ${rec.lot.price}$ CAD<br>
                        Capacit√©: ${Math.floor(rec.capacity / 100)} po (+${rec.marginPercent.toFixed(0)}% marge)<br>
                        Efficacit√©: ${rec.efficiency.toFixed(1)}%<br>
                        ${rec.breakdown.breakdown.length > 0 ? 'D√©composition: ' + rec.breakdown.breakdown.map(b => 
                            `${b.quantity} ${b.coin}${b.multiplier > 1 ? ' x' + b.multiplier : ''}`
                        ).join(', ') : ''}
                    </div>
                `;
            });
            resultsDiv.innerHTML = html;
        }
        
        function testCase(goldAmount) {
            // Remplir les champs du calculateur
            document.querySelector('input[data-currency="copper"]').value = 0;
            document.querySelector('input[data-currency="silver"]').value = 0;
            document.querySelector('input[data-currency="electrum"]').value = 0;
            document.querySelector('input[data-currency="gold"]').value = goldAmount;
            document.querySelector('input[data-currency="platinum"]').value = 0;
            
            // D√©clencher le recalcul
            if (window.render) {
                window.render();
            } else {
                // D√©clencher un √©v√©nement input sur le champ or
                const goldInput = document.querySelector('input[data-currency="gold"]');
                goldInput.dispatchEvent(new Event('input', { bubbles: true }));
            }
        }
        
        // Fonction simplifi√©e pour g√©n√©rer des recommandations de test
        function generateTestRecommendations(copperValue) {
            const rates = { copper: 1, silver: 10, electrum: 50, gold: 100, platinum: 1000 };
            const lots = {
                'lot10': { name: "L'Offrande du Voyageur", price: 60, pieces: { copper: 2, silver: 2, electrum: 2, gold: 2, platinum: 2 }, multiplierChoice: true },
                'lot25': { name: "La Monnaie des Cinq Royaumes", price: 145, pieces: { copper: 5, silver: 5, electrum: 5, gold: 5, platinum: 5 }, multiplierChoice: false },
                'lot50-essence': { name: "L'Essence du Marchand", price: 275, pieces: { copper: 10, silver: 10, electrum: 10, gold: 10, platinum: 10 }, multiplierChoice: false },
                'lot50-tresorerie': { name: "La Tr√©sorerie du Seigneur", price: 275, pieces: { copper: 10, silver: 10, electrum: 10, gold: 10, platinum: 10 }, multiplierChoice: true }
            };
            
            const recommendations = [];
            
            Object.values(lots).forEach(lot => {
                if (lot.multiplierChoice) {
                    [1, 10, 100, 1000, 10000].forEach(mult => {
                        const capacity = lot.pieces.platinum * rates.platinum * mult;
                        if (capacity >= copperValue) {
                            recommendations.push({
                                lot,
                                multiplier: mult,
                                capacity,
                                breakdown: { breakdown: [], coverage: 95 },
                                efficiency: 95,
                                marginPercent: ((capacity - copperValue) / copperValue) * 100,
                                label: `${lot.name} (x${mult})`
                            });
                        }
                    });
                } else {
                    const capacity = lot.pieces.platinum * rates.platinum * 10000;
                    if (capacity >= copperValue) {
                        recommendations.push({
                            lot,
                            multiplier: null,
                            capacity,
                            breakdown: { breakdown: [], coverage: 95 },
                            efficiency: 95,
                            marginPercent: ((capacity - copperValue) / copperValue) * 100,
                            label: lot.name
                        });
                    }
                }
            });
            
            // Trier par prix
            recommendations.sort((a, b) => a.lot.price - b.lot.price);
            return recommendations.slice(0, 3);
        }
    </script>
    
    <!-- Charger le calculateur principal -->
    <script src="js/currency-converter.js"></script>
</body>
</html>